<!DOCTYPE html>
<html lang="fr">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="apple-touch-icon" href="https://virtual-thom.github.io/archives/apple-touch-icon.png">
  <link rel="icon" href="https://virtual-thom.github.io/archives/favicon.ico" />
  <!-- Remplacé par Jekyll SEO (sinon apparait en double)
  <title>Virtual-Thom | Blog-notes VTOM et informatique</title>
  <meta name="description" content="Blog-notes VTOM, informatique, industrialisation, ordonnancement, DevOps">
  --> 
  
  <link rel="canonical" href="https://virtual-thom.github.io/archives/page9/">
  
  <link rel="stylesheet" media="screen" href="https://virtual-thom.github.io/archives/assets/main.css">
  
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Page 9 of 14 for Virtual-Thom Blog-notes VTOM et informatique | Blog-notes VTOM, informatique, industrialisation, ordonnancement, DevOps</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Virtual-Thom Blog-notes VTOM et informatique" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Blog-notes VTOM, informatique, industrialisation, ordonnancement, DevOps" />
<meta property="og:description" content="Blog-notes VTOM, informatique, industrialisation, ordonnancement, DevOps" />
<link rel="canonical" href="https://virtual-thom.github.io/archives/page9/" />
<meta property="og:url" content="https://virtual-thom.github.io/archives/page9/" />
<meta property="og:site_name" content="Virtual-Thom Blog-notes VTOM et informatique" />
<meta property="og:type" content="website" />
<link rel="prev" href="https://virtual-thom.github.io/archives/page8" />
<link rel="next" href="https://virtual-thom.github.io/archives/page10" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Virtual-Thom Blog-notes VTOM et informatique" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Blog-notes VTOM, informatique, industrialisation, ordonnancement, DevOps","headline":"Virtual-Thom Blog-notes VTOM et informatique","url":"https://virtual-thom.github.io/archives/page9/"}</script>
<!-- End Jekyll SEO tag -->

  
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Z8Y7902GRV"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Z8Y7902GRV');
</script>


  <body>
    <div class="container">
      <header id="site-header">
  <h1>Blog-notes VTOM, informatique, industrialisation, ordonnancement, DevOps</h1>
  <nav>
    <ul>
      <li>
        <a href="https://virtual-thom.github.io/archives" title="Home">
          <svg class="svg-icon" viewBox="0 0 20 20">
            <path d="M18.121,9.88l-7.832-7.836c-0.155-0.158-0.428-0.155-0.584,0L1.842,9.913c-0.262,0.263-0.073,0.705,0.292,0.705h2.069v7.042c0,0.227,0.187,0.414,0.414,0.414h3.725c0.228,0,0.414-0.188,0.414-0.414v-3.313h2.483v3.313c0,0.227,0.187,0.414,0.413,0.414h3.726c0.229,0,0.414-0.188,0.414-0.414v-7.042h2.068h0.004C18.331,10.617,18.389,10.146,18.121,9.88 M14.963,17.245h-2.896v-3.313c0-0.229-0.186-0.415-0.414-0.415H8.342c-0.228,0-0.414,0.187-0.414,0.415v3.313H5.032v-6.628h9.931V17.245z M3.133,9.79l6.864-6.868l6.867,6.868H3.133z"></path>
          </svg>
        </a>
      </li>
      <li>
        <a href="https://virtual-thom.github.io/archives/vos-commentaires-livre-d-or/" title="Commentaires - livre d'or">
          <svg class="svg-icon" viewBox="0 0 20 20">
            <path d="M17.657,2.982H2.342c-0.234,0-0.425,0.191-0.425,0.426v10.21c0,0.234,0.191,0.426,0.425,0.426h3.404v2.553c0,0.397,0.48,0.547,0.725,0.302l2.889-2.854h8.298c0.234,0,0.426-0.191,0.426-0.426V3.408C18.083,3.174,17.892,2.982,17.657,2.982M17.232,13.192H9.185c-0.113,0-0.219,0.045-0.3,0.124l-2.289,2.262v-1.96c0-0.233-0.191-0.426-0.425-0.426H2.767V3.833h14.465V13.192z M10,7.237c-0.821,0-1.489,0.668-1.489,1.489c0,0.821,0.668,1.489,1.489,1.489c0.821,0,1.488-0.668,1.488-1.489C11.488,7.905,10.821,7.237,10,7.237 M10,9.364c-0.352,0-0.638-0.288-0.638-0.638c0-0.351,0.287-0.638,0.638-0.638c0.351,0,0.638,0.287,0.638,0.638C10.638,9.077,10.351,9.364,10,9.364 M14.254,7.237c-0.821,0-1.489,0.668-1.489,1.489c0,0.821,0.668,1.489,1.489,1.489s1.489-0.668,1.489-1.489C15.743,7.905,15.075,7.237,14.254,7.237 M14.254,9.364c-0.351,0-0.638-0.288-0.638-0.638c0-0.351,0.287-0.638,0.638-0.638c0.352,0,0.639,0.287,0.639,0.638C14.893,9.077,14.605,9.364,14.254,9.364 M5.746,7.237c-0.821,0-1.489,0.668-1.489,1.489c0,0.821,0.668,1.489,1.489,1.489c0.821,0,1.489-0.668,1.489-1.489C7.234,7.905,6.566,7.237,5.746,7.237 M5.746,9.364c-0.351,0-0.638-0.288-0.638-0.638c0-0.351,0.287-0.638,0.638-0.638c0.351,0,0.638,0.287,0.638,0.638C6.384,9.077,6.096,9.364,5.746,9.364"></path>
          </svg>
        </a>
      </li>
      
      <li>
        <a href="https://virtual-thom.github.io/about" title="Curriculum Vitae Thom">
          <svg class="svg-icon" viewBox="0 0 20 20">
            <path d="M12.075,10.812c1.358-0.853,2.242-2.507,2.242-4.037c0-2.181-1.795-4.618-4.198-4.618S5.921,4.594,5.921,6.775c0,1.53,0.884,3.185,2.242,4.037c-3.222,0.865-5.6,3.807-5.6,7.298c0,0.23,0.189,0.42,0.42,0.42h14.273c0.23,0,0.42-0.189,0.42-0.42C17.676,14.619,15.297,11.677,12.075,10.812 M6.761,6.775c0-2.162,1.773-3.778,3.358-3.778s3.359,1.616,3.359,3.778c0,2.162-1.774,3.778-3.359,3.778S6.761,8.937,6.761,6.775 M3.415,17.69c0.218-3.51,3.142-6.297,6.704-6.297c3.562,0,6.486,2.787,6.705,6.297H3.415z"></path>
          </svg>
        </a>
      </li>
    </ul>
  </nav>
</header>

      <nav>
  <ul class="pagination">
    
    <li>
      <a href="/page8" class="Précédant">
        <span aria-hidden="true">&laquo;</span>
      </a>
    </li>
      
    <li>
      <a href="/archives/index.html">1</a>
    </li>
      
    <li>
      <a
        href="/archives/page2">2</a>
    </li>
      
    <li>
      <a
        href="/archives/page3">3</a>
    </li>
      
    <li>
      <a
        href="/archives/page4">4</a>
    </li>
      
    <li>
      <a
        href="/archives/page5">5</a>
    </li>
      
    <li>
      <a
        href="/archives/page6">6</a>
    </li>
      
    <li>
      <a
        href="/archives/page7">7</a>
    </li>
      
    <li>
      <a
        href="/archives/page8">8</a>
    </li>
      
    <li class="active">
      <span>9</span>
    </li>
      
    <li>
      <a
        href="/archives/page10">10</a>
    </li>
      
    <li>
      <a
        href="/archives/page11">11</a>
    </li>
      
    <li>
      <a
        href="/archives/page12">12</a>
    </li>
      
    <li>
      <a
        href="/archives/page13">13</a>
    </li>
      
    <li>
      <a
        href="/archives/page14">14</a>
    </li>
      
    <li>
      <a href="/page10" aria-label="Suivant">
        <span aria-hidden="true">&raquo;</span>
      </a>
    </li>
    
  </ul>
</nav>
<ul class="post-list post-list-with-type">
  
  <li>
    <a class="post-link" href="/archives/options-tengine-vtom/">Toutes les options du tengine</a>
  </li>
  
  <li>
    <a class="post-link" href="/archives/vtom-5-8-nouvelle-version/">VTOM version 5.8</a>
  </li>
  
  <li>
    <a class="post-link" href="/archives/control-m-feedback-a-chaud/">Control-M Premiers ressentis après 2 semaines d'utilisation</a>
  </li>
  
  <li>
    <a class="post-link" href="/archives/port-30004-listening-error/">Port 30004 encore en LISTENING malgré l'arrêt du client VTOM</a>
  </li>
  
  <li>
    <a class="post-link" href="/archives/docker-installation-serveur-vtom-test/">Docker première approche - déploiement serveur VTOM test</a>
  </li>
  
  <li>
    <a class="post-link" href="/archives/correlation-entre-jobs-vtom-et-policy-netbackup/">Corrélation entre les jobs VTOM et les policy netbackup</a>
  </li>
  
  <li>
    <a class="post-link" href="/archives/sh-lister-tous-les-fichiers-sauf-les-deux-derniers/">Shell Lister tous les fichiers sauf les x derniers</a>
  </li>
  
  <li>
    <a class="post-link" href="/archives/les-bizarreries-de-la-semaine/">les bizarreries de la semaine</a>
  </li>
  
  <li>
    <a class="post-link" href="/archives/vtaddjob-vtom-ajouter-une-ressource/">VTOM ajouter une ressource en mode commande</a>
  </li>
  
  <li>
    <a class="post-link" href="/archives/nas-lister-nfs-export-depuis-un-client-unix/">Lister les nfs export d'un NAS à partir d'un client Unix</a>
  </li>
  
</ul>


<div id="page-first-post">

  <div itemscope itemtype="http://schema.org/Article" class="post">

    <article class="post-content" itemprop="articleBody">
      <h1 itemprop="name about headline" class="post-title">Toutes les options du tengine</h1>
      <p>Une astuce de Fred, simple mais efficace, pour connaitre toutes les options possibles (du vtom.ini) de votre tengine (moteur VTOM) quand on n’a pas la documentation sous la main.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>strings $TOM_BIN/tengine 
</code></pre></div></div>

<p>Faites un grep sur le “= [” par exemple</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ strings $TOM_BIN/tengine | grep "= \["
GNSP                        = [%s]
useTz                       = [%d]
AcceptOrItems               = [%s]
AcceptAlphaStep             = [%s]
AdresseIP                   = [%s]
FQDNHostName                = [%s]
DateSystResetAll            = [%s]
AppCheckDateValue           = [%s]
JobCheckDateValue           = [%s]
JobBlockDateSyst            = [%s]
ManualRecovery              = [%s]
stats                       = [%s]
delaiWait                   = [%ds]
deplan_obj                  = [%s]
force_stats                 = [%s]
relanceAppCycliqueEnErreur  = [%s]
relanceJobCycliqueEnErreur  = [%s]
resnopla                    = [%s]
statusFailExist             = [%s]
statusFailSubmit            = [%s]
statusPileOne               = [%s]
statusPileAll               = [%s]
modeExecApp                 = [%s]
tagScript                   = [%s]
timeBexist                  = [%ds]
timeoutResGen               = [%ds]
nbJoursRattrapage           = [%d]
DelayHostVtSecure           = [%ds]
secureEngineTimeout         = [%ds]
blacklistCmd                = [%s]
useLinkBeforeEndTime        = [%d]
JobCheckAppConstraints      = [%d]
TRACE_FILE                  = [%s]
TRACE_FILE_COUNT            = [%d]
TRACE_FILE_SIZE             = [%dKo]
TRACE_LEVEL                 = [%d]
TRACE_SOURCE                = [%s]
TRACE_STDOUT                = [%s]
NbRetryDServerUnavailable           = [%d]
TimetoWaitRetryDServerUnavailable   = [%d]
appDisplayHeader            = [%s]
envDisplayHeader            = [%s]
tellClose                   = [%s]
tellDate                    = [%s]
tellFormat                  = [%s]
tellStatus                  = [%s]
- data..... array of %d %s = [
Next Cron     = [ %s (%d) ]
Next Cron     = [ none ]
</code></pre></div></div>

      (voir plus)
      <a class="post-link" href="/archives/options-tengine-vtom/">Toutes les options du tengine</a>
      <p class="post-meta">
        <time class="post-meta" itemprop="datePublished dateModified"
          datetime="2016-02-20T22:44:00+00:00">20-02-2016</time>
      </p>
    </article>
  </div>
</div>




















<ul class="post-list">
  
  
  
  
  <li>
    <div class="card">
      <h4><a class="post-link" href="/archives/vtom-5-8-nouvelle-version/">VTOM version 5.8</a></h4>
      <p><p>Bravo aux équipes d’Absyss (gros clin d’oeil à mon DukeAstar) pour cette nouvelle version 5.8 ! 
C’est incroyable comment le produit évolue dans le bon sens (c’est à dire, le notre :O).</p>

<p>Les deux évolutions que j’adoooooooooore :</p>

<h2 id="variables-denvironnement-personnalisables">variables d’environnement personnalisables</h2>

<p>Enfin !!! On peut désormais passer des variables personnalisables aux traitements.</p>

<p>Elles sont accessibles comme n’importe quelle variable d’environnement. <strong>LOVE</strong></p>

<p>Cerise sur le gâteau, on peut utiliser les variables directement dans le champ script ou paramètre <strong>TRIPLE LOVE</strong></p>

<p><img src="https://virtual-thom.github.io/archives/assets/img/variable_perso_vtom_v5.8.jpg" alt="variable_perso_vtom_v5.8" /></p>

<h2 id="unité-de-soumission">unité de soumission</h2>

<p>Alors là, chapeau.</p>

<p>Prenons l’exemple qu’on a tous fait : on veut purger le répertoire logs de VTOM sur tous nos clients VTOM.</p>

<h3 id="avant-">AVANT :</h3>

<p>On crée une application (ou plusieurs regroupées par plateformes par exemple) avec des myriades de jobs lançant le même script de purge sur tous nos clients.</p>

<h3 id="avec-la-version-vtom--58--">avec la version VTOM &gt; 5.8  :</h3>

<p>Lorsqu’on définit un nouvel agent VTOM, on peut aussi créer une unité de soumission.</p>

<p>Par défaut, si on fait du 1 pour 1, on aura la même unité de soumission que l’agent définit.</p>

<p>Mais on peut aussi regrouper les agents dans une même unité de soumission.</p>

<p><img src="https://virtual-thom.github.io/archives/assets/img/unite_de_soumission_vtom_v5.8.JPG" alt="unite_de_soumission_vtom_v5.8" /></p>

<p>J’appelle mon unité de soumission PROD_PAIE_UNIX, par exemple, afin d’y regrouper tous mes agents Unix de l’application de PAIE, pour l’environnement de PROD.</p>

<p>Je crée un seul job avec mon script de purge avec cette unité de soumission. Et voilà ! tous mes jobs de purges sont définis.</p>

<p>En mode pilotage, si on double clique sur le job, on a accès à une sorte de “suivi d’exploitation” avec les différents agents et le statut.</p>

<p><img src="https://virtual-thom.github.io/archives/assets/img/suivi_exploitation_unite_de_soumission_vtom_v5.8.JPG" alt="suivi_exploitation_unite_de_soumission_vtom_v5.8" /></p>

<p>On double clique sur une ligne et on a les logs d’exécution de l’agent final en question.</p>

<p>On peut aussi faire un clique droit sur un agent spécifique et relancer le traitement uniquement sur cette machine.</p>

<h2 id="what-else-">What Else ?</h2>

<ul>
  <li>En plus, je trouve l’interface de plus en plus belle et rapide.</li>
</ul>

<p>On peut vraiment paufiner les représentations graphiques (pour moi, il manque encore la possiblité de réorganiser les différents éléments graphiques à différents plans - premier plan, arrière plan, augmenter ou diminuer de plan graphique)</p>

<ul>
  <li>ah une autre évolution que j’aime bien : on peut définir une heure de bascule sur les dates d’exploitation (exemple on veut une journée d’exploitation de 14h à 14h J+1, on n’est plus obligé de créer une application qui attend 37:59:00 !</li>
</ul>
</p>
      
    </div>

  </li>
  
  
  
  <li>
    <div class="card">
      <h4><a class="post-link" href="/archives/control-m-feedback-a-chaud/">Control-M Premiers ressentis après 2 semaines d'utilisation</a></h4>
      <p><p>Après les premiers jours de formation sur Control-M, j’étais très enthousiaste !</p>

<p>Je ne sais pas si c’était la nouveauté ou les possibilités natives du produit qui m’ont séduites mais, au début, j’étais conquis.</p>

<p>Ce que j’ai apprécié (v8 pour info) :</p>

<ul>
  <li>le Do Action : on peut parser la log output directement, ajouter des conditions poussées, dire que le job est OK ou KO sur certaines conditions etc. etc.</li>
  <li>les liens : les liens sont textuels (même s’il y a une représentation graphique) ! alors c’est bien et c’est pas bien (parceque ça complique) mais je trouve ça très puissant</li>
  <li>les cycles : beaucoup d’options sympathiques (on peut relancer le cycle sur le début, la fin d’exécution par exemple), on peut spécifier le nombre de reruns etc.</li>
  <li>le module “planning” : c’est là qu’on effectue la conception et modélisation des jobs. Je trouve le module bien fait, on peut s’attribuer l’exclusivité de modification d’un folder, n’appliquer les modifications que lorsqu’on le souhaite etc.</li>
  <li>Les champs scripts “command line” : on peut écrire les commandes en ligne directement dans un champ texte</li>
  <li>les variables qu’on peut utiliser directement dans les commandline, ou dans les paramètres</li>
  <li>les modifications qu’on ne peut effectuer que sur le plan en cours</li>
  <li>module d’interface avec SAP pratique : on peut lister et sélectionner les programmes ABAP et variantes directement</li>
</ul>

<p>Bon, le problème, c’est le reste de la semaine et la semaine d’après … Quand j’ai commencé à utiliser le produit réellement pour modéliser et régler les premiers problèmes d’exploitation.</p>

<p>Ca fait deux semaines que je pète un câble sur l’exploitation de control-m.</p>

<p>Par exemple, on ne peut pas voir le plan dans sa globalité. On ne voit que le plan du jour dans le module “Monitoring” ou les plans passés dans le module “History”, a moins de faire du “Forecast” (en gros on monte fictivement un plan à une date future donnée).</p>

<p>Autre exemple, on ne peut voir les log d’exécution que de la journée en cours dans le “Monitoring”. Pas moyen, non plus de voir le script en direct depuis l’outil …</p>

<p>Le pire reste la visualisation du plan :</p>

<p>Imaginez que toutes les applications de tous vos environnements VTOM se retrouvent dans un seul et même plan et que la disposition ne soit pas définie comme vous le souhaitiez (un peu n’importe comment d’ailleurs) et que les liens partent dans tous les sens.</p>

<p>Après deux semaines d’intense utilisation sur Control-M pour un nouveau projet (migration de TNG à Control-M), je reviens sur mes premiers instants de découverte pendant lesquels j’ai vraiment apprécié le produit.</p>

<p>Autant j’apprécie toujours la conception et les possibilités de Control-M, autant l’exploitation et l’utilisation quotidienne du produit est une vraie tannée (surtout que mon Control-M Desktop plante toutes les 10 minutes et présente des lenteurs vraiment contraignantes).</p>

<p>Au final, rien qu’on ne puisse pas faire avec VTOM si ce n’est quelques lignes de code pour gérer tel ou tel envoi de mail ou parsing de log pour pallier aux options natives de Control-M.</p>

<p>Bref, vive VTOM !</p>
</p>
      
    </div>

  </li>
  
  
  
  <li>
    <div class="card">
      <h4><a class="post-link" href="/archives/port-30004-listening-error/">Port 30004 encore en LISTENING malgré l'arrêt du client VTOM</a></h4>
      <p><p>J’ai eu ce bug récemment : je stoppe le client VTOM, je le restart et plus aucune communication n’est possible.</p>

<h2 id="symptômes">Symptômes</h2>
<ul>
  <li>Le <code class="language-plaintext highlighter-rouge">bstat</code> pour connaitre le statut du client VTOM ne répond pas.</li>
  <li>Client à STOP dans le suivi des clients VTOM.</li>
  <li><code class="language-plaintext highlighter-rouge">netstat -ano | grep 30004</code> donne des ports en LISTENING alors que le bdaemon est arrêté et les process ID n’existent plus</li>
</ul>

<h2 id="solution-">Solution :</h2>
<p>kill les process WerFault.exe (passer en surbrillance sur le process et vous verrez les PID donnés dans le <code class="language-plaintext highlighter-rouge">netstat -ano</code>)</p>

<p>Ca vous permetra de ne pas reboot votre serveur pour rien !</p>
</p>
      
    </div>

  </li>
  
  
  
  <li>
    <div class="card">
      <h4><a class="post-link" href="/archives/docker-installation-serveur-vtom-test/">Docker première approche - déploiement serveur VTOM test</a></h4>
      <p><h2 id="but-et-explication-docker">But et explication Docker</h2>
<p>Pour faire simple, Docker va me permettre de déployer un serveur VTOM de test pour mes scripts.</p>

<p>(en fait, j’utilisais docker sans le savoir quand je déployais mes applications via Openshift de RedHat)</p>

<p>Docker se base sur une image qui va être montée en r/o (dans mon cas une debian) grâce à la couche OS de la machine qui fait tourner Docker Engine.</p>

<p>Puis, lors qu’on RUN l’image, il monte une surcouche UnionFS en r/w.
Le tout, monté, s’appelle un conteneur.</p>

<p>En fait, la notion de conteneur semble exister depuis pas mal de temps. Mais Docker arrive à banaliser les opérations de création, déploiement, et de gestion. (pas beaucoup de lignes de commandes, très faciles à appréhender et utilisables par tous)</p>

<p>Le conteneur n’est autre qu’un genre d’OS avec l’application qu’on aura déployée dessus.</p>

<p>On est bien d’accord que ça n’est pas réellement un OS puisqu’il s’appuie sur l’OS du host et qu’il ne fait que charger les librairies/binaires et l’application qu’on aura éventuellement configurée ; tout ça grâce au Docker Engine.</p>

<p><a href="https://www.docker.com/whatisdocker">Illustration très claire de ce qu’est Docker</a></p>

<p>Lorsqu’on quittera le conteneur, tout le travail effectué aura disparu.</p>

<p>Plusieurs solutions si on veut garder les modifications :</p>

<ul>
  <li>si c’est propre à l’OS ou de la configuration applicative, on va valider notre conteneur (commit) pour en faire une image</li>
  <li>si c’est plus pour sauvegarder et utiliser des fichiers, on va créer un dossier partagé entre le host et l’image. On peut aussi partager des volumes entre les conteneurs avec les <a href="https://docs.docker.com/userguide/dockervolumes">Data Volumes</a></li>
</ul>

<p>Je fais ça pour éviter d’avoir à ré-installer à la main à chaque fois un environenement de test avec la licence qui expire au bout de 30 jours.
On pourra aussi scripter le déploiement d’une licence particulière ou d’une base VTOM (ou vtimport pourquoi pas).</p>

<p>Si vous voulez une intro en français de Docker, voici une vidéo qui dégrossit bien le concept :
<a href="http://www.grafikart.fr/tutoriels/docker/docker-intro-634">video Grafikart</a></p>

<p>Autre lien vers un post de mon ami Werner BEROUX qui bosse chez Google : <a href="http://beroux.com/english/articles/kubernetes/">Kubernetes / Docker</a></p>

<h2 id="mode-opératoire">Mode opératoire</h2>

<h3 id="first-things-firt---installation-de-docker">First things firt - Installation de Docker</h3>
<p><a href="https://docs.docker.com/installation">Installation Docker</a></p>

<p>En gros, soit on installe Docker engine sur un linux, soit on installe <a href="https://www.docker.com/toolbox">Docker ToolBox</a> sur Windows. Cela dit, il ne fait qu’installer Virtualbox avec une mini VM Linux avec Docker installé dessus.</p>

<h3 id="clone-de-mon-repo-docker_vtom-dans-votre-répertoire">Clone de mon repo Docker_VTOM dans votre répertoire</h3>
<p><code class="language-plaintext highlighter-rouge">git clone https://github.com/virtual-thom/Docker_VTOM.git</code></p>

<h3 id="ajout-de-vos-sources-dinstallation-serveur--client-vtom-dans-le-répertoire-ses">Ajout de vos sources d’installation SERVEUR + CLIENT VTOM dans le répertoire SES</h3>

<p>Copier simplement les sources VT-SES-&lt;votre OS, votre version&gt; et VT-CS-&lt;votre OS, votre version&gt; depuis votre CD-ROM VTOM vers le répertoire SES/ clôné.
Au besoin, modifier le script SES/dockerinit.ksh</p>

<h3 id="paramétrer-le-fichier-dockerfile-ainsi-que-le-install_vtomini-comme-on-le-souhaite">Paramétrer le fichier Dockerfile ainsi que le install_vtom.ini comme on le souhaite</h3>

<p>J’ai mis des options et des paths par défaut d’installation de VTOM. Il suffit d’ouvrir ces deux fichiers Dockerfile et install_vtom.ini pour comprendre.</p>

<p>Dockerfile</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># On se base sur l'image de la dernière debian
FROM debian:latest 

MAINTAINER Virtual Thom &lt;virtual-thom@protonmail.com&gt;

# L'installation de VTOM nécessite ksh
RUN apt-get update
RUN apt-get install ksh

# On créé le répertoire d'installation de VTOM
RUN mkdir /opt/vtom 
# On créé le user d'administration vtom
RUN useradd -d /opt/vtom -s /usr/bin/ksh vtom
RUN chown vtom /opt/vtom

# On prépare les répertoires pour acceuilir les sources d'installation de VTOM
RUN mkdir /sources
RUN mkdir /sources/SES

# On copie les fichiers du repo dans SES/
COPY SES /sources/SES/

# on supprime les ^M si on utilise docker depuis windows
RUN sed -i 's/\r$//g' /sources/SES/install_vtom.ini
RUN sed -i 's/\r$//g' /sources/SES/dockerinit.ksh
RUN sed -i 's/\r$//g' /sources/SES/install_vtom

# A chaque lancement d'image, on commence le conteneur avec le script d'installation VTOM
ENTRYPOINT ["/bin/bash"]
CMD ["-c","/sources/SES/dockerinit.ksh ;/bin/bash"]

</code></pre></div></div>

<h3 id="build-de-limage">Build de l’image</h3>

<p><code class="language-plaintext highlighter-rouge">docker build /path/du/gitclone</code></p>

<h3 id="run-de-limage">Run de l’image</h3>

<ul>
  <li>on récupère l’ID de l’image créée</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">docker images</code></p>

<p>(si on veut conserver l’image, on fera un <code class="language-plaintext highlighter-rouge">docker tag IDimage &lt;nouveau nom d'image&gt;</code>)</p>

<ul>
  <li>on lance l’image (en mode tty)</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">docker run -it IDimage</code></p>

<p>Si vous voulez plus d’informations sur le Dockerfile ou autre n’hésitez pas.</p>
</p>
      
    </div>

  </li>
  
  
  
  <li>
    <div class="card">
      <h4><a class="post-link" href="/archives/correlation-entre-jobs-vtom-et-policy-netbackup/">Corrélation entre les jobs VTOM et les policy netbackup</a></h4>
      <p><h3 id="but-">But :</h3>

<p>Vérifier qu’on a bien autant de jobs VTOM que de couple Netbackup POLICY / SCHEDULE / HOSTS</p>

<h3 id="méthode-">Méthode :</h3>

<p>Je n’ai pas trouvé comment faire un dump des policies (stratégies de sauvegardes Netbackup) en XML ou autre format facilement exploitable.
Il y a bien le <code class="language-plaintext highlighter-rouge">bppllist</code> mais la sortie à l’écran n’est pas très pratique à retraiter.</p>

<p>Il semblerait que les données du référentiel Netbackup se retrouvent dans des fichiers plats / nom de dossiers.</p>

<p>J’ai pu retrouver toutes les policies dans <code class="language-plaintext highlighter-rouge">/usr/openv/netbackup/db/class</code> par exemple. On peut y récupérer les schedules, les hosts, etc.</p>

<h3 id="pré-requis">Pré-requis</h3>

<p>On veut un fichier généré par un script VTOM avec les objets suivants :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>env;app;job;script;host;[parameter|[parameter|]..]
</code></pre></div></div>

<p>Cf. <a href="https://virtual-thom.github.io/archives/vthttpd-dump-requete-sql">vthttpd -dump</a>
ou  <a href="https://virtual-thom.github.io/archives/vtom-tlist-ameliore-affichage-script-parametres-et-autres-champs">tlist amélioré</a></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    
		<span class="nb">export </span><span class="nv">FIC_ALL_JOBS</span><span class="o">=</span>/var/tmp/all_jobs_tlist.txt
		fn_Controle_Presence_Fichier <span class="k">${</span><span class="nv">FIC_ALL_JOBS</span><span class="k">}</span>
		<span class="nb">test</span> <span class="k">${</span><span class="nv">vRC_CODE</span><span class="k">}</span> <span class="nt">-ne</span> 0 <span class="o">&amp;&amp;</span> <span class="nb">break
		
		</span>fn_WriteLog <span class="s2">" "</span>
		fn_WriteLog <span class="s2">"INFO -- Correlation entre les jobs VTOM et les couples de policies / schedule / hosts"</span>
		
		<span class="c"># Répertoire des class netbackup (policies)</span>
		<span class="nb">export </span><span class="nv">NB_DB</span><span class="o">=</span>/usr/openv/netbackup/db/class
		
		<span class="nv">POLICIES_EXCLUSION</span><span class="o">=</span><span class="s2">"VTOM_xxx VTOM_yyyy"</span>
		<span class="c"># On boucle sur tous les jobs de ${DOMAINE} avec le script Script_netbackup.sh qui correspond au lancement des sauvegardes NB</span>
		<span class="k">while </span><span class="nb">read </span>POLICY <span class="p">;</span> <span class="k">do
			for </span>POLICY_EXCLUSION <span class="k">in</span> <span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">POLICIES_EXCLUSION</span><span class="k">}</span><span class="s2">"</span><span class="si">)</span>
			<span class="k">do 
				if </span><span class="nb">test</span> <span class="s2">"</span><span class="k">${</span><span class="nv">POLICY</span><span class="k">}</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"</span><span class="k">${</span><span class="nv">POLICY_EXCLUSION</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span><span class="k">then
					</span>fn_WriteLog <span class="s2">"INFO -- Cette police </span><span class="k">${</span><span class="nv">POLICY</span><span class="k">}</span><span class="s2"> a ete exclus du check"</span>
					<span class="k">continue </span>2
				<span class="k">fi
			done
			</span>fn_WriteLog <span class="s2">" "</span>
			<span class="c"># les SCHED_TYPE doivent être :</span>
			<span class="c">#	0 (automatique INCR) ou 1 (automatique FULL), 4 (cumulative INCR)</span>
			<span class="c"># NE PAS ETRE : 2 c'est application (et ça n'est pas à intégrer dans VTOM)</span>
			<span class="nv">NB_SCHEDULE_EXCLUSION</span><span class="o">=</span><span class="s1">'| grep -v "EXCEPT"'</span>
			<span class="nv">NB_SCHEDULE</span><span class="o">=</span><span class="s1">'ls -1 '</span><span class="k">${</span><span class="nv">NB_DB</span><span class="k">}</span><span class="s1">'/'</span><span class="k">${</span><span class="nv">POLICY</span><span class="k">}</span><span class="s1">'/schedule/*/info '</span><span class="k">${</span><span class="nv">NB_SCHEDULE_EXCLUSION</span><span class="k">}</span><span class="s1">'| while read info ; do SCHED_TYPE=`grep "SCHED_TYPE" $info | sed "s/SCHED_TYPE[    ]*//"` ; if test $SCHED_TYPE -eq 0 -o $SCHED_TYPE -eq 1 -o $SCHED_TYPE -eq 4; then echo $info ; fi ; done'</span>
			
			<span class="nv">NB_CLIENTS_EXCLUSION</span><span class="o">=</span><span class="s1">''</span>
			<span class="nv">NB_CLIENTS</span><span class="o">=</span><span class="s2">"cat </span><span class="k">${</span><span class="nv">NB_DB</span><span class="k">}</span><span class="s2">/</span><span class="k">${</span><span class="nv">POLICY</span><span class="k">}</span><span class="s2">/clients "</span><span class="k">${</span><span class="nv">NB_CLIENTS_EXCLUSION</span><span class="k">}</span><span class="s2">"| grep -v </span><span class="se">\"</span><span class="s2">^#</span><span class="se">\"</span><span class="s2">"</span>
			
			<span class="c"># on multiplie le nombre de schedule par le nombre de clients par policy</span>
			<span class="nv">NB_JOBS_ATTENDUS</span><span class="o">=</span><span class="sb">`</span><span class="nb">expr</span> <span class="si">$(</span><span class="nb">eval</span> <span class="s2">"</span><span class="k">${</span><span class="nv">NB_SCHEDULE</span><span class="k">}</span><span class="s2"> | wc -l"</span><span class="si">)</span> <span class="se">\*</span> <span class="si">$(</span><span class="nb">eval</span> <span class="s2">"</span><span class="k">${</span><span class="nv">NB_CLIENTS</span><span class="k">}</span><span class="s2"> | wc -l"</span><span class="si">)</span><span class="sb">`</span>
			
			<span class="nv">NB_JOBS_VTOM</span><span class="o">=</span><span class="sb">`</span><span class="nb">grep</span> <span class="s2">";</span><span class="k">${</span><span class="nv">POLICY</span><span class="k">}</span><span class="s2">|"</span> <span class="k">${</span><span class="nv">FIC_ALL_JOBS</span><span class="k">}</span> | <span class="nb">grep</span> <span class="s2">"</span><span class="k">${</span><span class="nv">DOMAINE</span><span class="k">}</span><span class="s2">ADMBK001"</span> | <span class="nb">wc</span> <span class="nt">-l</span><span class="sb">`</span>
			
			fn_WriteLog <span class="s2">"INFO -- Policy : </span><span class="k">${</span><span class="nv">POLICY</span><span class="k">}</span><span class="s2">"</span>
			fn_WriteLog <span class="s2">"INFO -- Nombre de jobs attendus : </span><span class="k">${</span><span class="nv">NB_JOBS_ATTENDUS</span><span class="k">}</span><span class="s2">"</span>
			fn_WriteLog <span class="s2">"INFO -- Nombre de jobs VTOM : </span><span class="k">${</span><span class="nv">NB_JOBS_VTOM</span><span class="k">}</span><span class="s2">"</span>
			<span class="k">if </span><span class="nb">test</span> <span class="k">${</span><span class="nv">NB_JOBS_ATTENDUS</span><span class="k">}</span> <span class="nt">-ne</span> <span class="k">${</span><span class="nv">NB_JOBS_VTOM</span><span class="k">}</span><span class="p">;</span> <span class="k">then
				</span>fn_WriteLog <span class="s2">"ERROR -- Les jobs VTOM ne correspondent pas au jobs attendus par rapport a netbackup"</span>
				fn_WriteLog <span class="s2">"INFO -- Jobs dans VTOM avec cette policy : "</span>
				<span class="nb">grep</span> <span class="s2">";</span><span class="k">${</span><span class="nv">POLICY</span><span class="k">}</span><span class="s2">|"</span> <span class="k">${</span><span class="nv">FIC_ALL_JOBS</span><span class="k">}</span> | <span class="nb">grep</span> <span class="s2">"</span><span class="k">${</span><span class="nv">DOMAINE</span><span class="k">}</span><span class="s2">ADMBK001"</span>
				fn_WriteLog <span class="s2">"INFO -- Schedules Netbackup : "</span>
				<span class="nb">eval</span> <span class="s1">'ls -1 '</span><span class="k">${</span><span class="nv">NB_DB</span><span class="k">}</span><span class="s1">'/'</span><span class="k">${</span><span class="nv">POLICY</span><span class="k">}</span><span class="s1">'/schedule/*/info '</span><span class="k">${</span><span class="nv">NB_SCHEDULE_EXCLUSION</span><span class="k">}</span>
				fn_WriteLog <span class="s2">"INFO -- clients Netbackup : "</span>
				<span class="nb">eval</span> <span class="s2">"cat </span><span class="k">${</span><span class="nv">NB_DB</span><span class="k">}</span><span class="s2">/</span><span class="k">${</span><span class="nv">POLICY</span><span class="k">}</span><span class="s2">/clients "</span><span class="k">${</span><span class="nv">NB_CLIENTS_EXCLUSION</span><span class="k">}</span><span class="s2">"| grep -v </span><span class="se">\"</span><span class="s2">^#</span><span class="se">\"</span><span class="s2">"</span>
				<span class="nv">vRC_CODE</span><span class="o">=</span>20
				<span class="k">continue
			fi

			</span>fn_WriteLog <span class="s2">"OK -- match ok"</span>
		
		<span class="k">done</span> &lt; &lt;<span class="o">(</span><span class="nb">cat</span> <span class="k">${</span><span class="nv">FIC_ALL_JOBS</span><span class="k">}</span> | <span class="nb">grep</span> <span class="s2">"</span><span class="k">${</span><span class="nv">DOMAINE</span><span class="k">}</span><span class="s2">ADMBK001"</span> | <span class="nb">grep</span> <span class="s2">"Script_netbackup.sh"</span>| <span class="nb">cut</span> <span class="nt">-d</span><span class="s2">";"</span> <span class="nt">-f6</span> | <span class="nb">awk</span> <span class="nt">-F</span><span class="s2">"|"</span> <span class="s1">'{print $1}'</span> | <span class="nb">sort</span> | <span class="nb">uniq</span><span class="o">)</span>
		<span class="c"># Mes jobs netbackup ont ce script "Script_netbackup.sh" et la machine d'exécution est ${DOMAINE}ADMBK001</span>
</code></pre></div></div>

<p>Les fonctions préfixées fn_ ne sont pas définies ici mais sont assez explicites.</p>
</p>
      
    </div>

  </li>
  
  
  
  <li>
    <div class="card">
      <h4><a class="post-link" href="/archives/sh-lister-tous-les-fichiers-sauf-les-deux-derniers/">Shell Lister tous les fichiers sauf les x derniers</a></h4>
      <p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span><span class="nb">ls</span> <span class="nt">-1t</span> | <span class="nb">head</span> <span class="nt">-n</span> 2<span class="p">;</span> <span class="nb">ls</span><span class="o">)</span> | <span class="nb">sort</span> | <span class="nb">uniq</span> <span class="nt">-u</span>
</code></pre></div></div>

<p>head -n 2 affiche les deux premières lignes du ls (-t pour trier par date, les plus vieilles en tête)</p>

<p>uniq -u supprime les lignes identiques</p>

<p>Ou plus simple avec awk, mon préféré :</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ls</span> <span class="nt">-t</span> | <span class="nb">awk</span> <span class="s1">'NR &gt; 2'</span>
</code></pre></div></div>

</p>
      
    </div>

  </li>
  
  
  
  <li>
    <div class="card">
      <h4><a class="post-link" href="/archives/les-bizarreries-de-la-semaine/">les bizarreries de la semaine</a></h4>
      <p><p>Quelques bizarreries de le semaine :</p>

<ul>
  <li>Script batch : Le echo ne modifie pas le errorlevel !</li>
  <li>Attention aux &amp; dans les paramètres ou dans les ressources VTOM. Ca peut avoir comme résultat assez drôle de n’afficher aucun log VTOM tout en ayant un retour tsend</li>
  <li>Les fichiers avec extension .i dans le répertoire de logs VTOM est normal depuis la 5.7xx ! Il semblerait que ça serve aux alarmes.</li>
  <li>fichier log sur le client VTOM à 0 ko ou pas la fin de la log. Mais, le job se statue bien. Dans mon cas, c’est un bug, le tsend du client vers le serveur de backup VTOM était bloqué (impossible de communiquer avec le backup)</li>
</ul>

<p>Quelques bouts de code de la semaine :</p>
<ul>
  <li>Script PERL : charger un fichier XML et récupérer des informations</li>
</ul>

<div class="language-perl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/perl</span>
<span class="k">use</span> <span class="nn">XML::</span><span class="nv">LibXML</span> <span class="p">;</span>


<span class="c1"># Load DOM du fichier XML</span>
<span class="k">my</span> <span class="nv">$dom</span> <span class="o">=</span> <span class="nn">XML::</span><span class="nv">LibXML</span><span class="o">-&gt;</span><span class="k">new</span><span class="p">()</span><span class="o">-&gt;</span><span class="nv">parse_file</span><span class="p">(</span><span class="nv">$ARGV</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">;</span>
<span class="c1"># Item à récupérer</span>
<span class="k">my</span> <span class="nv">$item</span> <span class="o">=</span> <span class="nv">$ARGV</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">;</span>


<span class="k">my</span> <span class="nv">$logVTOM</span> <span class="o">=</span>  <span class="nv">$dom</span><span class="o">-&gt;</span><span class="nv">findvalue</span><span class="p">('</span><span class="s1">/runResponse/runReturn/item/name[contains(text(),</span><span class="se">\'</span><span class="s1">flowResult</span><span class="se">\'</span><span class="s1">)]/../value</span><span class="p">')</span> <span class="p">;</span>
<span class="k">my</span> <span class="nv">$flowResponse</span> <span class="o">=</span>  <span class="nv">$dom</span><span class="o">-&gt;</span><span class="nv">findvalue</span><span class="p">('</span><span class="s1">/runResponse/runReturn/item/name[contains(text(),</span><span class="se">\'</span><span class="s1">flowResponse</span><span class="se">\'</span><span class="s1">)]/../value</span><span class="p">')</span> <span class="p">;</span>

<span class="c1"># On clean le flowResult pour construire un résultat XML et on charge le DOM en mémoire</span>
<span class="nv">$logVTOM</span> <span class="o">=~</span> <span class="sr">s/.*(&lt;VTOM_RESULT&gt;.*)/$1/</span> <span class="p">;</span>
<span class="nv">$logVTOM</span> <span class="o">=~</span> <span class="sr">s/(.*&lt;\/VTOM_RESULT&gt;).*/$1/</span> <span class="p">;</span>

<span class="k">my</span> <span class="nv">$domLogVTOM</span> <span class="o">=</span> <span class="nn">XML::</span><span class="nv">LibXML</span><span class="o">-&gt;</span><span class="nv">load_xml</span><span class="p">(</span>
	<span class="s">string</span> <span class="o">=&gt;</span> <span class="nv">$logVTOM</span>
<span class="p">)</span> <span class="p">;</span>

<span class="k">print</span> <span class="nv">$domLogVTOM</span><span class="o">-&gt;</span><span class="nv">findvalue</span><span class="p">('</span><span class="s1">/VTOM_RESULT/VTOM_STDERR</span><span class="p">')</span> <span class="k">if</span><span class="p">(</span><span class="nv">$item</span> <span class="ow">eq</span> <span class="p">"</span><span class="s2">VTOM_STDERR</span><span class="p">");</span> 
<span class="k">print</span> <span class="nv">$domLogVTOM</span><span class="o">-&gt;</span><span class="nv">findvalue</span><span class="p">('</span><span class="s1">/VTOM_RESULT/VTOM_STDOUT</span><span class="p">')</span> <span class="k">if</span><span class="p">(</span><span class="nv">$item</span> <span class="ow">eq</span> <span class="p">"</span><span class="s2">VTOM_STDOUT</span><span class="p">");</span> 
<span class="k">print</span> <span class="nv">$domLogVTOM</span><span class="o">-&gt;</span><span class="nv">findvalue</span><span class="p">('</span><span class="s1">/VTOM_RESULT/VTOM_CR</span><span class="p">')</span> <span class="k">if</span><span class="p">(</span><span class="nv">$item</span> <span class="ow">eq</span> <span class="p">"</span><span class="s2">VTOM_CR</span><span class="p">");</span> 
<span class="k">print</span> <span class="nv">$flowResponse</span> <span class="k">if</span><span class="p">(</span><span class="nv">$item</span> <span class="ow">eq</span> <span class="p">"</span><span class="s2">flowResponse</span><span class="p">");</span>
</code></pre></div></div>

<ul>
  <li>Script VTOM : lister les machines Windows VTOM et y associer l’utilisateur Log On “AbsyssBatchManager”</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vtmachine | <span class="nb">grep</span> <span class="nt">-i</span> Win | <span class="nb">awk</span> <span class="nt">-F</span><span class="s2">"|"</span> <span class="s1">'{print $2}'</span> | <span class="nb">sed</span> <span class="s1">'s/[   ]//g'</span> | <span class="k">while </span><span class="nb">read </span>machine<span class="p">;</span> <span class="k">do </span>vtmachine <span class="nt">-i</span> <span class="nv">$machine</span> <span class="p">;</span> <span class="k">done</span> <span class="o">&gt;</span> /var/tmp/vtmachine_windows_infotag.txt
egrep <span class="s2">"(Logical Name|Username)"</span> /var/tmp/vtmachine_windows_infotag.txt | <span class="nb">awk</span> <span class="nt">-F</span><span class="s2">"|"</span> <span class="s1">'{print $3}'</span> | <span class="nb">sed</span> <span class="s1">'s/[    ]//g'</span> <span class="o">&gt;</span> /var/tmp/liste_machine_user_windows.txt
<span class="nv">compteur</span><span class="o">=</span>0<span class="p">;</span> <span class="k">while </span><span class="nb">read </span>line <span class="p">;</span> <span class="k">do </span><span class="nb">echo</span> <span class="nt">-en</span> <span class="s2">"</span><span class="nv">$line</span><span class="s2">"</span> <span class="p">;</span> <span class="k">if </span><span class="nb">test</span> <span class="sb">`</span><span class="nb">expr</span> <span class="nv">$compteur</span> % 2<span class="sb">`</span> <span class="nt">-eq</span> 1 <span class="p">;</span> <span class="k">then </span><span class="nb">echo</span> <span class="s2">""</span> <span class="p">;</span> <span class="k">else </span><span class="nb">echo</span> <span class="nt">-en</span> <span class="s2">";"</span> <span class="p">;</span> <span class="k">fi</span> <span class="p">;</span> <span class="nv">compteur</span><span class="o">=</span><span class="sb">`</span><span class="nb">expr</span> <span class="nv">$compteur</span> + 1<span class="sb">`</span> <span class="p">;</span> <span class="k">done</span> &lt; /var/tmp/liste_machine_user_windows.txt
</code></pre></div></div>

<p>(Attention des fois le vtmachine /info ne donne pas de Username)</p>

<ul>
  <li>lister les dates communes à plusieurs environnements (dangereux ! ne pas faire ça, sinon on ne sait pas quel moteur va faire basculer la date)</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tlist <span class="nb">env</span>/date | <span class="nb">sort</span> <span class="nt">-u</span> <span class="nt">-k</span><span class="s2">"2,2"</span> <span class="nt">-k</span><span class="s2">"1,1"</span> | <span class="nb">awk</span> <span class="s1">'{print $2}'</span> | <span class="nb">uniq</span> <span class="nt">-c</span> | <span class="nb">awk</span> <span class="s1">'$1 &gt; 1'</span>
      2 date_system
      2 prod_0_agp
      2 prod_0_jour
      2 prod_0_saveUn
</code></pre></div></div>

<ul>
  <li>Petite astuce pour récupérer le dernier startup tomcat avec le log catalina.out</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>date --date="$(grep -B 1 "INFO: Server startup" catalina.out | grep -v "INFO: Server startup" | tail -n1 | awk '{$NF="";$(NF-1)="" ;print}')"

# Si on décortique, 
# on grep INFO: Server startup et la ligne d'avant, on affiche la ligne d'avant seulement sans les deux derniers champs (pour récupérer seulement l'heure de démarrage)
</code></pre></div></div>

<ul>
  <li>ouvrir les ports des firewalls pour les flux VTOM, c’est sympa mais des fois, iptables bloque aussi :</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cp -p /etc/sysconfig/iptables /etc/sysconfig/iptables.$(date +%Y%m%d) 
#Editer le fichier /etc/sysconfig/iptables 
#Ajouter avant la ligne "-A INPUT -j REJECT --reject-with icmp-host-prohibited" les 2 lignes suivantes : 
-A INPUT -s x.x.x.x/32 -p tcp -m state --state NEW -m tcp --dport 30004 -j ACCEPT 

#Relancer le serice iptables : 
service iptables stop 
service iptables start
</code></pre></div></div>
</p>
      
    </div>

  </li>
  
  
  
  <li>
    <div class="card">
      <h4><a class="post-link" href="/archives/vtaddjob-vtom-ajouter-une-ressource/">VTOM ajouter une ressource en mode commande</a></h4>
      <p><h2 id="ajoutmodificationsuppression-dattente-de-ressource-sur-app-ou-job">ajout/modification/suppression d’attente de ressource sur app ou job</h2>
<p>Le vthelp vtaddjob n’est pas très intuitif.
Voici un exmple pour rajouter (+) une ressource texte VTOM avec les options d’attente indéfiniment.</p>

<p><code class="language-plaintext highlighter-rouge">vtaddjob /nom=env/app/job /script='monscript' /res="+nom_ressource = OK [attend==oui jusqu'a==Illimité]"</code></p>

<ul>
  <li>Modifier (~) une ressource de type poids en ligne de commande avec libération</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">vtaddapp /nom=$ITEM_VTOM /Res="~${ITEM_VTOM_RES} ! 1 [attend==oui jusqu'a==Illimité liberation==oui]"</code></p>

<ul>
  <li>Remplacer une ressource de type fichier par une autre (P présent)</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">vtaddjob /nom=$ITEM_VTOM /res="-${OLD_RESS} P,+${NEW_RESS} P [attend==oui jusqu'a==Illimité]"</code></p>

<p>exemple de changement de masse sur des jobs. Retrait d’une ressource poids et ajout d’une autre (prend 1, libère et attente illimité) :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tlist jobs -f MONENV | egrep -i "UNPATTERN.*I2" | awk '{printf"vtaddjob /nom=%s/%s/%s /res=\"-P_ENV_00_PARAOAG P, +P_ENV_00_PARAING ! 1 [attend==oui jusqu'"'"'a==Illimite liberation==oui]\"\n",$1,$2,$3}'
# donne
vtaddjob /nom=MONENV/UNEAPP/UNPATTERNXXXI2 /res="-P_ENV_00_PARAOAG P, +P_ENV_00_PARAING ! 1 [attend==oui jusqu'a==Illimite liberation==oui]"
(...)
</code></pre></div></div>

<h2 id="ajoutmodificationsuppression-ressource-vtom">ajout/modification/suppression ressource vtom</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vtaddres  -  ajout ou modification d'une ressource globale

Usage:
 vtaddres /name &lt;nom_ressource&gt; [options]

Exemples :
 vtaddres /name rgen /type gen /value jobok.bat /host localhost /user myUser /parameter 1,2
 vtaddres /name rpil /type pil /value 1,2
 vtaddres /name rpil /type pil /value ""


Liste des options :

 Parametres    Caracteristiques
 ------------- -----------------------------------------------------------------------------------
 /help         (ou -h) affiche l'aide
 /name         (ou -n) nom de la ressource
 /type         (ou -y) type (poi|pil|tex(defaut)|num|fic|gen)
 /value        (ou -v) script pour les ressources generiques, valeur pour les autres types
 /host         (ou -o) machine (ressources generiques seulement)
 /user         (ou -u) utilisateur de soumission (ressources generiques seulement)
 /parameter    (ou -p) parametres (ressources generiques seulement)
 /max          (ou -m) valeur maximum pour les ressources poids
 /att_ALL_env  (ou -t) attachement a tous les environnements
 /det_ALL_env  (ou -e) detachement de tous les environnements
 /att_env      (ou -a) attachement aux environnements de la liste
 /det_env      (ou -d) detachement des environnements de la liste
 /sepopt       (ou -s) separateur utilise dans les listes

Remarques :
 Les attachements et detachements sont possibles en meme temps.
 Les attachements sont effectues avant les detachements. En cas de conflit, le resultat est le detachement.
 Les options /att_ALL_env et /det_ALL_env s'excluent mutuellement.
 L'option /sepopt=# permet d'indiquer un caractere separateur pour les listes, autre que la virgule (par defaut).
 Attention, cette option doit etre utilisee avant toutes celles qui contiennent des listes pour etre operationnelle.

 IMPORTANT : LA COMMANDE VTADDRES NE PERMET PAS LA GESTION DES RESSOURCES DE TYPE DATE.
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vtdelres  -  suppression d'une ressource

Usage:
 vtdelres /name &lt;nom_ressource&gt;

Exemple :
 vtdelres /name res_1

Liste des options :

 Parametres    Caracteristiques
 ------------- --------------------------------------------------------------------------
 /help         (ou -h) affiche l'aide
 /name         (ou -n) nom de la ressource
 /force        (ou -f) supprime les references si la ressource est liee uniquement aux
               environnements
 /purge        (ou -p) suppression des ressources non utilisees

Remarque :
 Si la ressource est liee a d'autres objets, elle ne pourra pas etre supprimee.
</code></pre></div></div>
</p>
      
    </div>

  </li>
  
  
  
  <li>
    <div class="card">
      <h4><a class="post-link" href="/archives/nas-lister-nfs-export-depuis-un-client-unix/">Lister les nfs export d'un NAS à partir d'un client Unix</a></h4>
      <p><p><code class="language-plaintext highlighter-rouge">showmount -e IP_interface_nas</code></p>
</p>
      
    </div>

  </li>
  
  
</ul>
<!-- Pagination links -->
<nav>
  <ul class="pagination">
    
    <li>
      <a href="/page8" class="Précédant">
        <span aria-hidden="true">&laquo;</span>
      </a>
    </li>
      
    <li>
      <a href="/archives/index.html">1</a>
    </li>
      
    <li>
      <a
        href="/archives/page2">2</a>
    </li>
      
    <li>
      <a
        href="/archives/page3">3</a>
    </li>
      
    <li>
      <a
        href="/archives/page4">4</a>
    </li>
      
    <li>
      <a
        href="/archives/page5">5</a>
    </li>
      
    <li>
      <a
        href="/archives/page6">6</a>
    </li>
      
    <li>
      <a
        href="/archives/page7">7</a>
    </li>
      
    <li>
      <a
        href="/archives/page8">8</a>
    </li>
      
    <li class="active">
      <span>9</span>
    </li>
      
    <li>
      <a
        href="/archives/page10">10</a>
    </li>
      
    <li>
      <a
        href="/archives/page11">11</a>
    </li>
      
    <li>
      <a
        href="/archives/page12">12</a>
    </li>
      
    <li>
      <a
        href="/archives/page13">13</a>
    </li>
      
    <li>
      <a
        href="/archives/page14">14</a>
    </li>
      
    <li>
      <a href="/page10" aria-label="Suivant">
        <span aria-hidden="true">&raquo;</span>
      </a>
    </li>
    
  </ul>
</nav>

      <footer id="site-footer">
    <div>&copy;<a href="https://github.com/virtual-thom/" title="Github Virtual-Thom">Virtual-Thom</a></div>
    <div>
            <a href="https://virtual-thom.github.io/archives/plan" title="Plan du site">sitemap</a> | <a href="https://virtual-thom.github.io/about" rel="publisher author" title="Curriculum vitae Thom">A propos</a>
    </div>
    <div>
        <a id="goto-site-header" href="#site-header" title="Retourner au début">&uArr; Top</a>
    </div>
    <div id="footer-disclaimer">
        <p>Avertissement : vous ne devez pas prendre pour argent comptant le contenu de ce site. Testez toujours la solution en environnement de test.</p>
        <p>Malgré le sérieux que je m'efforce de mettre dans le contenu de ces billets, je ne pourrai être tenu responsable d'éventuelles erreurs que cela pourrait engendrer.</p>
    </div>
    <div>
        <a class="hidden" href="https://virtual-thom.github.io/archives/sitemap.xml" title="SiteMap">sitemap</a>
    </div>
</footer>

    </div>
  </body>

</html>