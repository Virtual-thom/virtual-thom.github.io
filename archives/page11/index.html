<!DOCTYPE html>
<html lang="fr">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="apple-touch-icon" href="https://virtual-thom.github.io/archives/apple-touch-icon.png">
  <link rel="icon" href="https://virtual-thom.github.io/archives/favicon.ico" />
  <!-- Remplacé par Jekyll SEO (sinon apparait en double)
  <title>Virtual-Thom | Blog-notes VTOM et informatique</title>
  <meta name="description" content="Blog-notes VTOM, informatique, industrialisation, ordonnancement, DevOps">
  --> 
  
  <link rel="canonical" href="https://virtual-thom.github.io/archives/page11/">
  
  <link rel="stylesheet" media="screen" href="https://virtual-thom.github.io/archives/assets/main.css">
  
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Page 11 of 14 for Virtual-Thom Blog-notes VTOM et informatique | Blog-notes VTOM, informatique, industrialisation, ordonnancement, DevOps</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Virtual-Thom Blog-notes VTOM et informatique" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Blog-notes VTOM, informatique, industrialisation, ordonnancement, DevOps" />
<meta property="og:description" content="Blog-notes VTOM, informatique, industrialisation, ordonnancement, DevOps" />
<link rel="canonical" href="https://virtual-thom.github.io/archives/page11/" />
<meta property="og:url" content="https://virtual-thom.github.io/archives/page11/" />
<meta property="og:site_name" content="Virtual-Thom Blog-notes VTOM et informatique" />
<meta property="og:type" content="website" />
<link rel="prev" href="https://virtual-thom.github.io/archives/page10" />
<link rel="next" href="https://virtual-thom.github.io/archives/page12" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Virtual-Thom Blog-notes VTOM et informatique" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Blog-notes VTOM, informatique, industrialisation, ordonnancement, DevOps","headline":"Virtual-Thom Blog-notes VTOM et informatique","url":"https://virtual-thom.github.io/archives/page11/"}</script>
<!-- End Jekyll SEO tag -->

  
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Z8Y7902GRV"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Z8Y7902GRV');
</script>


  <body>
    <div class="container">
      <header id="site-header">
  <h1>Blog-notes VTOM, informatique, industrialisation, ordonnancement, DevOps</h1>
  <nav>
    <ul>
      <li>
        <a href="https://virtual-thom.github.io/archives" title="Home">
          <svg class="svg-icon" viewBox="0 0 20 20">
            <path d="M18.121,9.88l-7.832-7.836c-0.155-0.158-0.428-0.155-0.584,0L1.842,9.913c-0.262,0.263-0.073,0.705,0.292,0.705h2.069v7.042c0,0.227,0.187,0.414,0.414,0.414h3.725c0.228,0,0.414-0.188,0.414-0.414v-3.313h2.483v3.313c0,0.227,0.187,0.414,0.413,0.414h3.726c0.229,0,0.414-0.188,0.414-0.414v-7.042h2.068h0.004C18.331,10.617,18.389,10.146,18.121,9.88 M14.963,17.245h-2.896v-3.313c0-0.229-0.186-0.415-0.414-0.415H8.342c-0.228,0-0.414,0.187-0.414,0.415v3.313H5.032v-6.628h9.931V17.245z M3.133,9.79l6.864-6.868l6.867,6.868H3.133z"></path>
          </svg>
        </a>
      </li>
      <li>
        <a href="https://virtual-thom.github.io/archives/vos-commentaires-livre-d-or/" title="Commentaires - livre d'or">
          <svg class="svg-icon" viewBox="0 0 20 20">
            <path d="M17.657,2.982H2.342c-0.234,0-0.425,0.191-0.425,0.426v10.21c0,0.234,0.191,0.426,0.425,0.426h3.404v2.553c0,0.397,0.48,0.547,0.725,0.302l2.889-2.854h8.298c0.234,0,0.426-0.191,0.426-0.426V3.408C18.083,3.174,17.892,2.982,17.657,2.982M17.232,13.192H9.185c-0.113,0-0.219,0.045-0.3,0.124l-2.289,2.262v-1.96c0-0.233-0.191-0.426-0.425-0.426H2.767V3.833h14.465V13.192z M10,7.237c-0.821,0-1.489,0.668-1.489,1.489c0,0.821,0.668,1.489,1.489,1.489c0.821,0,1.488-0.668,1.488-1.489C11.488,7.905,10.821,7.237,10,7.237 M10,9.364c-0.352,0-0.638-0.288-0.638-0.638c0-0.351,0.287-0.638,0.638-0.638c0.351,0,0.638,0.287,0.638,0.638C10.638,9.077,10.351,9.364,10,9.364 M14.254,7.237c-0.821,0-1.489,0.668-1.489,1.489c0,0.821,0.668,1.489,1.489,1.489s1.489-0.668,1.489-1.489C15.743,7.905,15.075,7.237,14.254,7.237 M14.254,9.364c-0.351,0-0.638-0.288-0.638-0.638c0-0.351,0.287-0.638,0.638-0.638c0.352,0,0.639,0.287,0.639,0.638C14.893,9.077,14.605,9.364,14.254,9.364 M5.746,7.237c-0.821,0-1.489,0.668-1.489,1.489c0,0.821,0.668,1.489,1.489,1.489c0.821,0,1.489-0.668,1.489-1.489C7.234,7.905,6.566,7.237,5.746,7.237 M5.746,9.364c-0.351,0-0.638-0.288-0.638-0.638c0-0.351,0.287-0.638,0.638-0.638c0.351,0,0.638,0.287,0.638,0.638C6.384,9.077,6.096,9.364,5.746,9.364"></path>
          </svg>
        </a>
      </li>
      
      <li>
        <a href="https://virtual-thom.github.io/about" title="Curriculum Vitae Thom">
          <svg class="svg-icon" viewBox="0 0 20 20">
            <path d="M12.075,10.812c1.358-0.853,2.242-2.507,2.242-4.037c0-2.181-1.795-4.618-4.198-4.618S5.921,4.594,5.921,6.775c0,1.53,0.884,3.185,2.242,4.037c-3.222,0.865-5.6,3.807-5.6,7.298c0,0.23,0.189,0.42,0.42,0.42h14.273c0.23,0,0.42-0.189,0.42-0.42C17.676,14.619,15.297,11.677,12.075,10.812 M6.761,6.775c0-2.162,1.773-3.778,3.358-3.778s3.359,1.616,3.359,3.778c0,2.162-1.774,3.778-3.359,3.778S6.761,8.937,6.761,6.775 M3.415,17.69c0.218-3.51,3.142-6.297,6.704-6.297c3.562,0,6.486,2.787,6.705,6.297H3.415z"></path>
          </svg>
        </a>
      </li>
    </ul>
  </nav>
</header>

      <nav>
  <ul class="pagination">
    
    <li>
      <a href="/page10" class="Précédant">
        <span aria-hidden="true">&laquo;</span>
      </a>
    </li>
      
    <li>
      <a href="/archives/index.html">1</a>
    </li>
      
    <li>
      <a
        href="/archives/page2">2</a>
    </li>
      
    <li>
      <a
        href="/archives/page3">3</a>
    </li>
      
    <li>
      <a
        href="/archives/page4">4</a>
    </li>
      
    <li>
      <a
        href="/archives/page5">5</a>
    </li>
      
    <li>
      <a
        href="/archives/page6">6</a>
    </li>
      
    <li>
      <a
        href="/archives/page7">7</a>
    </li>
      
    <li>
      <a
        href="/archives/page8">8</a>
    </li>
      
    <li>
      <a
        href="/archives/page9">9</a>
    </li>
      
    <li>
      <a
        href="/archives/page10">10</a>
    </li>
      
    <li class="active">
      <span>11</span>
    </li>
      
    <li>
      <a
        href="/archives/page12">12</a>
    </li>
      
    <li>
      <a
        href="/archives/page13">13</a>
    </li>
      
    <li>
      <a
        href="/archives/page14">14</a>
    </li>
      
    <li>
      <a href="/page12" aria-label="Suivant">
        <span aria-hidden="true">&raquo;</span>
      </a>
    </li>
    
  </ul>
</nav>
<ul class="post-list post-list-with-type">
  
  <li>
    <a class="post-link" href="/archives/resnopla-vtom/">Exécuter une application si parent déplanifié</a>
  </li>
  
  <li>
    <a class="post-link" href="/archives/api-vtom-web-access/">API VTOM webaccess</a>
  </li>
  
  <li>
    <a class="post-link" href="/archives/documentations-vtom-absyss-telecharger-officielle/">Documentations VTOM, comment télécharger la doc officielle absyss</a>
  </li>
  
  <li>
    <a class="post-link" href="/archives/vtom-tlist-ameliore-affichage-script-parametres-et-autres-champs/">tlist amélioré affichage script paramètres et autres champs</a>
  </li>
  
  <li>
    <a class="post-link" href="/archives/comment-executer-un-script-powershell-avec-vtom/">Comment exécuter un script powershell avec VTOM</a>
  </li>
  
  <li>
    <a class="post-link" href="/archives/vtom-impossible-de-changer-les-queues-d-execution-sous-windows/">Impossible de changer les Queues d'exécution sous Windows</a>
  </li>
  
  <li>
    <a class="post-link" href="/archives/script-shell-dd-generator/">Script shell dd generator</a>
  </li>
  
  <li>
    <a class="post-link" href="/archives/lister-luns-par-pool-projet-script-aksh-zfs-storage-7310-oracle-unified-storage-systems-documentation/">Lister tous les LUNs par Pool et par projet en script aksh - ZFS Storage 7310 (Oracle Unified Storage Systems)</a>
  </li>
  
  <li>
    <a class="post-link" href="/archives/deployer-application-sails-js-framework-node-js-openshift-gratuit/">Déployer une application Sails JS (framework Node.js) sur Openshift - gratuit</a>
  </li>
  
  <li>
    <a class="post-link" href="/archives/indicateurs-etat-capacitaire-des-baies-de-stockage-naviseccli-xml-xslt-embarquee/">Indicateurs état capacitaire des baies de stockage (Naviseccli, XML et XSLT embarquée)</a>
  </li>
  
</ul>


<div id="page-first-post">

  <div itemscope itemtype="http://schema.org/Article" class="post">

    <article class="post-content" itemprop="articleBody">
      <h1 itemprop="name about headline" class="post-title">Exécuter une application si parent déplanifié</h1>
      <p>Une question de Bertrand :</p>

<p>Comment exécuter une application seulement si la précédente se déplanifie et sans passer par des ressources ?
(notamment utile sur une déplanification suite à une “non” ressource : fichier non présent …)</p>

<p>Le plus simple est de configurer resnopla dans le fichier vtom.ini, dans la section du tengine en question :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[TENGINE:exploitation]
resnopla=1
</code></pre></div></div>

<p>Ainsi, l’application ne passera plus à l’état DEPLANIFIE mais NON-PLANIFIE. 
On peut alors définir un lien exclusif (noir) entre les applications.</p>

<p>exemple :</p>

<p><img class="img-responsive" src="https://virtual-thom.github.io/archives/assets/img/resnopla.png" alt="resnopla vtom" /></p>

      (voir plus)
      <a class="post-link" href="/archives/resnopla-vtom/">Exécuter une application si parent déplanifié</a>
      <p class="post-meta">
        <time class="post-meta" itemprop="datePublished dateModified"
          datetime="2015-02-10T21:10:00+00:00">10-02-2015</time>
      </p>
    </article>
  </div>
</div>




















<ul class="post-list">
  
  
  
  
  <li>
    <div class="card">
      <h4><a class="post-link" href="/archives/api-vtom-web-access/">API VTOM webaccess</a></h4>
      <p><p>Vous n’êtes pas sans savoir que VTOM fournit, depuis quelques versions maintenant, un webaccess (un portail web d’accès à VTOM / vthttpd).</p>

<p>Sur une question de Stephane, je me suis penché sur son fonctionnement.</p>

<p>Voici quelques API VTOM glannées dans les pages du webaccess.</p>

<p>Peu importe comment vous y accédez, ici en curl (user:passwd à changer) mais on peut très bien faire ça avec POSTMAN.</p>

<h1 id="liste-de-tous-les-environnements">Liste de tous les environnements</h1>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-k</span> <span class="nt">-u</span> user:passwd <span class="s2">"http://localhost:30080/api/environment/list"</span> <span class="nt">-X</span> GET  | python <span class="nt">-m</span> json.tool
</code></pre></div></div>

<h1 id="liste-de-toutes-les-applications">Liste de toutes les applications</h1>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-k</span> <span class="nt">-u</span> user:passwd <span class="s2">"http://localhost:30080/api/application/list"</span> <span class="nt">-X</span> GET  | python <span class="nt">-m</span> json.tool
curl <span class="nt">-k</span> <span class="nt">-u</span> user:passwd <span class="s2">"http://localhost:30080/api/application/list?envSId=ENV7f00000102a3106054b8e57700000014"</span> <span class="nt">-X</span> GET  | python <span class="nt">-m</span> json.tool
curl <span class="nt">-k</span> <span class="nt">-u</span> user:passwd <span class="s2">"http://localhost:30080/api/application/list?environmentName=VAGUE5_INT"</span> <span class="nt">-X</span> GET  | python <span class="nt">-m</span> json.tool
</code></pre></div></div>

<h1 id="liste-de-tous-les-jobs">Liste de tous les jobs</h1>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-k</span> <span class="nt">-u</span> user:passwd <span class="s2">"http://localhost:30080/api/job/list"</span> <span class="nt">-X</span> GET  | python <span class="nt">-m</span> json.tool
curl <span class="nt">-k</span> <span class="nt">-u</span> user:passwd <span class="s2">"http://localhost:30080/api/job/list?appSId=APP7f00000129a98189539f1cb000000023"</span> <span class="nt">-X</span> GET  | python <span class="nt">-m</span> json.tool
curl <span class="nt">-k</span> <span class="nt">-u</span> user:passwd <span class="s2">"http://localhost:30080/api/job/list?applicationName=BASCULE_DATE"</span> <span class="nt">-X</span> GET  | python <span class="nt">-m</span> json.tool
</code></pre></div></div>

<h1 id="détails-dun-job">Détails d’un job</h1>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-k</span> <span class="nt">-u</span> user:passwd <span class="s2">"http://localhost:30080/api/job/getById?id=JOB7f0000012b10ca88539f1cb4000000c2"</span> <span class="nt">-X</span> GET  | python <span class="nt">-m</span> json.tool
</code></pre></div></div>

<h1 id="détails-de-tous-les-jobs-ou-autres-items">Détails de tous les jobs (ou autres items)</h1>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-k</span> <span class="nt">-u</span> user:passwd <span class="s2">"http://localhost:30080/api/job/getAll"</span> <span class="nt">-X</span> GET  | python <span class="nt">-m</span> json.tool
</code></pre></div></div>

<h2 id="exemple-de-résultat">Exemple de résultat</h2>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"rc"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> 
    </span><span class="nl">"result"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"ExpectedContexts"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w"> 
        </span><span class="nl">"ExpectedResources"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w"> 
        </span><span class="nl">"Script"</span><span class="p">:</span><span class="w"> </span><span class="s2">"D:</span><span class="se">\\</span><span class="s2">Script</span><span class="se">\\</span><span class="s2">rotation_log_dxserver</span><span class="se">\\</span><span class="s2">Rotate_log_dxserver.bat"</span><span class="p">,</span><span class="w"> 
        </span><span class="nl">"appInErr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w"> 
        </span><span class="nl">"applicationSId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"APP7f00000129a98189539f1cb000000023"</span><span class="p">,</span><span class="w"> 
        </span><span class="nl">"blockDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="p">,</span><span class="w"> 
        </span><span class="nl">"cycle"</span><span class="p">:</span><span class="w"> </span><span class="s2">"00:00:00"</span><span class="p">,</span><span class="w"> 
        </span><span class="nl">"cycleEnabled"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="p">,</span><span class="w"> 
        </span><span class="nl">"descOnErr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="p">,</span><span class="w"> 
        </span><span class="nl">"exploited"</span><span class="p">:</span><span class="w"> </span><span class="s2">"E"</span><span class="p">,</span><span class="w"> 
        </span><span class="nl">"frequency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"D"</span><span class="p">,</span><span class="w"> 
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"JOB7f0000012b10ca88539f1cb4000000c2"</span><span class="p">,</span><span class="w"> 
        </span><span class="nl">"information"</span><span class="p">:</span><span class="w"> </span><span class="s2">" "</span><span class="p">,</span><span class="w"> 
        </span><span class="nl">"isAsked"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="p">,</span><span class="w"> 
        </span><span class="nl">"maxStart"</span><span class="p">:</span><span class="w"> </span><span class="s2">"37:59:00"</span><span class="p">,</span><span class="w"> 
        </span><span class="nl">"minStart"</span><span class="p">:</span><span class="w"> </span><span class="s2">"25:30:00"</span><span class="p">,</span><span class="w"> 
        </span><span class="nl">"mode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"E"</span><span class="p">,</span><span class="w"> 
        </span><span class="nl">"movementTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="p">,</span><span class="w"> 
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ROT_LOG_DXSERVER"</span><span class="p">,</span><span class="w"> 
        </span><span class="nl">"onDemand"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="p">,</span><span class="w"> 
        </span><span class="nl">"restartCount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="p">,</span><span class="w"> 
        </span><span class="nl">"restartLabel"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="p">,</span><span class="w"> 
        </span><span class="nl">"restartMax"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w"> 
        </span><span class="nl">"restartType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"M"</span><span class="p">,</span><span class="w"> 
        </span><span class="nl">"retained"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="p">,</span><span class="w"> 
        </span><span class="nl">"retcode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"-1"</span><span class="p">,</span><span class="w"> 
        </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"W"</span><span class="p">,</span><span class="w"> 
        </span><span class="nl">"timeBegin"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1421112600"</span><span class="p">,</span><span class="w"> 
        </span><span class="nl">"timeEnd"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1421112630"</span><span class="p">,</span><span class="w"> 
        </span><span class="nl">"xid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"JOBc2"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<p>On a vérifié avec Stephane, les attributs sont hiérarchisés comme dans le vtexport xml (si pas dans Job, on remonte dans Application, si pas dans Application, on remonte sur Environnement).</p>

<h1 id="carrément-le-contenu-du-script-">carrément le contenu du script !!!</h1>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-k</span> <span class="nt">-u</span> user:passwd <span class="s2">"http://localhost:30080/api/job/getScript?id=JOB7f0000012b10ca88539f1cb4000000c2"</span>  <span class="nt">-X</span> GET  | python <span class="nt">-m</span> json.tool
</code></pre></div></div>

<h1 id="liste-des-logs-utiliser-le-job-xid-et-non-lid-tout-court">Liste des Logs (utiliser le job xid et non l’id tout court)</h1>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-k</span> <span class="nt">-u</span> user:passwd <span class="s2">"http://localhost:30080/api/log/getLogList?id=JOBc2"</span>  <span class="nt">-X</span> GET  | python <span class="nt">-m</span> json.tool
</code></pre></div></div>

<h1 id="si-je-résume-">Si je résume :</h1>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Pour avoir toutes les informations détaillées d'un ensemble d'items (environment, application, job, date, host, instruction - pour info instruction c'est les consignes -  etc)
http://localhost:30080/api/&lt;item&gt;/getAll

Pour avoir toute la liste d'un ensemble d'items mais avec moins de détails 
http://localhost:30080/api/&lt;item&gt;/list

Pour avoir le détail d'un item en particulier
http://localhost:30080/api/&lt;item&gt;/getById?id=&lt;id&gt;

Pour filtrer la liste d'un ensemble d'item sur un attribut particulier
http://localhost:30080/api/&lt;item&gt;/list?&lt;attribut&gt;=&lt;valeur&gt;

Si l'attribut n'est pas présent dans l'item le plus bas (job), il faut remonter d'un cran (application) et encore d'un cran si besoin (environment). Notion de hiérarchie, notamment pour les dates, host, queue, user.
</code></pre></div></div>

<p>On peut aussi utiliser cette méthode pour s’authentifier, en passant par le header http :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># echo -n "user:password" | base64, ici TOM:TOM
curl -H 'Authorization: Basic VE9NOlRPTQ=='
</code></pre></div></div>

<p>On peut aussi se pré-authentifier avec <code class="language-plaintext highlighter-rouge">/api/utilities/login</code> POST { login: “xxx”, password: “xxx” }.
Ca renvoie un cookie avec <code class="language-plaintext highlighter-rouge">vtsession</code> et <code class="language-plaintext highlighter-rouge">webdoc_account_id</code> qu’il faudra rajouter aux futures requêtes.
Ce qui est bien avec cette méthode, c’est que les utilisateurs LDAP passent, alors que l’Authorization Basic ne fonctionne qu’avec des utilisateurs “locaux”.</p>

<h1 id="vous-en-voulez-plus-">Vous en voulez plus ?</h1>

<p>Aucune doc Absyss ne référence toutes les APIs. Donc petite astuce :</p>

<p>Ouvrez votre navigateur Chrome F12 et aller dans l’onglet Network pour voir les appels aux API. Baladez vous sur l’interface Web du web access et glannez les différentes adresses et requêtes XHR.</p>

<h1 id="petite-astuce-côté-client-pour-effectuer-une-request-rest-sur-lapi-vtom-sans-utiliser-jquery">Petite astuce côté client pour effectuer une request REST sur l’api VTOM sans utiliser jQuery</h1>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">serveurVtom</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">http://monserveurvtom:30080</span><span class="dl">"</span> <span class="p">;</span>
<span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">XMLHttpRequest</span><span class="p">();</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="kd">var</span> <span class="nx">status</span> <span class="o">=</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span><span class="p">;</span>

      <span class="k">if </span><span class="p">(</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
        
        <span class="k">if</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">response</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// toute la réponse avec les columns et les rows</span>
                <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">response</span> <span class="p">)</span> <span class="p">;</span>
                <span class="c1">// on récupère le nom par exemple et on l'affiche dans la console</span>
                <span class="nx">xhr</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">result</span><span class="p">.</span><span class="nx">rows</span><span class="p">.</span><span class="nf">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">entry</span><span class="p">){</span>
                        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
                <span class="p">});</span>
        <span class="p">}</span>
        
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">error</span><span class="dl">"</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">status</span><span class="p">);</span>
      <span class="p">}</span>
<span class="p">}</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="dl">'</span><span class="s1">GET</span><span class="dl">'</span><span class="p">,</span> <span class="nx">serveurVtom</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">/api/job/list</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">responseType</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">json</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// attention sous unix echo "user:passwdord" | base64 interprète le saut de ligne du echo et vous donne une mauvaise authentification</span>
<span class="c1">// il faut utiliser l'option -n, echo -n "user:password" | base64</span>
<span class="c1">// on peut utiliser un encodage base64 via javascript directement mais dans ce cas le user:mdp est en clair dans le code</span>
<span class="c1">// ex. VE9NOlRPTQ== =&gt; base64 pour TOM:TOM</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nf">setRequestHeader</span><span class="p">(</span><span class="dl">'</span><span class="s1">Authorization</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Basic VE9NOlRPTQ==</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nf">send</span><span class="p">();</span>
</code></pre></div></div>

<p><a href="https://virtual-thom.github.io/archives/wp-content/uploads/list_all_jobs.html">Un exemple pour lister tous les jobs, il faut changer l’ip, le port et encoder le user:password</a></p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">fr"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>

<span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"refresh-button"</span><span class="nt">&gt;</span>Refresh<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;table</span> <span class="na">id=</span><span class="s">"list-jobs"</span><span class="nt">&gt;&lt;/table&gt;</span>

<span class="nt">&lt;script&gt;</span>
<span class="c1">// Variables Globales</span>
<span class="kd">var</span> <span class="nx">serveurVtom</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">http://192.168.99.100:30080</span><span class="dl">"</span> <span class="p">;</span> <span class="c1">// A changer !</span>
<span class="kd">var</span> <span class="nx">authVtom</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">VE9NOlRPTQ==</span><span class="dl">"</span> <span class="p">;</span> <span class="c1">//base64 user:password</span>
<span class="kd">var</span> <span class="nx">itemsVtom</span> <span class="o">=</span> <span class="p">[</span> <span class="dl">"</span><span class="s2">environment</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">application</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">job</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">date</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">host</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">queue</span><span class="dl">"</span> <span class="p">]</span> <span class="p">;</span> 
<span class="nx">itemsVtom</span><span class="p">.</span><span class="nf">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">){</span>
	<span class="nf">eval</span><span class="p">(</span><span class="dl">"</span><span class="s2">window.API_</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">item</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">_LIST = null ;</span><span class="dl">"</span><span class="p">)</span> <span class="p">;</span>
<span class="p">});</span>


<span class="c1">// Fonctions</span>
<span class="kd">function</span> <span class="nf">findItemById</span><span class="p">(</span><span class="nx">source</span><span class="p">,</span> <span class="nx">id</span><span class="p">){</span>
    <span class="k">return</span> <span class="nx">source</span><span class="p">.</span><span class="nf">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span> <span class="nx">obj</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">id</span> <span class="o">==</span> <span class="nx">id</span><span class="p">;</span>
    <span class="p">})[</span> <span class="mi">0</span> <span class="p">];</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">debutAffichage</span><span class="p">(){</span>
	
	<span class="nb">window</span><span class="p">.</span><span class="nx">API_job_LIST</span><span class="p">.</span><span class="nx">result</span><span class="p">.</span><span class="nf">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">entry</span><span class="p">){</span>
		<span class="kd">var</span> <span class="nx">application</span> <span class="o">=</span> <span class="nf">findItemById</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">API_application_LIST</span><span class="p">.</span><span class="nx">result</span><span class="p">,</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">applicationSId</span><span class="p">)</span> <span class="p">;</span>
		<span class="kd">var</span> <span class="nx">environment</span> <span class="o">=</span> <span class="nf">findItemById</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">API_environment_LIST</span><span class="p">.</span><span class="nx">result</span><span class="p">,</span> <span class="nx">application</span><span class="p">.</span><span class="nx">environmentSId</span><span class="p">)</span> <span class="p">;</span>
		<span class="kd">var</span> <span class="nx">host</span> <span class="o">=</span> <span class="nf">findItemById</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">API_host_LIST</span><span class="p">.</span><span class="nx">result</span><span class="p">,</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">host</span><span class="p">)</span> <span class="p">;</span>
		<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">host</span><span class="p">){</span>
			<span class="kd">var</span> <span class="nx">host</span> <span class="o">=</span> <span class="nf">findItemById</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">API_host_LIST</span><span class="p">.</span><span class="nx">result</span><span class="p">,</span> <span class="nx">application</span><span class="p">.</span><span class="nx">host</span><span class="p">)</span> <span class="p">;</span>
			<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">host</span><span class="p">){</span>
				<span class="kd">var</span> <span class="nx">host</span> <span class="o">=</span> <span class="nf">findItemById</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">API_host_LIST</span><span class="p">.</span><span class="nx">result</span><span class="p">,</span> <span class="nx">environment</span><span class="p">.</span><span class="nx">host</span><span class="p">)</span> <span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="kd">var</span> <span class="nx">dateVtom</span> <span class="o">=</span> <span class="nf">findItemById</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">API_date_LIST</span><span class="p">.</span><span class="nx">result</span><span class="p">,</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">date</span><span class="p">)</span> <span class="p">;</span>
		<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">dateVtom</span><span class="p">){</span>
			<span class="kd">var</span> <span class="nx">dateVtom</span> <span class="o">=</span> <span class="nf">findItemById</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">API_date_LIST</span><span class="p">.</span><span class="nx">result</span><span class="p">,</span> <span class="nx">application</span><span class="p">.</span><span class="nx">date</span><span class="p">)</span> <span class="p">;</span>
			<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">dateVtom</span><span class="p">){</span>
				<span class="kd">var</span> <span class="nx">dateVtom</span> <span class="o">=</span> <span class="nf">findItemById</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">API_date_LIST</span><span class="p">.</span><span class="nx">result</span><span class="p">,</span> <span class="nx">environment</span><span class="p">.</span><span class="nx">date</span><span class="p">)</span> <span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="kd">var</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nf">findItemById</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">API_queue_LIST</span><span class="p">.</span><span class="nx">result</span><span class="p">,</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">queue</span><span class="p">)</span> <span class="p">;</span>
		<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">queue</span><span class="p">){</span>
			<span class="kd">var</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nf">findItemById</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">API_queue_LIST</span><span class="p">.</span><span class="nx">result</span><span class="p">,</span> <span class="nx">application</span><span class="p">.</span><span class="nx">queue</span><span class="p">)</span> <span class="p">;</span>
			<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">queue</span><span class="p">){</span>
				<span class="kd">var</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nf">findItemById</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">API_queue_LIST</span><span class="p">.</span><span class="nx">result</span><span class="p">,</span> <span class="nx">environment</span><span class="p">.</span><span class="nx">queue</span><span class="p">)</span> <span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
		
		<span class="kd">var</span> <span class="nx">tableListJobs</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">table#list-jobs</span><span class="dl">'</span><span class="p">)</span> <span class="p">;</span>
		<span class="kd">var</span> <span class="nx">this_tr</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">tr</span><span class="dl">"</span><span class="p">);</span>
		<span class="nx">this_tr</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">&lt;td&gt;</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">environment</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">&lt;/td&gt;</span><span class="dl">"</span> <span class="o">+</span>
			<span class="dl">"</span><span class="s2">&lt;td&gt;</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">application</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">&lt;/td&gt;</span><span class="dl">"</span> <span class="o">+</span>
			<span class="dl">"</span><span class="s2">&lt;td&gt;</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">&lt;/td&gt;</span><span class="dl">"</span> <span class="o">+</span>
			<span class="dl">"</span><span class="s2">&lt;td&gt;</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">dateVtom</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">&lt;/td&gt;</span><span class="dl">"</span> <span class="o">+</span>
			<span class="dl">"</span><span class="s2">&lt;td&gt;</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">&lt;/td&gt;</span><span class="dl">"</span> <span class="o">+</span>
			<span class="dl">"</span><span class="s2">&lt;td&gt;</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">host</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">&lt;/td&gt;</span><span class="dl">"</span> <span class="o">+</span>
			<span class="dl">"</span><span class="s2">&lt;td&gt;</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">Script</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">&lt;/td&gt;</span><span class="dl">"</span> <span class="p">;</span>

		<span class="k">if</span><span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">Parameters</span><span class="p">){</span>
			<span class="nx">this_tr</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">this_tr</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">&lt;td&gt;</span><span class="dl">"</span> <span class="p">;</span>
			<span class="nx">entry</span><span class="p">.</span><span class="nx">Parameters</span><span class="p">.</span><span class="nf">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">parameter</span><span class="p">){</span>
				<span class="nx">this_tr</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">this_tr</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">+</span> <span class="nx">parameter</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">&lt;br&gt;</span><span class="dl">"</span> <span class="p">;</span>
			<span class="p">});</span>
			<span class="nx">this_tr</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">this_tr</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">&lt;/td&gt;</span><span class="dl">"</span> <span class="p">;</span>
		<span class="p">}</span>

		<span class="nx">tableListJobs</span><span class="p">.</span><span class="nf">appendChild</span><span class="p">(</span><span class="nx">this_tr</span><span class="p">);</span>
	<span class="p">});</span> <span class="c1">//eof foreach job list</span>

<span class="p">}</span> <span class="c1">// eof debutAffichage</span>

<span class="kd">function</span> <span class="nf">getItemsVtom</span><span class="p">(){</span>
	<span class="k">if</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">Storage</span><span class="p">)</span> <span class="o">!==</span> <span class="dl">"</span><span class="s2">undefined</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">isAllItemsInStorage</span> <span class="o">=</span> <span class="kc">true</span> <span class="p">;</span>
		<span class="nx">itemsVtom</span><span class="p">.</span><span class="nf">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">){</span>
			<span class="k">if</span><span class="p">(</span><span class="nx">sessionStorage</span><span class="p">[</span><span class="dl">"</span><span class="s2">API_</span><span class="dl">"</span><span class="o">+</span><span class="nx">item</span><span class="o">+</span><span class="dl">"</span><span class="s2">_LIST</span><span class="dl">"</span><span class="p">]){</span>
				<span class="nf">eval</span><span class="p">(</span><span class="dl">'</span><span class="s1">window.API_</span><span class="dl">'</span><span class="o">+</span><span class="nx">item</span><span class="o">+</span><span class="dl">'</span><span class="s1">_LIST = JSON.parse(sessionStorage.getItem("API_</span><span class="dl">'</span><span class="o">+</span><span class="nx">item</span><span class="o">+</span><span class="dl">'</span><span class="s1">_LIST")) ;</span><span class="dl">'</span><span class="p">)</span> <span class="p">;</span>
			<span class="p">}</span><span class="k">else</span><span class="p">{</span>
				<span class="nx">isAllItemsInStorage</span> <span class="o">=</span> <span class="kc">false</span> <span class="p">;</span>
			<span class="p">}</span>

		<span class="p">});</span>
		<span class="k">if</span><span class="p">(</span><span class="o">!</span> <span class="nx">isAllItemsInStorage</span><span class="p">){</span>
			<span class="nf">getItemsVtomAPI</span><span class="p">()</span> <span class="p">;</span>
		<span class="p">}</span>

	<span class="p">}</span><span class="k">else</span><span class="p">{</span>
		<span class="nf">getItemsVtomAPI</span><span class="p">()</span> <span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span> <span class="c1">// eof getItemsVtom</span>

<span class="kd">function</span> <span class="nf">removeItemsFromSessionStorage</span><span class="p">(){</span>
	<span class="nx">itemsVtom</span><span class="p">.</span><span class="nf">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">){</span>
		<span class="nx">sessionStorage</span><span class="p">.</span><span class="nf">removeItem</span><span class="p">(</span><span class="dl">"</span><span class="s2">API_</span><span class="dl">"</span><span class="o">+</span><span class="nx">item</span><span class="o">+</span><span class="dl">"</span><span class="s2">_LIST</span><span class="dl">"</span><span class="p">);</span>
	<span class="p">});</span>
<span class="p">}</span>

<span class="c1">// http://www.html5rocks.com/en/tutorials/cors/</span>
<span class="c1">// cross domain </span>
<span class="kd">function</span> <span class="nf">getItemsVtomAPI</span><span class="p">(){</span>
  
 <span class="nx">itemsVtom</span><span class="p">.</span><span class="nf">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">){</span>

	<span class="nf">eval</span><span class="p">(</span><span class="dl">'</span><span class="s1">var xhr</span><span class="dl">'</span><span class="o">+</span><span class="nx">item</span><span class="o">+</span><span class="dl">'</span><span class="s1"> = new XMLHttpRequest();</span><span class="dl">'</span><span class="p">)</span> <span class="p">;</span> 
	<span class="kd">var</span> <span class="nx">strCode</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">xhr</span><span class="dl">'</span><span class="o">+</span><span class="nx">item</span><span class="o">+</span><span class="dl">'</span><span class="s1">.onreadystatechange = function(){</span><span class="dl">'</span> <span class="o">+</span> 
	      <span class="dl">'</span><span class="s1">var status = xhr</span><span class="dl">'</span><span class="o">+</span><span class="nx">item</span><span class="o">+</span><span class="dl">'</span><span class="s1">.status;</span><span class="dl">'</span> <span class="o">+</span>

	      <span class="dl">'</span><span class="s1">if (status == 200) {</span><span class="dl">'</span><span class="o">+</span>
		<span class="dl">'</span><span class="s1">if(xhr</span><span class="dl">'</span><span class="o">+</span><span class="nx">item</span><span class="o">+</span><span class="dl">'</span><span class="s1">.response != null) {</span><span class="dl">'</span> <span class="o">+</span>
			<span class="dl">'</span><span class="s1">window.API_</span><span class="dl">'</span><span class="o">+</span><span class="nx">item</span><span class="o">+</span><span class="dl">'</span><span class="s1">_LIST = xhr</span><span class="dl">'</span><span class="o">+</span><span class="nx">item</span><span class="o">+</span><span class="dl">'</span><span class="s1">.response ;</span><span class="dl">'</span> <span class="o">+</span>
			<span class="dl">'</span><span class="s1">if(typeof(Storage) !== "undefined") {</span><span class="dl">'</span> <span class="o">+</span>
				<span class="dl">'</span><span class="s1">sessionStorage.setItem("API_</span><span class="dl">'</span><span class="o">+</span><span class="nx">item</span><span class="o">+</span><span class="dl">'</span><span class="s1">_LIST",JSON.stringify(window.API_</span><span class="dl">'</span><span class="o">+</span><span class="nx">item</span><span class="o">+</span><span class="dl">'</span><span class="s1">_LIST)) ;</span><span class="dl">'</span> <span class="o">+</span>
			<span class="dl">'</span><span class="s1">}</span><span class="dl">'</span> <span class="o">+</span>
		<span class="dl">'</span><span class="s1">}</span><span class="dl">'</span> <span class="o">+</span> 
	      <span class="dl">'</span><span class="s1">}</span><span class="dl">'</span> <span class="o">+</span>

	<span class="dl">'</span><span class="s1">}</span><span class="dl">'</span> <span class="p">;</span>
	<span class="nf">eval</span><span class="p">(</span><span class="nx">strCode</span><span class="p">);</span>
	<span class="nf">eval</span><span class="p">(</span><span class="dl">'</span><span class="s1">xhr</span><span class="dl">'</span><span class="o">+</span><span class="nx">item</span><span class="o">+</span><span class="dl">"</span><span class="s2">.open('GET', serveurVtom + '/api/</span><span class="dl">"</span><span class="o">+</span><span class="nx">item</span><span class="o">+</span><span class="dl">"</span><span class="s2">/getAll',true);</span><span class="dl">"</span><span class="p">)</span> <span class="p">;</span>
	<span class="nf">eval</span><span class="p">(</span><span class="dl">'</span><span class="s1">xhr</span><span class="dl">'</span><span class="o">+</span><span class="nx">item</span><span class="o">+</span><span class="dl">"</span><span class="s2">.responseType = 'json';</span><span class="dl">"</span><span class="p">)</span> <span class="p">;</span>
	<span class="nf">eval</span><span class="p">(</span><span class="dl">'</span><span class="s1">xhr</span><span class="dl">'</span><span class="o">+</span><span class="nx">item</span><span class="o">+</span><span class="dl">"</span><span class="s2">.setRequestHeader('Authorization', 'Basic ' + authVtom);</span><span class="dl">"</span><span class="p">);</span>
	<span class="nf">eval</span><span class="p">(</span><span class="dl">'</span><span class="s1">xhr</span><span class="dl">'</span><span class="o">+</span><span class="nx">item</span><span class="o">+</span><span class="dl">'</span><span class="s1">.send();</span><span class="dl">'</span><span class="p">)</span> <span class="p">;</span>
 <span class="p">});</span>

<span class="p">}</span> <span class="c1">// eof getItemsVtomAPI</span>

<span class="c1">// On récupère les items</span>
<span class="nf">getItemsVtom</span><span class="p">()</span> <span class="p">;</span>

<span class="kd">function</span> <span class="nf">_isAllItemsLoaded</span><span class="p">(){</span>

 <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">((</span><span class="k">new</span> <span class="nc">Date</span><span class="p">()).</span><span class="nf">getTime</span><span class="p">());</span> <span class="c1">// debug to make sure we pass through this</span>
 
 <span class="kd">var</span> <span class="nx">isAllItemsLoaded</span> <span class="o">=</span> <span class="kc">true</span> <span class="p">;</span>
 <span class="nx">itemsVtom</span><span class="p">.</span><span class="nf">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">){</span>
  
	<span class="k">if</span><span class="p">(</span><span class="nf">eval</span><span class="p">(</span><span class="dl">'</span><span class="s1">window.API_</span><span class="dl">'</span><span class="o">+</span><span class="nx">item</span><span class="o">+</span><span class="dl">'</span><span class="s1">_LIST</span><span class="dl">'</span><span class="p">)</span> <span class="o">==</span> <span class="kc">null</span><span class="p">){</span>
		<span class="nx">isAllItemsLoaded</span> <span class="o">=</span> <span class="kc">false</span> <span class="p">;</span>
	<span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nf">eval</span><span class="p">(</span><span class="dl">'</span><span class="s1">window.API_</span><span class="dl">'</span><span class="o">+</span><span class="nx">item</span><span class="o">+</span><span class="dl">'</span><span class="s1">_LIST.rc</span><span class="dl">'</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">){</span>
		<span class="nx">isAllItemsLoaded</span> <span class="o">=</span> <span class="kc">false</span> <span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nf">eval</span><span class="p">(</span><span class="dl">'</span><span class="s1">window.API_</span><span class="dl">'</span><span class="o">+</span><span class="nx">item</span><span class="o">+</span><span class="dl">'</span><span class="s1">_LIST.errmsg</span><span class="dl">'</span><span class="p">))</span> <span class="p">;</span>
    <span class="nf">clearInterval</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">intervalDebutAffichage</span><span class="p">);</span>
  <span class="p">}</span>
 <span class="p">});</span>
 <span class="k">if</span><span class="p">(</span> <span class="nx">isAllItemsLoaded</span> <span class="p">)</span>
 <span class="p">{</span> 
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">loaded</span><span class="dl">"</span><span class="p">);</span> <span class="c1">// debug to make sure we pass through this </span>
	<span class="nf">clearInterval</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">intervalDebutAffichage</span><span class="p">);</span>
	<span class="nf">debutAffichage</span><span class="p">();</span>
  <span class="k">return</span> <span class="kc">true</span> <span class="p">;</span>
 <span class="p">}</span><span class="k">else</span><span class="p">{</span>
  <span class="k">return</span> <span class="kc">false</span> <span class="p">;</span> 
 <span class="p">}</span>  
<span class="p">}</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span> <span class="nf">_isAllItemsLoaded</span><span class="p">()){</span> <span class="c1">// si les items ne sont pas chargés au démarrage, on lance une boucle interval</span>
  <span class="c1">// On vérifie qu'on a bien chargé toutes les données, on affiche quand c'est ok</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">intervalDebutAffichage</span> <span class="o">=</span> <span class="nf">setInterval</span><span class="p">(</span><span class="nx">_isAllItemsLoaded</span><span class="p">,</span><span class="mi">1000</span><span class="p">);</span> 

  <span class="c1">// quoi qu'il arrive on sort de la boucle au bout de x secondes</span>
  <span class="nf">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span> 
    <span class="nf">clearInterval</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">intervalDebutAffichage</span><span class="p">);</span>
  <span class="p">},</span> <span class="mi">60000</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Events</span>

<span class="c1">// Refresh data</span>
<span class="nb">document</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">#refresh-button</span><span class="dl">'</span><span class="p">).</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
	<span class="nf">removeItemsFromSessionStorage</span><span class="p">();</span>
	<span class="nb">window</span><span class="p">.</span><span class="nx">location</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span> <span class="p">;</span>	
<span class="p">})</span> <span class="p">;</span>

<span class="nt">&lt;/script&gt;</span>

<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>Bon évidemment ça ne donnera rien mais importer cette page chez vous, et changer l’IP, le port et le mot de passe pour que ça fonctionne.</p>

<h2 id="exemple-pour-lister-toutes-les-consignes">Exemple pour lister toutes les consignes</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># on récupère les données en JSON depuis l'API web access VTOM
curl -k -u user:passwd "http://localhost:30080/api/instruction/getAll &gt; /var/tmp/instructions.json

# on créé le script qui va générer les consignes au format HTML
vi /var/tmp/create_instructions_html.py
#!/usr/bin/python
import json
import sys
import io

jdata = open(sys.argv[1])
data = json.load(jdata)

for result in data["result"]:
        with io.open(result["name"] + ".html", "w", encoding='utf-8') as f:
                f.write(result["content"])
                f.close()
jdata.close()


# On exécute le script 
chmod +x /var/tmp/create_instructions_html.py
/var/tmp/create_instructions_html.py /var/tmp/instructions.json
</code></pre></div></div>
</p>
      
    </div>

  </li>
  
  
  
  <li>
    <div class="card">
      <h4><a class="post-link" href="/archives/documentations-vtom-absyss-telecharger-officielle/">Documentations VTOM, comment télécharger la doc officielle absyss</a></h4>
      <p><p>La question revient assez fréquemment. Comment se procurer la documentation officielle VTOM Absyss ?
Je n’ai pas le droit de diffuser les documentations VTOM car c’est strictement interdit par l’éditeur Absyss.</p>

<h1 id="modalité-pour-télécharger-la-documentation">Modalité pour télécharger la documentation</h1>

<h2 id="vous-êtes-client">Vous êtes client</h2>
<p>La documentation se trouve sur votre CD d’installation.</p>

<p>Cependant, si vous souhaitez avoir la documentation de versions plus récentes :</p>

<p>Téléphonez à la hotline, ils vous donneront, gratuitement, un lien FTP et une procédure pour les obtenir (voir ci-dessous pour les coordonnées)</p>

<h2 id="vous-nêtes-pas-client">Vous n’êtes pas client</h2>
<p>Téléphonnez au numéro ci-dessous. Demandez un commercial avant-vente, il se fera une joie de vous éclairer sur le produit VTOM.</p>

<p>Il vous donnera très certainement la documentation si vous la souhaitez et, vous proposera une maquette adaptée à votre contexte.</p>

<h1 id="coordonnées-absyss">Coordonnées Absyss</h1>

<p><a href="http://www.absyss.fr/contact.html">Contact Absyss</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ABSYSS
15/17 boulevard du Général de Gaulle
92120 MONTROUGE - France
33 (0) 1 40 84 89 01 (standard)
33 (0) 1 40 84 85 91 (hotline)
33 (0) 1 40 84 88 40 Fax
hotline@absyss.com
</code></pre></div></div>
</p>
      
    </div>

  </li>
  
  
  
  <li>
    <div class="card">
      <h4><a class="post-link" href="/archives/vtom-tlist-ameliore-affichage-script-parametres-et-autres-champs/">tlist amélioré affichage script paramètres et autres champs</a></h4>
      <p><p>
edit 20/08/2015 )

J'ai trouvé plus simple pour le même résultat, ça fait un script en moins à maintenir ! 
allez faire un tour sur mon article <a href="https://virtual-thom.github.io/archives/vthttpd-dump-requete-sql" title="vthttpd dump et requêtes SQL sur votre base VTOM">vthttpd dump et requêtes SQL sur votre base VTOM</a>
</p>

Pour tous les frustrés du tlist VTOM qui est assez pauvre en informations,voici mon tlist (ok je sais, il y a la "Recherche" dans l'IHM mais le mode commande tlist est loin d'être suffisant). 
Je m'en sers notamment pour chercher tous les jobs avec un certain script et un certain paramètre, pour les mettre à STOP ou sortir un fichier csv. Et tout ça en mode commande.

Grâce au vtexport en xml, il permet de lister rapidement les applications et les jobs avec les champs et les options suivantes :
<pre>
Liste des options :

 Parametres  Valeurs / Formats Caracteristiques
 ----------- ----------------- -------------------------------------------------------
 -h                            Affiche l'aide
 -f          ENV[/APP][/JOB]   Filtre sur environnement/application/traitement (le nom
                               de l'application ou du traitement est optionnel)
 -novt                         Ne re-genere pas un nouvel vtexport 
 -myvt       path              Specifie le chemin du fichier vtexport.xml (couple avec
                               l'option -novt, permet de specifier votre fichier
                               vtexport.xml)
 -app                          N'affiche que les applications 
 -job                          N'affiche que les traitements 
 -encours                      Filtre les traitements en cours d'execution 
 -items      item[/item]..     N'affiche que certains items dans la liste
 -searchJ    item=value        Filtre les jobs selon une recherche de pattern sur un ou
                               plusieurs items 
 -excludeJ   item=value        Exclure les jobs selon une recherche de pattern sur un ou
                               plusieurs items
 -csv        motif             Permet de specifier un motif de separation (; par defaut)
 -output     path/fic          Permet de rediriger la sortie standard vers un fichier
 -status     R|U|F|W|E         Permet de filtrer les jobs avec un certain statut
                               R=En cours;U=Non planifie;F=Termine;W=A venir;E=Erreur
 -nofirstline                  N'affiche pas la premiere ligne recapitulative d item
 -debug                        Affiche  la requete XPath

Liste des items et sortie a l'ecran par defaut :
item;env;app;job;minStart;maxStart;maxLength;cycleEnabled;cycle;mode;retained;onDemand;daysInWeek;daysInMonth;weeksInMonth;monthsInYear;isFormula;formula;comment;information;date;user;status;host;queue;script;parameter;

Liste des items pris en charge par searchJ et excludeJ : 
env | app | job | status | cycleEnabled | script | parameter[position] | host | mode | onDemand | queue | user | retained

Signification des valeurs : 
	Planning
	1 = yes ; 0 = no ;
	B = Both (chome + ouvre) ; W = Worked (ouvre) ; N = No (chome)

	Mode;
	J = traitement ; O = stop ; T = test ; S = simulation ; E = execution

	Status;
	R = En cours ; U = Non planifie ; F = Termine ; W = A venir ; E = En erreur

Exemples : 
        $0 -novt -myvt /tmp/monvtexport.xml -items env/app/job/parameter -searchJ script=netbackup -searchJ env=PROD -excludeJ job=CFG

        $0 -searchJ parameter1=MA_POLICIE_NETBACKUP
 
        $0 > /tmp/domaine_prod.csv		
</pre>

<a href="https://virtual-thom.github.io/archives/wp-content/uploads/tlist.pl">tlist amélioré VTOM</a>
<s>Vous pouvez tester ce code sur codingground à cette adresse :</s>(ils ont changé la VM, je n'arrive plus à mettre la librairie XML::LibXML <a href="http://goo.gl/6MXx2I">http://goo.gl/6MXx2I</a>

<p>
Vous pouvez uploader votre fichier vtexport, testez le script en n'oubliant pas de spécifier -novt et -myvt nomvotrevtexport (évidemment VTOM n'est pas installé, il n'y a donc pas la commande vtexport)
</p>
<p>
Mise à jour pour Antoine avec les ressources :
<a href="https://virtual-thom.github.io/archives/wp-content/uploads/tlist_resources.pl">tlist amélioré VTOM avec les ressources</a>
</p>
<p>
  <a href="https://virtual-thom.github.io/archives/scripts/Tlist_All_Jobs.pl" title="Tlist all jobs amélioré">tlist all jobs amélioré</a>
</p>
</p>
      
    </div>

  </li>
  
  
  
  <li>
    <div class="card">
      <h4><a class="post-link" href="/archives/comment-executer-un-script-powershell-avec-vtom/">Comment exécuter un script powershell avec VTOM</a></h4>
      <p>Nouveau job, nouveau contexte, et un nombre impressionnant de plateformes Windows. Ma balance de serveurs 80% Unix / 20% Windows vient de basculer.
Qui dit Windows, dit scripts Powershell. 
Mieux vaut un qui sait, que dix qui cherchent comme on dit.

<h2>Installation du client VTOM en 64 bits !</h2>
<strong>On peut aussi laisser le client VTOM 32 bits mais dans ce cas là, il faudra lancer le powerhsell x86 dans la queue(car celui par défaut dans le PATH des OS 64Bits est le powershell 64bits)</strong>
<ul>
	<li>Arrêter l'agent VTOM AbsyssBatchManager dans services.msc</li>
	<li>Se déplacer dans %ABM_BIN%\..\services</li>
        <li>Renommer bdaemon.exe en bdaemon-32.exe et bdaemon-64.exe en bdaemon.exe</li>
	<li>Relancer l'agent VTOM AbsyssBatchManager dans services.msc</li>
 </ul>
 
<p>on peut vérifier si le bdaemon.exe est en 32 ou 64 Bits dans le Gestionnaire des Tâches Windows. Ca sera préciser (x32)</p>

<h2>Une queue particulière pour lancer les scripts Powershell</h2>
Je passe les mises en formes et fioritures habituelles <a href="/ecrire-sa-queue-batch-vtom-cygwin-php-perl/" title="Ecrire sa queue batch vtom">(voir mon article sur les queues d'exécution VTOM)</a>.
La commande principale pour lancer des scripts powershell est la suivante (même si on peut adapter, voir get-help about_Powershell.exe).
<strong>Noubliez pas de mettre le full path du powershell x86 si vous avez un client VTOM 32 bits</strong>
<pre lang="powershell">PowerShell.exe -ExecutionPolicy Unrestricted -NonInteractive -File &lt;FilePath&gt; [&lt;Args&gt;]</pre>
Attention, si vous avez des problèmes de sécurité (« Impossible de charger le fichier c:\script.ps1 car l’exécution de scripts est désactivée sur ce système. Pour plus d’information, consultez…. »), regardez de ce côté : get-help about_Execution_Policies ou about_Signing). L'idée, c'est que la stratégie de sécurité est généralement restreinte pour ne pouvoir lancer aucun script powershell.
<pre lang="powershell">get-executionpolicy
Restricted
set-executionpolicy Unrestricted
</pre>
</p>
      
    </div>

  </li>
  
  
  
  <li>
    <div class="card">
      <h4><a class="post-link" href="/archives/vtom-impossible-de-changer-les-queues-d-execution-sous-windows/">Impossible de changer les Queues d'exécution sous Windows</a></h4>
      <p><p>Alors celle-là, si on ne la sait pas, on ne peut pas l’inventer. 
Ca vous est peut-être déjà arrivé ? Vous voulez changer les queues d’exécution sur un client Windows et rien n’y fait. Vous modifiez le %systemroot%\vtom.ini en rajoutant votre queue /queue_maqueue:nbMaxExecSimultanées, vous relancez le client et queue_maqueue n’est toujours pas prise en charge par le client VTOM.</p>

<p>Pour rappel, installation d’une queue sous <a href="/ecrire-sa-queue-batch-vtom-cygwin-php-perl/#install_windows" title="Ecrire sa queue batch VTOM (cygwin, php, perl, sap)">Windows</a>.
Une fois que ces éléments sont bien modifiés, je vous invite d’ailleurs à redémarrer votre client VTOM et à faire un %ABM_BIN%\bstat pour bien vérifier quelles sont les queues d’exécution prises en compte sur votre client.</p>

<h2>La solution :</h2>
<p>En fait, c’est tout bête. Selon votre configuration Windows, si vous avez mis un utilisateur particulier de connexion dans votre service AbsyssBatchManager (disons LukeSkywalker), il faut aller dans %userprofile%\Windows\vtom.ini (en gros dans C:\Users\LukeSkywalker\Windows\vtom.ini).</p>

<p>Merci à Fred :)</p>
</p>
      
    </div>

  </li>
  
  
  
  <li>
    <div class="card">
      <h4><a class="post-link" href="/archives/script-shell-dd-generator/">Script shell dd generator</a></h4>
      <p><h1 id="la-commande-dd-en-shell-à-quoi-ça-sert-">La commande dd en shell, à quoi ça sert ?</h1>
<p>Je vois deux principaux intérêts à la commande dd unix.</p>
<ol>
  <li>Copie bloc à bloc d’un support (CD, DVD, Clé, Disques, etc.)</li>
  <li>Test de performance d’écriture entre la source et la destination de la copie.</li>
</ol>

<p>edit 2015)</p>
<p>je viens de découvrir qu'on pouvait créer un fichier plein de zéro (avec dd par exemple), le formater, et le monter comme si c'était un filesystem ! ça me parait fou mais ça semble fonctionner. Très pratique quand il n'y a pas de VG ou plus de place pour créer des lv, ou pas de fs disponible. 

Ca permet surtout de cloisonner l'espace disque si, par exemple, on ne veut pas qu'un répertoire impacte le fs complet.
<a href="http://souptonuts.sourceforge.net/quota_tutorial.html" title="Linux quota tutorial">Magnifique tutorial de quota pour linux</a>
<pre>
Next, create a 20M file (disk image) in a suitable location. What I did below is create the file disk-quota.ext3 in the directory /usr/disk-img.

   # mkdir -p /usr/disk-img
   # dd if=/dev/zero of=/usr/disk-img/disk-quota.ext3 count=40960
The dd command above created a 20MB file because, by default, dd uses a block size of 512 bytes. That makes this size: 40960*512=20971520. For kicks, we'll confirm this size.

   # ls -lh /usr/disk-img/disk-quota.ext3
   -rw-r--r--  1 root root 20M Jul 19 14:34 /usr/disk-img/disk-quota.ext3
Next, format this as an ext3 filesystem.

   # /sbin/mkfs -t ext3 -q /usr/disk-img/disk-quota.ext3 -F
The "-t" gives it the type. You're not limited to ext3. In fact, you could use ext2 or other filesystems installed on your system. The "-q" is for the device, and "-F" is to force the creation without warning us that this is a file and not a block device.
</pre>
</p>

<p><a title="Lien Wikipédia dd (Unix)" href="http://fr.wikipedia.org/wiki/Dd_%28Unix%29">Lien Wikipédia dd (Unix).</a></p>

<p>Toujours est-il que les paramètres de la commande ne sont pas forcément triviales. C’est pourquoi j’ai fait un petit script shell avec un menu.</p>

<h1 id="script">Script</h1>
<p><a href="https://virtual-thom.github.io/archives/wp-content/uploads/dd_generator.sh.txt">dd_generator.sh</a></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/sh</span>
<span class="c">#</span>
<span class="c">#	SCRIPT	: dd_generator</span>
<span class="c">#	AUTEUR 	: Virtual Thom</span>
<span class="c">#	DATE	: 02.10.13</span>
<span class="c"># set -x # debug</span>
<span class="c"># set -n # verif syntax sans exec</span>
<span class="c">#</span>
<span class="c">##################################</span>
<span class="c">#	VARIABLES</span>
<span class="c">##################################</span>
<span class="nv">datenow</span><span class="o">=</span><span class="si">$(</span><span class="nb">date</span> +<span class="s2">"%d-%m-%y_%H.%M.%S"</span><span class="si">)</span>
<span class="nv">ibs</span><span class="o">=</span><span class="s1">'1024'</span> <span class="c"># nombre d'octet lu d'un coup du if</span>
<span class="nv">count</span><span class="o">=</span><span class="s1">'10000'</span> <span class="c"># nombre de segments ibs lu (si 0 il va au bout du fichier)</span>
<span class="nv">unit</span><span class="o">=</span><span class="s1">'Mo'</span>
<span class="nv">unit_base</span><span class="o">=</span>1024
<span class="nv">unit_mo</span><span class="o">=</span><span class="sb">`</span><span class="nb">expr</span> <span class="k">${</span><span class="nv">unit_base</span><span class="k">}</span> <span class="se">\*</span> <span class="k">${</span><span class="nv">unit_base</span><span class="k">}</span><span class="sb">`</span>
<span class="nv">unit_go</span><span class="o">=</span><span class="sb">`</span><span class="nb">expr</span> <span class="k">${</span><span class="nv">unit_mo</span><span class="k">}</span> <span class="se">\*</span> <span class="k">${</span><span class="nv">unit_base</span><span class="k">}</span><span class="sb">`</span>
<span class="nv">unit_to</span><span class="o">=</span><span class="sb">`</span><span class="nb">expr</span> <span class="k">${</span><span class="nv">unit_go</span><span class="k">}</span> <span class="se">\*</span> <span class="k">${</span><span class="nv">unit_base</span><span class="k">}</span><span class="sb">`</span>
fonc_calc_unit<span class="o">(){</span>
<span class="k">case</span> <span class="k">${</span><span class="nv">unit</span><span class="k">}</span> <span class="k">in</span>
	<span class="s2">"octets"</span><span class="p">)</span>
	<span class="nv">unit_calc</span><span class="o">=</span>1
	<span class="p">;;</span>
	<span class="s2">"Ko"</span><span class="p">)</span>
	<span class="nv">unit_calc</span><span class="o">=</span><span class="k">${</span><span class="nv">unit_base</span><span class="k">}</span>
	<span class="p">;;</span>
	<span class="s2">"Go"</span><span class="p">)</span>
	<span class="nv">unit_calc</span><span class="o">=</span><span class="k">${</span><span class="nv">unit_go</span><span class="k">}</span>
	<span class="p">;;</span>
	<span class="s2">"To"</span><span class="p">)</span>
	<span class="nv">unit_calc</span><span class="o">=</span><span class="k">${</span><span class="nv">unit_to</span><span class="k">}</span>
	<span class="p">;;</span>
	<span class="s2">"Mo"</span> <span class="p">|</span> <span class="k">*</span><span class="p">)</span>
	<span class="nv">unit_calc</span><span class="o">=</span><span class="k">${</span><span class="nv">unit_mo</span><span class="k">}</span>
	<span class="p">;;</span>
<span class="k">esac</span> 
<span class="o">}</span>
fonc_calc_unit
<span class="c">#total_size='expr ${ibs} \* ${count} \/ ${unit_calc}' # par defaut en Mo, doit être évaluer</span>
<span class="nv">total_size</span><span class="o">=</span><span class="s2">"echo 'scale=2;</span><span class="k">${</span><span class="nv">ibs</span><span class="k">}</span><span class="s2"> * </span><span class="k">${</span><span class="nv">count</span><span class="k">}</span><span class="s2"> / </span><span class="k">${</span><span class="nv">unit_calc</span><span class="k">}</span><span class="s2">' | bc"</span> <span class="c"># par defaut en Mo, doit être évaluer</span>
<span class="nv">total_size_msg</span><span class="o">=</span><span class="s1">'echo "Taille Totale (en $unit) :"'</span>
<span class="nv">of_path</span><span class="o">=</span><span class="s1">'echo "${PWD}/dd_`eval ${total_size}`${unit}_${datenow}.bin"'</span> <span class="c"># par defaut fichier écrit dans le répertoire courant</span>
<span class="nv">if_path</span><span class="o">=</span><span class="s1">'/dev/zero'</span> <span class="c"># par defaut fichier lu constitué de vide </span>
<span class="nv">msg_retour</span><span class="o">=</span><span class="s2">"Tapez retour99 ou laissez vide pour ne pas changer la valeur"</span>

<span class="c">##################################</span>
<span class="c">#	FONCTIONS</span>
<span class="c">##################################</span>
date_heure<span class="o">(){</span>
        <span class="nv">date_heure_var</span><span class="o">=</span><span class="sb">`</span><span class="nb">date</span> +<span class="s2">"%d/%m/%Y - %H:%M:%S : "</span><span class="sb">`</span>
        <span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">date_heure_var</span><span class="k">}</span><span class="nv">$1</span><span class="s2">"</span>
<span class="o">}</span>
date_simple<span class="o">(){</span>
        <span class="nv">date_heure_var</span><span class="o">=</span><span class="sb">`</span><span class="nb">date</span> +<span class="s2">"%d%m%Y_%H%M%S"</span><span class="sb">`</span>
        <span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">date_heure_var</span><span class="k">}</span><span class="s2">"</span>
<span class="o">}</span>
fonc_sortie<span class="o">(){</span>
        <span class="nv">numero_exit</span><span class="o">=</span><span class="nv">$1</span>
        <span class="nv">message_exit</span><span class="o">=</span><span class="nv">$2</span>
        date_heure <span class="s2">"</span><span class="k">${</span><span class="nv">message_exit</span><span class="k">}</span><span class="s2">"</span>
        date_heure <span class="s2">"Fin du script. Exit : </span><span class="k">${</span><span class="nv">numero_exit</span><span class="k">}</span><span class="s2">"</span>
        <span class="nb">exit</span> <span class="k">${</span><span class="nv">numero_exit</span><span class="k">}</span>
<span class="o">}</span>
fonc_pause<span class="o">(){</span>
   <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">Appuyez sur Entrer pour continuer...</span><span class="se">\c</span><span class="s2">"</span>
   <span class="nb">read</span>
<span class="o">}</span>
fonc_trap_exit<span class="o">(){</span>
	<span class="nb">echo</span> <span class="s2">""</span>
	fonc_sortie <span class="s2">"123"</span> <span class="s2">"Script interrompu"</span>
<span class="o">}</span>
<span class="nb">trap</span> <span class="s1">'fonc_trap_exit'</span> 2
fonc_menu_principal<span class="o">(){</span>
	clear

	<span class="c">#TITRE </span>
	<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n\t</span><span class="s2">################</span><span class="se">\n\t</span><span class="s2"># DD GENERATOR #</span><span class="se">\n\t</span><span class="s2">################</span><span class="se">\n</span><span class="s2">"</span>
	<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n\t</span><span class="s2">dd of=</span><span class="sb">`</span><span class="nb">eval</span> <span class="k">${</span><span class="nv">of_path</span><span class="k">}</span><span class="sb">`</span><span class="s2"> if=</span><span class="k">${</span><span class="nv">if_path</span><span class="k">}</span><span class="s2"> ibs=</span><span class="k">${</span><span class="nv">ibs</span><span class="k">}</span><span class="s2"> count=</span><span class="k">${</span><span class="nv">count</span><span class="k">}</span><span class="se">\n</span><span class="s2">"</span>
	<span class="nv">PS3</span><span class="o">=</span><span class="s2">"Selectionner une option et appuyer sur Entrer :"</span>

	<span class="k">select </span>options <span class="k">in</span> <span class="s2">"Unite par defaut : </span><span class="nv">$unit</span><span class="s2">"</span> <span class="s2">"Fichier lu : </span><span class="nv">$if_path</span><span class="s2">"</span> <span class="s2">"Fichier ecrit : </span><span class="sb">`</span><span class="nb">eval</span> <span class="nv">$of_path</span><span class="sb">`</span><span class="s2">"</span> <span class="s2">"Taille segment de lecture (octet) : </span><span class="nv">$ibs</span><span class="s2">"</span> <span class="s2">"Nombre de Segment : </span><span class="nv">$count</span><span class="s2">"</span> <span class="s2">"</span><span class="sb">`</span><span class="nb">eval</span> <span class="nv">$total_size_msg</span><span class="sb">`</span><span class="s2"> </span><span class="sb">`</span><span class="nb">eval</span> <span class="se">\"</span><span class="nv">$total_size</span><span class="se">\"</span><span class="sb">`</span><span class="s2">"</span> <span class="s2">"Creer le fichier"</span> <span class="s2">"Quitter"</span>
	<span class="k">do
	case</span> <span class="k">${</span><span class="nv">options</span><span class="k">}</span>	 <span class="k">in</span> 
		<span class="s2">"Unite par defaut : </span><span class="nv">$unit</span><span class="s2">"</span><span class="p">)</span>
			menu_unit
		<span class="p">;;</span>
		<span class="s2">"Fichier lu : </span><span class="nv">$if_path</span><span class="s2">"</span><span class="p">)</span>
			clear
			<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"Veuillez entrer le chemin complet du fichier à lire : </span><span class="se">\n\t</span><span class="s2">(</span><span class="k">${</span><span class="nv">msg_retour</span><span class="k">}</span><span class="s2">)"</span>
			<span class="nb">read </span>read_if_path
			fonc_test_retour <span class="s2">"</span><span class="k">${</span><span class="nv">read_if_path</span><span class="k">}</span><span class="s2">"</span> <span class="o">&amp;&amp;</span>  <span class="nv">if_path</span><span class="o">=</span><span class="k">${</span><span class="nv">read_if_path</span><span class="k">}</span>
			fonc_menu_principal
		<span class="p">;;</span>
		<span class="s2">"Fichier ecrit : </span><span class="sb">`</span><span class="nb">eval</span> <span class="nv">$of_path</span><span class="sb">`</span><span class="s2">"</span><span class="p">)</span>
			clear
			<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"Veuillez entrer le chemin complet du fichier à créer : </span><span class="se">\n\t</span><span class="s2">(</span><span class="k">${</span><span class="nv">msg_retour</span><span class="k">}</span><span class="s2">)"</span>
			<span class="nb">read </span>read_of_path
			fonc_test_retour <span class="s2">"</span><span class="k">${</span><span class="nv">read_of_path</span><span class="k">}</span><span class="s2">"</span>
			<span class="k">if </span><span class="nb">test</span> <span class="nv">$?</span> <span class="nt">-eq</span> 0
			<span class="k">then
				</span><span class="nv">of_path_tmp</span><span class="o">=</span><span class="k">${</span><span class="nv">read_of_path</span><span class="k">}</span>
				<span class="nv">of_path</span><span class="o">=</span><span class="s1">'echo ${of_path_tmp}'</span>
			<span class="k">fi
			</span>fonc_menu_principal
		<span class="p">;;</span>
		<span class="s2">"Taille segment de lecture (octet) : </span><span class="nv">$ibs</span><span class="s2">"</span><span class="p">)</span>
			clear
			<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"Veuillez entrer la taille du segment lu : </span><span class="se">\n\t</span><span class="s2">(</span><span class="k">${</span><span class="nv">msg_retour</span><span class="k">}</span><span class="s2">)"</span>
			<span class="nb">read </span>read_ibs 
			fonc_test_retour <span class="s2">"</span><span class="k">${</span><span class="nv">read_ibs</span><span class="k">}</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> <span class="nv">ibs</span><span class="o">=</span><span class="k">${</span><span class="nv">read_ibs</span><span class="k">}</span>
			fonc_menu_principal
		<span class="p">;;</span>
		<span class="s2">"Nombre de Segment : </span><span class="nv">$count</span><span class="s2">"</span><span class="p">)</span>
			clear
			<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"Veuillez entrer le nombre de segment : </span><span class="se">\n\t</span><span class="s2">(</span><span class="k">${</span><span class="nv">msg_retour</span><span class="k">}</span><span class="s2">)</span><span class="se">\n\t</span><span class="s2">(tapez 0 pour copier le fichier if en totalite)"</span>
			<span class="nb">read </span>read_count 
			fonc_test_retour <span class="s2">"</span><span class="k">${</span><span class="nv">read_count</span><span class="k">}</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> <span class="nv">count</span><span class="o">=</span><span class="k">${</span><span class="nv">read_count</span><span class="k">}</span>
			fonc_menu_principal
		<span class="p">;;</span>
		<span class="s2">"</span><span class="sb">`</span><span class="nb">eval</span> <span class="nv">$total_size_msg</span><span class="sb">`</span><span class="s2"> </span><span class="sb">`</span><span class="nb">eval</span> <span class="se">\"</span><span class="nv">$total_size</span><span class="se">\"</span><span class="sb">`</span><span class="s2">"</span><span class="p">)</span>
			clear
			<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"Veuillez entrer </span><span class="sb">`</span><span class="nb">eval</span> <span class="nv">$total_size_msg</span><span class="sb">`</span><span class="s2"> </span><span class="sb">`</span><span class="nb">eval</span> <span class="se">\"</span><span class="nv">$total_size</span><span class="se">\"</span><span class="sb">`</span><span class="s2"> : </span><span class="se">\n\t</span><span class="s2">(</span><span class="k">${</span><span class="nv">msg_retour</span><span class="k">}</span><span class="s2">)</span><span class="se">\n\t</span><span class="s2">(tapez 0 pour copier le fichier if en totalite)"</span>
			<span class="nb">read </span>read_total_size 
			fonc_test_retour <span class="s2">"</span><span class="k">${</span><span class="nv">read_total_size</span><span class="k">}</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> fonc_calc_count	
			fonc_menu_principal
		<span class="p">;;</span>
		<span class="s2">"Creer le fichier"</span><span class="p">)</span>
			fonc_dd_generator
			fonc_sortie <span class="nv">$?</span>  
		<span class="p">;;</span>
		<span class="s2">"Quitter"</span><span class="p">)</span>
			fonc_sortie 0
		<span class="p">;;</span>
		
	<span class="k">esac</span>
	<span class="nb">echo</span> <span class="s2">""</span>
	<span class="nv">REPLY</span><span class="o">=</span>
	clear
	<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n\n\t</span><span class="s2">DD GENERATOR</span><span class="se">\n\n</span><span class="s2">"</span>
	<span class="k">done
	</span>clear
<span class="o">}</span>
fonc_dd_generator<span class="o">(){</span>
    <span class="k">if </span><span class="nb">test</span> <span class="nv">$count</span> <span class="nt">-eq</span> 0 
	<span class="k">then 	
		</span><span class="nb">echo</span> <span class="s2">"dd of=</span><span class="sb">`</span><span class="nb">eval</span> <span class="k">${</span><span class="nv">of_path</span><span class="k">}</span><span class="sb">`</span><span class="s2"> if=</span><span class="k">${</span><span class="nv">if_path</span><span class="k">}</span><span class="s2"> ibs=</span><span class="k">${</span><span class="nv">ibs</span><span class="k">}</span><span class="s2">"</span>
		<span class="nb">dd </span><span class="nv">of</span><span class="o">=</span><span class="sb">`</span><span class="nb">eval</span> <span class="k">${</span><span class="nv">of_path</span><span class="k">}</span><span class="sb">`</span> <span class="k">if</span><span class="o">=</span><span class="k">${</span><span class="nv">if_path</span><span class="k">}</span> <span class="nv">ibs</span><span class="o">=</span><span class="k">${</span><span class="nv">ibs</span><span class="k">}</span> <span class="o">&amp;&amp;</span> 
		<span class="nb">echo</span> <span class="s2">"Le fichier </span><span class="sb">`</span><span class="nb">eval</span> <span class="k">${</span><span class="nv">of_path</span><span class="k">}</span><span class="sb">`</span><span class="s2"> a été créé"</span> 
	<span class="k">else
		</span><span class="nb">echo</span> <span class="s2">"dd of=</span><span class="sb">`</span><span class="nb">eval</span> <span class="k">${</span><span class="nv">of_path</span><span class="k">}</span><span class="sb">`</span><span class="s2"> if=</span><span class="k">${</span><span class="nv">if_path</span><span class="k">}</span><span class="s2"> ibs=</span><span class="k">${</span><span class="nv">ibs</span><span class="k">}</span><span class="s2"> count=</span><span class="k">${</span><span class="nv">count</span><span class="k">}</span><span class="s2">"</span> 
		<span class="nb">dd </span><span class="nv">of</span><span class="o">=</span><span class="sb">`</span><span class="nb">eval</span> <span class="k">${</span><span class="nv">of_path</span><span class="k">}</span><span class="sb">`</span> <span class="k">if</span><span class="o">=</span><span class="k">${</span><span class="nv">if_path</span><span class="k">}</span> <span class="nv">ibs</span><span class="o">=</span><span class="k">${</span><span class="nv">ibs</span><span class="k">}</span> <span class="nv">count</span><span class="o">=</span><span class="k">${</span><span class="nv">count</span><span class="k">}</span><span class="o">&amp;&amp;</span> 
		<span class="nb">echo</span> <span class="s2">"Le fichier </span><span class="sb">`</span><span class="nb">eval</span> <span class="k">${</span><span class="nv">of_path</span><span class="k">}</span><span class="sb">`</span><span class="s2"> a été créé"</span> 
	<span class="k">fi</span>
<span class="o">}</span>
fonc_test_retour<span class="o">(){</span>
	<span class="k">if </span><span class="nb">test</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"retour99"</span> <span class="nt">-o</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> 
	<span class="k">then
		return </span>250
	<span class="k">else
		return </span>0
	<span class="k">fi</span>
<span class="o">}</span>
menu_unit<span class="o">(){</span>
	clear

        <span class="c">#TITRE</span>
        <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n\n\t</span><span class="s2">Unite actuelle : </span><span class="nv">$unit</span><span class="se">\n\n</span><span class="s2">"</span>
        <span class="nv">PS3</span><span class="o">=</span><span class="s2">"Selectionner une option et appuyer sur Entrer :"</span>

        <span class="k">select </span>options <span class="k">in</span> <span class="s2">"octets"</span> <span class="s2">"Ko"</span> <span class="s2">"Mo"</span> <span class="s2">"Go"</span> <span class="s2">"To"</span> <span class="s2">"Retour"</span>
	<span class="k">do
		case</span> <span class="k">${</span><span class="nv">options</span><span class="k">}</span> <span class="k">in</span> 
			<span class="s2">"octets"</span><span class="p">)</span>
				<span class="nv">unit</span><span class="o">=</span><span class="s1">'octets'</span>
				fonc_calc_unit
				fonc_menu_principal
			<span class="p">;;</span>
			<span class="s2">"Ko"</span><span class="p">)</span>
				<span class="nv">unit</span><span class="o">=</span><span class="s1">'Ko'</span>
				fonc_calc_unit
				fonc_menu_principal
			<span class="p">;;</span>
			<span class="s2">"Mo"</span><span class="p">)</span>
				<span class="nv">unit</span><span class="o">=</span><span class="s1">'Mo'</span>
				fonc_calc_unit
				fonc_menu_principal
			<span class="p">;;</span>
			<span class="s2">"Go"</span><span class="p">)</span>
				<span class="nv">unit</span><span class="o">=</span><span class="s1">'Go'</span>
				fonc_calc_unit
				fonc_menu_principal
			<span class="p">;;</span>
			<span class="s2">"To"</span><span class="p">)</span>
				<span class="nv">unit</span><span class="o">=</span><span class="s1">'To'</span>
				fonc_calc_unit
				fonc_menu_principal
			<span class="p">;;</span>
			<span class="s2">"Retour"</span><span class="p">)</span>
				fonc_menu_principal
				<span class="nb">break</span>
			<span class="p">;;</span>
		<span class="k">esac</span>
        <span class="nb">echo</span> <span class="s2">""</span>
        <span class="nv">REPLY</span><span class="o">=</span>
        clear
        <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n\n\t</span><span class="s2">Unit actuelle : </span><span class="nv">$unit</span><span class="se">\n\n</span><span class="s2">"</span>
        <span class="k">done
        </span>clear

<span class="o">}</span>
fonc_calc_count<span class="o">(){</span>
	<span class="nv">count</span><span class="o">=</span><span class="sb">`</span><span class="nb">expr</span> <span class="k">${</span><span class="nv">read_total_size</span><span class="k">}</span> <span class="se">\*</span> <span class="k">${</span><span class="nv">unit_calc</span><span class="k">}</span> <span class="se">\/</span> <span class="k">${</span><span class="nv">ibs</span><span class="k">}</span><span class="sb">`</span>
<span class="o">}</span>

<span class="c">##################################</span>
<span class="c">#	SCRIPT</span>
<span class="c">##################################</span>
fonc_menu_principal
<span class="c"># end of script</span>
</code></pre></div></div>

<h1 id="résultat-du-script-dd_generatorsh">Résultat du script dd_generator.sh</h1>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>################
# DD GENERATOR #
################
dd of=/SCRIPTS/dd_9.76Mo_15-10-14_09.53.09.bin if=/dev/zero ibs=1024 count=10000
1) Unite par defaut : Mo
2) Fichier lu : /dev/zero
3) Fichier ecrit : /SCRIPTS/dd_9.76Mo_15-10-14_09.53.09.bin
4) Taille segment de lecture (octet) : 1024
5) Nombre de Segment : 10000
6) Taille Totale (en Mo) : 9.76
7) Creer le fichier

8) Quitter
Selectionner une option et appuyer sur Entrer :7

dd of=/SCRIPTS/dd_9.76Mo_15-10-14_09.53.09.bin if=/dev/zero ibs=1024 count=10000
10000+0 enregistrements lus
20000+0 enregistrements écrits
10240000 octets (10 MB) copiés, 0,05625 seconde, 182 MB/s
Le fichier /SCRIPTS/dd_9.76Mo_15-10-14_09.53.09.bin a été créé
15/10/2014 - 09:53:33 :
15/10/2014 - 09:53:33 : Fin du script. Exit : 0

#ls -lisa /SCRIPTS/dd_9.76Mo_15-10-14_09.53.09.bin
23592966 10016 -rw-r--r-- 1 root root 10240000 oct 15 09:53 /SCRIPTS/dd_9.76Mo_15-10-14_09.53.09.bin
#ls -lisah /SCRIPTS/dd_9.76Mo_15-10-14_09.53.09.bin
23592966 9,8M -rw-r--r-- 1 root root 9,8M oct 15 09:53 /SCRIPTS/dd_9.76Mo_15-10-14_09.53.09.bin
</code></pre></div></div>
</p>
      
    </div>

  </li>
  
  
  
  <li>
    <div class="card">
      <h4><a class="post-link" href="/archives/lister-luns-par-pool-projet-script-aksh-zfs-storage-7310-oracle-unified-storage-systems-documentation/">Lister tous les LUNs par Pool et par projet en script aksh - ZFS Storage 7310 (Oracle Unified Storage Systems)</a></h4>
      <p>Cet article a pour objectif de lister tous les LUNs par pool et par projet en mode automatique par script, sur les baies de stockage ZFS 7310 (Oracle Unified Storage Systems).

Les explications, c'est pas votre point fort ? Rendez-vous directement au script <a href="#scriptaksh">ici</a>
<h2>Qu'est ce qu'aksh ?</h2>
C'est le shell par défaut quand vous vous connectez sur les baies de stockage ZFS 7310 (et plus globalement pour les Oracle Unified Storage Systems).
En général, ce shell, aux commandes bien particulières, est destiné à l'exploitation des baies, en plus de la GUI par navigateur web.
On n'y reste, généralement, pas bien longtemps avant de taper la commande " confirm shell " pour passer en root sur la baie (avec un shell tout ce qu'il y a de plus classique).

<h3>Scripter en aksh</h3>
Depuis le shell aksh, vous pouvez taper un certain nombre de commandes comme :
<ul>
<li>ls : pour l'état des objets courants du chemin où vous vous trouvez</li>
<li>cd : pour se déplacer</li>
<li>select xxxx : pour sélectionner un pool, un projet, un LUN etc. et se positionner sur l'objet</li>
<li>get attribut : pour récupérer la valeur d'un attribut de l'objet où vous vous trouvez</li>
<li>la liste n'est pas exhaustive mais ça suffit en général, vous trouverez la documentation en bas de page</li>
</ul>
Pour scripter, il suffira d'encapsuler ces commandes avec run('commande') soit :
<ul>
<li>dans un shell aksh en tapant " script " (pour terminer saisissez "." et ENTRéE</li>
<li>dans un fichier xxxx.aksh. Vous pourrez lancer  le script en ssh depuis un autre serveur : ssh root@ip_tete_baie script < votrescript.aksh<ul><li>pour rajouter une clé ssh entre un serveur et la tête de baie, rien de plus simple, "confirm shell; cd ~/.ssh; vi authorized_keys;" et vous rajouter la clé publique de votre serveur (attention la clé saute sur un changement de firmware, j'en ai fait les frais récemment)</li></ul></li>
</ul>
Pour le reste, ça ressemble comme deux gouttes d'eau à du javascript. Pour ceux qui sont habitués, ça va être très facile de comprendre mon script pour lister les LUNs. 

<h3 id="scriptaksh">Script aksh pour lister les LUNs</h3>
<pre class="hightlight"><code class="language-javascript" data-lang="javascript">
run('cd /'); // certain d'être dans le répertoire racine
run('shares'); // déplace dans shares
var projects = list(); // liste de tous les projets 
var pool = run('get pool').split(/\s+/)[3]; // récupération du nom du pool

for (var i = 0; i < projects.length; i++) { // pour chaque pool
  run('select ' + projects[i]);             // sélection du pool
  var luns = list() ;                       // liste des LUNs du pool
  for (var j = 0;j < luns.length ; j++){    // pour chaque LUNs
     run('select ' + luns[j]) ;             // sélection du LUN
     var initiatorgroup = run('get initiatorgroup').split(/\s+/)[3];  // récupération de l'initiator group
     var targetgroup = run('get targetgroup').split(/\s+/)[3];  // récupération du target group
     var space_total = run('get space_total').split(/\s+/)[3];  // récupération de la taille du LUN
     printf('%s;%s;%s;%s;%s\n',projects[i],luns[j],initiatorgroup,targetgroup,space_total) ; // affichage, ici en csv
     run('cd ..') ;  // on remonte d'un cran pour sortir du select LUN
   }
   run('cd ..'); // remonte d'un cran pour sortir du select Pool
}
run('cd ..'); 
</code>
</pre>

Voilà, rien de compliqué. Quand vous voulez adapter, connectez-vous en aksh sur la tête de baie et vérifier les attributs en faisant un " ls ". 

<a href="http://www.oracle.com/technetwork/documentation/old-unified-ss-1882427.html" title="Documentation Oracle">Documentations offcielles ORACLE</a>
</p>
      
    </div>

  </li>
  
  
  
  <li>
    <div class="card">
      <h4><a class="post-link" href="/archives/deployer-application-sails-js-framework-node-js-openshift-gratuit/">Déployer une application Sails JS (framework Node.js) sur Openshift - gratuit</a></h4>
      <p><p>Je me mets à Node.js et plus particulièrement au framework Sails JS. Pour déployer mon application, il me fallait une solution robuste et un service gratuit qui puisse héberger du Node js.
C’est là que j’ai découvert <a href="https://www.openshift.com/" title="openshift">Openshift</a>.</p>

<p>Le service de RedHat offre carrément l’accès à une VM en ssh et la possibilité de déployer n’importe quelle type d’application (j’ai aussi une base MongoDB qui tourne).</p>

<p>Tout est plutôt bien expliqué sur le site mais rien de très clair pour le framework Sails js. C’est l’objet de cet article.</p>

<p>&lt;edit 16/01/2015&gt;J’ai trouvé encore mieux ! <a href="https://c9.io/">Cloud9</a>. Environnement de développement complet sur le Cloud, gratuit.&lt;/edit&gt;</p>

<p>Je suppose que votre application fonctionne déjà sous sails js en local sur votre machine.</p>

<h1 id="procédure">Procédure</h1>
<ol>
  <li>Ouvrir un compte sur <a href="https://www.openshift.com/" title="openshift">Openshift</a> (le plus petit est gratuit)</li>
  <li>Déployer un gear / application Node JS depuis l’interface web d’openshift</li>
  <li>Définir une clé ssh en copiant votre clé publique locale (bien souvent ~/.ssh/id_rsa.pub, sinon lancer ssh-keygen)<a href="https://virtual-thom.github.io/archives/wp-content/uploads/openshift.png"><img src="https://virtual-thom.github.io/archives/wp-content/uploads/openshift-300x149.png" alt="openshift" /></a></li>
  <li>Sauvegarder votre application locale pour être sûr de ne rien casser</li>
  <li>Effectuer un git clone de l’adresse de votre application (copier depuis Source Code dans l’interface web d’openshift</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd votre_repertoire_de_travail
git clone ssh://votre_id@app-namespace.rhcloud.com

</code></pre></div></div>

<ol>
  <li>Supprimer tout le contenu du répertoire que vous avez cloné, excepté le répertoire .git</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd /votre_repertoire_de_travail/app
rm -Rf votre_repertoire_de_travail/app
</code></pre></div></div>

<ol>
  <li>Copier l’intégralité de votre application sails js dans le répertoire</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cp -Rp /votre_app_sauvegardée/* /votre_repertoire_de_travail/app/
</code></pre></div></div>

<ol>
  <li>Pousser les informations sur openshift avec git</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd /votre_repertoire_de_travail/app/
# modifier le fichier config/models.js, passer l'attribut migrate à 'safe', 'alter' ou 'drop' selon ce que vous voulez

# renseigner bien votre fichier package.json qui devra comprendre toutes les dépendances de votre application 
# c'est une étape indispensable car le processus appliquera les dépendances lors du git push grâce à package.json

git add *
git commit -m "date_du_jour premier push"
git push --set-upstream origin master
#par la suite un simple git push suffira pour pousser les modifications (ici on établit la relation origin master) 
</code></pre></div></div>

<ol>
  <li>Se connecter en ssh sur votre VM (voir remote access dans l’interface d’administration openshift)</li>
  <li>Ajouter ou modifier le fichier config/local.js pour ajouter le port web correct et ne plus utiliser le port 1337 par défaut</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd $OPENSHIFT_REPO_DIR
vi config/local.js

module.exports = {
port: process.env.OPENSHIFT_NODEJS_PORT || 8080,
host: process.env.OPENSHIFT_NODEJS_IP
}
</code></pre></div></div>

<ol>
  <li>Arrêter et redémarrer votre application</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>killall node
node app.js
</code></pre></div></div>

<p>Et voilà !</p>
</p>
      
    </div>

  </li>
  
  
  
  <li>
    <div class="card">
      <h4><a class="post-link" href="/archives/indicateurs-etat-capacitaire-des-baies-de-stockage-naviseccli-xml-xslt-embarquee/">Indicateurs état capacitaire des baies de stockage (Naviseccli, XML et XSLT embarquée)</a></h4>
      <p><h2 id="but-">But :</h2>

<p>Donner à la direction informatique une visualisation globale des indicateurs de l’état capacitaire (espace utilisé, disponible et total) des baies de stockage. L’outil doit fournir une aide décisionnelle qui permettra, par exemple, la commande de nouveaux disques, la prise en compte de nouveaux systèmes d’informations en étant sûr de pouvoir l’héberger.</p>

<p>Voici un <a href="https://virtual-thom.github.io/archives/wp-content/uploads/etat-capacitaire.xml">rendu du fichier XML</a> basique.</p>

<p>Les explications, ça n’est pas votre tasse de thé ? On en vient directement au fait <a href="#demo-script" title="La démonstration par l'exemple">ici</a>.</p>

<h2 id="comment-">Comment ?</h2>

<h3 id="les-besoins-">Les besoins :</h3>
<ul>
<li>Une visualisation d'ensemble des KPI (indicateurs clefs de performances) : l'état capacitaire de toutes les baies de  stockage (espace utilisé, disponible et total). Si possible en pourcentage, en Giga Octet et en camembert.</li>
<li>Une mise à jour régulière des données, sur demande ou temps réel selon les besoins. J'estime qu'une mise à jour quotidienne, et à la demande suffisent aux besoins.</li>
<li>Un accès web.</li>
<li>Un compte rendu journalier par e-mail.</li>
<li>Un état imprimable. (Je pense que je vais améliorer cet aspect)</li>
</ul>

<h3 id="les-méthodes-">Les méthodes :</h3>
<ul>
<li>Pour les requêtes aux baies de stockage EMC, j'utilise : naviseccli. Le programme permet de récupérer toutes les informations qu'on souhaite.</li>
<li>
Afin de produire un seul document, qui va servir à la fois, pour une page web, à la fois, pour le compte-rendu journalier par e-mail, j'utilise le format XML. Le fichier XML ne fait rien en lui-même. Il n'est donc pas exploitable sans la transformation XSL pour un rendu HTML.
<ul>
<li>Pour stocker les données, j'utilise le format XML.</li>
<li>Pour mettre en forme, j'utilise le langage de transformation XSLT avec un rendu HTML5.</li>  
<li>Pour la mise à jour des données, j'utilise l'ordonnanceur VTOM. Il lance le script de mise à jour 3 fois par jour, et dispose d'un traitement à la demande au besoin. Une fois par jour, le matin, VTOM envoie le fichier XML par e-mail.</li>
</ul>
</li>
</ul>

<p>Dans ce genre de cas, il faut éviter les tableaux excels car, ils ne sont pas mis à jour automatiquement (on peut presque dire, jamais à jour par conséquent).
De même, il est quasiment exclus de donner un accès direct au logiciel d’administration, à notre DSI.</p>

<p>Pourquoi, me diriez-vous ? Navisphere, par exemple, dispose de toutes les informations, même sous forme graphique. 
A cela, je répondrais : trop compliqué, trop de cliques à effectuer, trop de chargement, pas de visualisation d’ensemble. La direction a autre chose à faire que de naviguer dans les menus complexes que nous, administrateurs chevronnés, connaissons par coeur.</p>

<h2 id="naviseccli">naviseccli</h2>

<p>Je vous conseille d’authentifier votre utilisateur afin d’effectuer des requêtes sans mot de passe.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>naviseccli -h IParray -AddUserSecurity -user username -password mypass -scope 0
</code></pre></div></div>

<p>Toutes mes baies EMC sont configurées en Storage Pool. J’effectue une requête pour obtenir l’espace utilisable total utilisateur, l’espace disponible et le nom. J’en déduirai l’espace utilisé.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>naviseccli -h $iparray storagepool -list -userCap -availableCap &gt; ${tmpfile}_$iparray

Contenu du fichier :
Pool Name:  Pool Bronze
Pool ID:  1
User Capacity (Blocks):  21107025920
User Capacity (GBs):  10064.614
Available Capacity (Blocks):  21107025920
Available Capacity (GBs):  10064.614
 
Pool Name:  Pool Gold 1
Pool ID:  2
User Capacity (Blocks):  29173164800
User Capacity (GBs):  13910.849
Available Capacity (Blocks):  11354673920
Available Capacity (GBs):  5414.330
 
...
...

</code></pre></div></div>

<p>Petit problème, l’espace du Storage Pool NAS est utilisé à 100%, ou peu s’en faut. L’information n’est pas fausse en soit. En effet, le datamover prend bien tout l’espace du Storage Pool pour constituer son propre pool de stockage, afin de créer les filesystems.
Pour pallier à ce problème, j’utilise des requêtes directement sur la control station du NAS.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># il m'a fallu positionner les variables d'environnement afin d'exécuter les commandes
ssh nasadmin@$ipnas '. .bash_profile ; nas_pool -size "Pool NAS"' &gt; pool_nas_size_$ipnas
&lt;/pre&gt;
Toujours pour éviter de mettre les mots de passe, j'effectue la mise en place de clés ssh entre mon serveur et la control station.
&lt;pre lang="bash"&gt;
# connexion en ssh sur la control station en nasadmin
# ssh nasadmin@ipcontrolstation
# aller dans le répertoire /home/nasadmin/.ssh ou le créer s'il n'existe pas avec ssh-keygen
test -d ~/.ssh || ssh-keygen
cd ~/.ssh
# éditer le fichier authorized_keys pour ajouter la clé de votre serveur
# attention le fichier authorized_keys doit avoir les droits 600
vi authorized_keys
# coller la clé ~/.ssh/id_rsa.pub de votre serveur distant (si c'est une clé rsa) dans le fichier authorized_keys
# sauvegarder
</code></pre></div></div>

<h2 id="comment-traiter-les-informations-de-naviseccli-et-du-nas-">Comment traiter les informations de naviseccli et du NAS ?</h2>
<p>J’ai toutes mes informations. Maintenant, je les traite avec un script shell et les mets en forme en XML.
Le fichier XML aura la feuille de style XSLT embarquée, avec un rendu HTML.</p>

<p><a href="https://virtual-thom.github.io/archives/wp-content/uploads/etat-capacitaire-en-tete-xml.txt" title="entete xml">Entête XML pour le script.</a> (J’utilise <a href="http://www.chartjs.org/" title="Chart.js">Chart.js</a> pour les camemberts en canvas)
<a href="https://virtual-thom.github.io/archives/wp-content/uploads/etat-capacitaire-shemc.sh.txt" title="script genere xml">Script qui génère le fichier XML.</a></p>

<p><a href="https://virtual-thom.github.io/archives/wp-content/uploads/etat-capacitaire.xml">Rendu fichier XML.</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/bin/bash
#	AUTEUR : SCH Virtual Thom
#	VERSION : 1.0
#	DATE : 10/08/2014
#
# set -n   # Decommenter pour debug syntax sans exéon
#	NOTE: Ne pas oublier de recommenter !
# set -x   # Decommenter pour debug
#
##########################################################
#	VARIABLES
##########################################################
OK=0
KOCRIT=1
KOWARN=2
CR=${OK}
date_du_jour=`date +"%d_%m_%Y"`
# Le nom des arrays doit pouvoir être résolu (/etc/hosts ou dns)  ou mettre l'adresse IP
iparrays="VNX5700 VNX5300 CX4-960"
tmpfile="${date_du_jour}_`uuidgen`_etat-capacitaire-shemc.xml"
ftp_ip=ftp.adresse.intradef.gouv.fr
ftp_user=xxxx
ftp_mdp=xxxx
rep_script='/SANSCRIPTS/etat-capacitaire'
# pour naviseccli
export PATH=$PATH:/opt/Navisphere/bin

##########################################################
#	FONCTIONS
##########################################################
date_heure(){
	date_heure_var=`date +"%d/%m/%Y - %H:%M:%S : "`
	echo "${date_heure_var}$1"
}
fonc_sortie(){
	numero_exit=$1
	message_exit=$2
	date_heure "${message_exit}"
	date_heure "Fin du script. Exit : ${numero_exit}"
	exit ${numero_exit}
}
usage(){
	# exemple d'usage
	script=${0##*/} ;
	#script=${script%.*} ;
	echo "" ;
	echo "Genere un fichier xml de l'etat capacitaire SHEM-C"
	echo "Usage :" ;
	echo " ${script}"
	echo "    Pas de parametre."
	echo ""
	exit ${KOWARN};
}
##########################################################
#	SCRIPT
##########################################################
date_heure 'Début du script'

cat ${rep_script}/etat-capacitaire-en-tete-xml.txt &gt; ${rep_script}/$tmpfile

echo "&lt;!-- cette partie est mise à jour par naviseccli --&gt;
&lt;data:data&gt;" &gt;&gt; ${rep_script}/$tmpfile

# Requete sur les baies de stockage en naviseccli (les clés doivent être mise en place)
# naviseccli -h ipbaie -addusersecurity -scope 0 -password password -user userName
for iparray in $(echo $iparrays)
do
	# un seul naviseccli pour toues les storages d'une baie (ça fait moins de requêtes)
	naviseccli -h $iparray storagepool -list  -userCap -availableCap &gt; ${rep_script}/${tmpfile}_$iparray

	# Le nom et les ip des array sont identiques ici mais on peut mettre autre chose
	# si le résultat contient des lignes, on traite
	if test $(cat  ${rep_script}/${tmpfile}_$iparray | wc -l) -gt 1
	then
		# si les baies sont aussi des têtes NAS, je récupère l'état du "Pool NAS" (il s'appelle comme ça chez moi)
		if test "$iparray" = "VNX5700"
		then
			namearray="VNX5700"
			# le nom du NAS doit pouvoir être résolu (/etc/hosts ou dns) ou mettre l'adresse IP
			ipnas="NAS5700"
			ssh nasadmin@$ipnas '. .bash_profile ; nas_pool -size "Pool NAS"' &gt; ${rep_script}/pool_nas_size_$ipnas
		else
			if test "$iparray" = "VNX5300"
			then
				namearray="VNX5300"
				# le nom du NAS doit pouvoir être résolu (/etc/hosts ou dns) ou mettre l'adresse IP
				ipnas="NAS5300"
				ssh nasadmin@$ipnas '. .bash_profile ; nas_pool -size "Pool NAS"' &gt; ${rep_script}/pool_nas_size_$ipnas
			else
				if test  "$iparray" = "CX4-960"
				then
					 	namearray="CX4-960"
				else
						# par défaut on met l'IP ou le nom dns en tant que nom de baie
						namearray=$iparray
				fi
			fi
		fi

		echo "&lt;array name='$namearray'&gt;" &gt;&gt; ${rep_script}/$tmpfile

		# line de la sortie naviseccli &lt; ${rep_script}/${tmpfile}_$iparray
		# Ne pas oublier que l'entrée ssh dans un boucle while remplace l'entrée standard
		# solution ssh -n
		while read line
		do
			if test -n "$(echo $line | grep 'Pool Name')"
			then
				if test -n  "$(echo $line | grep 'NAS')"
				then
					NAS=1
				else
					NAS=0
				fi
				echo "&lt;storagepool&gt;" &gt;&gt; ${rep_script}/$tmpfile
				echo "&lt;name&gt;" &gt;&gt; ${rep_script}/$tmpfile
				# awk -F: '$1 ~ /Pool Name/ {print $2}' =&gt; délimiteur ":", 1er champ contient "Pool Name"
				# affiche le deuxième champs
				echo $line | awk -F: '$1 ~ /Pool Name/ {print $2}' | sed 's/^ //g' &gt;&gt; ${rep_script}/$tmpfile
				echo "&lt;/name&gt;" &gt;&gt; ${rep_script}/$tmpfile
			# FIN name
			else
				if test -n  "$(echo $line | grep 'User Capacity (GBs)')"
				then
					echo "&lt;usercap&gt;" &gt;&gt; ${rep_script}/$tmpfile

					if test "$NAS" = "1"
					then
						usercap=`cat ${rep_script}/pool_nas_size_${ipnas} | awk -F"=" '$1 ~ /total_mb/ {print $2}' | sed 's/^ //g'`
						if test "$usercap" != "0"
						then
							usercap=`expr $usercap \/ 1024`
						else
							usercap=`cat ${rep_script}/pool_nas_size_${ipnas} | awk -F"=" '$1 ~ /potential_mb/ {print $2}' | sed 's/^ //g'`
							usercap=`expr $usercap \/ 1024`
						fi
						echo $usercap &gt;&gt; ${rep_script}/$tmpfile

					# si Pool différent du NAS
					else
						echo $line | awk -F: '$1 ~ /User Capacity \(GBs\)/ {print $2}' | sed 's/^ //g' &gt;&gt; ${rep_script}/$tmpfile
					fi

					echo "&lt;/usercap&gt;" &gt;&gt; ${rep_script}/$tmpfile
				# FIN usercap
				else
					if test -n  "$(echo $line | grep 'Available Capacity (GBs)')"
					then
						echo "&lt;availablecap&gt;" &gt;&gt; ${rep_script}/$tmpfile

						if test "$NAS" = "1"
						then
							availablecap=`cat ${rep_script}/pool_nas_size_${ipnas} | awk -F"=" '$1 ~ /avail_mb/ {print $2}' | sed 's/^ //g'`
							if test "$availablecap" != "0"
							then
								availablecap=`expr $availablecap \/ 1024`
							else
								availablecap=`cat ${rep_script}/pool_nas_size_${ipnas} | awk -F"=" '$1 ~ /potential_mb/ {print $2}' | sed 's/^ //g'`
								availablecap=`expr $availablecap \/ 1024`
							fi
							echo $availablecap &gt;&gt; ${rep_script}/$tmpfile

						# si pas pool NAS
						else
							echo $line | awk -F: '$1 ~ /Available Capacity \(GBs\)/ {print $2}' | sed 's/^ //g' &gt;&gt; $tmpfile
						fi

						echo "&lt;/availablecap&gt;" &gt;&gt; ${rep_script}/$tmpfile
					# FIN availablecap
					else
						# Je prends les lignes vides comme séparateur des pools
						if test -z "$line"
						then
							echo "&lt;/storagepool&gt;" &gt;&gt; ${rep_script}/$tmpfile
						fi

					fi
				fi
			fi

		done &lt; ${rep_script}/${tmpfile}_$iparray

		echo "&lt;/array&gt;" &gt;&gt; ${rep_script}/$tmpfile
	fi
done


echo "&lt;/data:data&gt; &lt;!-- fin des datas --&gt;
&lt;/xsl:stylesheet&gt; &lt;!-- fin du fichier xml --&gt;" &gt;&gt; ${rep_script}/$tmpfile

date_heure "Transfert FTP"
# Transfert FTP sur le site de la SHEM
ftp -v -n -i &gt; /dev/null &lt;&lt; EOF
open ${ftp_ip}
user ${ftp_user} ${ftp_mdp}
binary
put ${rep_script}/$tmpfile index.xml
EOF

# TODO : prévoir d'envoyer un e-mail en compte rendu avec le xml attaché

# Nettoyage des fichiers temporaires
for iparray in $(echo $iparrays)
do
	rm -f ${rep_script}/${tmpfile}_$iparray
done
rm -f ${rep_script}/pool_nas_size*
rm -f ${rep_script}/$tmpfile
date_heure 'Fin du script'
</code></pre></div></div>

<p>Vous avez remarqué que je dis souvent que la feuille XSLT est embarquée dans le fichier XML. En réalité, c’est plutôt la data XML qui est embarquée dans la transformation XSLT. En fait, la feuille de transformation XSLT est un fichier XML en elle-même. Il suffit de lui insérer des datas et de définir un certain nombre de paramètres :</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span> <span class="c">&lt;!-- Comme tout fichier XML --&gt;</span>
<span class="cp">&lt;?xml-stylesheet href="#stylesheet" type="text/xsl"?&gt;</span> <span class="c">&lt;!-- D'habitude on met l'url du fichier XML à transformer ici --&gt;</span>
<span class="c">&lt;!-- là, on fait référence à l'ID stylesheet, interne à ce fichier --&gt;</span>

<span class="c">&lt;!--  Pour ça, il faut définir la structure du document DTD (Document Type Definition)  --&gt;</span>
<span class="cp">&lt;!DOCTYPE xsl:stylesheet [
&lt;!ATTLIST xsl:stylesheet
id	ID	#REQUIRED&gt;</span>
]&gt;
 
<span class="c">&lt;!-- balises de transformation xsl --&gt;</span>
<span class="nt">&lt;xsl:stylesheet</span> <span class="na">version=</span><span class="s">"2.0"</span> <span class="na">id=</span><span class="s">"stylesheet"</span>  <span class="na">xmlns:data=</span><span class="s">"localhost"</span> 
<span class="na">xmlns:xsl=</span><span class="s">"http://www.w3.org/1999/XSL/Transform"</span><span class="nt">&gt;</span>

<span class="c">&lt;!-- pour un rendu HTML --&gt;</span>
<span class="nt">&lt;xsl:output</span> <span class="na">method=</span><span class="s">"html"</span> <span class="na">indent=</span><span class="s">"yes"</span> <span class="na">encoding=</span><span class="s">"UTF-8"</span> <span class="nt">/&gt;</span>

<span class="c">&lt;!-- definition du template principal avec le rendu html --&gt;</span>
<span class="nt">&lt;xsl:template</span> <span class="na">match=</span><span class="s">"/"</span><span class="nt">&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;body&gt;</span>...
<span class="c">&lt;!-- Les appels de template se feront &lt;xsl:apply-templates select="/xsl:stylesheet/data:data/xxx" /&gt; --&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
<span class="nt">&lt;/xsl:template&gt;</span>

<span class="nt">&lt;data:data&gt;</span>
<span class="c">&lt;!-- c'est ici que j'insère de la data --&gt;</span>
<span class="nt">&lt;/data:data&gt;</span> <span class="c">&lt;!-- fin des datas --&gt;</span>

<span class="nt">&lt;/xsl:stylesheet&gt;</span> <span class="c">&lt;!-- fin du fichier xml --&gt;</span>
</code></pre></div></div>

<p>Petite aparté :
Il faut savoir que vous pouvez sortir les informations en XML avec naviseccli. C’est possible mais, le format est tellement peu pratique et peu lisible (car non-imbriqué) que je ne l’utilise pas. Si vous voulez absolument avoir une sortie en XML il faut rajouter -Xml à naviseccli.</p>

<p><code class="language-plaintext highlighter-rouge">naviseccli -Xml -h x.x.x.x storagepool -list  -userCap -availableCap</code></p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8" ?&gt;</span>
<span class="nt">&lt;CIM</span> <span class="na">CIMVERSION=</span><span class="s">"2.0"</span> <span class="na">DTDVERSION=</span><span class="s">"2.0"</span><span class="nt">&gt;&lt;MESSAGE</span> <span class="na">ID=</span><span class="s">"877"</span> <span class="na">PROTOCOLVERSION=</span><span class="s">"1.0"</span><span class="nt">&gt;&lt;SIMPLERSP&gt;&lt;METHODRESPONSE</span> <span class="na">NAME=</span><span class="s">"ExecuteClientRequest"</span><span class="nt">&gt;&lt;RETURNVALUE</span> <span class="na">TYPE=</span><span class="s">"Navi_Error"</span><span class="nt">&gt;</span>
<span class="nt">&lt;VALUE.NAMEDINSTANCE&gt;</span>
<span class="nt">&lt;INSTANCENAME</span> <span class="na">CLASSNAME=</span><span class="s">"Navi_Error"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/INSTANCENAME&gt;</span>
<span class="nt">&lt;INSTANCE</span> <span class="na">CLASSNAME=</span><span class="s">"Navi_Error"</span><span class="nt">&gt;</span>
<span class="nt">&lt;PROPERTY</span> <span class="na">NAME=</span><span class="s">"errorCode"</span> <span class="na">TYPE=</span><span class="s">"uint32"</span><span class="nt">&gt;&lt;VALUE&gt;</span>0<span class="nt">&lt;/VALUE&gt;</span>
<span class="nt">&lt;/PROPERTY&gt;</span>
<span class="nt">&lt;PROPERTY</span> <span class="na">NAME=</span><span class="s">"success"</span> <span class="na">TYPE=</span><span class="s">"boolean"</span><span class="nt">&gt;&lt;VALUE&gt;</span>true<span class="nt">&lt;/VALUE&gt;</span>
<span class="nt">&lt;/PROPERTY&gt;</span>
<span class="nt">&lt;PROPERTY</span> <span class="na">NAME=</span><span class="s">"where"</span> <span class="na">TYPE=</span><span class="s">"string"</span><span class="nt">&gt;&lt;VALUE&gt;</span>ProvisionProvider<span class="nt">&lt;/VALUE&gt;</span>
<span class="nt">&lt;/PROPERTY&gt;</span>
<span class="nt">&lt;PROPERTY</span> <span class="na">NAME=</span><span class="s">"why"</span> <span class="na">TYPE=</span><span class="s">"string"</span><span class="nt">&gt;&lt;VALUE&gt;&lt;/VALUE&gt;</span>
<span class="nt">&lt;/PROPERTY&gt;</span>
<span class="nt">&lt;/INSTANCE&gt;</span>
<span class="nt">&lt;/VALUE.NAMEDINSTANCE&gt;</span>
<span class="nt">&lt;/RETURNVALUE&gt;&lt;PARAMVALUE</span> <span class="na">NAME=</span><span class="s">"Pool Name"</span> <span class="na">TYPE=</span><span class="s">"string"</span><span class="nt">&gt;&lt;VALUE&gt;</span>Pool<span class="ni">&amp;#32;</span>Bronze<span class="nt">&lt;/VALUE&gt;</span>
<span class="nt">&lt;/PARAMVALUE&gt;</span>
<span class="nt">&lt;PARAMVALUE</span> <span class="na">NAME=</span><span class="s">"Pool ID"</span> <span class="na">TYPE=</span><span class="s">"string"</span><span class="nt">&gt;&lt;VALUE&gt;</span>1<span class="nt">&lt;/VALUE&gt;</span>
<span class="nt">&lt;/PARAMVALUE&gt;</span>
<span class="nt">&lt;PARAMVALUE</span> <span class="na">NAME=</span><span class="s">"User Capacity (Blocks)"</span> <span class="na">TYPE=</span><span class="s">"string"</span><span class="nt">&gt;&lt;VALUE&gt;</span>21107025920<span class="nt">&lt;/VALUE&gt;</span>
<span class="nt">&lt;/PARAMVALUE&gt;</span>
<span class="nt">&lt;PARAMVALUE</span> <span class="na">NAME=</span><span class="s">"User Capacity (GBs)"</span> <span class="na">TYPE=</span><span class="s">"string"</span><span class="nt">&gt;&lt;VALUE&gt;</span>10064.614<span class="nt">&lt;/VALUE&gt;</span>
<span class="nt">&lt;/PARAMVALUE&gt;</span>
<span class="nt">&lt;PARAMVALUE</span> <span class="na">NAME=</span><span class="s">"Available Capacity (Blocks)"</span> <span class="na">TYPE=</span><span class="s">"string"</span><span class="nt">&gt;&lt;VALUE&gt;</span>21107025920<span class="nt">&lt;/VALUE&gt;</span>
<span class="nt">&lt;/PARAMVALUE&gt;</span>
<span class="nt">&lt;PARAMVALUE</span> <span class="na">NAME=</span><span class="s">"Available Capacity (GBs)"</span> <span class="na">TYPE=</span><span class="s">"string"</span><span class="nt">&gt;&lt;VALUE&gt;</span>10064.614<span class="nt">&lt;/VALUE&gt;</span>
<span class="nt">&lt;/PARAMVALUE&gt;</span>
<span class="nt">&lt;PARAMVALUE</span> <span class="na">NAME=</span><span class="s">""</span> <span class="na">TYPE=</span><span class="s">"string"</span><span class="nt">&gt;&lt;VALUE&gt;</span><span class="ni">&amp;#32;</span><span class="nt">&lt;/VALUE&gt;</span>
<span class="nt">&lt;/PARAMVALUE&gt;</span>
...
...
<span class="nt">&lt;/METHODRESPONSE&gt;&lt;/SIMPLERSP&gt;&lt;/MESSAGE&gt;&lt;/CIM&gt;</span>
</code></pre></div></div>
</p>
      
    </div>

  </li>
  
  
</ul>
<!-- Pagination links -->
<nav>
  <ul class="pagination">
    
    <li>
      <a href="/page10" class="Précédant">
        <span aria-hidden="true">&laquo;</span>
      </a>
    </li>
      
    <li>
      <a href="/archives/index.html">1</a>
    </li>
      
    <li>
      <a
        href="/archives/page2">2</a>
    </li>
      
    <li>
      <a
        href="/archives/page3">3</a>
    </li>
      
    <li>
      <a
        href="/archives/page4">4</a>
    </li>
      
    <li>
      <a
        href="/archives/page5">5</a>
    </li>
      
    <li>
      <a
        href="/archives/page6">6</a>
    </li>
      
    <li>
      <a
        href="/archives/page7">7</a>
    </li>
      
    <li>
      <a
        href="/archives/page8">8</a>
    </li>
      
    <li>
      <a
        href="/archives/page9">9</a>
    </li>
      
    <li>
      <a
        href="/archives/page10">10</a>
    </li>
      
    <li class="active">
      <span>11</span>
    </li>
      
    <li>
      <a
        href="/archives/page12">12</a>
    </li>
      
    <li>
      <a
        href="/archives/page13">13</a>
    </li>
      
    <li>
      <a
        href="/archives/page14">14</a>
    </li>
      
    <li>
      <a href="/page12" aria-label="Suivant">
        <span aria-hidden="true">&raquo;</span>
      </a>
    </li>
    
  </ul>
</nav>

      <footer id="site-footer">
    <div>&copy;<a href="https://github.com/virtual-thom/" title="Github Virtual-Thom">Virtual-Thom</a></div>
    <div>
            <a href="https://virtual-thom.github.io/archives/plan" title="Plan du site">sitemap</a> | <a href="https://virtual-thom.github.io/about" rel="publisher author" title="Curriculum vitae Thom">A propos</a>
    </div>
    <div>
        <a id="goto-site-header" href="#site-header" title="Retourner au début">&uArr; Top</a>
    </div>
    <div id="footer-disclaimer">
        <p>Avertissement : vous ne devez pas prendre pour argent comptant le contenu de ce site. Testez toujours la solution en environnement de test.</p>
        <p>Malgré le sérieux que je m'efforce de mettre dans le contenu de ces billets, je ne pourrai être tenu responsable d'éventuelles erreurs que cela pourrait engendrer.</p>
    </div>
    <div>
        <a class="hidden" href="https://virtual-thom.github.io/archives/sitemap.xml" title="SiteMap">sitemap</a>
    </div>
</footer>

    </div>
  </body>

</html>