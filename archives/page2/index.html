<!DOCTYPE html>
<html lang="fr">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="apple-touch-icon" href="https://virtual-thom.github.io/archives/apple-touch-icon.png">
  <link rel="icon" href="https://virtual-thom.github.io/archives/favicon.ico" />
  <!-- Remplac√© par Jekyll SEO (sinon apparait en double)
  <title>Virtual-Thom | Blog-notes VTOM et informatique</title>
  <meta name="description" content="Blog-notes VTOM, informatique, industrialisation, ordonnancement, DevOps">
  --> 
  
  <link rel="canonical" href="https://virtual-thom.github.io/archives/page2/">
  
  <link rel="stylesheet" media="screen" href="https://virtual-thom.github.io/archives/assets/main.css">
  
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Page 2 of 14 for Virtual-Thom Blog-notes VTOM et informatique | Blog-notes VTOM, informatique, industrialisation, ordonnancement, DevOps</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Virtual-Thom Blog-notes VTOM et informatique" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Blog-notes VTOM, informatique, industrialisation, ordonnancement, DevOps" />
<meta property="og:description" content="Blog-notes VTOM, informatique, industrialisation, ordonnancement, DevOps" />
<link rel="canonical" href="https://virtual-thom.github.io/archives/page2/" />
<meta property="og:url" content="https://virtual-thom.github.io/archives/page2/" />
<meta property="og:site_name" content="Virtual-Thom Blog-notes VTOM et informatique" />
<meta property="og:type" content="website" />
<link rel="prev" href="https://virtual-thom.github.io/archives/" />
<link rel="next" href="https://virtual-thom.github.io/archives/page3" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Virtual-Thom Blog-notes VTOM et informatique" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Blog-notes VTOM, informatique, industrialisation, ordonnancement, DevOps","headline":"Virtual-Thom Blog-notes VTOM et informatique","url":"https://virtual-thom.github.io/archives/page2/"}</script>
<!-- End Jekyll SEO tag -->

  
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Z8Y7902GRV"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Z8Y7902GRV');
</script>


  <body>
    <div class="container">
      <header id="site-header">
  <h1>Blog-notes VTOM, informatique, industrialisation, ordonnancement, DevOps</h1>
  <nav>
    <ul>
      <li>
        <a href="https://virtual-thom.github.io/archives" title="Home">
          <svg class="svg-icon" viewBox="0 0 20 20">
            <path d="M18.121,9.88l-7.832-7.836c-0.155-0.158-0.428-0.155-0.584,0L1.842,9.913c-0.262,0.263-0.073,0.705,0.292,0.705h2.069v7.042c0,0.227,0.187,0.414,0.414,0.414h3.725c0.228,0,0.414-0.188,0.414-0.414v-3.313h2.483v3.313c0,0.227,0.187,0.414,0.413,0.414h3.726c0.229,0,0.414-0.188,0.414-0.414v-7.042h2.068h0.004C18.331,10.617,18.389,10.146,18.121,9.88 M14.963,17.245h-2.896v-3.313c0-0.229-0.186-0.415-0.414-0.415H8.342c-0.228,0-0.414,0.187-0.414,0.415v3.313H5.032v-6.628h9.931V17.245z M3.133,9.79l6.864-6.868l6.867,6.868H3.133z"></path>
          </svg>
        </a>
      </li>
      <li>
        <a href="https://virtual-thom.github.io/archives/vos-commentaires-livre-d-or/" title="Commentaires - livre d'or">
          <svg class="svg-icon" viewBox="0 0 20 20">
            <path d="M17.657,2.982H2.342c-0.234,0-0.425,0.191-0.425,0.426v10.21c0,0.234,0.191,0.426,0.425,0.426h3.404v2.553c0,0.397,0.48,0.547,0.725,0.302l2.889-2.854h8.298c0.234,0,0.426-0.191,0.426-0.426V3.408C18.083,3.174,17.892,2.982,17.657,2.982M17.232,13.192H9.185c-0.113,0-0.219,0.045-0.3,0.124l-2.289,2.262v-1.96c0-0.233-0.191-0.426-0.425-0.426H2.767V3.833h14.465V13.192z M10,7.237c-0.821,0-1.489,0.668-1.489,1.489c0,0.821,0.668,1.489,1.489,1.489c0.821,0,1.488-0.668,1.488-1.489C11.488,7.905,10.821,7.237,10,7.237 M10,9.364c-0.352,0-0.638-0.288-0.638-0.638c0-0.351,0.287-0.638,0.638-0.638c0.351,0,0.638,0.287,0.638,0.638C10.638,9.077,10.351,9.364,10,9.364 M14.254,7.237c-0.821,0-1.489,0.668-1.489,1.489c0,0.821,0.668,1.489,1.489,1.489s1.489-0.668,1.489-1.489C15.743,7.905,15.075,7.237,14.254,7.237 M14.254,9.364c-0.351,0-0.638-0.288-0.638-0.638c0-0.351,0.287-0.638,0.638-0.638c0.352,0,0.639,0.287,0.639,0.638C14.893,9.077,14.605,9.364,14.254,9.364 M5.746,7.237c-0.821,0-1.489,0.668-1.489,1.489c0,0.821,0.668,1.489,1.489,1.489c0.821,0,1.489-0.668,1.489-1.489C7.234,7.905,6.566,7.237,5.746,7.237 M5.746,9.364c-0.351,0-0.638-0.288-0.638-0.638c0-0.351,0.287-0.638,0.638-0.638c0.351,0,0.638,0.287,0.638,0.638C6.384,9.077,6.096,9.364,5.746,9.364"></path>
          </svg>
        </a>
      </li>
      
      <li>
        <a href="https://virtual-thom.github.io/about" title="Curriculum Vitae Thom">
          <svg class="svg-icon" viewBox="0 0 20 20">
            <path d="M12.075,10.812c1.358-0.853,2.242-2.507,2.242-4.037c0-2.181-1.795-4.618-4.198-4.618S5.921,4.594,5.921,6.775c0,1.53,0.884,3.185,2.242,4.037c-3.222,0.865-5.6,3.807-5.6,7.298c0,0.23,0.189,0.42,0.42,0.42h14.273c0.23,0,0.42-0.189,0.42-0.42C17.676,14.619,15.297,11.677,12.075,10.812 M6.761,6.775c0-2.162,1.773-3.778,3.358-3.778s3.359,1.616,3.359,3.778c0,2.162-1.774,3.778-3.359,3.778S6.761,8.937,6.761,6.775 M3.415,17.69c0.218-3.51,3.142-6.297,6.704-6.297c3.562,0,6.486,2.787,6.705,6.297H3.415z"></path>
          </svg>
        </a>
      </li>
    </ul>
  </nav>
</header>

      <nav>
  <ul class="pagination">
    
    <li>
      <a href="/" class="Pr√©c√©dant">
        <span aria-hidden="true">&laquo;</span>
      </a>
    </li>
      
    <li>
      <a href="/archives/index.html">1</a>
    </li>
      
    <li class="active">
      <span>2</span>
    </li>
      
    <li>
      <a
        href="/archives/page3">3</a>
    </li>
      
    <li>
      <a
        href="/archives/page4">4</a>
    </li>
      
    <li>
      <a
        href="/archives/page5">5</a>
    </li>
      
    <li>
      <a
        href="/archives/page6">6</a>
    </li>
      
    <li>
      <a
        href="/archives/page7">7</a>
    </li>
      
    <li>
      <a
        href="/archives/page8">8</a>
    </li>
      
    <li>
      <a
        href="/archives/page9">9</a>
    </li>
      
    <li>
      <a
        href="/archives/page10">10</a>
    </li>
      
    <li>
      <a
        href="/archives/page11">11</a>
    </li>
      
    <li>
      <a
        href="/archives/page12">12</a>
    </li>
      
    <li>
      <a
        href="/archives/page13">13</a>
    </li>
      
    <li>
      <a
        href="/archives/page14">14</a>
    </li>
      
    <li>
      <a href="/page3" aria-label="Suivant">
        <span aria-hidden="true">&raquo;</span>
      </a>
    </li>
    
  </ul>
</nav>
<ul class="post-list post-list-with-type">
  
  <li>
    <a class="post-link" href="/archives/queue-wnt-bug/">Bug queue_wnt de base Absyss</a>
  </li>
  
  <li>
    <a class="post-link" href="/archives/no-log-exit-en-erreur/">No log, exit en erreur, saut de ligne dans param</a>
  </li>
  
  <li>
    <a class="post-link" href="/archives/warning-sid-unknown-sid/">WARNING SID UNKNOWN_SID vtexport</a>
  </li>
  
  <li>
    <a class="post-link" href="/archives/documentation-officielle-Absyss/">Documentation officielle Absyss</a>
  </li>
  
  <li>
    <a class="post-link" href="/archives/open-workbook-excel-taskscheduler-vtom/">Microsoft Excel Microsoft Excel cannot access the file</a>
  </li>
  
  <li>
    <a class="post-link" href="/archives/vtom-cas-ecole-2/">VTOM Cas d'√©cole n¬∞2</a>
  </li>
  
  <li>
    <a class="post-link" href="/archives/rpi4-wifi-dhcp-lost-ipv4/">RPI4 WiFi wlan0 lost its ip address</a>
  </li>
  
  <li>
    <a class="post-link" href="/archives/Umbrel-change-wallpapers/">Changer le fond d'√©cran du dashboard Umbrel</a>
  </li>
  
  <li>
    <a class="post-link" href="/archives/BTCPayServer-plugin-wordpress-webhook/">Plugin wordpress add donater BTCPay server</a>
  </li>
  
  <li>
    <a class="post-link" href="/archives/BTCPayServer-Umbrel-email/">Envoyer des emails avec BTCPayServer sur noeud rpi4 Umbrel gratuitement</a>
  </li>
  
</ul>


<div id="page-first-post">

  <div itemscope itemtype="http://schema.org/Article" class="post">

    <article class="post-content" itemprop="articleBody">
      <h1 itemprop="name about headline" class="post-title">Bug queue_wnt de base Absyss</h1>
      <p>v7.1.1b5<br />
petit binz avec la queue_wnt de base de chez Absyss. J‚Äôai des doubles quotes qui ne vont pas.<br />
Coup du sort, j‚Äôai un comp√®re porscheboxster77 qui a eu le m√™me probl√®me 2 jours avant moi.<br />
Ca fait des trucs du genre :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Arguments: """TEST ESPACE"" "
ESPACE""=="" was unexpected at this time.
</code></pre></div></div>

<p>C‚Äôest pas grand chose, c‚Äôest leur loop args qui merdouille. On peut remplacer :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>:argloop
shift
if "%0"=="" goto argend
set arg=%arg% %0
goto argloop
:argend

call "%TOM_SCRIPT%" %arg%


en :
call "%TOM_SCRIPT%" %*
</code></pre></div></div>

<p>c‚Äôest assez dr√¥le d‚Äôailleurs, car ils fournissent une nouvelle queue √† ma connaissance <code class="language-plaintext highlighter-rouge">submit_queue_wnt_space.bat</code> qui fait appel √† une nouvelle variable TOM_ que je ne connaissais pas :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rem :argloop
rem shift
rem if "%0"=="" goto argend
rem set arg=%arg% %0
rem goto argloop
rem :argend

rem call "%TOM_SCRIPT%" %arg%
call "%TOM_SCRIPT%" %TOM_SCRIPT_ARGS%
</code></pre></div></div>

<p>Comme quoi, on ne devait pas √™tre les seuls ^^</p>

      (voir plus)
      <a class="post-link" href="/archives/queue-wnt-bug/">Bug queue_wnt de base Absyss</a>
      <p class="post-meta">
        <time class="post-meta" itemprop="datePublished dateModified"
          datetime="2023-11-30T12:00:00+00:00">30-11-2023</time>
      </p>
    </article>
  </div>
</div>




















<ul class="post-list">
  
  
  
  
  <li>
    <div class="card">
      <h4><a class="post-link" href="/archives/no-log-exit-en-erreur/">No log, exit en erreur, saut de ligne dans param</a></h4>
      <p><p>v7.1.1b5<br />
Petit bug mais plut√¥t sain en fait. Disons que je n‚Äôavais pas le cas avant mais √ßa me semble normal que √ßa plante.<br />
Saut de ligne dans Param du job vtom == plantage du script, pas de log, et retour chelou dans vtom avec le bon tsend.<br />
Ca sent le vieux copi√© / coll√© depuis excel dans le param du job.<br />
Pour les rep√©rer, <code class="language-plaintext highlighter-rouge">vtexport -x</code> et chercher la pattern regex <code class="language-plaintext highlighter-rouge">^]]&gt;&lt;/Parameter&gt;$</code></p>

<p>Editer le job en question et supprimer √† la mano l‚Äôespace √† la fin, √ßa r√®gle le probl√®me.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># l√† on voit bien les sauts de lignes sur param 2, 3, 4, 5, 6, 7
            &lt;Job name="put_luke_contacts" retained="0" family="leia" comment="Depot du fichiers en provenance du cyberespac" information=" " frequency="D" onDemand="0" isAsked="0" cycleEnabled="0" cycle="00:00:00" minStart="04:10:00" maxStart="23:10:00" mode="E" hostsGroup="starship" queue="queue_sh" user="skyw" retcode="-1" status="W" statusTime="29-11-2023 09:55:12" substatus="0" appInErr="1" descOnErr="0" blockDate="0" restartType="M" restartCount="0" restartMax="1" restartDelay="00:00:00" restartLabel="0" timeBegin="1701251193" timeEnd="1701251195" ipid="0" mepType="E"&gt;
              &lt;Script&gt;&lt;![CDATA[#/usr/local/spool/SCRIPTS/transfert_ftp.sh]]&gt;&lt;/Script&gt;
              &lt;Parameters&gt;
                &lt;Parameter&gt;&lt;![CDATA[--client "anakin"]]&gt;&lt;/Parameter&gt;
                &lt;Parameter&gt;&lt;![CDATA[--ip 1.1.1.1
]]&gt;&lt;/Parameter&gt;
                &lt;Parameter&gt;&lt;![CDATA[--action put
]]&gt;&lt;/Parameter&gt;
                &lt;Parameter&gt;&lt;![CDATA[--rep-source "/usr/local/spool/leia/EM"
]]&gt;&lt;/Parameter&gt;
                &lt;Parameter&gt;&lt;![CDATA[--rep-cible /ImportAuto/
]]&gt;&lt;/Parameter&gt;
                &lt;Parameter&gt;&lt;![CDATA[--on-error stop
]]&gt;&lt;/Parameter&gt;
                &lt;Parameter&gt;&lt;![CDATA[--file-name csv
]]&gt;&lt;/Parameter&gt;
                &lt;Parameter&gt;&lt;![CDATA[--delete]]&gt;&lt;/Parameter&gt;
                &lt;Parameter&gt;&lt;![CDATA[--function sftp]]&gt;&lt;/Parameter&gt;
                &lt;Parameter&gt;&lt;![CDATA[--ftp-mode --ftp-pasv]]&gt;&lt;/Parameter&gt;
              &lt;/Parameters&gt;
              &lt;Node objectType="job" x="270" y="260" z="0"/&gt;
            &lt;/Job&gt;
</code></pre></div></div>
</p>
      
    </div>

  </li>
  
  
  
  <li>
    <div class="card">
      <h4><a class="post-link" href="/archives/warning-sid-unknown-sid/">WARNING SID UNKNOWN_SID vtexport</a></h4>
      <p><p>Si vous avez d√©j√† eu ce genre de probl√®me lors d‚Äôun vtexport filtr√© avec WARNING SID :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS E:\temp&gt; vtexport -x &gt; e:\temp\vtexport.xml
vtexport elapsed time : 9s 147ms

PS E:\temp&gt; vtexport -x -f * &gt; e:\temp\vtexport.xml
WARNING SID 'DAT752' not found in map 'date'.
WARNING SID 'RES1b2d' not found in map 'ressource'.
WARNING SID 'DAT753' not found in map 'date'.
WARNING SID 'RES1b2b' not found in map 'ressource'.
Le controle d'integrite a detecte des anomalies, vtexport interrompu 
</code></pre></div></div>

<p>Rajoutez /forceExport √† votre commande et faites une recherche de ‚ÄúUNKNOWN_SID‚Äù √† l‚Äôint√©rieur de l‚Äôexport pour voir les objets impact√©s.<br />
Avec un peu de chance, un simple ‚ÄúD√©finir et OK‚Äù sur l‚Äôobjet r√©soudra le probl√®me.<br />
Sinon copier / coller l‚Äôapp ou le job en question vu dans l‚Äôexport avec ‚ÄúUNKNOWN_SID‚Äù et supprimer l‚Äôancien (bourrin mais √ßa fonctionne, attention √† vos liens, mise en exploit, tout √ßa).</p>

</p>
      
    </div>

  </li>
  
  
  
  <li>
    <div class="card">
      <h4><a class="post-link" href="/archives/documentation-officielle-Absyss/">Documentation officielle Absyss</a></h4>
      <p><p>Au cas o√π vous l‚Äôauriez loup√©, Absyss a sorti sa documentation online : <a href="https://docs.absyss.com/">https://docs.absyss.com/</a></p>
</p>
      
    </div>

  </li>
  
  
  
  <li>
    <div class="card">
      <h4><a class="post-link" href="/archives/open-workbook-excel-taskscheduler-vtom/">Microsoft Excel Microsoft Excel cannot access the file</a></h4>
      <p><p>Vous essayez d‚Äôouvrir un workbook Excel sans √™tre connect√© en session (que √ßa soit un script via VTOM ou TaskScheduler win) ?<br />
Ca fonctionne en √©tant connect√© et en lan√ßant le script √† la main, mais pas via VTOM avec le message √©trange qu‚Äôil ne trouve pas le fichier (alors qu‚Äôil existe bien) :<br />
Open c:\path\fichier.xlsx (clsMSExcel::Open)<br />
Microsoft Excel: Microsoft Excel cannot access the file</p>

<p>Essayez :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>It's likely a DCOM permissions issue. Automating Excel is sometimes fraught with peril...

The only way I've found around issues such as this is to set Excel to run as a specific user through DCOM permissions.

Open Component Services (Start -&gt; Run, type in dcomcnfg)
Drill down to Component Services -&gt; Computers -&gt; My Computer and click on DCOM Config
Right-click on Microsoft Excel Application and choose Properties
In the Identity tab select This User and enter the ID and password of an interactive user account (domain or local) and click Ok
Keeping it as the interactive user or the launching doesn't work with the task scheduler unfortunately, even when setting the task up to run under an account that has admin access to the machine.
</code></pre></div></div>

<p>A savoir quand m√™me : impossible d‚Äôouvrir Excel mainteant en session mais vos scripts seront automatisables via TaskSCheduler ou via VTOM.</p>
</p>
      
    </div>

  </li>
  
  
  
  <li>
    <div class="card">
      <h4><a class="post-link" href="/archives/vtom-cas-ecole-2/">VTOM Cas d'√©cole n¬∞2</a></h4>
      <p><p>Contexte et souhait du client (d√©sol√© je ne les invente pas ü§ê) :</p>
<ul>
  <li>3 applications A, B, C, cycliques 5 min (cha√Ænes de jobs plut√¥t complexes √† l‚Äôint√©rieur, on verra que √ßa excluera une des possibilit√©s)</li>
  <li>l‚Äôapplication C ne doit pas tourner si A ou B est en cours</li>
  <li>A de 6h √† 23h</li>
  <li>B de 18h √† 23h</li>
  <li>C de 6h √† 23h</li>
  <li>on part du principe que les cycles s‚Äôenchainent correctement et qu‚Äôune fois C en cours, peut importe le comportement de A ou de B</li>
</ul>
</p>
      
          <a href="/archives/vtom-cas-ecole-2/">Article complet ici</a>
      
    </div>

  </li>
  
  
  
  <li>
    <div class="card">
      <h4><a class="post-link" href="/archives/rpi4-wifi-dhcp-lost-ipv4/">RPI4 WiFi wlan0 lost its ip address</a></h4>
      <p><p>Umbrel sur rpi4 utilise docker pour d√©ployer ses applis. A priori, moi j‚Äôai un probl√®me avec le dhcpcd sur mon interface wlan0 qui perd r√©guli√®rement (toutes les 24h more or less) son adresse ip.</p>

<p>Pour r√©soudre le probl√®me :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># ajouter √† la fin du fichier /etc/dhcpcd.conf
denyinterfaces veth*
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The veth (virtual ethernet) devices are used in software-defined networking to pass data across network namespaces (e.g. between a host and a container).
https://developers.redhat.com/blog/2018/10/22/introduction-to-linux-interfaces-for-virtual-networking#veth

The veth interfaces you see are half of the pairs created by Docker, the other halves live in each container Docker runs.
Docker should manage these interfaces completely, but under Raspios dhcpcd tries to configure every interface that appears in the host.
So the denyinterfaces option makes sure dhcpcd leaves these interfaces and Docker alone.

If you don‚Äôt add the line, dhcpcd will likely interfere with Docker, causing load on the system and possibly disrupting networking completely.
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># pour v√©rifier si vous avez ce probl√®me, regardez ces logs
journalctl -u dhcpcd
 veth*: no IPv6 Routers available
 route socket overflowed - learning interface state
</code></pre></div></div>

<p>source <a href="https://forums.raspberrypi.com/viewtopic.php?t=315363#p1886355">https://forums.raspberrypi.com/viewtopic.php?t=315363#p1886355</a></p>

<p>Petite astuce quand m√™me si jamais vous voulez debug sans red√©marrer le rpi et que vous n‚Äôarrivez plus √† vous co en ssh :</p>
<ul>
  <li>enable VNC sur le rpi</li>
  <li>installer VNC Viewer sur votre PC</li>
  <li>configurer une connexion avec le nom de votre rpi (hostname) + .local, exemple : raspberrypi.local</li>
  <li>une fois co sur votre rpi via VNC, <code class="language-plaintext highlighter-rouge">sudo service dhcpcd restart</code></li>
</ul>

<p>Pas s√ªr de comment √ßa fonctionne si c‚Äôest par adresse MAC ou ipv6 ou je ne sais quoi, mais √ßa fonctionne m√™me quand j‚Äôai perdu l‚ÄôIPv4 local sur mon wlan0 (alors que je n‚Äôai pas de c√¢ble ethernet de connect√© et que je n‚Äôai plus d‚Äôadresse ipv4 sur mon wlan0 ^^)</p>
</p>
      
    </div>

  </li>
  
  
  
  <li>
    <div class="card">
      <h4><a class="post-link" href="/archives/Umbrel-change-wallpapers/">Changer le fond d'√©cran du dashboard Umbrel</a></h4>
      <p><p>Pour ceux qui voudraient changer une image de fond d‚Äô√©cran de leur page d‚Äôaccueil Umbrel :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Copier en scp (avec WinSCP par ex) votreimage.jpg de votre PC vers votre umbrel dans votre home dir ~ (ceci est un exemple pour les noms et chemins)
Se connecter en ssh sur votre noeud umbrel
docker cp ~/votreimage.jpg $(docker ps | grep dashboard | awk '{print $1}'):/dist/wallpapers/1.jpg
</code></pre></div></div>

<p>ou copier/coller l‚ÄôID du container docker du dashboard √† la place de <code class="language-plaintext highlighter-rouge">$(docker ps | grep dashboard | awk '{print $1}')</code><br />
ou tout autre image wallpapers entre 1 et 16 (le code est comme √ßa, on peut pas mettre d‚Äôautres noms ou ajouter)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> data() {
    return {
      wallpapers: ['1.jpg', '2.jpg', '3.jpg', '4.jpg', '5.jpg', '6.jpg', '7.jpg', '8.jpg', '9.jpg', '10.jpg', '11.jpg', '12.jpg', '13.jpg', '14.jpg', '15.jpg', '16.jpg']
    };
  },
</code></pre></div></div>

<p>Ca n‚Äôest pas permanent et ‚Äúsautera‚Äù √† la prochaine MAJ de l‚Äôimage du dashboard ou reconstruction du container mais c‚Äôest easy √† remettre.</p>
</p>
      
    </div>

  </li>
  
  
  
  <li>
    <div class="card">
      <h4><a class="post-link" href="/archives/BTCPayServer-plugin-wordpress-webhook/">Plugin wordpress add donater BTCPay server</a></h4>
      <p><p>J‚Äôai √©crit un plugin wordpress pour callback un webhook BTCPay Server.<br />
Suite √† une invoice ‚ÄúSettled‚Äù, en d√©finissant un montant minimum, √ßa ajoute automatiquement les donateurs, ou on peut les g√©rer √† la main aussi. Si on fournit un nom de donateur avec @ pour twitter, et qu‚Äôon a renseign√© une api twitter dans les Settings du plugin, √ßa va chercher automatiquement l‚Äôimage du profile.</p>

<p>C‚Äôest ici :</p>
<ul>
  <li><a href="https://virtual-thom.github.io/archives/vthom-don-btcpay-wordpress/">https://virtual-thom.github.io/archives/vthom-don-btcpay-wordpress/</a></li>
  <li><a href="https://github.com/Virtual-thom/vthom-don-btcpay-wordpress">https://github.com/Virtual-thom/vthom-don-btcpay-wordpress</a></li>
</ul>
</p>
      
    </div>

  </li>
  
  
  
  <li>
    <div class="card">
      <h4><a class="post-link" href="/archives/BTCPayServer-Umbrel-email/">Envoyer des emails avec BTCPayServer sur noeud rpi4 Umbrel gratuitement</a></h4>
      <p><h2 id="configuration-rpi4">Configuration RPI4</h2>
<ul>
  <li>install umbrel et app BTCPayServer : <a href="https://github.com/getumbrel/umbrel-os">https://github.com/getumbrel/umbrel-os</a></li>
  <li>r√©cup√©rer les informations du r√©seau docker</li>
</ul>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker network <span class="nb">ls
</span>NETWORK ID     NAME                  DRIVER    SCOPE
f4e06556dcab   bridge                bridge    <span class="nb">local
</span>363be02c0e7f   host                  host      <span class="nb">local
</span>279d424f0982   none                  null      <span class="nb">local
</span>d2f1103e7741   umbrel_main_network   bridge    <span class="nb">local
</span>docker network inspect d2f1103e7741 | <span class="nb">head</span> <span class="nt">-n20</span>
<span class="c"># r√©cup√©rer le subnet "IPAM"."Config"."Subnet": exemple. "10.19.0.0/16"</span>
<span class="c"># r√©cup√©rer la gateway "IPAM"."Config"."Gateway": exemple. "10.19.0.1"</span>
</code></pre></div></div>

<ul>
  <li>cr√©er un free domain sur : <a href="https://dynv6.com/">https://dynv6.com/</a> + Record MX mail.votredomaine.dynv6.net et mettre √† jour l‚ÄôIP dynamiquement si vous n‚Äôavez pas d‚Äôip fixe par votre ISP (fournisseur d‚Äôacc√®s internet)</li>
</ul>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>umbrel@umbrel:~ <span class="nv">$ </span>crontab <span class="nt">-l</span>
<span class="k">*</span>/1 <span class="k">*</span> <span class="k">*</span> <span class="k">*</span> <span class="k">*</span> ~/dyn.sh &lt;votredomaine&gt;.dynv6.net password_ou_httptoken_c_idem <span class="o">&gt;</span> /dev/null 2&gt;&amp;1
<span class="k">*</span>/1 <span class="k">*</span> <span class="k">*</span> <span class="k">*</span> <span class="k">*</span> ~/dyn4.sh &lt;votredomaine&gt;.dynv6.net password_ou_httptoken_c_idem <span class="o">&gt;</span> /dev/null 2&gt;&amp;1

umbrel@umbrel:~ <span class="nv">$ </span><span class="nb">cat </span>dyn4.sh
<span class="c">#!/bin/sh -e</span>
<span class="c"># based on https://gist.github.com/corny/7a07f5ac901844bd20c9</span>

<span class="nb">hostname</span><span class="o">=</span><span class="nv">$1</span>
<span class="nv">token</span><span class="o">=</span><span class="nv">$2</span>
<span class="nv">v4_address</span><span class="o">=</span><span class="sb">`</span>curl <span class="s1">'https://api.ipify.org'</span><span class="sb">`</span>

<span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$hostname</span><span class="s2">"</span> <span class="nt">-o</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$token</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nb">echo</span> <span class="s2">"Usage: </span><span class="nv">$0</span><span class="s2"> your-name.dynv6.net &lt;your-authentication-token&gt;"</span>
  <span class="nb">exit </span>1
<span class="k">fi

if</span> <span class="o">[</span> <span class="nt">-e</span> /usr/bin/curl <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nv">bin</span><span class="o">=</span><span class="s2">"curl -fsS"</span>
<span class="k">elif</span> <span class="o">[</span> <span class="nt">-e</span> /usr/bin/wget <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nv">bin</span><span class="o">=</span><span class="s2">"wget -O-"</span>
<span class="k">else
  </span><span class="nb">echo</span> <span class="s2">"neither curl nor wget found"</span>
  <span class="nb">exit </span>1
<span class="k">fi</span>

<span class="nv">$bin</span> <span class="s2">"http://ipv4.dynv6.com/api/update?hostname=</span><span class="nv">$hostname</span><span class="s2">&amp;ipv4=</span><span class="nv">$v4_address</span><span class="s2">&amp;token=</span><span class="nv">$token</span><span class="s2">"</span>

umbrel@umbrel:~ <span class="nv">$ </span><span class="nb">cat </span>dyn.sh
<span class="c">#!/bin/sh -e</span>
<span class="nb">hostname</span><span class="o">=</span><span class="nv">$1</span>
<span class="nv">token</span><span class="o">=</span><span class="nv">$2</span>
<span class="nv">device</span><span class="o">=</span><span class="nv">$3</span>
<span class="nv">file</span><span class="o">=</span><span class="nv">$HOME</span>/.dynv6.addr6
<span class="o">[</span> <span class="nt">-e</span> <span class="nv">$file</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nv">old</span><span class="o">=</span><span class="sb">`</span><span class="nb">cat</span> <span class="nv">$file</span><span class="sb">`</span>

<span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$hostname</span><span class="s2">"</span> <span class="nt">-o</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$token</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nb">echo</span> <span class="s2">"Usage: your-name.dynv6.net &lt;your-authentication-token&gt; [device]"</span>
  <span class="nb">exit </span>1
<span class="k">fi

if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$netmask</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nv">netmask</span><span class="o">=</span>128
<span class="k">fi

if</span> <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$device</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nv">device</span><span class="o">=</span><span class="s2">"dev </span><span class="nv">$device</span><span class="s2">"</span>
<span class="k">fi
</span><span class="nv">address</span><span class="o">=</span><span class="si">$(</span>ip <span class="nt">-6</span> addr list scope global <span class="nv">$device</span> | <span class="nb">grep</span> <span class="nt">-v</span> <span class="s2">" fd"</span> | <span class="nb">sed</span> <span class="nt">-n</span> <span class="s1">'s/.*inet6 \([0-9a-f:]\+\).*/\1/p'</span> | <span class="nb">head</span> <span class="nt">-n</span> 1<span class="si">)</span>

<span class="k">if</span> <span class="o">[</span> <span class="nt">-e</span> /usr/bin/curl <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nv">bin</span><span class="o">=</span><span class="s2">"curl -fsS"</span>
<span class="k">elif</span> <span class="o">[</span> <span class="nt">-e</span> /usr/bin/wget <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nv">bin</span><span class="o">=</span><span class="s2">"wget -O-"</span>
<span class="k">else
  </span><span class="nb">echo</span> <span class="s2">"neither curl nor wget found"</span>
  <span class="nb">exit </span>1
<span class="k">fi

if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$address</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nb">echo</span> <span class="s2">"no IPv6 address found"</span>
  <span class="nb">exit </span>1
<span class="k">fi</span>

<span class="c"># address with netmask</span>
<span class="nv">current</span><span class="o">=</span><span class="nv">$address</span>/<span class="nv">$netmask</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$old</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"</span><span class="nv">$current</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nb">echo</span> <span class="s2">"IPv6 address unchanged"</span>
  <span class="nb">exit
</span><span class="k">fi</span>

<span class="c"># send addresses to dynv6</span>
<span class="nv">$bin</span> <span class="s2">"http://dynv6.com/api/update?hostname=</span><span class="nv">$hostname</span><span class="s2">&amp;ipv6=</span><span class="nv">$current</span><span class="s2">&amp;token=</span><span class="nv">$token</span><span class="s2">"</span>

<span class="c"># save current address</span>
<span class="nb">echo</span> <span class="nv">$current</span> <span class="o">&gt;</span> <span class="nv">$file</span>
</code></pre></div></div>

<ul>
  <li>install/config postfix sur rpi4 : <a href="https://raspberrytips.com/mail-server-raspberry-pi/">https://raspberrytips.com/mail-server-raspberry-pi/</a></li>
</ul>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># rajouter ou modifier </span>
<span class="c"># ex ISP orange : relayhost = smtp.orange.fr</span>
<span class="nb">sudo </span>vi /etc/postfix/main.cf
myhostname <span class="o">=</span> votredomaine.dynv6.net
mydestination <span class="o">=</span> <span class="nv">$myhostname</span>, votredomaine.dynv6.net, umbrel, localhost.localdomain, localhost
relayhost <span class="o">=</span> smtp.votreisp.fr
mynetworks <span class="o">=</span> 127.0.0.0/8 <span class="o">[</span>::ffff:127.0.0.0]/104 <span class="o">[</span>::1]/128, 10.19.0.0/16
inet_interfaces <span class="o">=</span> all
inet_protocols <span class="o">=</span> ipv4
smtpd_helo_restrictions <span class="o">=</span>
permit_mynetworks <span class="o">=</span>
permit_sasl_authenticated <span class="o">=</span>
reject_invalid_helo_hostname <span class="o">=</span>
reject_non_fqdn_helo_hostname <span class="o">=</span>
reject_unknown_helo_hostname <span class="o">=</span>
check_helo_access <span class="o">=</span>
<span class="nb">hash</span>:/etc/postfix/helo_access <span class="o">=</span>

umbrel@umbrel:~ <span class="nv">$ </span><span class="nb">sudo </span>vi /etc/postfix/helo_access
&lt;votreipv4delabox&gt; REJECT
votredomaine.dynv6.net REJECT
mail.votredomaine.dynv6.net REJECT

<span class="c"># MAJ ipv4 si votre IP box ISP n'est pas fixe</span>
<span class="nb">sudo </span>crontab <span class="nt">-e</span>
0 <span class="k">*</span> <span class="k">*</span> <span class="k">*</span> <span class="k">*</span> <span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'1 s#.*#'</span><span class="sb">`</span>curl <span class="s1">'https://api.ipify.org'</span><span class="sb">`</span><span class="s1">' REJECT#'</span> /etc/postfix/helo_access

<span class="nb">sudo </span>service postfix restart
</code></pre></div></div>

<ul>
  <li>autoriser le port 25 pour le r√©seau docker afin que les containers puissent envoyer des emails <code class="language-plaintext highlighter-rouge">sudo ufw allow from 10.19.0.0/16 to any  port 25</code>
    <h2 id="btcpay-server-email-settings">BTCPay Server email settings</h2>
    <p>Configurer la gateway docker r√©cup√©r√©e pr√©c√©demment.<br />
<img src="https://virtual-thom.github.io/archives/wp-content/uploads/btcpayserver_email_settings.png" alt="btcpayserver_email_settings.png" /></p>
  </li>
</ul>
</p>
      
    </div>

  </li>
  
  
</ul>
<!-- Pagination links -->
<nav>
  <ul class="pagination">
    
    <li>
      <a href="/" class="Pr√©c√©dant">
        <span aria-hidden="true">&laquo;</span>
      </a>
    </li>
      
    <li>
      <a href="/archives/index.html">1</a>
    </li>
      
    <li class="active">
      <span>2</span>
    </li>
      
    <li>
      <a
        href="/archives/page3">3</a>
    </li>
      
    <li>
      <a
        href="/archives/page4">4</a>
    </li>
      
    <li>
      <a
        href="/archives/page5">5</a>
    </li>
      
    <li>
      <a
        href="/archives/page6">6</a>
    </li>
      
    <li>
      <a
        href="/archives/page7">7</a>
    </li>
      
    <li>
      <a
        href="/archives/page8">8</a>
    </li>
      
    <li>
      <a
        href="/archives/page9">9</a>
    </li>
      
    <li>
      <a
        href="/archives/page10">10</a>
    </li>
      
    <li>
      <a
        href="/archives/page11">11</a>
    </li>
      
    <li>
      <a
        href="/archives/page12">12</a>
    </li>
      
    <li>
      <a
        href="/archives/page13">13</a>
    </li>
      
    <li>
      <a
        href="/archives/page14">14</a>
    </li>
      
    <li>
      <a href="/page3" aria-label="Suivant">
        <span aria-hidden="true">&raquo;</span>
      </a>
    </li>
    
  </ul>
</nav>

      <footer id="site-footer">
    <div>&copy;<a href="https://github.com/virtual-thom/" title="Github Virtual-Thom">Virtual-Thom</a></div>
    <div>
            <a href="https://virtual-thom.github.io/archives/plan" title="Plan du site">sitemap</a> | <a href="https://virtual-thom.github.io/about" rel="publisher author" title="Curriculum vitae Thom">A propos</a>
    </div>
    <div>
        <a id="goto-site-header" href="#site-header" title="Retourner au d√©but">&uArr; Top</a>
    </div>
    <div id="footer-disclaimer">
        <p>Avertissement : vous ne devez pas prendre pour argent comptant le contenu de ce site. Testez toujours la solution en environnement de test.</p>
        <p>Malgr√© le s√©rieux que je m'efforce de mettre dans le contenu de ces billets, je ne pourrai √™tre tenu responsable d'√©ventuelles erreurs que cela pourrait engendrer.</p>
    </div>
    <div>
        <a class="hidden" href="https://virtual-thom.github.io/archives/sitemap.xml" title="SiteMap">sitemap</a>
    </div>
</footer>

    </div>
  </body>

</html>