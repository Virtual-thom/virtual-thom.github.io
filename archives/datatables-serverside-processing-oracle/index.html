<!DOCTYPE html>
<html lang="fr">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="apple-touch-icon" href="https://virtual-thom.github.io/archives/apple-touch-icon.png">
  <link rel="icon" href="https://virtual-thom.github.io/archives/favicon.ico" />
  <!-- Remplacé par Jekyll SEO (sinon apparait en double)
  <title>DataTables ServerSide Processing pour Oracle</title>
  <meta name="description" content="oracle.ssp.class.phphttps://github.com/virtual-thom/DataTables/blob/master/oracle.ssp.class.phpPetite adaptation pour ma base oracle afin d’effectuer du serv...">
  --> 
  
  <link rel="canonical" href="https://virtual-thom.github.io/archives/datatables-serverside-processing-oracle/">
  
  <link rel="stylesheet" media="screen" href="https://virtual-thom.github.io/archives/assets/main.css">
  
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>DataTables ServerSide Processing pour Oracle | Virtual-Thom Blog-notes VTOM et informatique</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="DataTables ServerSide Processing pour Oracle" />
<meta name="author" content="Virtual Thom" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="oracle.ssp.class.php https://github.com/virtual-thom/DataTables/blob/master/oracle.ssp.class.php Petite adaptation pour ma base oracle afin d’effectuer du serverSide Processing avec DataTables : PDO driver oci, requête pour simuler le LIMIT, ajout d’un NLS_DATE_FORMAT. Originale pour MySQL : https://github.com/DataTables/DataTables/blob/master/examples/server_side/scripts/ssp.class.php https://datatables.net/examples/data_sources/server_side" />
<meta property="og:description" content="oracle.ssp.class.php https://github.com/virtual-thom/DataTables/blob/master/oracle.ssp.class.php Petite adaptation pour ma base oracle afin d’effectuer du serverSide Processing avec DataTables : PDO driver oci, requête pour simuler le LIMIT, ajout d’un NLS_DATE_FORMAT. Originale pour MySQL : https://github.com/DataTables/DataTables/blob/master/examples/server_side/scripts/ssp.class.php https://datatables.net/examples/data_sources/server_side" />
<link rel="canonical" href="https://virtual-thom.github.io/archives/datatables-serverside-processing-oracle/" />
<meta property="og:url" content="https://virtual-thom.github.io/archives/datatables-serverside-processing-oracle/" />
<meta property="og:site_name" content="Virtual-Thom Blog-notes VTOM et informatique" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-10-10T12:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="DataTables ServerSide Processing pour Oracle" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Virtual Thom"},"dateModified":"2018-10-10T12:00:00+00:00","datePublished":"2018-10-10T12:00:00+00:00","description":"oracle.ssp.class.php https://github.com/virtual-thom/DataTables/blob/master/oracle.ssp.class.php Petite adaptation pour ma base oracle afin d’effectuer du serverSide Processing avec DataTables : PDO driver oci, requête pour simuler le LIMIT, ajout d’un NLS_DATE_FORMAT. Originale pour MySQL : https://github.com/DataTables/DataTables/blob/master/examples/server_side/scripts/ssp.class.php https://datatables.net/examples/data_sources/server_side","headline":"DataTables ServerSide Processing pour Oracle","mainEntityOfPage":{"@type":"WebPage","@id":"https://virtual-thom.github.io/archives/datatables-serverside-processing-oracle/"},"url":"https://virtual-thom.github.io/archives/datatables-serverside-processing-oracle/"}</script>
<!-- End Jekyll SEO tag -->

  
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Z8Y7902GRV"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Z8Y7902GRV');
</script>


  <body>
    <div class="container">
      <header id="site-header">
  <h1>Blog-notes VTOM, informatique, industrialisation, ordonnancement, DevOps</h1>
  <nav>
    <ul>
      <li>
        <a href="https://virtual-thom.github.io/archives" title="Home">
          <svg class="svg-icon" viewBox="0 0 20 20">
            <path d="M18.121,9.88l-7.832-7.836c-0.155-0.158-0.428-0.155-0.584,0L1.842,9.913c-0.262,0.263-0.073,0.705,0.292,0.705h2.069v7.042c0,0.227,0.187,0.414,0.414,0.414h3.725c0.228,0,0.414-0.188,0.414-0.414v-3.313h2.483v3.313c0,0.227,0.187,0.414,0.413,0.414h3.726c0.229,0,0.414-0.188,0.414-0.414v-7.042h2.068h0.004C18.331,10.617,18.389,10.146,18.121,9.88 M14.963,17.245h-2.896v-3.313c0-0.229-0.186-0.415-0.414-0.415H8.342c-0.228,0-0.414,0.187-0.414,0.415v3.313H5.032v-6.628h9.931V17.245z M3.133,9.79l6.864-6.868l6.867,6.868H3.133z"></path>
          </svg>
        </a>
      </li>
      <li>
        <a href="https://virtual-thom.github.io/archives/vos-commentaires-livre-d-or/" title="Commentaires - livre d'or">
          <svg class="svg-icon" viewBox="0 0 20 20">
            <path d="M17.657,2.982H2.342c-0.234,0-0.425,0.191-0.425,0.426v10.21c0,0.234,0.191,0.426,0.425,0.426h3.404v2.553c0,0.397,0.48,0.547,0.725,0.302l2.889-2.854h8.298c0.234,0,0.426-0.191,0.426-0.426V3.408C18.083,3.174,17.892,2.982,17.657,2.982M17.232,13.192H9.185c-0.113,0-0.219,0.045-0.3,0.124l-2.289,2.262v-1.96c0-0.233-0.191-0.426-0.425-0.426H2.767V3.833h14.465V13.192z M10,7.237c-0.821,0-1.489,0.668-1.489,1.489c0,0.821,0.668,1.489,1.489,1.489c0.821,0,1.488-0.668,1.488-1.489C11.488,7.905,10.821,7.237,10,7.237 M10,9.364c-0.352,0-0.638-0.288-0.638-0.638c0-0.351,0.287-0.638,0.638-0.638c0.351,0,0.638,0.287,0.638,0.638C10.638,9.077,10.351,9.364,10,9.364 M14.254,7.237c-0.821,0-1.489,0.668-1.489,1.489c0,0.821,0.668,1.489,1.489,1.489s1.489-0.668,1.489-1.489C15.743,7.905,15.075,7.237,14.254,7.237 M14.254,9.364c-0.351,0-0.638-0.288-0.638-0.638c0-0.351,0.287-0.638,0.638-0.638c0.352,0,0.639,0.287,0.639,0.638C14.893,9.077,14.605,9.364,14.254,9.364 M5.746,7.237c-0.821,0-1.489,0.668-1.489,1.489c0,0.821,0.668,1.489,1.489,1.489c0.821,0,1.489-0.668,1.489-1.489C7.234,7.905,6.566,7.237,5.746,7.237 M5.746,9.364c-0.351,0-0.638-0.288-0.638-0.638c0-0.351,0.287-0.638,0.638-0.638c0.351,0,0.638,0.287,0.638,0.638C6.384,9.077,6.096,9.364,5.746,9.364"></path>
          </svg>
        </a>
      </li>
      
      <li>
        <a href="https://virtual-thom.github.io/about" title="Curriculum Vitae Thom">
          <svg class="svg-icon" viewBox="0 0 20 20">
            <path d="M12.075,10.812c1.358-0.853,2.242-2.507,2.242-4.037c0-2.181-1.795-4.618-4.198-4.618S5.921,4.594,5.921,6.775c0,1.53,0.884,3.185,2.242,4.037c-3.222,0.865-5.6,3.807-5.6,7.298c0,0.23,0.189,0.42,0.42,0.42h14.273c0.23,0,0.42-0.189,0.42-0.42C17.676,14.619,15.297,11.677,12.075,10.812 M6.761,6.775c0-2.162,1.773-3.778,3.358-3.778s3.359,1.616,3.359,3.778c0,2.162-1.774,3.778-3.359,3.778S6.761,8.937,6.761,6.775 M3.415,17.69c0.218-3.51,3.142-6.297,6.704-6.297c3.562,0,6.486,2.787,6.705,6.297H3.415z"></path>
          </svg>
        </a>
      </li>
    </ul>
  </nav>
</header>

      <div itemscope itemtype ="http://schema.org/Article" class="post">
  
  <header class="post-header">
    <h1 itemprop="name about headline" class="post-title">DataTables ServerSide Processing pour Oracle</h1>
    <p class="post-meta">
      <time itemprop="datePublished dateModified" datetime="2018-10-10T12:00:00+00:00">10-10-2018</time></p>
  </header>

  <article class="post-content" itemprop="articleBody">
    <h1 class="hidden">DataTables ServerSide Processing pour Oracle</h1>
    <h2 id="oraclesspclassphp">oracle.ssp.class.php</h2>

<p><a href="https://github.com/virtual-thom/DataTables/blob/master/oracle.ssp.class.php">https://github.com/virtual-thom/DataTables/blob/master/oracle.ssp.class.php</a></p>

<p>Petite adaptation pour ma base oracle afin d’effectuer du serverSide Processing avec DataTables : PDO driver oci, requête pour simuler le LIMIT, ajout d’un NLS_DATE_FORMAT.</p>

<p>Originale pour MySQL :</p>

<p><a href="https://github.com/DataTables/DataTables/blob/master/examples/server_side/scripts/ssp.class.php">https://github.com/DataTables/DataTables/blob/master/examples/server_side/scripts/ssp.class.php</a></p>

<p><a href="https://datatables.net/examples/data_sources/server_side">https://datatables.net/examples/data_sources/server_side</a>
<!--more--></p>

<h2 id="api-exemple">api exemple</h2>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="c1">// dtServerSideProcessing.php</span>
<span class="nb">ini_set</span><span class="p">(</span><span class="s1">'max_execution_time'</span><span class="p">,</span> <span class="mi">300</span><span class="p">);</span>
<span class="nb">error_reporting</span><span class="p">(</span><span class="kc">E_ALL</span><span class="p">);</span>
<span class="nb">ini_set</span><span class="p">(</span><span class="s2">"display_errors"</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">ini_set</span><span class="p">(</span><span class="s1">'memory_limit'</span><span class="p">,</span> <span class="s1">'512M'</span><span class="p">);</span>

<span class="c1"># return content as json</span>
<span class="nb">header</span><span class="p">(</span><span class="s1">'Content-Type: application/json'</span><span class="p">);</span>

<span class="k">require</span><span class="p">(</span> <span class="s1">'oracle.ssp.class.php'</span> <span class="p">);</span>
<span class="nv">$fic_par</span> <span class="o">=</span> <span class="s1">'cnx_ora.ini'</span><span class="p">;</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">file_exists</span><span class="p">(</span><span class="nv">$fic_par</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">echo</span><span class="p">(</span><span class="s2">"Le fichier "</span><span class="mf">.</span> <span class="nv">$fic_par</span> <span class="mf">.</span><span class="s2">" est introuvable"</span><span class="p">);</span>
		<span class="k">die</span><span class="p">();</span>
<span class="p">}</span>
<span class="c1">//Recuperation User/Mot de passe/Instance</span>
<span class="nv">$ini</span> <span class="o">=</span> <span class="nb">parse_ini_file</span><span class="p">(</span><span class="nv">$fic_par</span><span class="p">,</span><span class="kc">TRUE</span><span class="p">);</span>
<span class="nv">$sql_details</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
	<span class="s1">'user'</span> <span class="o">=&gt;</span> <span class="nv">$ini</span><span class="p">[</span><span class="s1">'MONID'</span><span class="p">][</span><span class="s1">'User'</span><span class="p">],</span>
	<span class="s1">'pass'</span> <span class="o">=&gt;</span> <span class="nv">$ini</span><span class="p">[</span><span class="s1">'MONID'</span><span class="p">][</span><span class="s1">'Mdp'</span><span class="p">],</span>
	<span class="s1">'dbInstance'</span>   <span class="o">=&gt;</span> <span class="nv">$ini</span><span class="p">[</span><span class="s1">'MONID'</span><span class="p">][</span><span class="s1">'Instance'</span><span class="p">]</span>
<span class="p">);</span>


<span class="c1">// DB table to use</span>
<span class="nv">$table</span> <span class="o">=</span> <span class="s1">'MATABLE'</span><span class="p">;</span>

<span class="c1">// Table's primary key</span>
<span class="nv">$primaryKey</span> <span class="o">=</span> <span class="s1">'MONINDEX'</span><span class="p">;</span>

<span class="nv">$columns</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
	<span class="k">array</span><span class="p">(</span> <span class="s1">'db'</span> <span class="o">=&gt;</span> <span class="s1">'INDEX'</span><span class="p">,</span> <span class="s1">'dt'</span> <span class="o">=&gt;</span> <span class="mi">0</span> <span class="p">),</span>
	<span class="k">array</span><span class="p">(</span> <span class="s1">'db'</span> <span class="o">=&gt;</span> <span class="s1">'TRTNAME'</span><span class="p">,</span>  <span class="s1">'dt'</span> <span class="o">=&gt;</span> <span class="mi">1</span> <span class="p">),</span>
	<span class="k">array</span><span class="p">(</span> <span class="s1">'db'</span> <span class="o">=&gt;</span> <span class="s1">'ENVNAME'</span><span class="p">,</span>   <span class="s1">'dt'</span> <span class="o">=&gt;</span> <span class="mi">2</span> <span class="p">),</span>
	<span class="k">array</span><span class="p">(</span> <span class="s1">'db'</span> <span class="o">=&gt;</span> <span class="s1">'FICTRT'</span><span class="p">,</span>     <span class="s1">'dt'</span> <span class="o">=&gt;</span> <span class="mi">3</span> <span class="p">),</span>
	<span class="k">array</span><span class="p">(</span>
		<span class="s1">'db'</span>        <span class="o">=&gt;</span> <span class="s1">'DATE_DEB'</span><span class="p">,</span>
		<span class="s1">'dt'</span>        <span class="o">=&gt;</span> <span class="mi">4</span><span class="cm">/*,
		'formatter' =&gt; function( $d, $row ) {
			return date( 'jS M y', strtotime($d));
		}*/</span>
	<span class="p">),</span>
	<span class="k">array</span><span class="p">(</span>
		<span class="s1">'db'</span>        <span class="o">=&gt;</span> <span class="s1">'DATE_FIN'</span><span class="p">,</span>
		<span class="s1">'dt'</span>        <span class="o">=&gt;</span> <span class="mi">5</span><span class="cm">/*,
		'formatter' =&gt; function( $d, $row ) {
			return date( 'jS M y', strtotime($d));
		}*/</span>
	<span class="p">),</span>
	<span class="k">array</span><span class="p">(</span> <span class="s1">'db'</span> <span class="o">=&gt;</span> <span class="s1">'INFO'</span><span class="p">,</span>     <span class="s1">'dt'</span> <span class="o">=&gt;</span> <span class="mi">6</span> <span class="p">)</span>
<span class="p">);</span>


<span class="k">echo</span> <span class="nb">json_encode</span><span class="p">(</span>
	<span class="no">SSP</span><span class="o">::</span><span class="nf">simple</span><span class="p">(</span> <span class="nv">$_GET</span><span class="p">,</span> <span class="nv">$sql_details</span><span class="p">,</span> <span class="nv">$table</span><span class="p">,</span> <span class="nv">$primaryKey</span><span class="p">,</span> <span class="nv">$columns</span> <span class="p">)</span>
<span class="p">);</span>
</code></pre></div></div>

<p>et les appels en js par ex</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  "processing": true,
  "serverSide": true,
  "ajax": "/api/dtServerSideProcessing.php",
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nf">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

<span class="kd">var</span> <span class="nx">table</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#example</span><span class="dl">'</span><span class="p">).</span><span class="nc">DataTable</span><span class="p">({</span>
  <span class="dl">"</span><span class="s2">dom</span><span class="dl">"</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Bfrtip</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">language</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span><span class="dl">"</span><span class="s2">url</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">vendor/DataTables-1.10.18/lang/French.json</span><span class="dl">"</span><span class="p">},</span>
  <span class="dl">"</span><span class="s2">processing</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">serverSide</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">ajax</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">/api/dtServerSideProcessing.php</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">order</span><span class="dl">"</span><span class="p">:</span> <span class="p">[[</span> <span class="mi">4</span><span class="p">,</span> <span class="dl">"</span><span class="s2">desc</span><span class="dl">"</span> <span class="p">],</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="dl">"</span><span class="s2">desc</span><span class="dl">"</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="dl">"</span><span class="s2">desc</span><span class="dl">"</span><span class="p">]],</span>
  <span class="dl">"</span><span class="s2">lengthMenu</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Tout</span><span class="dl">"</span><span class="p">]</span> <span class="p">],</span>
  <span class="dl">"</span><span class="s2">buttons</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
    <span class="dl">'</span><span class="s1">pageLength</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">colvis</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">copy</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">excel</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">{</span>
      <span class="na">extend</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">pdfHtml5</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">title</span> <span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">return</span> <span class="dl">"</span><span class="s2">USI Suivi Trt</span><span class="dl">"</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="na">orientation</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">landscape</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">pageSize</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">LEGAL</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">text</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">PDF</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">titleAttr</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">PDF</span><span class="dl">'</span>
    <span class="p">},</span>
    <span class="p">{</span>
    <span class="na">extend</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">print</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">customize</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">win</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">last</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
                <span class="kd">var</span> <span class="nx">current</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
                <span class="kd">var</span> <span class="nx">bod</span> <span class="o">=</span> <span class="p">[];</span>

                <span class="kd">var</span> <span class="nx">css</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">@page { size: landscape; }</span><span class="dl">'</span><span class="p">,</span>
                    <span class="nx">head</span> <span class="o">=</span> <span class="nx">win</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">head</span> <span class="o">||</span> <span class="nx">win</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nf">getElementsByTagName</span><span class="p">(</span><span class="dl">'</span><span class="s1">head</span><span class="dl">'</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="nx">style</span> <span class="o">=</span> <span class="nx">win</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nf">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">style</span><span class="dl">'</span><span class="p">);</span>
 
                <span class="nx">style</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">text/css</span><span class="dl">'</span><span class="p">;</span>
                <span class="nx">style</span><span class="p">.</span><span class="nx">media</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">print</span><span class="dl">'</span><span class="p">;</span>
 
                <span class="k">if </span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">styleSheet</span><span class="p">)</span>
                <span class="p">{</span>
                  <span class="nx">style</span><span class="p">.</span><span class="nx">styleSheet</span><span class="p">.</span><span class="nx">cssText</span> <span class="o">=</span> <span class="nx">css</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                  <span class="nx">style</span><span class="p">.</span><span class="nf">appendChild</span><span class="p">(</span><span class="nx">win</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nf">createTextNode</span><span class="p">(</span><span class="nx">css</span><span class="p">));</span>
                <span class="p">}</span>
 
                <span class="nx">head</span><span class="p">.</span><span class="nf">appendChild</span><span class="p">(</span><span class="nx">style</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="na">text</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Refresh</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">action</span><span class="p">:</span> <span class="nf">function </span><span class="p">(</span> <span class="nx">e</span><span class="p">,</span> <span class="nx">dt</span><span class="p">,</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">config</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">dt</span><span class="p">.</span><span class="nx">ajax</span><span class="p">.</span><span class="nf">reload</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="dl">"</span><span class="s2">initComplete</span><span class="dl">"</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">api</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">api</span><span class="p">();</span>

    <span class="c1">// Apply the search</span>
    <span class="nx">api</span><span class="p">.</span><span class="nf">columns</span><span class="p">().</span><span class="nf">every</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

      <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">input</span><span class="dl">'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nf">footer</span><span class="p">()).</span><span class="nf">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">keyup change</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nf">search</span><span class="p">()</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">that</span>
            <span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">draw</span><span class="p">();</span>
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">colReorder</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">});</span>


<span class="c1">// Setup - add a text input to each footer cell</span>
<span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#example tfoot th</span><span class="dl">'</span><span class="p">).</span><span class="nf">each</span><span class="p">(</span> <span class="nf">function </span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">title</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nf">text</span><span class="p">();</span>
  <span class="nf">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nf">html</span><span class="p">(</span> <span class="dl">'</span><span class="s1">&lt;input type="text" placeholder="Filtre </span><span class="dl">'</span><span class="o">+</span><span class="nx">title</span><span class="o">+</span><span class="dl">'</span><span class="s1">" /&gt;</span><span class="dl">'</span> <span class="p">);</span>
<span class="p">}</span> <span class="p">);</span>

<span class="p">});</span> <span class="c1">// end ready</span>
</code></pre></div></div>

<p>On peut aussi passer des data dans “ajax” de DataTables :</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nx">index</span><span class="p">.</span><span class="nx">php</span>
<span class="o">&lt;</span><span class="p">?</span><span class="nx">php</span>
<span class="c1">// PHP </span>
<span class="nx">$table</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">USI_LOG_TRT</span><span class="dl">'</span><span class="p">;</span>
<span class="nx">$primaryKey</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">USI_INDEX</span><span class="dl">'</span><span class="p">;</span>
<span class="nx">$columns</span> <span class="o">=</span> <span class="nf">array</span><span class="p">(</span>
	<span class="nf">array</span><span class="p">(</span> <span class="dl">'</span><span class="s1">db</span><span class="dl">'</span> <span class="o">=&gt;</span> <span class="dl">'</span><span class="s1">USI_INDEX</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">dt</span><span class="dl">'</span> <span class="o">=&gt;</span> <span class="mi">0</span> <span class="p">),</span>
	<span class="nf">array</span><span class="p">(</span> <span class="dl">'</span><span class="s1">db</span><span class="dl">'</span> <span class="o">=&gt;</span> <span class="dl">'</span><span class="s1">USI_TRTNAME</span><span class="dl">'</span><span class="p">,</span>  <span class="dl">'</span><span class="s1">dt</span><span class="dl">'</span> <span class="o">=&gt;</span> <span class="mi">1</span> <span class="p">),</span>
	<span class="nf">array</span><span class="p">(</span> <span class="dl">'</span><span class="s1">db</span><span class="dl">'</span> <span class="o">=&gt;</span> <span class="dl">'</span><span class="s1">USI_ENVNAME</span><span class="dl">'</span><span class="p">,</span>   <span class="dl">'</span><span class="s1">dt</span><span class="dl">'</span> <span class="o">=&gt;</span> <span class="mi">2</span> <span class="p">),</span>
	<span class="nf">array</span><span class="p">(</span> <span class="dl">'</span><span class="s1">db</span><span class="dl">'</span> <span class="o">=&gt;</span> <span class="dl">'</span><span class="s1">USI_FICTRT</span><span class="dl">'</span><span class="p">,</span>     <span class="dl">'</span><span class="s1">dt</span><span class="dl">'</span> <span class="o">=&gt;</span> <span class="mi">3</span> <span class="p">),</span>
	<span class="nf">array</span><span class="p">(</span>
		<span class="dl">'</span><span class="s1">db</span><span class="dl">'</span>        <span class="o">=&gt;</span> <span class="dl">'</span><span class="s1">USI_DATE_DEB</span><span class="dl">'</span><span class="p">,</span>
		<span class="dl">'</span><span class="s1">dt</span><span class="dl">'</span>        <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">,</span>
		<span class="dl">'</span><span class="s1">formatter</span><span class="dl">'</span> <span class="o">=&gt;</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">$d</span><span class="p">,</span> <span class="nx">$row</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nf">date</span><span class="p">(</span> <span class="dl">'</span><span class="s1">jS M y</span><span class="dl">'</span><span class="p">,</span> <span class="nf">strtotime</span><span class="p">(</span><span class="nx">$d</span><span class="p">));</span>
		<span class="p">}</span>
	<span class="p">),</span>
	<span class="nf">array</span><span class="p">(</span>
		<span class="dl">'</span><span class="s1">db</span><span class="dl">'</span>        <span class="o">=&gt;</span> <span class="dl">'</span><span class="s1">USI_DATE_FIN</span><span class="dl">'</span><span class="p">,</span>
		<span class="dl">'</span><span class="s1">dt</span><span class="dl">'</span>        <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">,</span>
		<span class="dl">'</span><span class="s1">formatter</span><span class="dl">'</span> <span class="o">=&gt;</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">$d</span><span class="p">,</span> <span class="nx">$row</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nf">date</span><span class="p">(</span> <span class="dl">'</span><span class="s1">jS M y</span><span class="dl">'</span><span class="p">,</span> <span class="nf">strtotime</span><span class="p">(</span><span class="nx">$d</span><span class="p">));</span>
		<span class="p">}</span>
	<span class="p">),</span>
	<span class="nf">array</span><span class="p">(</span> <span class="dl">'</span><span class="s1">db</span><span class="dl">'</span> <span class="o">=&gt;</span> <span class="dl">'</span><span class="s1">USI_INFO</span><span class="dl">'</span><span class="p">,</span>     <span class="dl">'</span><span class="s1">dt</span><span class="dl">'</span> <span class="o">=&gt;</span> <span class="mi">6</span> <span class="p">)</span>
<span class="p">);</span>
<span class="p">?</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">myColumns</span> <span class="o">=</span> <span class="o">&lt;</span><span class="p">?</span><span class="nx">php</span> <span class="nx">echo</span> <span class="nf">json_encode</span><span class="p">(</span><span class="nx">$columns</span><span class="p">);</span> <span class="p">?</span><span class="o">&gt;</span> <span class="p">;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">myTable</span> <span class="o">=</span> <span class="o">&lt;</span><span class="p">?</span><span class="nx">php</span> <span class="nx">echo</span> <span class="nf">json_encode</span><span class="p">(</span><span class="nx">$table</span><span class="p">);</span> <span class="p">?</span><span class="o">&gt;</span> <span class="p">;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">myPrimaryKey</span> <span class="o">=</span> <span class="o">&lt;</span><span class="p">?</span><span class="nx">php</span> <span class="nx">echo</span> <span class="nf">json_encode</span><span class="p">(</span><span class="nx">$primaryKey</span><span class="p">);</span> <span class="p">?</span><span class="o">&gt;</span> <span class="p">;</span>
<span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="dl">"</span><span class="s2">index.js</span><span class="dl">"</span> <span class="nx">type</span><span class="o">=</span><span class="dl">"</span><span class="s2">text/javascript</span><span class="dl">"</span><span class="o">&gt;&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span>

<span class="nx">index</span><span class="p">.</span><span class="nx">js</span>
<span class="p">...</span>
<span class="kd">let</span> <span class="nx">table</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#example</span><span class="dl">'</span><span class="p">).</span><span class="nc">DataTable</span><span class="p">({</span>
<span class="p">...</span>
<span class="p">...</span>
  <span class="dl">"</span><span class="s2">processing</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">serverSide</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">ajax</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">url</span><span class="dl">"</span> <span class="p">:</span><span class="dl">"</span><span class="s2">/api/dtServerSideProcessing.php</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">data</span><span class="dl">"</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">){</span>
      <span class="kd">let</span> <span class="nx">objTable</span> <span class="o">=</span> <span class="p">{}</span>
      <span class="k">if</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">myColumns</span><span class="p">){</span>
        <span class="nx">objTable</span><span class="p">[</span><span class="dl">"</span><span class="s2">myColumns</span><span class="dl">"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">myColumns</span>
      <span class="p">}</span>
      <span class="k">if</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">myTable</span><span class="p">){</span>
        <span class="nx">objTable</span><span class="p">[</span><span class="dl">"</span><span class="s2">myTable</span><span class="dl">"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">myTable</span>
      <span class="p">}</span>
      <span class="k">if</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">myPrimaryKey</span><span class="p">){</span>
        <span class="nx">objTable</span><span class="p">[</span><span class="dl">"</span><span class="s2">myPrimaryKey</span><span class="dl">"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">myPrimaryKey</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nf">extend</span><span class="p">({},</span><span class="nx">d</span><span class="p">,</span><span class="nx">objTable</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">},</span>
<span class="p">...</span>
<span class="p">...</span>
</code></pre></div></div>

<p>afin de se passer de définition des colonnes dans le dtServerSideProcessing.php (réutilisable pour d’autres DataTables du coup) :</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">...</span>
<span class="mf">...</span>
<span class="k">if</span><span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'myTable'</span><span class="p">])){</span>
	<span class="nv">$table</span> <span class="o">=</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'myTable'</span><span class="p">]</span> <span class="p">;</span>
<span class="p">}</span>
<span class="k">if</span><span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'myPrimaryKey'</span><span class="p">])){</span>
	<span class="nv">$primaryKey</span> <span class="o">=</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'myPrimaryKey'</span><span class="p">]</span> <span class="p">;</span>
<span class="p">}</span>
<span class="k">if</span><span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'myColumns'</span><span class="p">])){</span>
	<span class="nv">$columns</span> <span class="o">=</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'myColumns'</span><span class="p">]</span> <span class="p">;</span>
<span class="p">}</span>

<span class="k">echo</span> <span class="nb">json_encode</span><span class="p">(</span>
	<span class="no">SSP</span><span class="o">::</span><span class="nf">simple</span><span class="p">(</span> <span class="nv">$_GET</span><span class="p">,</span> <span class="nv">$sql_details</span><span class="p">,</span> <span class="nv">$table</span><span class="p">,</span> <span class="nv">$primaryKey</span><span class="p">,</span> <span class="nv">$columns</span> <span class="p">)</span>
<span class="p">);</span>
</code></pre></div></div>


  </article>
  
<nav>
  <ul class="pager">
    
     
    <li class="previous">
      <a href="https://virtual-thom.github.io/archives/modele-job-vtom-api-rest-webservice/"><span aria-hidden="true">&larr;</span> Webservice / Modele Job VTOM REST</a> 
    </li>
    
     
     <li class="next">
      <a class="next" href="https://virtual-thom.github.io/archives/job-modele-vtom-db-oracle/">Modèle de job SGBD (VT-XAP-SGBD) vtom (ex oracle) <span aria-hidden="true">&rarr;</span></a> 
    </li>
     
    
  </ul>
</nav>


  <footer class="post-footer">
    
      
        <a itemprop="articleSection" class="btn btn-default btn-xs btn-categories" href="https://virtual-thom.github.io/archives"><span class="glyphicon glyphicon-asterisk"></span>javascript</a>
      
        <a itemprop="articleSection" class="btn btn-default btn-xs btn-categories" href="https://virtual-thom.github.io/archives"><span class="glyphicon glyphicon-asterisk"></span>datatables</a>
      
        <a itemprop="articleSection" class="btn btn-default btn-xs btn-categories" href="https://virtual-thom.github.io/archives"><span class="glyphicon glyphicon-asterisk"></span>oracle</a>
      
        <a itemprop="articleSection" class="btn btn-default btn-xs btn-categories" href="https://virtual-thom.github.io/archives"><span class="glyphicon glyphicon-asterisk"></span>php</a>
      
    
    <span  itemprop="author publisher" class="hidden">Virtual Thom</span>
  </footer>
  
  <div id="disqus_thread" ></div>
  <script>
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'thomas-asnar'; // required: replace example with your forum shortname
  
      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
</div>

      <footer id="site-footer">
    <div>&copy;<a href="https://github.com/virtual-thom/" title="Github Virtual-Thom">Virtual-Thom</a></div>
    <div>
            <a href="https://virtual-thom.github.io/archives/plan" title="Plan du site">sitemap</a> | <a href="https://virtual-thom.github.io/about" rel="publisher author" title="Curriculum vitae Thom">A propos</a>
    </div>
    <div>
        <a id="goto-site-header" href="#site-header" title="Retourner au début">&uArr; Top</a>
    </div>
    <div id="footer-disclaimer">
        <p>Avertissement : vous ne devez pas prendre pour argent comptant le contenu de ce site. Testez toujours la solution en environnement de test.</p>
        <p>Malgré le sérieux que je m'efforce de mettre dans le contenu de ces billets, je ne pourrai être tenu responsable d'éventuelles erreurs que cela pourrait engendrer.</p>
    </div>
    <div>
        <a class="hidden" href="https://virtual-thom.github.io/archives/sitemap.xml" title="SiteMap">sitemap</a>
    </div>
</footer>

    </div>
  </body>

</html>