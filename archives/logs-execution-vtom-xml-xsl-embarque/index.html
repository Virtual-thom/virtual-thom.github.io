<!DOCTYPE html>
<html lang="fr">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="apple-touch-icon" href="https://virtual-thom.github.io/archives/apple-touch-icon.png">
  <link rel="icon" href="https://virtual-thom.github.io/archives/favicon.ico" />
  <!-- Remplacé par Jekyll SEO (sinon apparait en double)
  <title>Mise en forme des logs d'exécution VTOM - insérer de la data XML dans un fichier XSL directement</title>
  <meta name="description" content="A la demande de certains clients, j’ai écrit un script qui récupère les logs d’exécutions des jobs et les mets en forme en page web xml.Le principe est simpl...">
  --> 
  
  <link rel="canonical" href="https://virtual-thom.github.io/archives/logs-execution-vtom-xml-xsl-embarque/">
  
  <link rel="stylesheet" media="screen" href="https://virtual-thom.github.io/archives/assets/main.css">
  
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Mise en forme des logs d’exécution VTOM - insérer de la data XML dans un fichier XSL directement | Virtual-Thom Blog-notes VTOM et informatique</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Mise en forme des logs d’exécution VTOM - insérer de la data XML dans un fichier XSL directement" />
<meta name="author" content="Virtual Thom" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A la demande de certains clients, j’ai écrit un script qui récupère les logs d’exécutions des jobs et les mets en forme en page web xml. Le principe est simple. Insérer de la data XML dans un fichier de feuille de style XSLT et transformer les data directement. On peut dire aussi que la feuille de transformation XSL est embarquée dans le fichier data XML. Vous pouvez télécharger le résultat XML : exemple_log.xml Les besoins des clients nous obligent parfois à effectuer un peu de “développement” perso. Voici ma recette pour récupérer et ordonner les logs d’exécution. Dans l’ordre d’affichage, JOBS EN COURS, JOBS EN ERREUR, JOBS TERMINES. La sortie finale en xml a l’avantage d’être visible sur la plupart des navigateurs web et intègre directement la mise en forme sans autre fichier (transformation xsl directement). Je vous propose de regarder dans un premier temps le résultat final. Dans un deuxième temps, je vous montrerai mon script en shell qui génère ce fichier xml. &lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt; &lt;?xml-stylesheet href=&quot;#stylesheet&quot; type=&quot;text/xsl&quot;?&gt; &lt;!DOCTYPE xsl:stylesheet [ &lt;!ATTLIST xsl:stylesheet id ID #REQUIRED&gt; ]&gt; &lt;!-- balises de transformation xsl --&gt; &lt;xsl:stylesheet version=&quot;2.0&quot; id=&quot;stylesheet&quot; xmlns:data=&quot;localhost&quot; xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;&gt; &lt;xsl:output method=&quot;html&quot; indent=&quot;yes&quot;/&gt; &lt;!-- définition du template principal avec le rendu html --&gt; &lt;xsl:template match=&quot;/&quot;&gt; &lt;html&gt; &lt;head&gt; &lt;title&gt;Rapport log d execution job VTOM&lt;/title&gt; &lt;style type=&quot;text/css&quot;&gt; h1 a { background-color : #339933 ; border : 1pt solid black ; margin : 0 0 0 10pt ; padding : 2pt ; } h2 a { background-color : #33FF66 ; border : 1pt solid black ; margin : 0 0 0 20pt ; padding : 2pt ; } div.in{ border: inset 5pt green; } div.pair{ border: outset 5pt green; border-collapse: separate; border-spacing: 5pt ; margin : 0 0 10pt 0 ; background-color: #33FF66 ; } div.impair{ border: outset 5pt green; border-collapse: separate; border-spacing: 5pt ; margin : 0 0 10pt 0 ; background-color: #339933 ; } div.erreur1{ border: outset 5pt red; border-collapse: separate; border-spacing: 5pt ; margin : 0 0 10pt 0 ; background-color: brown ; } div.erreur2{ border: outset 5pt red; border-collapse: separate; border-spacing: 5pt ; margin : 0 0 10pt 0 ; background-color: coral ; } div.encours1{ border: outset 5pt aqua; border-collapse: separate; border-spacing: 5pt ; margin : 0 0 10pt 0 ; background-color: blue ; } div.encours2{ border: outset 5pt aqua; border-collapse: separate; border-spacing: 5pt ; margin : 0 0 10pt 0 ; background-color: aqua ; } div.logok{ border : 1pt solid black ; margin : 5pt ; padding : 10pt ; } div.logok a{ font : 12pt ; color : lawngreen ; text-decoration : underline ; background-color : darkgreen ; padding : 5 pt ; } div.logko { border : 1pt solid black ; margin : 5pt ; padding : 10pt ; } div.logko a{ text-decoration : underline ; color : red ; background-color : yellow ; padding : 5 pt ; } &lt;/style&gt; &lt;/head&gt; &lt;body&gt; &lt;!-- appel des templates qui vont chercher dans les datas (les logs) --&gt; &lt;xsl:apply-templates select=&quot;/xsl:stylesheet/data:data&quot; /&gt; &lt;/body&gt; &lt;/html&gt; &lt;/xsl:template&gt; &lt;xsl:template match=&quot;/xsl:stylesheet/data:data&quot;&gt; &lt;!-- Ce premier appel de template va définir le layout de l état de l enregistrement 1 row = un log d exécution --&gt; &lt;xsl:if test=&quot;count(row) = 0&quot;&gt; &lt;a&gt;Aucun traitement&lt;/a&gt; &lt;/xsl:if&gt; &lt;!-- JOBS EN COURS j ai défini dans mon script que les jobs en cours ont un exit 321321 --&gt; &lt;xsl:for-each select=&quot;row[exit = 321321]&quot;&gt; &lt;!-- le modulo est juste là pour faire une couleur un peu différente si plusieurs enregistrements de même type sont à la suite --&gt; &lt;xsl:choose&gt; &lt;xsl:when test=&quot;position() mod 2 = 0&quot; &gt; &lt;div class=&quot;encours1&quot;&gt; &lt;div class=&quot;in&quot;&gt; &lt;!-- appel du template pour le contenu du log --&gt; &lt;xsl:call-template name=&quot;rapport&quot; /&gt; &lt;/div&gt; &lt;/div&gt; &lt;/xsl:when&gt; &lt;xsl:otherwise&gt; &lt;div class=&quot;encours2&quot;&gt; &lt;div class=&quot;in&quot;&gt; &lt;!-- appel du template pour le contenu du log --&gt; &lt;xsl:call-template name=&quot;rapport&quot; /&gt; &lt;/div&gt; &lt;/div&gt; &lt;/xsl:otherwise&gt; &lt;/xsl:choose&gt; &lt;/xsl:for-each&gt; &lt;!-- fin des row EN COURS --&gt; &lt;!-- JOB EN ERREUR --&gt; &lt;xsl:for-each select=&quot;row[exit != 0 and exit != 321321]&quot;&gt; &lt;xsl:choose&gt; &lt;xsl:when test=&quot;position() mod 2 = 0&quot; &gt; &lt;div class=&quot;erreur1&quot;&gt; &lt;div class=&quot;in&quot;&gt; &lt;xsl:call-template name=&quot;rapport&quot; /&gt; &lt;/div&gt; &lt;/div&gt; &lt;/xsl:when&gt; &lt;xsl:otherwise&gt; &lt;div class=&quot;erreur2&quot;&gt; &lt;div class=&quot;in&quot;&gt; &lt;xsl:call-template name=&quot;rapport&quot; /&gt; &lt;/div&gt; &lt;/div&gt; &lt;/xsl:otherwise&gt; &lt;/xsl:choose&gt; &lt;/xsl:for-each&gt; &lt;!-- fin des row EN ERREUR --&gt; &lt;!-- JOB TERMINES --&gt; &lt;xsl:for-each select=&quot;row[exit = 0]&quot;&gt; &lt;xsl:choose&gt; &lt;xsl:when test=&quot;position() mod 2 = 0&quot; &gt; &lt;div class=&quot;pair&quot;&gt; &lt;div class=&quot;in&quot;&gt; &lt;xsl:call-template name=&quot;rapport&quot; /&gt; &lt;/div&gt; &lt;/div&gt; &lt;/xsl:when&gt; &lt;xsl:otherwise&gt; &lt;div class=&quot;impair&quot;&gt; &lt;div class=&quot;in&quot;&gt; &lt;xsl:call-template name=&quot;rapport&quot; /&gt; &lt;/div&gt; &lt;/div&gt; &lt;/xsl:otherwise&gt; &lt;/xsl:choose&gt; &lt;/xsl:for-each&gt; &lt;!-- fin des row TERMINES --&gt; &lt;/xsl:template&gt; &lt;!-- fin du template des datas --&gt; &lt;!-- appel du template pour le contenu du log --&gt; &lt;xsl:template name=&quot;rapport&quot;&gt; &lt;h1&gt;&lt;a&gt;Application : &lt;xsl:value-of select=&quot;app&quot; /&gt;&lt;/a&gt;&lt;/h1&gt; &lt;h2&gt;&lt;a&gt;Traitement : &lt;xsl:value-of select=&quot;job&quot; /&gt;&lt;/a&gt;&lt;/h2&gt; &lt;div class=&quot;logok&quot;&gt; &lt;a&gt;Log d execution : sortie standard : &lt;/a&gt;&lt;br /&gt; &amp;lt;pre&amp;gt; &lt;xsl:value-of select=&quot;logok&quot; /&gt; &amp;lt;/pre&amp;gt; &lt;/div&gt; &lt;div class=&quot;logko&quot;&gt; &lt;a&gt;Log d execution : sortie en erreur : &lt;/a&gt;&lt;br /&gt; &amp;lt;pre&amp;gt; &lt;xsl:value-of select=&quot;logko&quot; /&gt; &amp;lt;/pre&amp;gt; &lt;/div&gt; &lt;/xsl:template&gt; &lt;!-- fin du template rapport --&gt; &lt;!-- les datas, les logs d&#39;exécutions 1 row = 1 enregistrement 1 enregistrement = nom de l&#39;application et job, le n°exit les logs d&#39;exécution --&gt; &lt;data:data&gt; &lt;row&gt; &lt;app&gt; APPLICATION_1 &lt;/app&gt; &lt;job&gt; TRAITEMENT_1 &lt;/job&gt; &lt;exit&gt; 0 &lt;/exit&gt; &lt;logok&gt; _______________________________________________________________________ Contexte Visual TOM du traitement Machine : machine-la01 Utilisateur : root Script : /path/monscript.sh Shell : /bin/ksh Serveur Visual TOM : serveur-vtom Traitement : TRAITEMENT_1 Application : APPLICATION_1 Environnement : ENVIRONNEMENT_A Job ID : 3348 Nombre de relances : 0 Label de reprise : 0 Mode Execution : NORMAL Date d&#39;exploitation : DATE_PROD Valeur de la date : 31/08/2012 _______________________________________________________________________ vendredi 31/08/2012 - 04:29:58 Debut de l&#39;execution du script ... _______________________________________________________________________ LUKE aime LEIA sortie standard _______________________________________________________________________ vendredi 31/08/2012 - 04:30:59 Fin de l&#39;execution du script. --&amp;gt; Exit [0] donc acquitement &lt;/logok&gt; &lt;logko&gt; &lt;/logko&gt; &lt;/row&gt; &lt;row&gt; &lt;app&gt; APPLICATION_1 &lt;/app&gt; &lt;job&gt; TRAITEMENT_2 &lt;/job&gt; &lt;exit&gt; 123 &lt;/exit&gt; &lt;logok&gt; _______________________________________________________________________ Contexte Visual TOM du traitement Machine : machine-la01 Utilisateur : root Script : /path/monscript.sh Shell : /bin/ksh Serveur Visual TOM : serveur-vtom Traitement : TRAITEMENT_2 Application : APPLICATION_1 Environnement : ENVIRONNEMENT_A Job ID : 3349 Nombre de relances : 0 Label de reprise : 0 Mode Execution : NORMAL Date d&#39;exploitation : DATE_PROD Valeur de la date : 31/08/2012 _______________________________________________________________________ vendredi 31/08/2012 - 04:29:58 Debut de l&#39;execution du script ... _______________________________________________________________________ LUKE aime LEIA sortie standard _______________________________________________________________________ vendredi 31/08/2012 - 04:30:59 Fin de l&#39;execution du script. --&amp;gt; Exit [123] donc acquitement &lt;/logok&gt; &lt;logko&gt; JE SUIS TON PERE sortie erreur &lt;/logko&gt; &lt;/row&gt; &lt;row&gt; &lt;app&gt; APPLICATION_1 &lt;/app&gt; &lt;job&gt; TRAITEMENT_3 &lt;/job&gt; &lt;exit&gt; 321321 &lt;/exit&gt; &lt;logok&gt; _______________________________________________________________________ Contexte Visual TOM du traitement Machine : machine-la01 Utilisateur : root Script : /path/monscript.sh Shell : /bin/ksh Serveur Visual TOM : serveur-vtom Traitement : TRAITEMENT_3 Application : APPLICATION_1 Environnement : ENVIRONNEMENT_A Job ID : 3350 Nombre de relances : 0 Label de reprise : 0 Mode Execution : NORMAL Date d&#39;exploitation : DATE_PROD Valeur de la date : 31/08/2012 _______________________________________________________________________ vendredi 31/08/2012 - 04:29:58 Debut de l&#39;execution du script ... _______________________________________________________________________ LUKE aime ... &lt;/logok&gt; &lt;logko&gt; &lt;/logko&gt; &lt;/row&gt; &lt;/data:data&gt; &lt;!-- fin des datas --&gt; &lt;/xsl:stylesheet&gt; &lt;!-- fin du fichier xml --&gt; Pour aller plus loin dans l’explication du XML, c’est en réalité un xml qui fait appel à une feuille de style XSL, non pas extérieure mais dans le XML, grâce à son ID. De plus la feuille de style xsl:stylesheet intègre directement les données. Il suffit de définir le namespace dans la déclaration du xsl:stylesheet. Appel de la feuille de style xsl:stylesheet dans le fichier xml : &lt;?xml-stylesheet href=&quot;#stylesheet&quot; type=&quot;text/xsl&quot;?&gt; vers le href #stylesheet =&gt; id=stylesheet &lt;xsl:stylesheet version=&quot;2.0&quot; id=&quot;stylesheet&quot; xmlns:data=&quot;localhost&quot; xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;&gt; Déclaration normale pour les balises de transformation xsl xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot; Déclaration de ma balise perso. Cela va permettre de faire mes balises du type où je vais stocker mes données. Les templates vont matcher à partir de cette arborescence. xmlns:data=&quot;localhost&quot; Passons maintenant au script shell exécuté sur chaque machine dont vous voulez récupérer les logs. Voici le script generexml.sh Je me base sur la structure du nom des logs d’exécution VTOM. Il y aura surement quelques adaptations à effectuer chez vous. Attention, je ne test pas la volumétrie des logs. #!/bin/sh # # AUTEUR : Virtual Thom # VERSION : 1.0 # DATE : 20/05/2011 # # set -n # Decommenter pour debug syntax sans execution # NOTE: Ne pas oublier de recommenter ! # set -x # Decommenter pour debug # ########################################################## # SCRIPT ########################################################## usage(){ # exemple d&#39;usage script=${0##*/} ; #script=${script%.*} ; echo &quot;&quot; ; echo &quot;${script} - permet de recuperer des logs d&#39;execution et de les mettre en forme&quot; ; echo &quot;&quot; echo &quot;Usage :&quot; ; echo &quot; ${script} machine environnement tempsenseconde&quot; ; echo &quot;1er parametre : nom de la machine&quot; ; echo &quot;2eme parametre : filtre pour la recuperation des logs, peut etre l&#39;environnement par exemple&quot; ; echo &quot;3eme parametre : temps en secondes depuis l&#39;execution du script jusqu&#39;au temps de recuperation&quot; ; echo &quot;&quot; ; exit 123 ; } if test &quot;$1&quot; = &quot;--help&quot; -o &quot;$1&quot; = &quot;-help&quot; -o &quot;$1&quot; = &quot;-h&quot; -o -z &quot;$1&quot; then usage fi machine=${1} #Par defaut machine environnement=${2:-PROD} #Par defaut PROD retour_tps=${3:-86400} #Par defaut 86400 s soit 24h LOGS_REP=${TOM_LOG_DIR:-/opt/vtom/logs/} LOGS_SCRIPTS=/opt/vtom/scripts/ INFILE=/opt/vtom/scripts/infile OUTFILE=/opt/vtom/scripts/outfile XML=/opt/vtom/scripts/${machine}_${environnement}.xml thisday=`date +%s` #date du jour en timestamp dayminusday=`expr $thisday - ${retour_tps}` #calcul date du jour - 24h (en s) en timestamp &gt; $OUTFILE ls ${LOGS_REP} | grep &quot;${environnement}.*.o&quot; | sort &gt; $INFILE #liste des logs #chargement de l entete xml xsl entete=&#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;\n &lt;?xml-stylesheet href=&quot;#stylesheet&quot; type=&quot;text/xsl&quot;?&gt;\n \n &lt;!DOCTYPE xsl:stylesheet [\n &lt;!ATTLIST xsl:stylesheetn id ID #REQUIRED&gt;\n ]&gt;\n \n &lt;!-- balises de transformation xsl --&gt;\n &lt;xsl:stylesheet version=&quot;2.0&quot; id=&quot;stylesheet&quot; xmlns:data=&quot;localhost&quot; \n xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;&gt;\n &lt;xsl:output method=&quot;html&quot; indent=&quot;yes&quot;/&gt;\n \n &lt;!-- définition du template principal avec le rendu html --&gt;\n &lt;xsl:template match=&quot;/&quot;&gt;\n &lt;html&gt;\n &lt;head&gt;\n &lt;title&gt;Rapport log d execution job VTOM&lt;/title&gt;\n &lt;style type=&quot;text/css&quot;&gt;\n h1 a {\n background-color : #339933 ;\n border : 1pt solid black ;\n margin : 0 0 0 10pt ; \n padding : 2pt ;\n }\n h2 a {\n background-color : #33FF66 ;\n border : 1pt solid black ;\n margin : 0 0 0 20pt ;\n padding : 2pt ;\n }\n div.in{ \n border: inset 5pt green;\n }\n div.pair{\n border: outset 5pt green; \n border-collapse: separate;\n border-spacing: 5pt ;\n margin : 0 0 10pt 0 ;\n background-color: #33FF66 ;\n }\n div.impair{\n border: outset 5pt green; \n border-collapse: separate;\n border-spacing: 5pt ;\n margin : 0 0 10pt 0 ;\n background-color: #339933 ;\n }\n div.erreur1{\n border: outset 5pt red; \n border-collapse: separate;\n border-spacing: 5pt ;\n margin : 0 0 10pt 0 ;\n background-color: brown ;\n }\n div.erreur2{\n border: outset 5pt red; \n border-collapse: separate;\n border-spacing: 5pt ;\n margin : 0 0 10pt 0 ;\n background-color: coral ;\n }\n div.encours1{\n border: outset 5pt aqua; \n border-collapse: separate;\n border-spacing: 5pt ;\n margin : 0 0 10pt 0 ;\n background-color: blue ;\n }\n div.encours2{\n border: outset 5pt aqua; \n border-collapse: separate;\n border-spacing: 5pt ;\n margin : 0 0 10pt 0 ;\n background-color: aqua ;\n }\n div.logok{\n border : 1pt solid black ;\n margin : 5pt ; \n padding : 10pt ;\n }\n div.logok a{\n font : 12pt ;\n color : lawngreen ;\n text-decoration : underline ;\n background-color : darkgreen ;\n padding : 5 pt ;\n }\n div.logko {\n border : 1pt solid black ;\n margin : 5pt ; \n padding : 10pt ;\n }\n div.logko a{\n text-decoration : underline ;\n color : red ;\n background-color : yellow ;\n padding : 5 pt ;\n }\n &lt;/style&gt;\n &lt;/head&gt;\n &lt;body&gt;\n &lt;!-- appel des templates qui vont chercher dans les datas (les logs) --&gt; \n &lt;xsl:apply-templates select=&quot;/xsl:stylesheet/data:data&quot; /&gt;\n &lt;/body&gt;\n &lt;/html&gt;\n &lt;/xsl:template&gt;\n \n \n &lt;xsl:template match=&quot;/xsl:stylesheet/data:data&quot;&gt;\n &lt;!--\n Ce premier appel de template va définir le layout de l état de l enregistrement 1 row = un log d exécutionn --&gt;\n \n &lt;xsl:if test=&quot;count(row) = 0&quot;&gt; \n &lt;a&gt;Aucun traitement&lt;/a&gt; \n &lt;/xsl:if&gt;\n \n &lt;!-- JOBS EN COURSn j ai défini dans mon scriptn que les jobs en cours ont un exit 321321n --&gt;\n &lt;xsl:for-each select=&quot;row[exit = 321321]&quot;&gt;\n &lt;!-- le modulo est juste là pour faire une couleur un peu différente \n si plusieurs enregistrements de même type sont à la suite --&gt;\n &lt;xsl:choose&gt;\n &lt;xsl:when test=&quot;position() mod 2 = 0&quot; &gt;\n &lt;div class=&quot;encours1&quot;&gt;\n &lt;div class=&quot;in&quot;&gt;\n &lt;!-- appel du template pour le contenu du log --&gt;\n &lt;xsl:call-template name=&quot;rapport&quot; /&gt;\n &lt;/div&gt;\n &lt;/div&gt;\n &lt;/xsl:when&gt;\n &lt;xsl:otherwise&gt;\n &lt;div class=&quot;encours2&quot;&gt;\n &lt;div class=&quot;in&quot;&gt;\n &lt;!-- appel du template pour le contenu du log --&gt;\n &lt;xsl:call-template name=&quot;rapport&quot; /&gt;\n &lt;/div&gt;\n &lt;/div&gt;\n &lt;/xsl:otherwise&gt;\n &lt;/xsl:choose&gt;\n &lt;/xsl:for-each&gt; &lt;!-- fin des row EN COURS --&gt;\n \n \n &lt;!-- JOB EN ERREUR --&gt;\n &lt;xsl:for-each select=&quot;row[exit != 0 and exit != 321321]&quot;&gt;\n \n &lt;xsl:choose&gt;\n &lt;xsl:when test=&quot;position() mod 2 = 0&quot; &gt;\n &lt;div class=&quot;erreur1&quot;&gt;\n &lt;div class=&quot;in&quot;&gt;\n &lt;xsl:call-template name=&quot;rapport&quot; /&gt;\n &lt;/div&gt;\n &lt;/div&gt;\n &lt;/xsl:when&gt;\n &lt;xsl:otherwise&gt;\n &lt;div class=&quot;erreur2&quot;&gt;\n &lt;div class=&quot;in&quot;&gt;\n &lt;xsl:call-template name=&quot;rapport&quot; /&gt;\n &lt;/div&gt;\n &lt;/div&gt;\n &lt;/xsl:otherwise&gt;\n &lt;/xsl:choose&gt;\n &lt;/xsl:for-each&gt; &lt;!-- fin des row EN ERREUR --&gt;\n \n &lt;!-- JOB TERMINES --&gt;\n &lt;xsl:for-each select=&quot;row[exit = 0]&quot;&gt;\n \n &lt;xsl:choose&gt;\n &lt;xsl:when test=&quot;position() mod 2 = 0&quot; &gt;\n &lt;div class=&quot;pair&quot;&gt;\n &lt;div class=&quot;in&quot;&gt;\n &lt;xsl:call-template name=&quot;rapport&quot; /&gt;\n &lt;/div&gt;\n &lt;/div&gt;\n &lt;/xsl:when&gt;\n &lt;xsl:otherwise&gt;\n &lt;div class=&quot;impair&quot;&gt;\n &lt;div class=&quot;in&quot;&gt;\n &lt;xsl:call-template name=&quot;rapport&quot; /&gt;\n &lt;/div&gt;\n &lt;/div&gt;\n &lt;/xsl:otherwise&gt;\n &lt;/xsl:choose&gt;\n &lt;/xsl:for-each&gt; &lt;!-- fin des row TERMINES --&gt;\n \n &lt;/xsl:template&gt; &lt;!-- fin du template des datas --&gt;\n \n &lt;!-- appel du template pour le contenu du log --&gt;\n &lt;xsl:template name=&quot;rapport&quot;&gt;\n &lt;h1&gt;&lt;a&gt;Application : &lt;xsl:value-of select=&quot;app&quot; /&gt;&lt;/a&gt;&lt;/h1&gt;\n &lt;h2&gt;&lt;a&gt;Traitement : &lt;xsl:value-of select=&quot;job&quot; /&gt;&lt;/a&gt;&lt;/h2&gt;\n &lt;div class=&quot;logok&quot;&gt;\n &lt;a&gt;Log d execution : sortie standard : &lt;/a&gt;&lt;br /&gt;\n &amp;lt;pre&amp;gt;\n &lt;xsl:value-of select=&quot;logok&quot; /&gt;\n &amp;lt;/pre&amp;gt;\n &lt;/div&gt;\n &lt;div class=&quot;logko&quot;&gt;\n &lt;a&gt;Log d execution : sortie en erreur : &lt;/a&gt;&lt;br /&gt;\n &amp;lt;pre&amp;gt;\n &lt;xsl:value-of select=&quot;logko&quot; /&gt;\n &amp;lt;/pre&amp;gt;\n &lt;/div&gt;\n &lt;/xsl:template&gt; &lt;!-- fin du template rapport --&gt;\n &#39; echo -e $entete &gt; $XML echo &quot;&lt;data:data&gt;&quot; &gt;&gt; $XML #arbre xslt : /stylesheet/data:data/row for LIGNE in $(cat $INFILE) do nom_exec=${LIGNE%.*} nom_traitement=${LIGNE%.*} #recuperation nom du fichier sans extension chaine la plus courte a droite du . suivi de n caracteres nom_traitement=`echo $nom_traitement | sed &#39;s/_[0-9][0-9][0-9][0-9][0-9][0-9]-[0-9][0-9][0-9][0-9][0-9][0-9]$//&#39;` #suppression de la date et heure exemple de sed date_exec=`echo $LIGNE | awk -F &quot;_&quot; &#39;{print $NF}&#39; | awk -F &quot;.&quot; &#39;{print $1}&#39; | awk -F &quot;-&quot; &#39;{print $1}&#39;` #je laisse un exemple avec awk -F est le delemiter $NF le dernier argument heure_exec=${nom_exec##*-} #chaine la plus longue a gauche de - suivi de n caracteres heure_exec=`echo $heure_exec | sed &#39;s/^[0-9][0-9]/&amp;:/&#39; | sed &#39;s/[0-9][0-9]$/:&amp;/&#39;` #trick pour rajouter : entre heures et minutes avec sed date_traitement=`date --date=&quot;$date_exec $heure_exec&quot; +&quot;%d/%m/%y %H:%M:%S&quot;` #interpretation de la date par --date et remise en format classique date_exec=`date --date=&quot;$date_exec $heure_exec&quot; +%s` #timestamp pour tester avec le timestamp minimum requis if test &quot;$date_exec&quot; &gt; &quot;$dayminusday&quot; -a $LIGNE != &quot;&quot; then echo &quot; &lt;row&gt;&quot; &gt;&gt; $XML echo &quot; &lt;app&gt;&quot; &gt;&gt; $XML app=`head -n 20 &quot;$LOGS_REP$LIGNE&quot; | grep &quot;Application&quot; | awk -F &quot;:&quot; &#39;{print $2}&#39;` #head comme tail mais en partant du debut recuperation du nom application dans les logs echo &quot; $app&quot; &gt;&gt; $XML echo &quot; &lt;/app&gt;&quot; &gt;&gt; $XML echo &quot; &lt;job&gt;&quot; &gt;&gt; $XML job=`head -n 20 &quot;$LOGS_REP$LIGNE&quot; | grep &quot;Traitement&quot; | awk -F &quot;:&quot; &#39;{print $2}&#39;` #recuperation du nom traitement dans les logs echo &quot; $job&quot; &gt;&gt; $XML echo &quot; &lt;/job&gt;&quot; &gt;&gt; $XML echo &quot; &lt;exit&gt;&quot; &gt;&gt; $XML num_exit=`tail -n 5 &quot;$LOGS_REP$LIGNE&quot; | grep &quot;Exit&quot; | awk -F &quot;[&quot; &#39;{print $2}&#39; | awk -F &quot;]&quot; &#39;{print $1}&#39;` #recuperation du numero exit dans les logs if test &quot;${num_exit}&quot; != &quot;&quot; then echo &quot; $num_exit&quot; &gt;&gt; $XML else echo &quot; 321321&quot; &gt;&gt; $XML fi echo &quot; &lt;/exit&gt;&quot; &gt;&gt; $XML echo &quot; &lt;logok&gt;&quot; &gt;&gt; $XML #cat ${LOGS_REP}$LIGNE | sed &#39;s#&lt;#&amp;lt;#g&#39; | sed &#39;s#&gt;#&amp;gt;#g&#39; | sed &#39;s#&amp;#&amp;amp;#g&#39; &gt;&gt; $XML #sed remplace les &lt; et les &gt; par les notations xml pour ces caracteres speciaux cat ${LOGS_REP}$LIGNE | sed &#39;s#&amp;#&amp;amp;#g&#39; | sed &#39;s#&lt;#&amp;lt;#g&#39; | sed &#39;s#&gt;#&amp;gt;#g&#39; &gt;&gt; $XML echo &quot; &lt;/logok&gt;&quot; &gt;&gt; $XML logko=`echo $LIGNE | sed &#39;s/.o$/.e/&#39;` #exemple de sed j aurai pu mettre ${nom_exec}.e echo &quot; &lt;logko&gt;&quot; &gt;&gt; $XML cat ${LOGS_REP}$logko | sed &#39;s#&amp;#&amp;amp;#g&#39; | sed &#39;s#&lt;#&amp;lt;#g&#39; | sed &#39;s#&gt;#&amp;gt;#g&#39; &gt;&gt; $XML echo &quot; &lt;/logko&gt;&quot; &gt;&gt; $XML echo &quot; &lt;/row&gt;&quot; &gt;&gt; $XML fi done echo &quot;&lt;/data:data&gt;&quot; &gt;&gt; $XML echo &quot;&lt;/xsl:stylesheet&gt;&quot; &gt;&gt; $XML #arbre xslt : /stylesheet/data:data/row rm -f $INFILE #nettoyage fichiers temp rm -f $OUTFILE" />
<meta property="og:description" content="A la demande de certains clients, j’ai écrit un script qui récupère les logs d’exécutions des jobs et les mets en forme en page web xml. Le principe est simple. Insérer de la data XML dans un fichier de feuille de style XSLT et transformer les data directement. On peut dire aussi que la feuille de transformation XSL est embarquée dans le fichier data XML. Vous pouvez télécharger le résultat XML : exemple_log.xml Les besoins des clients nous obligent parfois à effectuer un peu de “développement” perso. Voici ma recette pour récupérer et ordonner les logs d’exécution. Dans l’ordre d’affichage, JOBS EN COURS, JOBS EN ERREUR, JOBS TERMINES. La sortie finale en xml a l’avantage d’être visible sur la plupart des navigateurs web et intègre directement la mise en forme sans autre fichier (transformation xsl directement). Je vous propose de regarder dans un premier temps le résultat final. Dans un deuxième temps, je vous montrerai mon script en shell qui génère ce fichier xml. &lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt; &lt;?xml-stylesheet href=&quot;#stylesheet&quot; type=&quot;text/xsl&quot;?&gt; &lt;!DOCTYPE xsl:stylesheet [ &lt;!ATTLIST xsl:stylesheet id ID #REQUIRED&gt; ]&gt; &lt;!-- balises de transformation xsl --&gt; &lt;xsl:stylesheet version=&quot;2.0&quot; id=&quot;stylesheet&quot; xmlns:data=&quot;localhost&quot; xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;&gt; &lt;xsl:output method=&quot;html&quot; indent=&quot;yes&quot;/&gt; &lt;!-- définition du template principal avec le rendu html --&gt; &lt;xsl:template match=&quot;/&quot;&gt; &lt;html&gt; &lt;head&gt; &lt;title&gt;Rapport log d execution job VTOM&lt;/title&gt; &lt;style type=&quot;text/css&quot;&gt; h1 a { background-color : #339933 ; border : 1pt solid black ; margin : 0 0 0 10pt ; padding : 2pt ; } h2 a { background-color : #33FF66 ; border : 1pt solid black ; margin : 0 0 0 20pt ; padding : 2pt ; } div.in{ border: inset 5pt green; } div.pair{ border: outset 5pt green; border-collapse: separate; border-spacing: 5pt ; margin : 0 0 10pt 0 ; background-color: #33FF66 ; } div.impair{ border: outset 5pt green; border-collapse: separate; border-spacing: 5pt ; margin : 0 0 10pt 0 ; background-color: #339933 ; } div.erreur1{ border: outset 5pt red; border-collapse: separate; border-spacing: 5pt ; margin : 0 0 10pt 0 ; background-color: brown ; } div.erreur2{ border: outset 5pt red; border-collapse: separate; border-spacing: 5pt ; margin : 0 0 10pt 0 ; background-color: coral ; } div.encours1{ border: outset 5pt aqua; border-collapse: separate; border-spacing: 5pt ; margin : 0 0 10pt 0 ; background-color: blue ; } div.encours2{ border: outset 5pt aqua; border-collapse: separate; border-spacing: 5pt ; margin : 0 0 10pt 0 ; background-color: aqua ; } div.logok{ border : 1pt solid black ; margin : 5pt ; padding : 10pt ; } div.logok a{ font : 12pt ; color : lawngreen ; text-decoration : underline ; background-color : darkgreen ; padding : 5 pt ; } div.logko { border : 1pt solid black ; margin : 5pt ; padding : 10pt ; } div.logko a{ text-decoration : underline ; color : red ; background-color : yellow ; padding : 5 pt ; } &lt;/style&gt; &lt;/head&gt; &lt;body&gt; &lt;!-- appel des templates qui vont chercher dans les datas (les logs) --&gt; &lt;xsl:apply-templates select=&quot;/xsl:stylesheet/data:data&quot; /&gt; &lt;/body&gt; &lt;/html&gt; &lt;/xsl:template&gt; &lt;xsl:template match=&quot;/xsl:stylesheet/data:data&quot;&gt; &lt;!-- Ce premier appel de template va définir le layout de l état de l enregistrement 1 row = un log d exécution --&gt; &lt;xsl:if test=&quot;count(row) = 0&quot;&gt; &lt;a&gt;Aucun traitement&lt;/a&gt; &lt;/xsl:if&gt; &lt;!-- JOBS EN COURS j ai défini dans mon script que les jobs en cours ont un exit 321321 --&gt; &lt;xsl:for-each select=&quot;row[exit = 321321]&quot;&gt; &lt;!-- le modulo est juste là pour faire une couleur un peu différente si plusieurs enregistrements de même type sont à la suite --&gt; &lt;xsl:choose&gt; &lt;xsl:when test=&quot;position() mod 2 = 0&quot; &gt; &lt;div class=&quot;encours1&quot;&gt; &lt;div class=&quot;in&quot;&gt; &lt;!-- appel du template pour le contenu du log --&gt; &lt;xsl:call-template name=&quot;rapport&quot; /&gt; &lt;/div&gt; &lt;/div&gt; &lt;/xsl:when&gt; &lt;xsl:otherwise&gt; &lt;div class=&quot;encours2&quot;&gt; &lt;div class=&quot;in&quot;&gt; &lt;!-- appel du template pour le contenu du log --&gt; &lt;xsl:call-template name=&quot;rapport&quot; /&gt; &lt;/div&gt; &lt;/div&gt; &lt;/xsl:otherwise&gt; &lt;/xsl:choose&gt; &lt;/xsl:for-each&gt; &lt;!-- fin des row EN COURS --&gt; &lt;!-- JOB EN ERREUR --&gt; &lt;xsl:for-each select=&quot;row[exit != 0 and exit != 321321]&quot;&gt; &lt;xsl:choose&gt; &lt;xsl:when test=&quot;position() mod 2 = 0&quot; &gt; &lt;div class=&quot;erreur1&quot;&gt; &lt;div class=&quot;in&quot;&gt; &lt;xsl:call-template name=&quot;rapport&quot; /&gt; &lt;/div&gt; &lt;/div&gt; &lt;/xsl:when&gt; &lt;xsl:otherwise&gt; &lt;div class=&quot;erreur2&quot;&gt; &lt;div class=&quot;in&quot;&gt; &lt;xsl:call-template name=&quot;rapport&quot; /&gt; &lt;/div&gt; &lt;/div&gt; &lt;/xsl:otherwise&gt; &lt;/xsl:choose&gt; &lt;/xsl:for-each&gt; &lt;!-- fin des row EN ERREUR --&gt; &lt;!-- JOB TERMINES --&gt; &lt;xsl:for-each select=&quot;row[exit = 0]&quot;&gt; &lt;xsl:choose&gt; &lt;xsl:when test=&quot;position() mod 2 = 0&quot; &gt; &lt;div class=&quot;pair&quot;&gt; &lt;div class=&quot;in&quot;&gt; &lt;xsl:call-template name=&quot;rapport&quot; /&gt; &lt;/div&gt; &lt;/div&gt; &lt;/xsl:when&gt; &lt;xsl:otherwise&gt; &lt;div class=&quot;impair&quot;&gt; &lt;div class=&quot;in&quot;&gt; &lt;xsl:call-template name=&quot;rapport&quot; /&gt; &lt;/div&gt; &lt;/div&gt; &lt;/xsl:otherwise&gt; &lt;/xsl:choose&gt; &lt;/xsl:for-each&gt; &lt;!-- fin des row TERMINES --&gt; &lt;/xsl:template&gt; &lt;!-- fin du template des datas --&gt; &lt;!-- appel du template pour le contenu du log --&gt; &lt;xsl:template name=&quot;rapport&quot;&gt; &lt;h1&gt;&lt;a&gt;Application : &lt;xsl:value-of select=&quot;app&quot; /&gt;&lt;/a&gt;&lt;/h1&gt; &lt;h2&gt;&lt;a&gt;Traitement : &lt;xsl:value-of select=&quot;job&quot; /&gt;&lt;/a&gt;&lt;/h2&gt; &lt;div class=&quot;logok&quot;&gt; &lt;a&gt;Log d execution : sortie standard : &lt;/a&gt;&lt;br /&gt; &amp;lt;pre&amp;gt; &lt;xsl:value-of select=&quot;logok&quot; /&gt; &amp;lt;/pre&amp;gt; &lt;/div&gt; &lt;div class=&quot;logko&quot;&gt; &lt;a&gt;Log d execution : sortie en erreur : &lt;/a&gt;&lt;br /&gt; &amp;lt;pre&amp;gt; &lt;xsl:value-of select=&quot;logko&quot; /&gt; &amp;lt;/pre&amp;gt; &lt;/div&gt; &lt;/xsl:template&gt; &lt;!-- fin du template rapport --&gt; &lt;!-- les datas, les logs d&#39;exécutions 1 row = 1 enregistrement 1 enregistrement = nom de l&#39;application et job, le n°exit les logs d&#39;exécution --&gt; &lt;data:data&gt; &lt;row&gt; &lt;app&gt; APPLICATION_1 &lt;/app&gt; &lt;job&gt; TRAITEMENT_1 &lt;/job&gt; &lt;exit&gt; 0 &lt;/exit&gt; &lt;logok&gt; _______________________________________________________________________ Contexte Visual TOM du traitement Machine : machine-la01 Utilisateur : root Script : /path/monscript.sh Shell : /bin/ksh Serveur Visual TOM : serveur-vtom Traitement : TRAITEMENT_1 Application : APPLICATION_1 Environnement : ENVIRONNEMENT_A Job ID : 3348 Nombre de relances : 0 Label de reprise : 0 Mode Execution : NORMAL Date d&#39;exploitation : DATE_PROD Valeur de la date : 31/08/2012 _______________________________________________________________________ vendredi 31/08/2012 - 04:29:58 Debut de l&#39;execution du script ... _______________________________________________________________________ LUKE aime LEIA sortie standard _______________________________________________________________________ vendredi 31/08/2012 - 04:30:59 Fin de l&#39;execution du script. --&amp;gt; Exit [0] donc acquitement &lt;/logok&gt; &lt;logko&gt; &lt;/logko&gt; &lt;/row&gt; &lt;row&gt; &lt;app&gt; APPLICATION_1 &lt;/app&gt; &lt;job&gt; TRAITEMENT_2 &lt;/job&gt; &lt;exit&gt; 123 &lt;/exit&gt; &lt;logok&gt; _______________________________________________________________________ Contexte Visual TOM du traitement Machine : machine-la01 Utilisateur : root Script : /path/monscript.sh Shell : /bin/ksh Serveur Visual TOM : serveur-vtom Traitement : TRAITEMENT_2 Application : APPLICATION_1 Environnement : ENVIRONNEMENT_A Job ID : 3349 Nombre de relances : 0 Label de reprise : 0 Mode Execution : NORMAL Date d&#39;exploitation : DATE_PROD Valeur de la date : 31/08/2012 _______________________________________________________________________ vendredi 31/08/2012 - 04:29:58 Debut de l&#39;execution du script ... _______________________________________________________________________ LUKE aime LEIA sortie standard _______________________________________________________________________ vendredi 31/08/2012 - 04:30:59 Fin de l&#39;execution du script. --&amp;gt; Exit [123] donc acquitement &lt;/logok&gt; &lt;logko&gt; JE SUIS TON PERE sortie erreur &lt;/logko&gt; &lt;/row&gt; &lt;row&gt; &lt;app&gt; APPLICATION_1 &lt;/app&gt; &lt;job&gt; TRAITEMENT_3 &lt;/job&gt; &lt;exit&gt; 321321 &lt;/exit&gt; &lt;logok&gt; _______________________________________________________________________ Contexte Visual TOM du traitement Machine : machine-la01 Utilisateur : root Script : /path/monscript.sh Shell : /bin/ksh Serveur Visual TOM : serveur-vtom Traitement : TRAITEMENT_3 Application : APPLICATION_1 Environnement : ENVIRONNEMENT_A Job ID : 3350 Nombre de relances : 0 Label de reprise : 0 Mode Execution : NORMAL Date d&#39;exploitation : DATE_PROD Valeur de la date : 31/08/2012 _______________________________________________________________________ vendredi 31/08/2012 - 04:29:58 Debut de l&#39;execution du script ... _______________________________________________________________________ LUKE aime ... &lt;/logok&gt; &lt;logko&gt; &lt;/logko&gt; &lt;/row&gt; &lt;/data:data&gt; &lt;!-- fin des datas --&gt; &lt;/xsl:stylesheet&gt; &lt;!-- fin du fichier xml --&gt; Pour aller plus loin dans l’explication du XML, c’est en réalité un xml qui fait appel à une feuille de style XSL, non pas extérieure mais dans le XML, grâce à son ID. De plus la feuille de style xsl:stylesheet intègre directement les données. Il suffit de définir le namespace dans la déclaration du xsl:stylesheet. Appel de la feuille de style xsl:stylesheet dans le fichier xml : &lt;?xml-stylesheet href=&quot;#stylesheet&quot; type=&quot;text/xsl&quot;?&gt; vers le href #stylesheet =&gt; id=stylesheet &lt;xsl:stylesheet version=&quot;2.0&quot; id=&quot;stylesheet&quot; xmlns:data=&quot;localhost&quot; xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;&gt; Déclaration normale pour les balises de transformation xsl xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot; Déclaration de ma balise perso. Cela va permettre de faire mes balises du type où je vais stocker mes données. Les templates vont matcher à partir de cette arborescence. xmlns:data=&quot;localhost&quot; Passons maintenant au script shell exécuté sur chaque machine dont vous voulez récupérer les logs. Voici le script generexml.sh Je me base sur la structure du nom des logs d’exécution VTOM. Il y aura surement quelques adaptations à effectuer chez vous. Attention, je ne test pas la volumétrie des logs. #!/bin/sh # # AUTEUR : Virtual Thom # VERSION : 1.0 # DATE : 20/05/2011 # # set -n # Decommenter pour debug syntax sans execution # NOTE: Ne pas oublier de recommenter ! # set -x # Decommenter pour debug # ########################################################## # SCRIPT ########################################################## usage(){ # exemple d&#39;usage script=${0##*/} ; #script=${script%.*} ; echo &quot;&quot; ; echo &quot;${script} - permet de recuperer des logs d&#39;execution et de les mettre en forme&quot; ; echo &quot;&quot; echo &quot;Usage :&quot; ; echo &quot; ${script} machine environnement tempsenseconde&quot; ; echo &quot;1er parametre : nom de la machine&quot; ; echo &quot;2eme parametre : filtre pour la recuperation des logs, peut etre l&#39;environnement par exemple&quot; ; echo &quot;3eme parametre : temps en secondes depuis l&#39;execution du script jusqu&#39;au temps de recuperation&quot; ; echo &quot;&quot; ; exit 123 ; } if test &quot;$1&quot; = &quot;--help&quot; -o &quot;$1&quot; = &quot;-help&quot; -o &quot;$1&quot; = &quot;-h&quot; -o -z &quot;$1&quot; then usage fi machine=${1} #Par defaut machine environnement=${2:-PROD} #Par defaut PROD retour_tps=${3:-86400} #Par defaut 86400 s soit 24h LOGS_REP=${TOM_LOG_DIR:-/opt/vtom/logs/} LOGS_SCRIPTS=/opt/vtom/scripts/ INFILE=/opt/vtom/scripts/infile OUTFILE=/opt/vtom/scripts/outfile XML=/opt/vtom/scripts/${machine}_${environnement}.xml thisday=`date +%s` #date du jour en timestamp dayminusday=`expr $thisday - ${retour_tps}` #calcul date du jour - 24h (en s) en timestamp &gt; $OUTFILE ls ${LOGS_REP} | grep &quot;${environnement}.*.o&quot; | sort &gt; $INFILE #liste des logs #chargement de l entete xml xsl entete=&#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;\n &lt;?xml-stylesheet href=&quot;#stylesheet&quot; type=&quot;text/xsl&quot;?&gt;\n \n &lt;!DOCTYPE xsl:stylesheet [\n &lt;!ATTLIST xsl:stylesheetn id ID #REQUIRED&gt;\n ]&gt;\n \n &lt;!-- balises de transformation xsl --&gt;\n &lt;xsl:stylesheet version=&quot;2.0&quot; id=&quot;stylesheet&quot; xmlns:data=&quot;localhost&quot; \n xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;&gt;\n &lt;xsl:output method=&quot;html&quot; indent=&quot;yes&quot;/&gt;\n \n &lt;!-- définition du template principal avec le rendu html --&gt;\n &lt;xsl:template match=&quot;/&quot;&gt;\n &lt;html&gt;\n &lt;head&gt;\n &lt;title&gt;Rapport log d execution job VTOM&lt;/title&gt;\n &lt;style type=&quot;text/css&quot;&gt;\n h1 a {\n background-color : #339933 ;\n border : 1pt solid black ;\n margin : 0 0 0 10pt ; \n padding : 2pt ;\n }\n h2 a {\n background-color : #33FF66 ;\n border : 1pt solid black ;\n margin : 0 0 0 20pt ;\n padding : 2pt ;\n }\n div.in{ \n border: inset 5pt green;\n }\n div.pair{\n border: outset 5pt green; \n border-collapse: separate;\n border-spacing: 5pt ;\n margin : 0 0 10pt 0 ;\n background-color: #33FF66 ;\n }\n div.impair{\n border: outset 5pt green; \n border-collapse: separate;\n border-spacing: 5pt ;\n margin : 0 0 10pt 0 ;\n background-color: #339933 ;\n }\n div.erreur1{\n border: outset 5pt red; \n border-collapse: separate;\n border-spacing: 5pt ;\n margin : 0 0 10pt 0 ;\n background-color: brown ;\n }\n div.erreur2{\n border: outset 5pt red; \n border-collapse: separate;\n border-spacing: 5pt ;\n margin : 0 0 10pt 0 ;\n background-color: coral ;\n }\n div.encours1{\n border: outset 5pt aqua; \n border-collapse: separate;\n border-spacing: 5pt ;\n margin : 0 0 10pt 0 ;\n background-color: blue ;\n }\n div.encours2{\n border: outset 5pt aqua; \n border-collapse: separate;\n border-spacing: 5pt ;\n margin : 0 0 10pt 0 ;\n background-color: aqua ;\n }\n div.logok{\n border : 1pt solid black ;\n margin : 5pt ; \n padding : 10pt ;\n }\n div.logok a{\n font : 12pt ;\n color : lawngreen ;\n text-decoration : underline ;\n background-color : darkgreen ;\n padding : 5 pt ;\n }\n div.logko {\n border : 1pt solid black ;\n margin : 5pt ; \n padding : 10pt ;\n }\n div.logko a{\n text-decoration : underline ;\n color : red ;\n background-color : yellow ;\n padding : 5 pt ;\n }\n &lt;/style&gt;\n &lt;/head&gt;\n &lt;body&gt;\n &lt;!-- appel des templates qui vont chercher dans les datas (les logs) --&gt; \n &lt;xsl:apply-templates select=&quot;/xsl:stylesheet/data:data&quot; /&gt;\n &lt;/body&gt;\n &lt;/html&gt;\n &lt;/xsl:template&gt;\n \n \n &lt;xsl:template match=&quot;/xsl:stylesheet/data:data&quot;&gt;\n &lt;!--\n Ce premier appel de template va définir le layout de l état de l enregistrement 1 row = un log d exécutionn --&gt;\n \n &lt;xsl:if test=&quot;count(row) = 0&quot;&gt; \n &lt;a&gt;Aucun traitement&lt;/a&gt; \n &lt;/xsl:if&gt;\n \n &lt;!-- JOBS EN COURSn j ai défini dans mon scriptn que les jobs en cours ont un exit 321321n --&gt;\n &lt;xsl:for-each select=&quot;row[exit = 321321]&quot;&gt;\n &lt;!-- le modulo est juste là pour faire une couleur un peu différente \n si plusieurs enregistrements de même type sont à la suite --&gt;\n &lt;xsl:choose&gt;\n &lt;xsl:when test=&quot;position() mod 2 = 0&quot; &gt;\n &lt;div class=&quot;encours1&quot;&gt;\n &lt;div class=&quot;in&quot;&gt;\n &lt;!-- appel du template pour le contenu du log --&gt;\n &lt;xsl:call-template name=&quot;rapport&quot; /&gt;\n &lt;/div&gt;\n &lt;/div&gt;\n &lt;/xsl:when&gt;\n &lt;xsl:otherwise&gt;\n &lt;div class=&quot;encours2&quot;&gt;\n &lt;div class=&quot;in&quot;&gt;\n &lt;!-- appel du template pour le contenu du log --&gt;\n &lt;xsl:call-template name=&quot;rapport&quot; /&gt;\n &lt;/div&gt;\n &lt;/div&gt;\n &lt;/xsl:otherwise&gt;\n &lt;/xsl:choose&gt;\n &lt;/xsl:for-each&gt; &lt;!-- fin des row EN COURS --&gt;\n \n \n &lt;!-- JOB EN ERREUR --&gt;\n &lt;xsl:for-each select=&quot;row[exit != 0 and exit != 321321]&quot;&gt;\n \n &lt;xsl:choose&gt;\n &lt;xsl:when test=&quot;position() mod 2 = 0&quot; &gt;\n &lt;div class=&quot;erreur1&quot;&gt;\n &lt;div class=&quot;in&quot;&gt;\n &lt;xsl:call-template name=&quot;rapport&quot; /&gt;\n &lt;/div&gt;\n &lt;/div&gt;\n &lt;/xsl:when&gt;\n &lt;xsl:otherwise&gt;\n &lt;div class=&quot;erreur2&quot;&gt;\n &lt;div class=&quot;in&quot;&gt;\n &lt;xsl:call-template name=&quot;rapport&quot; /&gt;\n &lt;/div&gt;\n &lt;/div&gt;\n &lt;/xsl:otherwise&gt;\n &lt;/xsl:choose&gt;\n &lt;/xsl:for-each&gt; &lt;!-- fin des row EN ERREUR --&gt;\n \n &lt;!-- JOB TERMINES --&gt;\n &lt;xsl:for-each select=&quot;row[exit = 0]&quot;&gt;\n \n &lt;xsl:choose&gt;\n &lt;xsl:when test=&quot;position() mod 2 = 0&quot; &gt;\n &lt;div class=&quot;pair&quot;&gt;\n &lt;div class=&quot;in&quot;&gt;\n &lt;xsl:call-template name=&quot;rapport&quot; /&gt;\n &lt;/div&gt;\n &lt;/div&gt;\n &lt;/xsl:when&gt;\n &lt;xsl:otherwise&gt;\n &lt;div class=&quot;impair&quot;&gt;\n &lt;div class=&quot;in&quot;&gt;\n &lt;xsl:call-template name=&quot;rapport&quot; /&gt;\n &lt;/div&gt;\n &lt;/div&gt;\n &lt;/xsl:otherwise&gt;\n &lt;/xsl:choose&gt;\n &lt;/xsl:for-each&gt; &lt;!-- fin des row TERMINES --&gt;\n \n &lt;/xsl:template&gt; &lt;!-- fin du template des datas --&gt;\n \n &lt;!-- appel du template pour le contenu du log --&gt;\n &lt;xsl:template name=&quot;rapport&quot;&gt;\n &lt;h1&gt;&lt;a&gt;Application : &lt;xsl:value-of select=&quot;app&quot; /&gt;&lt;/a&gt;&lt;/h1&gt;\n &lt;h2&gt;&lt;a&gt;Traitement : &lt;xsl:value-of select=&quot;job&quot; /&gt;&lt;/a&gt;&lt;/h2&gt;\n &lt;div class=&quot;logok&quot;&gt;\n &lt;a&gt;Log d execution : sortie standard : &lt;/a&gt;&lt;br /&gt;\n &amp;lt;pre&amp;gt;\n &lt;xsl:value-of select=&quot;logok&quot; /&gt;\n &amp;lt;/pre&amp;gt;\n &lt;/div&gt;\n &lt;div class=&quot;logko&quot;&gt;\n &lt;a&gt;Log d execution : sortie en erreur : &lt;/a&gt;&lt;br /&gt;\n &amp;lt;pre&amp;gt;\n &lt;xsl:value-of select=&quot;logko&quot; /&gt;\n &amp;lt;/pre&amp;gt;\n &lt;/div&gt;\n &lt;/xsl:template&gt; &lt;!-- fin du template rapport --&gt;\n &#39; echo -e $entete &gt; $XML echo &quot;&lt;data:data&gt;&quot; &gt;&gt; $XML #arbre xslt : /stylesheet/data:data/row for LIGNE in $(cat $INFILE) do nom_exec=${LIGNE%.*} nom_traitement=${LIGNE%.*} #recuperation nom du fichier sans extension chaine la plus courte a droite du . suivi de n caracteres nom_traitement=`echo $nom_traitement | sed &#39;s/_[0-9][0-9][0-9][0-9][0-9][0-9]-[0-9][0-9][0-9][0-9][0-9][0-9]$//&#39;` #suppression de la date et heure exemple de sed date_exec=`echo $LIGNE | awk -F &quot;_&quot; &#39;{print $NF}&#39; | awk -F &quot;.&quot; &#39;{print $1}&#39; | awk -F &quot;-&quot; &#39;{print $1}&#39;` #je laisse un exemple avec awk -F est le delemiter $NF le dernier argument heure_exec=${nom_exec##*-} #chaine la plus longue a gauche de - suivi de n caracteres heure_exec=`echo $heure_exec | sed &#39;s/^[0-9][0-9]/&amp;:/&#39; | sed &#39;s/[0-9][0-9]$/:&amp;/&#39;` #trick pour rajouter : entre heures et minutes avec sed date_traitement=`date --date=&quot;$date_exec $heure_exec&quot; +&quot;%d/%m/%y %H:%M:%S&quot;` #interpretation de la date par --date et remise en format classique date_exec=`date --date=&quot;$date_exec $heure_exec&quot; +%s` #timestamp pour tester avec le timestamp minimum requis if test &quot;$date_exec&quot; &gt; &quot;$dayminusday&quot; -a $LIGNE != &quot;&quot; then echo &quot; &lt;row&gt;&quot; &gt;&gt; $XML echo &quot; &lt;app&gt;&quot; &gt;&gt; $XML app=`head -n 20 &quot;$LOGS_REP$LIGNE&quot; | grep &quot;Application&quot; | awk -F &quot;:&quot; &#39;{print $2}&#39;` #head comme tail mais en partant du debut recuperation du nom application dans les logs echo &quot; $app&quot; &gt;&gt; $XML echo &quot; &lt;/app&gt;&quot; &gt;&gt; $XML echo &quot; &lt;job&gt;&quot; &gt;&gt; $XML job=`head -n 20 &quot;$LOGS_REP$LIGNE&quot; | grep &quot;Traitement&quot; | awk -F &quot;:&quot; &#39;{print $2}&#39;` #recuperation du nom traitement dans les logs echo &quot; $job&quot; &gt;&gt; $XML echo &quot; &lt;/job&gt;&quot; &gt;&gt; $XML echo &quot; &lt;exit&gt;&quot; &gt;&gt; $XML num_exit=`tail -n 5 &quot;$LOGS_REP$LIGNE&quot; | grep &quot;Exit&quot; | awk -F &quot;[&quot; &#39;{print $2}&#39; | awk -F &quot;]&quot; &#39;{print $1}&#39;` #recuperation du numero exit dans les logs if test &quot;${num_exit}&quot; != &quot;&quot; then echo &quot; $num_exit&quot; &gt;&gt; $XML else echo &quot; 321321&quot; &gt;&gt; $XML fi echo &quot; &lt;/exit&gt;&quot; &gt;&gt; $XML echo &quot; &lt;logok&gt;&quot; &gt;&gt; $XML #cat ${LOGS_REP}$LIGNE | sed &#39;s#&lt;#&amp;lt;#g&#39; | sed &#39;s#&gt;#&amp;gt;#g&#39; | sed &#39;s#&amp;#&amp;amp;#g&#39; &gt;&gt; $XML #sed remplace les &lt; et les &gt; par les notations xml pour ces caracteres speciaux cat ${LOGS_REP}$LIGNE | sed &#39;s#&amp;#&amp;amp;#g&#39; | sed &#39;s#&lt;#&amp;lt;#g&#39; | sed &#39;s#&gt;#&amp;gt;#g&#39; &gt;&gt; $XML echo &quot; &lt;/logok&gt;&quot; &gt;&gt; $XML logko=`echo $LIGNE | sed &#39;s/.o$/.e/&#39;` #exemple de sed j aurai pu mettre ${nom_exec}.e echo &quot; &lt;logko&gt;&quot; &gt;&gt; $XML cat ${LOGS_REP}$logko | sed &#39;s#&amp;#&amp;amp;#g&#39; | sed &#39;s#&lt;#&amp;lt;#g&#39; | sed &#39;s#&gt;#&amp;gt;#g&#39; &gt;&gt; $XML echo &quot; &lt;/logko&gt;&quot; &gt;&gt; $XML echo &quot; &lt;/row&gt;&quot; &gt;&gt; $XML fi done echo &quot;&lt;/data:data&gt;&quot; &gt;&gt; $XML echo &quot;&lt;/xsl:stylesheet&gt;&quot; &gt;&gt; $XML #arbre xslt : /stylesheet/data:data/row rm -f $INFILE #nettoyage fichiers temp rm -f $OUTFILE" />
<link rel="canonical" href="https://virtual-thom.github.io/archives/logs-execution-vtom-xml-xsl-embarque/" />
<meta property="og:url" content="https://virtual-thom.github.io/archives/logs-execution-vtom-xml-xsl-embarque/" />
<meta property="og:site_name" content="Virtual-Thom Blog-notes VTOM et informatique" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2012-09-15T15:24:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Mise en forme des logs d’exécution VTOM - insérer de la data XML dans un fichier XSL directement" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Virtual Thom"},"dateModified":"2012-09-15T15:24:00+00:00","datePublished":"2012-09-15T15:24:00+00:00","description":"A la demande de certains clients, j’ai écrit un script qui récupère les logs d’exécutions des jobs et les mets en forme en page web xml. Le principe est simple. Insérer de la data XML dans un fichier de feuille de style XSLT et transformer les data directement. On peut dire aussi que la feuille de transformation XSL est embarquée dans le fichier data XML. Vous pouvez télécharger le résultat XML : exemple_log.xml Les besoins des clients nous obligent parfois à effectuer un peu de “développement” perso. Voici ma recette pour récupérer et ordonner les logs d’exécution. Dans l’ordre d’affichage, JOBS EN COURS, JOBS EN ERREUR, JOBS TERMINES. La sortie finale en xml a l’avantage d’être visible sur la plupart des navigateurs web et intègre directement la mise en forme sans autre fichier (transformation xsl directement). Je vous propose de regarder dans un premier temps le résultat final. Dans un deuxième temps, je vous montrerai mon script en shell qui génère ce fichier xml. &lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt; &lt;?xml-stylesheet href=&quot;#stylesheet&quot; type=&quot;text/xsl&quot;?&gt; &lt;!DOCTYPE xsl:stylesheet [ &lt;!ATTLIST xsl:stylesheet id ID #REQUIRED&gt; ]&gt; &lt;!-- balises de transformation xsl --&gt; &lt;xsl:stylesheet version=&quot;2.0&quot; id=&quot;stylesheet&quot; xmlns:data=&quot;localhost&quot; xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;&gt; &lt;xsl:output method=&quot;html&quot; indent=&quot;yes&quot;/&gt; &lt;!-- définition du template principal avec le rendu html --&gt; &lt;xsl:template match=&quot;/&quot;&gt; &lt;html&gt; &lt;head&gt; &lt;title&gt;Rapport log d execution job VTOM&lt;/title&gt; &lt;style type=&quot;text/css&quot;&gt; h1 a { background-color : #339933 ; border : 1pt solid black ; margin : 0 0 0 10pt ; padding : 2pt ; } h2 a { background-color : #33FF66 ; border : 1pt solid black ; margin : 0 0 0 20pt ; padding : 2pt ; } div.in{ border: inset 5pt green; } div.pair{ border: outset 5pt green; border-collapse: separate; border-spacing: 5pt ; margin : 0 0 10pt 0 ; background-color: #33FF66 ; } div.impair{ border: outset 5pt green; border-collapse: separate; border-spacing: 5pt ; margin : 0 0 10pt 0 ; background-color: #339933 ; } div.erreur1{ border: outset 5pt red; border-collapse: separate; border-spacing: 5pt ; margin : 0 0 10pt 0 ; background-color: brown ; } div.erreur2{ border: outset 5pt red; border-collapse: separate; border-spacing: 5pt ; margin : 0 0 10pt 0 ; background-color: coral ; } div.encours1{ border: outset 5pt aqua; border-collapse: separate; border-spacing: 5pt ; margin : 0 0 10pt 0 ; background-color: blue ; } div.encours2{ border: outset 5pt aqua; border-collapse: separate; border-spacing: 5pt ; margin : 0 0 10pt 0 ; background-color: aqua ; } div.logok{ border : 1pt solid black ; margin : 5pt ; padding : 10pt ; } div.logok a{ font : 12pt ; color : lawngreen ; text-decoration : underline ; background-color : darkgreen ; padding : 5 pt ; } div.logko { border : 1pt solid black ; margin : 5pt ; padding : 10pt ; } div.logko a{ text-decoration : underline ; color : red ; background-color : yellow ; padding : 5 pt ; } &lt;/style&gt; &lt;/head&gt; &lt;body&gt; &lt;!-- appel des templates qui vont chercher dans les datas (les logs) --&gt; &lt;xsl:apply-templates select=&quot;/xsl:stylesheet/data:data&quot; /&gt; &lt;/body&gt; &lt;/html&gt; &lt;/xsl:template&gt; &lt;xsl:template match=&quot;/xsl:stylesheet/data:data&quot;&gt; &lt;!-- Ce premier appel de template va définir le layout de l état de l enregistrement 1 row = un log d exécution --&gt; &lt;xsl:if test=&quot;count(row) = 0&quot;&gt; &lt;a&gt;Aucun traitement&lt;/a&gt; &lt;/xsl:if&gt; &lt;!-- JOBS EN COURS j ai défini dans mon script que les jobs en cours ont un exit 321321 --&gt; &lt;xsl:for-each select=&quot;row[exit = 321321]&quot;&gt; &lt;!-- le modulo est juste là pour faire une couleur un peu différente si plusieurs enregistrements de même type sont à la suite --&gt; &lt;xsl:choose&gt; &lt;xsl:when test=&quot;position() mod 2 = 0&quot; &gt; &lt;div class=&quot;encours1&quot;&gt; &lt;div class=&quot;in&quot;&gt; &lt;!-- appel du template pour le contenu du log --&gt; &lt;xsl:call-template name=&quot;rapport&quot; /&gt; &lt;/div&gt; &lt;/div&gt; &lt;/xsl:when&gt; &lt;xsl:otherwise&gt; &lt;div class=&quot;encours2&quot;&gt; &lt;div class=&quot;in&quot;&gt; &lt;!-- appel du template pour le contenu du log --&gt; &lt;xsl:call-template name=&quot;rapport&quot; /&gt; &lt;/div&gt; &lt;/div&gt; &lt;/xsl:otherwise&gt; &lt;/xsl:choose&gt; &lt;/xsl:for-each&gt; &lt;!-- fin des row EN COURS --&gt; &lt;!-- JOB EN ERREUR --&gt; &lt;xsl:for-each select=&quot;row[exit != 0 and exit != 321321]&quot;&gt; &lt;xsl:choose&gt; &lt;xsl:when test=&quot;position() mod 2 = 0&quot; &gt; &lt;div class=&quot;erreur1&quot;&gt; &lt;div class=&quot;in&quot;&gt; &lt;xsl:call-template name=&quot;rapport&quot; /&gt; &lt;/div&gt; &lt;/div&gt; &lt;/xsl:when&gt; &lt;xsl:otherwise&gt; &lt;div class=&quot;erreur2&quot;&gt; &lt;div class=&quot;in&quot;&gt; &lt;xsl:call-template name=&quot;rapport&quot; /&gt; &lt;/div&gt; &lt;/div&gt; &lt;/xsl:otherwise&gt; &lt;/xsl:choose&gt; &lt;/xsl:for-each&gt; &lt;!-- fin des row EN ERREUR --&gt; &lt;!-- JOB TERMINES --&gt; &lt;xsl:for-each select=&quot;row[exit = 0]&quot;&gt; &lt;xsl:choose&gt; &lt;xsl:when test=&quot;position() mod 2 = 0&quot; &gt; &lt;div class=&quot;pair&quot;&gt; &lt;div class=&quot;in&quot;&gt; &lt;xsl:call-template name=&quot;rapport&quot; /&gt; &lt;/div&gt; &lt;/div&gt; &lt;/xsl:when&gt; &lt;xsl:otherwise&gt; &lt;div class=&quot;impair&quot;&gt; &lt;div class=&quot;in&quot;&gt; &lt;xsl:call-template name=&quot;rapport&quot; /&gt; &lt;/div&gt; &lt;/div&gt; &lt;/xsl:otherwise&gt; &lt;/xsl:choose&gt; &lt;/xsl:for-each&gt; &lt;!-- fin des row TERMINES --&gt; &lt;/xsl:template&gt; &lt;!-- fin du template des datas --&gt; &lt;!-- appel du template pour le contenu du log --&gt; &lt;xsl:template name=&quot;rapport&quot;&gt; &lt;h1&gt;&lt;a&gt;Application : &lt;xsl:value-of select=&quot;app&quot; /&gt;&lt;/a&gt;&lt;/h1&gt; &lt;h2&gt;&lt;a&gt;Traitement : &lt;xsl:value-of select=&quot;job&quot; /&gt;&lt;/a&gt;&lt;/h2&gt; &lt;div class=&quot;logok&quot;&gt; &lt;a&gt;Log d execution : sortie standard : &lt;/a&gt;&lt;br /&gt; &amp;lt;pre&amp;gt; &lt;xsl:value-of select=&quot;logok&quot; /&gt; &amp;lt;/pre&amp;gt; &lt;/div&gt; &lt;div class=&quot;logko&quot;&gt; &lt;a&gt;Log d execution : sortie en erreur : &lt;/a&gt;&lt;br /&gt; &amp;lt;pre&amp;gt; &lt;xsl:value-of select=&quot;logko&quot; /&gt; &amp;lt;/pre&amp;gt; &lt;/div&gt; &lt;/xsl:template&gt; &lt;!-- fin du template rapport --&gt; &lt;!-- les datas, les logs d&#39;exécutions 1 row = 1 enregistrement 1 enregistrement = nom de l&#39;application et job, le n°exit les logs d&#39;exécution --&gt; &lt;data:data&gt; &lt;row&gt; &lt;app&gt; APPLICATION_1 &lt;/app&gt; &lt;job&gt; TRAITEMENT_1 &lt;/job&gt; &lt;exit&gt; 0 &lt;/exit&gt; &lt;logok&gt; _______________________________________________________________________ Contexte Visual TOM du traitement Machine : machine-la01 Utilisateur : root Script : /path/monscript.sh Shell : /bin/ksh Serveur Visual TOM : serveur-vtom Traitement : TRAITEMENT_1 Application : APPLICATION_1 Environnement : ENVIRONNEMENT_A Job ID : 3348 Nombre de relances : 0 Label de reprise : 0 Mode Execution : NORMAL Date d&#39;exploitation : DATE_PROD Valeur de la date : 31/08/2012 _______________________________________________________________________ vendredi 31/08/2012 - 04:29:58 Debut de l&#39;execution du script ... _______________________________________________________________________ LUKE aime LEIA sortie standard _______________________________________________________________________ vendredi 31/08/2012 - 04:30:59 Fin de l&#39;execution du script. --&amp;gt; Exit [0] donc acquitement &lt;/logok&gt; &lt;logko&gt; &lt;/logko&gt; &lt;/row&gt; &lt;row&gt; &lt;app&gt; APPLICATION_1 &lt;/app&gt; &lt;job&gt; TRAITEMENT_2 &lt;/job&gt; &lt;exit&gt; 123 &lt;/exit&gt; &lt;logok&gt; _______________________________________________________________________ Contexte Visual TOM du traitement Machine : machine-la01 Utilisateur : root Script : /path/monscript.sh Shell : /bin/ksh Serveur Visual TOM : serveur-vtom Traitement : TRAITEMENT_2 Application : APPLICATION_1 Environnement : ENVIRONNEMENT_A Job ID : 3349 Nombre de relances : 0 Label de reprise : 0 Mode Execution : NORMAL Date d&#39;exploitation : DATE_PROD Valeur de la date : 31/08/2012 _______________________________________________________________________ vendredi 31/08/2012 - 04:29:58 Debut de l&#39;execution du script ... _______________________________________________________________________ LUKE aime LEIA sortie standard _______________________________________________________________________ vendredi 31/08/2012 - 04:30:59 Fin de l&#39;execution du script. --&amp;gt; Exit [123] donc acquitement &lt;/logok&gt; &lt;logko&gt; JE SUIS TON PERE sortie erreur &lt;/logko&gt; &lt;/row&gt; &lt;row&gt; &lt;app&gt; APPLICATION_1 &lt;/app&gt; &lt;job&gt; TRAITEMENT_3 &lt;/job&gt; &lt;exit&gt; 321321 &lt;/exit&gt; &lt;logok&gt; _______________________________________________________________________ Contexte Visual TOM du traitement Machine : machine-la01 Utilisateur : root Script : /path/monscript.sh Shell : /bin/ksh Serveur Visual TOM : serveur-vtom Traitement : TRAITEMENT_3 Application : APPLICATION_1 Environnement : ENVIRONNEMENT_A Job ID : 3350 Nombre de relances : 0 Label de reprise : 0 Mode Execution : NORMAL Date d&#39;exploitation : DATE_PROD Valeur de la date : 31/08/2012 _______________________________________________________________________ vendredi 31/08/2012 - 04:29:58 Debut de l&#39;execution du script ... _______________________________________________________________________ LUKE aime ... &lt;/logok&gt; &lt;logko&gt; &lt;/logko&gt; &lt;/row&gt; &lt;/data:data&gt; &lt;!-- fin des datas --&gt; &lt;/xsl:stylesheet&gt; &lt;!-- fin du fichier xml --&gt; Pour aller plus loin dans l’explication du XML, c’est en réalité un xml qui fait appel à une feuille de style XSL, non pas extérieure mais dans le XML, grâce à son ID. De plus la feuille de style xsl:stylesheet intègre directement les données. Il suffit de définir le namespace dans la déclaration du xsl:stylesheet. Appel de la feuille de style xsl:stylesheet dans le fichier xml : &lt;?xml-stylesheet href=&quot;#stylesheet&quot; type=&quot;text/xsl&quot;?&gt; vers le href #stylesheet =&gt; id=stylesheet &lt;xsl:stylesheet version=&quot;2.0&quot; id=&quot;stylesheet&quot; xmlns:data=&quot;localhost&quot; xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;&gt; Déclaration normale pour les balises de transformation xsl xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot; Déclaration de ma balise perso. Cela va permettre de faire mes balises du type où je vais stocker mes données. Les templates vont matcher à partir de cette arborescence. xmlns:data=&quot;localhost&quot; Passons maintenant au script shell exécuté sur chaque machine dont vous voulez récupérer les logs. Voici le script generexml.sh Je me base sur la structure du nom des logs d’exécution VTOM. Il y aura surement quelques adaptations à effectuer chez vous. Attention, je ne test pas la volumétrie des logs. #!/bin/sh # # AUTEUR : Virtual Thom # VERSION : 1.0 # DATE : 20/05/2011 # # set -n # Decommenter pour debug syntax sans execution # NOTE: Ne pas oublier de recommenter ! # set -x # Decommenter pour debug # ########################################################## # SCRIPT ########################################################## usage(){ # exemple d&#39;usage script=${0##*/} ; #script=${script%.*} ; echo &quot;&quot; ; echo &quot;${script} - permet de recuperer des logs d&#39;execution et de les mettre en forme&quot; ; echo &quot;&quot; echo &quot;Usage :&quot; ; echo &quot; ${script} machine environnement tempsenseconde&quot; ; echo &quot;1er parametre : nom de la machine&quot; ; echo &quot;2eme parametre : filtre pour la recuperation des logs, peut etre l&#39;environnement par exemple&quot; ; echo &quot;3eme parametre : temps en secondes depuis l&#39;execution du script jusqu&#39;au temps de recuperation&quot; ; echo &quot;&quot; ; exit 123 ; } if test &quot;$1&quot; = &quot;--help&quot; -o &quot;$1&quot; = &quot;-help&quot; -o &quot;$1&quot; = &quot;-h&quot; -o -z &quot;$1&quot; then usage fi machine=${1} #Par defaut machine environnement=${2:-PROD} #Par defaut PROD retour_tps=${3:-86400} #Par defaut 86400 s soit 24h LOGS_REP=${TOM_LOG_DIR:-/opt/vtom/logs/} LOGS_SCRIPTS=/opt/vtom/scripts/ INFILE=/opt/vtom/scripts/infile OUTFILE=/opt/vtom/scripts/outfile XML=/opt/vtom/scripts/${machine}_${environnement}.xml thisday=`date +%s` #date du jour en timestamp dayminusday=`expr $thisday - ${retour_tps}` #calcul date du jour - 24h (en s) en timestamp &gt; $OUTFILE ls ${LOGS_REP} | grep &quot;${environnement}.*.o&quot; | sort &gt; $INFILE #liste des logs #chargement de l entete xml xsl entete=&#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;\\n &lt;?xml-stylesheet href=&quot;#stylesheet&quot; type=&quot;text/xsl&quot;?&gt;\\n \\n &lt;!DOCTYPE xsl:stylesheet [\\n &lt;!ATTLIST xsl:stylesheetn id ID #REQUIRED&gt;\\n ]&gt;\\n \\n &lt;!-- balises de transformation xsl --&gt;\\n &lt;xsl:stylesheet version=&quot;2.0&quot; id=&quot;stylesheet&quot; xmlns:data=&quot;localhost&quot; \\n xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;&gt;\\n &lt;xsl:output method=&quot;html&quot; indent=&quot;yes&quot;/&gt;\\n \\n &lt;!-- définition du template principal avec le rendu html --&gt;\\n &lt;xsl:template match=&quot;/&quot;&gt;\\n &lt;html&gt;\\n &lt;head&gt;\\n &lt;title&gt;Rapport log d execution job VTOM&lt;/title&gt;\\n &lt;style type=&quot;text/css&quot;&gt;\\n h1 a {\\n background-color : #339933 ;\\n border : 1pt solid black ;\\n margin : 0 0 0 10pt ; \\n padding : 2pt ;\\n }\\n h2 a {\\n background-color : #33FF66 ;\\n border : 1pt solid black ;\\n margin : 0 0 0 20pt ;\\n padding : 2pt ;\\n }\\n div.in{ \\n border: inset 5pt green;\\n }\\n div.pair{\\n border: outset 5pt green; \\n border-collapse: separate;\\n border-spacing: 5pt ;\\n margin : 0 0 10pt 0 ;\\n background-color: #33FF66 ;\\n }\\n div.impair{\\n border: outset 5pt green; \\n border-collapse: separate;\\n border-spacing: 5pt ;\\n margin : 0 0 10pt 0 ;\\n background-color: #339933 ;\\n }\\n div.erreur1{\\n border: outset 5pt red; \\n border-collapse: separate;\\n border-spacing: 5pt ;\\n margin : 0 0 10pt 0 ;\\n background-color: brown ;\\n }\\n div.erreur2{\\n border: outset 5pt red; \\n border-collapse: separate;\\n border-spacing: 5pt ;\\n margin : 0 0 10pt 0 ;\\n background-color: coral ;\\n }\\n div.encours1{\\n border: outset 5pt aqua; \\n border-collapse: separate;\\n border-spacing: 5pt ;\\n margin : 0 0 10pt 0 ;\\n background-color: blue ;\\n }\\n div.encours2{\\n border: outset 5pt aqua; \\n border-collapse: separate;\\n border-spacing: 5pt ;\\n margin : 0 0 10pt 0 ;\\n background-color: aqua ;\\n }\\n div.logok{\\n border : 1pt solid black ;\\n margin : 5pt ; \\n padding : 10pt ;\\n }\\n div.logok a{\\n font : 12pt ;\\n color : lawngreen ;\\n text-decoration : underline ;\\n background-color : darkgreen ;\\n padding : 5 pt ;\\n }\\n div.logko {\\n border : 1pt solid black ;\\n margin : 5pt ; \\n padding : 10pt ;\\n }\\n div.logko a{\\n text-decoration : underline ;\\n color : red ;\\n background-color : yellow ;\\n padding : 5 pt ;\\n }\\n &lt;/style&gt;\\n &lt;/head&gt;\\n &lt;body&gt;\\n &lt;!-- appel des templates qui vont chercher dans les datas (les logs) --&gt; \\n &lt;xsl:apply-templates select=&quot;/xsl:stylesheet/data:data&quot; /&gt;\\n &lt;/body&gt;\\n &lt;/html&gt;\\n &lt;/xsl:template&gt;\\n \\n \\n &lt;xsl:template match=&quot;/xsl:stylesheet/data:data&quot;&gt;\\n &lt;!--\\n Ce premier appel de template va définir le layout de l état de l enregistrement 1 row = un log d exécutionn --&gt;\\n \\n &lt;xsl:if test=&quot;count(row) = 0&quot;&gt; \\n &lt;a&gt;Aucun traitement&lt;/a&gt; \\n &lt;/xsl:if&gt;\\n \\n &lt;!-- JOBS EN COURSn j ai défini dans mon scriptn que les jobs en cours ont un exit 321321n --&gt;\\n &lt;xsl:for-each select=&quot;row[exit = 321321]&quot;&gt;\\n &lt;!-- le modulo est juste là pour faire une couleur un peu différente \\n si plusieurs enregistrements de même type sont à la suite --&gt;\\n &lt;xsl:choose&gt;\\n &lt;xsl:when test=&quot;position() mod 2 = 0&quot; &gt;\\n &lt;div class=&quot;encours1&quot;&gt;\\n &lt;div class=&quot;in&quot;&gt;\\n &lt;!-- appel du template pour le contenu du log --&gt;\\n &lt;xsl:call-template name=&quot;rapport&quot; /&gt;\\n &lt;/div&gt;\\n &lt;/div&gt;\\n &lt;/xsl:when&gt;\\n &lt;xsl:otherwise&gt;\\n &lt;div class=&quot;encours2&quot;&gt;\\n &lt;div class=&quot;in&quot;&gt;\\n &lt;!-- appel du template pour le contenu du log --&gt;\\n &lt;xsl:call-template name=&quot;rapport&quot; /&gt;\\n &lt;/div&gt;\\n &lt;/div&gt;\\n &lt;/xsl:otherwise&gt;\\n &lt;/xsl:choose&gt;\\n &lt;/xsl:for-each&gt; &lt;!-- fin des row EN COURS --&gt;\\n \\n \\n &lt;!-- JOB EN ERREUR --&gt;\\n &lt;xsl:for-each select=&quot;row[exit != 0 and exit != 321321]&quot;&gt;\\n \\n &lt;xsl:choose&gt;\\n &lt;xsl:when test=&quot;position() mod 2 = 0&quot; &gt;\\n &lt;div class=&quot;erreur1&quot;&gt;\\n &lt;div class=&quot;in&quot;&gt;\\n &lt;xsl:call-template name=&quot;rapport&quot; /&gt;\\n &lt;/div&gt;\\n &lt;/div&gt;\\n &lt;/xsl:when&gt;\\n &lt;xsl:otherwise&gt;\\n &lt;div class=&quot;erreur2&quot;&gt;\\n &lt;div class=&quot;in&quot;&gt;\\n &lt;xsl:call-template name=&quot;rapport&quot; /&gt;\\n &lt;/div&gt;\\n &lt;/div&gt;\\n &lt;/xsl:otherwise&gt;\\n &lt;/xsl:choose&gt;\\n &lt;/xsl:for-each&gt; &lt;!-- fin des row EN ERREUR --&gt;\\n \\n &lt;!-- JOB TERMINES --&gt;\\n &lt;xsl:for-each select=&quot;row[exit = 0]&quot;&gt;\\n \\n &lt;xsl:choose&gt;\\n &lt;xsl:when test=&quot;position() mod 2 = 0&quot; &gt;\\n &lt;div class=&quot;pair&quot;&gt;\\n &lt;div class=&quot;in&quot;&gt;\\n &lt;xsl:call-template name=&quot;rapport&quot; /&gt;\\n &lt;/div&gt;\\n &lt;/div&gt;\\n &lt;/xsl:when&gt;\\n &lt;xsl:otherwise&gt;\\n &lt;div class=&quot;impair&quot;&gt;\\n &lt;div class=&quot;in&quot;&gt;\\n &lt;xsl:call-template name=&quot;rapport&quot; /&gt;\\n &lt;/div&gt;\\n &lt;/div&gt;\\n &lt;/xsl:otherwise&gt;\\n &lt;/xsl:choose&gt;\\n &lt;/xsl:for-each&gt; &lt;!-- fin des row TERMINES --&gt;\\n \\n &lt;/xsl:template&gt; &lt;!-- fin du template des datas --&gt;\\n \\n &lt;!-- appel du template pour le contenu du log --&gt;\\n &lt;xsl:template name=&quot;rapport&quot;&gt;\\n &lt;h1&gt;&lt;a&gt;Application : &lt;xsl:value-of select=&quot;app&quot; /&gt;&lt;/a&gt;&lt;/h1&gt;\\n &lt;h2&gt;&lt;a&gt;Traitement : &lt;xsl:value-of select=&quot;job&quot; /&gt;&lt;/a&gt;&lt;/h2&gt;\\n &lt;div class=&quot;logok&quot;&gt;\\n &lt;a&gt;Log d execution : sortie standard : &lt;/a&gt;&lt;br /&gt;\\n &amp;lt;pre&amp;gt;\\n &lt;xsl:value-of select=&quot;logok&quot; /&gt;\\n &amp;lt;/pre&amp;gt;\\n &lt;/div&gt;\\n &lt;div class=&quot;logko&quot;&gt;\\n &lt;a&gt;Log d execution : sortie en erreur : &lt;/a&gt;&lt;br /&gt;\\n &amp;lt;pre&amp;gt;\\n &lt;xsl:value-of select=&quot;logko&quot; /&gt;\\n &amp;lt;/pre&amp;gt;\\n &lt;/div&gt;\\n &lt;/xsl:template&gt; &lt;!-- fin du template rapport --&gt;\\n &#39; echo -e $entete &gt; $XML echo &quot;&lt;data:data&gt;&quot; &gt;&gt; $XML #arbre xslt : /stylesheet/data:data/row for LIGNE in $(cat $INFILE) do nom_exec=${LIGNE%.*} nom_traitement=${LIGNE%.*} #recuperation nom du fichier sans extension chaine la plus courte a droite du . suivi de n caracteres nom_traitement=`echo $nom_traitement | sed &#39;s/_[0-9][0-9][0-9][0-9][0-9][0-9]-[0-9][0-9][0-9][0-9][0-9][0-9]$//&#39;` #suppression de la date et heure exemple de sed date_exec=`echo $LIGNE | awk -F &quot;_&quot; &#39;{print $NF}&#39; | awk -F &quot;.&quot; &#39;{print $1}&#39; | awk -F &quot;-&quot; &#39;{print $1}&#39;` #je laisse un exemple avec awk -F est le delemiter $NF le dernier argument heure_exec=${nom_exec##*-} #chaine la plus longue a gauche de - suivi de n caracteres heure_exec=`echo $heure_exec | sed &#39;s/^[0-9][0-9]/&amp;:/&#39; | sed &#39;s/[0-9][0-9]$/:&amp;/&#39;` #trick pour rajouter : entre heures et minutes avec sed date_traitement=`date --date=&quot;$date_exec $heure_exec&quot; +&quot;%d/%m/%y %H:%M:%S&quot;` #interpretation de la date par --date et remise en format classique date_exec=`date --date=&quot;$date_exec $heure_exec&quot; +%s` #timestamp pour tester avec le timestamp minimum requis if test &quot;$date_exec&quot; &gt; &quot;$dayminusday&quot; -a $LIGNE != &quot;&quot; then echo &quot; &lt;row&gt;&quot; &gt;&gt; $XML echo &quot; &lt;app&gt;&quot; &gt;&gt; $XML app=`head -n 20 &quot;$LOGS_REP$LIGNE&quot; | grep &quot;Application&quot; | awk -F &quot;:&quot; &#39;{print $2}&#39;` #head comme tail mais en partant du debut recuperation du nom application dans les logs echo &quot; $app&quot; &gt;&gt; $XML echo &quot; &lt;/app&gt;&quot; &gt;&gt; $XML echo &quot; &lt;job&gt;&quot; &gt;&gt; $XML job=`head -n 20 &quot;$LOGS_REP$LIGNE&quot; | grep &quot;Traitement&quot; | awk -F &quot;:&quot; &#39;{print $2}&#39;` #recuperation du nom traitement dans les logs echo &quot; $job&quot; &gt;&gt; $XML echo &quot; &lt;/job&gt;&quot; &gt;&gt; $XML echo &quot; &lt;exit&gt;&quot; &gt;&gt; $XML num_exit=`tail -n 5 &quot;$LOGS_REP$LIGNE&quot; | grep &quot;Exit&quot; | awk -F &quot;[&quot; &#39;{print $2}&#39; | awk -F &quot;]&quot; &#39;{print $1}&#39;` #recuperation du numero exit dans les logs if test &quot;${num_exit}&quot; != &quot;&quot; then echo &quot; $num_exit&quot; &gt;&gt; $XML else echo &quot; 321321&quot; &gt;&gt; $XML fi echo &quot; &lt;/exit&gt;&quot; &gt;&gt; $XML echo &quot; &lt;logok&gt;&quot; &gt;&gt; $XML #cat ${LOGS_REP}$LIGNE | sed &#39;s#&lt;#&amp;lt;#g&#39; | sed &#39;s#&gt;#&amp;gt;#g&#39; | sed &#39;s#&amp;#&amp;amp;#g&#39; &gt;&gt; $XML #sed remplace les &lt; et les &gt; par les notations xml pour ces caracteres speciaux cat ${LOGS_REP}$LIGNE | sed &#39;s#&amp;#&amp;amp;#g&#39; | sed &#39;s#&lt;#&amp;lt;#g&#39; | sed &#39;s#&gt;#&amp;gt;#g&#39; &gt;&gt; $XML echo &quot; &lt;/logok&gt;&quot; &gt;&gt; $XML logko=`echo $LIGNE | sed &#39;s/.o$/.e/&#39;` #exemple de sed j aurai pu mettre ${nom_exec}.e echo &quot; &lt;logko&gt;&quot; &gt;&gt; $XML cat ${LOGS_REP}$logko | sed &#39;s#&amp;#&amp;amp;#g&#39; | sed &#39;s#&lt;#&amp;lt;#g&#39; | sed &#39;s#&gt;#&amp;gt;#g&#39; &gt;&gt; $XML echo &quot; &lt;/logko&gt;&quot; &gt;&gt; $XML echo &quot; &lt;/row&gt;&quot; &gt;&gt; $XML fi done echo &quot;&lt;/data:data&gt;&quot; &gt;&gt; $XML echo &quot;&lt;/xsl:stylesheet&gt;&quot; &gt;&gt; $XML #arbre xslt : /stylesheet/data:data/row rm -f $INFILE #nettoyage fichiers temp rm -f $OUTFILE","headline":"Mise en forme des logs d’exécution VTOM - insérer de la data XML dans un fichier XSL directement","mainEntityOfPage":{"@type":"WebPage","@id":"https://virtual-thom.github.io/archives/logs-execution-vtom-xml-xsl-embarque/"},"url":"https://virtual-thom.github.io/archives/logs-execution-vtom-xml-xsl-embarque/"}</script>
<!-- End Jekyll SEO tag -->

  
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Z8Y7902GRV"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Z8Y7902GRV');
</script>


  <body>
    <div class="container">
      <header id="site-header">
  <h1>Blog-notes VTOM, informatique, industrialisation, ordonnancement, DevOps</h1>
  <nav>
    <ul>
      <li>
        <a href="https://virtual-thom.github.io/archives" title="Home">
          <svg class="svg-icon" viewBox="0 0 20 20">
            <path d="M18.121,9.88l-7.832-7.836c-0.155-0.158-0.428-0.155-0.584,0L1.842,9.913c-0.262,0.263-0.073,0.705,0.292,0.705h2.069v7.042c0,0.227,0.187,0.414,0.414,0.414h3.725c0.228,0,0.414-0.188,0.414-0.414v-3.313h2.483v3.313c0,0.227,0.187,0.414,0.413,0.414h3.726c0.229,0,0.414-0.188,0.414-0.414v-7.042h2.068h0.004C18.331,10.617,18.389,10.146,18.121,9.88 M14.963,17.245h-2.896v-3.313c0-0.229-0.186-0.415-0.414-0.415H8.342c-0.228,0-0.414,0.187-0.414,0.415v3.313H5.032v-6.628h9.931V17.245z M3.133,9.79l6.864-6.868l6.867,6.868H3.133z"></path>
          </svg>
        </a>
      </li>
      <li>
        <a href="https://virtual-thom.github.io/archives/vos-commentaires-livre-d-or/" title="Commentaires - livre d'or">
          <svg class="svg-icon" viewBox="0 0 20 20">
            <path d="M17.657,2.982H2.342c-0.234,0-0.425,0.191-0.425,0.426v10.21c0,0.234,0.191,0.426,0.425,0.426h3.404v2.553c0,0.397,0.48,0.547,0.725,0.302l2.889-2.854h8.298c0.234,0,0.426-0.191,0.426-0.426V3.408C18.083,3.174,17.892,2.982,17.657,2.982M17.232,13.192H9.185c-0.113,0-0.219,0.045-0.3,0.124l-2.289,2.262v-1.96c0-0.233-0.191-0.426-0.425-0.426H2.767V3.833h14.465V13.192z M10,7.237c-0.821,0-1.489,0.668-1.489,1.489c0,0.821,0.668,1.489,1.489,1.489c0.821,0,1.488-0.668,1.488-1.489C11.488,7.905,10.821,7.237,10,7.237 M10,9.364c-0.352,0-0.638-0.288-0.638-0.638c0-0.351,0.287-0.638,0.638-0.638c0.351,0,0.638,0.287,0.638,0.638C10.638,9.077,10.351,9.364,10,9.364 M14.254,7.237c-0.821,0-1.489,0.668-1.489,1.489c0,0.821,0.668,1.489,1.489,1.489s1.489-0.668,1.489-1.489C15.743,7.905,15.075,7.237,14.254,7.237 M14.254,9.364c-0.351,0-0.638-0.288-0.638-0.638c0-0.351,0.287-0.638,0.638-0.638c0.352,0,0.639,0.287,0.639,0.638C14.893,9.077,14.605,9.364,14.254,9.364 M5.746,7.237c-0.821,0-1.489,0.668-1.489,1.489c0,0.821,0.668,1.489,1.489,1.489c0.821,0,1.489-0.668,1.489-1.489C7.234,7.905,6.566,7.237,5.746,7.237 M5.746,9.364c-0.351,0-0.638-0.288-0.638-0.638c0-0.351,0.287-0.638,0.638-0.638c0.351,0,0.638,0.287,0.638,0.638C6.384,9.077,6.096,9.364,5.746,9.364"></path>
          </svg>
        </a>
      </li>
      
      <li>
        <a href="https://virtual-thom.github.io/about" title="Curriculum Vitae Thom">
          <svg class="svg-icon" viewBox="0 0 20 20">
            <path d="M12.075,10.812c1.358-0.853,2.242-2.507,2.242-4.037c0-2.181-1.795-4.618-4.198-4.618S5.921,4.594,5.921,6.775c0,1.53,0.884,3.185,2.242,4.037c-3.222,0.865-5.6,3.807-5.6,7.298c0,0.23,0.189,0.42,0.42,0.42h14.273c0.23,0,0.42-0.189,0.42-0.42C17.676,14.619,15.297,11.677,12.075,10.812 M6.761,6.775c0-2.162,1.773-3.778,3.358-3.778s3.359,1.616,3.359,3.778c0,2.162-1.774,3.778-3.359,3.778S6.761,8.937,6.761,6.775 M3.415,17.69c0.218-3.51,3.142-6.297,6.704-6.297c3.562,0,6.486,2.787,6.705,6.297H3.415z"></path>
          </svg>
        </a>
      </li>
    </ul>
  </nav>
</header>

      <div itemscope itemtype ="http://schema.org/Article" class="post">
  
  <header class="post-header">
    <h1 itemprop="name about headline" class="post-title">Mise en forme des logs d'exécution VTOM - insérer de la data XML dans un fichier XSL directement</h1>
    <p class="post-meta">
      <time itemprop="datePublished dateModified" datetime="2012-09-15T15:24:00+00:00">15-09-2012</time></p>
  </header>

  <article class="post-content" itemprop="articleBody">
    <h1 class="hidden">Mise en forme des logs d'exécution VTOM - insérer de la data XML dans un fichier XSL directement</h1>
    <p>A la demande de certains clients, j’ai écrit un script qui récupère les logs d’exécutions des jobs et les mets en forme en page web xml.
Le principe est simple. Insérer de la data XML dans un fichier de feuille de style XSLT et transformer les data directement. On peut dire aussi que la feuille de transformation XSL est embarquée dans le fichier data XML.</p>

<p>Vous pouvez télécharger le résultat XML : 
<a target="_blank" href="https://virtual-thom.github.io/archives/wp-content/uploads/exemple_log.xml" title="exemple_log.xml">exemple_log.xml</a></p>

<p>Les besoins des clients nous obligent parfois à effectuer un peu de “développement” perso. Voici ma recette pour récupérer et ordonner les logs d’exécution. Dans l’ordre d’affichage, JOBS EN COURS, JOBS EN ERREUR, JOBS TERMINES.
La sortie finale en xml a l’avantage d’être visible sur la plupart des navigateurs web et intègre directement la mise en forme sans autre fichier (transformation xsl directement).</p>

<p>Je vous propose de regarder dans un premier temps le résultat final. Dans un deuxième temps, je vous montrerai mon script en shell qui génère ce fichier xml.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;</span>
<span class="cp">&lt;?xml-stylesheet href="#stylesheet" type="text/xsl"?&gt;</span>

<span class="cp">&lt;!DOCTYPE xsl:stylesheet [
&lt;!ATTLIST xsl:stylesheet
id	ID	#REQUIRED&gt;</span>
]&gt;

<span class="c">&lt;!-- balises de transformation xsl --&gt;</span>
<span class="nt">&lt;xsl:stylesheet</span> <span class="na">version=</span><span class="s">"2.0"</span> <span class="na">id=</span><span class="s">"stylesheet"</span>  <span class="na">xmlns:data=</span><span class="s">"localhost"</span> 
<span class="na">xmlns:xsl=</span><span class="s">"http://www.w3.org/1999/XSL/Transform"</span><span class="nt">&gt;</span>
<span class="nt">&lt;xsl:output</span> <span class="na">method=</span><span class="s">"html"</span> <span class="na">indent=</span><span class="s">"yes"</span><span class="nt">/&gt;</span>

<span class="c">&lt;!-- définition du template principal avec le rendu html --&gt;</span>
<span class="nt">&lt;xsl:template</span> <span class="na">match=</span><span class="s">"/"</span><span class="nt">&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;title&gt;</span>Rapport log d execution job VTOM<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;style</span> <span class="na">type=</span><span class="s">"text/css"</span><span class="nt">&gt;</span>
h1 a {
	background-color : #339933 ;
	border : 1pt solid black ;
	margin : 0 0 0 10pt ; 
	padding : 2pt ;
}
h2 a {
	background-color : #33FF66 ;
	border : 1pt solid black ;
	margin : 0 0 0 20pt ;
	padding : 2pt ;
}
div.in{	
	border: inset 5pt green;
}
div.pair{
	border: outset 5pt green; 
    border-collapse: separate;
    border-spacing: 5pt ;
	margin : 0 0 10pt 0 ;
	background-color: #33FF66 ;
}
div.impair{
	border: outset 5pt green; 
    border-collapse: separate;
    border-spacing: 5pt ;
	margin : 0 0 10pt 0 ;
	background-color: #339933 ;
}
div.erreur1{
	border: outset 5pt red; 
    border-collapse: separate;
    border-spacing: 5pt ;
	margin : 0 0 10pt 0 ;
	background-color: brown ;
}
div.erreur2{
	border: outset 5pt red; 
    border-collapse: separate;
    border-spacing: 5pt ;
	margin : 0 0 10pt 0 ;
	background-color: coral ;
}
div.encours1{
	border: outset 5pt aqua; 
    border-collapse: separate;
    border-spacing: 5pt ;
	margin : 0 0 10pt 0 ;
	background-color: blue ;
}
div.encours2{
	border: outset 5pt aqua; 
    border-collapse: separate;
    border-spacing: 5pt ;
	margin : 0 0 10pt 0 ;
	background-color: aqua ;
}
div.logok{
	border : 1pt solid black ;
	margin : 5pt ; 
	padding : 10pt ;
}
div.logok a{
	font : 12pt ;
	color : lawngreen ;
	text-decoration : underline ;
	background-color : darkgreen ;
	padding : 5 pt ;
}
div.logko {
	border : 1pt solid black ;
	margin : 5pt ; 
	padding : 10pt ;
}
div.logko a{
	text-decoration : underline ;
	color : red ;
	background-color : yellow ;
	padding : 5 pt ;
}
<span class="nt">&lt;/style&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="c">&lt;!-- appel des templates qui vont chercher dans les datas (les logs) --&gt;</span> 
<span class="nt">&lt;xsl:apply-templates</span> <span class="na">select=</span><span class="s">"/xsl:stylesheet/data:data"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
<span class="nt">&lt;/xsl:template&gt;</span>


<span class="nt">&lt;xsl:template</span> <span class="na">match=</span><span class="s">"/xsl:stylesheet/data:data"</span><span class="nt">&gt;</span>
<span class="c">&lt;!--
    Ce premier appel de template va définir le layout de l état de l enregistrement
    1 row = un log d exécution
--&gt;</span>

<span class="nt">&lt;xsl:if</span> <span class="na">test=</span><span class="s">"count(row) = 0"</span><span class="nt">&gt;</span> 
<span class="nt">&lt;a&gt;</span>Aucun traitement<span class="nt">&lt;/a&gt;</span> 
<span class="nt">&lt;/xsl:if&gt;</span>

<span class="c">&lt;!-- JOBS EN COURS
     j ai défini dans mon script
     que les jobs en cours ont un exit 321321
--&gt;</span>
<span class="nt">&lt;xsl:for-each</span> <span class="na">select=</span><span class="s">"row[exit = 321321]"</span><span class="nt">&gt;</span>
<span class="c">&lt;!-- le modulo est juste là pour faire une couleur un peu différente 
     si plusieurs enregistrements de même type sont à la suite --&gt;</span>
<span class="nt">&lt;xsl:choose&gt;</span>
<span class="nt">&lt;xsl:when</span> <span class="na">test=</span><span class="s">"position() mod 2 = 0"</span> <span class="nt">&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"encours1"</span><span class="nt">&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"in"</span><span class="nt">&gt;</span>
<span class="c">&lt;!-- appel du template pour le contenu du log --&gt;</span>
<span class="nt">&lt;xsl:call-template</span> <span class="na">name=</span><span class="s">"rapport"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/xsl:when&gt;</span>
<span class="nt">&lt;xsl:otherwise&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"encours2"</span><span class="nt">&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"in"</span><span class="nt">&gt;</span>
<span class="c">&lt;!-- appel du template pour le contenu du log --&gt;</span>
<span class="nt">&lt;xsl:call-template</span> <span class="na">name=</span><span class="s">"rapport"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/xsl:otherwise&gt;</span>
<span class="nt">&lt;/xsl:choose&gt;</span>
<span class="nt">&lt;/xsl:for-each&gt;</span> <span class="c">&lt;!-- fin des row EN COURS --&gt;</span>


<span class="c">&lt;!-- JOB EN ERREUR --&gt;</span>
<span class="nt">&lt;xsl:for-each</span> <span class="na">select=</span><span class="s">"row[exit != 0 and exit != 321321]"</span><span class="nt">&gt;</span>

<span class="nt">&lt;xsl:choose&gt;</span>
<span class="nt">&lt;xsl:when</span> <span class="na">test=</span><span class="s">"position() mod 2 = 0"</span> <span class="nt">&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"erreur1"</span><span class="nt">&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"in"</span><span class="nt">&gt;</span>
<span class="nt">&lt;xsl:call-template</span> <span class="na">name=</span><span class="s">"rapport"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/xsl:when&gt;</span>
<span class="nt">&lt;xsl:otherwise&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"erreur2"</span><span class="nt">&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"in"</span><span class="nt">&gt;</span>
<span class="nt">&lt;xsl:call-template</span> <span class="na">name=</span><span class="s">"rapport"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/xsl:otherwise&gt;</span>
<span class="nt">&lt;/xsl:choose&gt;</span>
<span class="nt">&lt;/xsl:for-each&gt;</span> <span class="c">&lt;!-- fin des row EN ERREUR --&gt;</span>

<span class="c">&lt;!-- JOB TERMINES --&gt;</span>
<span class="nt">&lt;xsl:for-each</span> <span class="na">select=</span><span class="s">"row[exit = 0]"</span><span class="nt">&gt;</span>

<span class="nt">&lt;xsl:choose&gt;</span>
<span class="nt">&lt;xsl:when</span> <span class="na">test=</span><span class="s">"position() mod 2 = 0"</span> <span class="nt">&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"pair"</span><span class="nt">&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"in"</span><span class="nt">&gt;</span>
<span class="nt">&lt;xsl:call-template</span> <span class="na">name=</span><span class="s">"rapport"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/xsl:when&gt;</span>
<span class="nt">&lt;xsl:otherwise&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"impair"</span><span class="nt">&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"in"</span><span class="nt">&gt;</span>
<span class="nt">&lt;xsl:call-template</span> <span class="na">name=</span><span class="s">"rapport"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/xsl:otherwise&gt;</span>
<span class="nt">&lt;/xsl:choose&gt;</span>
<span class="nt">&lt;/xsl:for-each&gt;</span> <span class="c">&lt;!-- fin des row TERMINES --&gt;</span>

<span class="nt">&lt;/xsl:template&gt;</span> <span class="c">&lt;!-- fin du template des datas --&gt;</span>

<span class="c">&lt;!-- appel du template pour le contenu du log --&gt;</span>
<span class="nt">&lt;xsl:template</span> <span class="na">name=</span><span class="s">"rapport"</span><span class="nt">&gt;</span>
<span class="nt">&lt;h1&gt;&lt;a&gt;</span>Application : <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"app"</span> <span class="nt">/&gt;&lt;/a&gt;&lt;/h1&gt;</span>
<span class="nt">&lt;h2&gt;&lt;a&gt;</span>Traitement : <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"job"</span> <span class="nt">/&gt;&lt;/a&gt;&lt;/h2&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"logok"</span><span class="nt">&gt;</span>
<span class="nt">&lt;a&gt;</span>Log d execution : sortie standard : <span class="nt">&lt;/a&gt;&lt;br</span> <span class="nt">/&gt;</span>
<span class="ni">&amp;lt;</span>pre<span class="ni">&amp;gt;</span>
<span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"logok"</span> <span class="nt">/&gt;</span>
<span class="ni">&amp;lt;</span>/pre<span class="ni">&amp;gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"logko"</span><span class="nt">&gt;</span>
<span class="nt">&lt;a&gt;</span>Log d execution : sortie en erreur : <span class="nt">&lt;/a&gt;&lt;br</span> <span class="nt">/&gt;</span>
<span class="ni">&amp;lt;</span>pre<span class="ni">&amp;gt;</span>
<span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"logko"</span> <span class="nt">/&gt;</span>
<span class="ni">&amp;lt;</span>/pre<span class="ni">&amp;gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/xsl:template&gt;</span> <span class="c">&lt;!-- fin du template rapport --&gt;</span>

<span class="c">&lt;!-- les datas, les logs d'exécutions 
     1 row = 1 enregistrement
     1 enregistrement = nom de l'application et job, le n°exit
                        les logs d'exécution
--&gt;</span>
<span class="nt">&lt;data:data&gt;</span>
	<span class="nt">&lt;row&gt;</span>
		<span class="nt">&lt;app&gt;</span>
		 APPLICATION_1
		<span class="nt">&lt;/app&gt;</span>
		<span class="nt">&lt;job&gt;</span>
		 TRAITEMENT_1
		<span class="nt">&lt;/job&gt;</span>
		<span class="nt">&lt;exit&gt;</span>
		0
		<span class="nt">&lt;/exit&gt;</span>
		<span class="nt">&lt;logok&gt;</span>
_______________________________________________________________________
Contexte Visual TOM du traitement
 
Machine             : machine-la01
Utilisateur         : root
Script              : /path/monscript.sh
Shell               : /bin/ksh
Serveur Visual TOM  : serveur-vtom
 
Traitement          : TRAITEMENT_1
Application         : APPLICATION_1
Environnement       : ENVIRONNEMENT_A
Job ID              : 3348
Nombre de relances  : 0
Label de reprise    : 0
Mode Execution      : NORMAL
Date d'exploitation : DATE_PROD
Valeur de la date   : 31/08/2012
_______________________________________________________________________
vendredi 31/08/2012 - 04:29:58
 Debut de l'execution du script ...
_______________________________________________________________________
  
  LUKE aime LEIA sortie standard
_______________________________________________________________________
vendredi 31/08/2012 - 04:30:59
Fin de l'execution du script.
 
--<span class="ni">&amp;gt;</span> Exit [0] donc acquitement
		<span class="nt">&lt;/logok&gt;</span>
		<span class="nt">&lt;logko&gt;</span>
		<span class="nt">&lt;/logko&gt;</span>
	<span class="nt">&lt;/row&gt;</span>
	<span class="nt">&lt;row&gt;</span>
		<span class="nt">&lt;app&gt;</span>
		 APPLICATION_1
		<span class="nt">&lt;/app&gt;</span>
		<span class="nt">&lt;job&gt;</span>
		 TRAITEMENT_2
		<span class="nt">&lt;/job&gt;</span>
		<span class="nt">&lt;exit&gt;</span>
		123
		<span class="nt">&lt;/exit&gt;</span>
		<span class="nt">&lt;logok&gt;</span>
_______________________________________________________________________
Contexte Visual TOM du traitement
 
Machine             : machine-la01
Utilisateur         : root
Script              : /path/monscript.sh
Shell               : /bin/ksh
Serveur Visual TOM  : serveur-vtom
 
Traitement          : TRAITEMENT_2
Application         : APPLICATION_1
Environnement       : ENVIRONNEMENT_A
Job ID              : 3349
Nombre de relances  : 0
Label de reprise    : 0
Mode Execution      : NORMAL
Date d'exploitation : DATE_PROD
Valeur de la date   : 31/08/2012
_______________________________________________________________________
vendredi 31/08/2012 - 04:29:58
 Debut de l'execution du script ...
_______________________________________________________________________
  
  LUKE aime LEIA sortie standard
_______________________________________________________________________
vendredi 31/08/2012 - 04:30:59
Fin de l'execution du script.
 
--<span class="ni">&amp;gt;</span> Exit [123] donc acquitement
		<span class="nt">&lt;/logok&gt;</span>
		<span class="nt">&lt;logko&gt;</span>
		JE SUIS TON PERE sortie erreur
		<span class="nt">&lt;/logko&gt;</span>
	<span class="nt">&lt;/row&gt;</span>
	<span class="nt">&lt;row&gt;</span>
		<span class="nt">&lt;app&gt;</span>
		 APPLICATION_1
		<span class="nt">&lt;/app&gt;</span>
		<span class="nt">&lt;job&gt;</span>
		 TRAITEMENT_3
		<span class="nt">&lt;/job&gt;</span>
		<span class="nt">&lt;exit&gt;</span>
		321321
		<span class="nt">&lt;/exit&gt;</span>
		<span class="nt">&lt;logok&gt;</span>
_______________________________________________________________________
Contexte Visual TOM du traitement
 
Machine             : machine-la01
Utilisateur         : root
Script              : /path/monscript.sh
Shell               : /bin/ksh
Serveur Visual TOM  : serveur-vtom
 
Traitement          : TRAITEMENT_3
Application         : APPLICATION_1
Environnement       : ENVIRONNEMENT_A
Job ID              : 3350
Nombre de relances  : 0
Label de reprise    : 0
Mode Execution      : NORMAL
Date d'exploitation : DATE_PROD
Valeur de la date   : 31/08/2012
_______________________________________________________________________
vendredi 31/08/2012 - 04:29:58
 Debut de l'execution du script ...
_______________________________________________________________________
  
  LUKE aime ...
		<span class="nt">&lt;/logok&gt;</span>
		<span class="nt">&lt;logko&gt;</span>
		<span class="nt">&lt;/logko&gt;</span>
	<span class="nt">&lt;/row&gt;</span>
<span class="nt">&lt;/data:data&gt;</span> <span class="c">&lt;!-- fin des datas --&gt;</span>
<span class="nt">&lt;/xsl:stylesheet&gt;</span> <span class="c">&lt;!-- fin du fichier xml --&gt;</span>
</code></pre></div></div>

<p>Pour aller plus loin dans l’explication du XML, c’est en réalité un xml qui fait appel à une feuille de style XSL, non pas extérieure mais dans le XML, grâce à son ID.</p>

<p>De plus la feuille de style xsl:stylesheet intègre directement les données. Il suffit de définir le namespace dans la déclaration du xsl:stylesheet.</p>

<p>Appel de la feuille de style xsl:stylesheet dans le fichier xml :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;?xml-stylesheet href="#stylesheet" type="text/xsl"?&gt;
</code></pre></div></div>

<p>vers le href #stylesheet =&gt; id=stylesheet</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;xsl:stylesheet version="2.0" id="stylesheet"  xmlns:data="localhost" 
xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;
</code></pre></div></div>

<p>Déclaration normale pour les balises de transformation xsl</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
</code></pre></div></div>

<p>Déclaration de ma balise perso.
Cela va permettre de faire mes balises du type <data:data> où je vais stocker mes données.</data:data></p>

<p>Les templates vont matcher à partir de cette arborescence.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>xmlns:data="localhost"
</code></pre></div></div>

<p>Passons maintenant au script shell exécuté sur chaque machine dont vous voulez récupérer les logs.</p>

<p>Voici le script <a target="_blank" href="https://virtual-thom.github.io/archives/wp-content/uploads/generexml.sh_.txt" title="generexml.sh">generexml.sh</a></p>

<p>Je me base sur la structure du nom des logs d’exécution VTOM. Il y aura surement quelques adaptations à effectuer chez vous.</p>

<p>Attention, je ne test pas la volumétrie des logs.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/sh</span>
<span class="c">#</span>
<span class="c">#       AUTEUR : Virtual Thom</span>
<span class="c">#       VERSION : 1.0</span>
<span class="c">#       DATE : 20/05/2011</span>
<span class="c">#</span>
<span class="c"># set -n   # Decommenter pour debug syntax sans execution</span>
<span class="c">#       NOTE: Ne pas oublier de recommenter !</span>
<span class="c"># set -x   # Decommenter pour debug</span>
<span class="c">#</span>
<span class="c">##########################################################</span>
<span class="c">#       SCRIPT</span>
<span class="c">##########################################################</span>
usage<span class="o">(){</span>
	<span class="c"># exemple d'usage</span>
	<span class="nv">script</span><span class="o">=</span><span class="k">${</span><span class="nv">0</span><span class="p">##*/</span><span class="k">}</span> <span class="p">;</span>
	<span class="c">#script=${script%.*} ;</span>
	<span class="nb">echo</span> <span class="s2">""</span> <span class="p">;</span>
	<span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">script</span><span class="k">}</span><span class="s2"> - permet de recuperer des logs d'execution et de les mettre en forme"</span> <span class="p">;</span>
	<span class="nb">echo</span> <span class="s2">""</span>
	<span class="nb">echo</span> <span class="s2">"Usage :"</span> <span class="p">;</span>
	<span class="nb">echo</span> <span class="s2">"    </span><span class="k">${</span><span class="nv">script</span><span class="k">}</span><span class="s2"> machine environnement tempsenseconde"</span> <span class="p">;</span>
	<span class="nb">echo</span> <span class="s2">"1er parametre  : nom de la machine"</span> <span class="p">;</span>
	<span class="nb">echo</span> <span class="s2">"2eme parametre : filtre pour la recuperation des logs, peut etre l'environnement par exemple"</span> <span class="p">;</span>
	<span class="nb">echo</span> <span class="s2">"3eme parametre : temps en secondes depuis l'execution du script jusqu'au temps de recuperation"</span>  <span class="p">;</span>
	<span class="nb">echo</span> <span class="s2">""</span> <span class="p">;</span>
	<span class="nb">exit </span>123 <span class="p">;</span>
<span class="o">}</span>
<span class="k">if </span><span class="nb">test</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"--help"</span> <span class="nt">-o</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"-help"</span> <span class="nt">-o</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"-h"</span> <span class="nt">-o</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>
<span class="k">then
	</span>usage	
<span class="k">fi
</span><span class="nv">machine</span><span class="o">=</span><span class="k">${</span><span class="nv">1</span><span class="k">}</span> <span class="c">#Par defaut machine</span>
<span class="nv">environnement</span><span class="o">=</span><span class="k">${</span><span class="nv">2</span><span class="k">:-</span><span class="nv">PROD</span><span class="k">}</span> <span class="c">#Par defaut PROD</span>
<span class="nv">retour_tps</span><span class="o">=</span><span class="k">${</span><span class="nv">3</span><span class="k">:-</span><span class="nv">86400</span><span class="k">}</span>	<span class="c">#Par defaut 86400 s soit 24h</span>

<span class="nv">LOGS_REP</span><span class="o">=</span><span class="k">${</span><span class="nv">TOM_LOG_DIR</span><span class="k">:-</span><span class="p">/opt/vtom/logs/</span><span class="k">}</span>
<span class="nv">LOGS_SCRIPTS</span><span class="o">=</span>/opt/vtom/scripts/
<span class="nv">INFILE</span><span class="o">=</span>/opt/vtom/scripts/infile
<span class="nv">OUTFILE</span><span class="o">=</span>/opt/vtom/scripts/outfile
<span class="nv">XML</span><span class="o">=</span>/opt/vtom/scripts/<span class="k">${</span><span class="nv">machine</span><span class="k">}</span>_<span class="k">${</span><span class="nv">environnement</span><span class="k">}</span>.xml
<span class="nv">thisday</span><span class="o">=</span><span class="sb">`</span><span class="nb">date</span> +%s<span class="sb">`</span>	<span class="c">#date du jour en timestamp</span>
<span class="nv">dayminusday</span><span class="o">=</span><span class="sb">`</span><span class="nb">expr</span> <span class="nv">$thisday</span> - <span class="k">${</span><span class="nv">retour_tps</span><span class="k">}</span><span class="sb">`</span>	<span class="c">#calcul date du jour - 24h (en s) en timestamp</span>

<span class="o">&gt;</span> <span class="nv">$OUTFILE</span>
<span class="nb">ls</span> <span class="k">${</span><span class="nv">LOGS_REP</span><span class="k">}</span> | <span class="nb">grep</span> <span class="s2">"</span><span class="k">${</span><span class="nv">environnement</span><span class="k">}</span><span class="s2">.*.o"</span> | <span class="nb">sort</span> <span class="o">&gt;</span> <span class="nv">$INFILE</span>	<span class="c">#liste des logs</span>
<span class="c">#chargement de l entete xml xsl</span>
<span class="nv">entete</span><span class="o">=</span><span class="s1">'&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;\n
&lt;?xml-stylesheet href="#stylesheet" type="text/xsl"?&gt;\n
\n
&lt;!DOCTYPE xsl:stylesheet [\n
&lt;!ATTLIST xsl:stylesheetn
id	ID	#REQUIRED&gt;\n
]&gt;\n
\n
&lt;!-- balises de transformation xsl --&gt;\n
&lt;xsl:stylesheet version="2.0" id="stylesheet"  xmlns:data="localhost" \n
xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;\n
&lt;xsl:output method="html" indent="yes"/&gt;\n
\n
&lt;!-- définition du template principal avec le rendu html --&gt;\n
&lt;xsl:template match="/"&gt;\n
&lt;html&gt;\n
&lt;head&gt;\n
&lt;title&gt;Rapport log d execution job VTOM&lt;/title&gt;\n
&lt;style type="text/css"&gt;\n
h1 a {\n
	background-color : #339933 ;\n
	border : 1pt solid black ;\n
	margin : 0 0 0 10pt ; \n
	padding : 2pt ;\n
}\n
h2 a {\n
	background-color : #33FF66 ;\n
	border : 1pt solid black ;\n
	margin : 0 0 0 20pt ;\n
	padding : 2pt ;\n
}\n
div.in{	\n
	border: inset 5pt green;\n
}\n
div.pair{\n
	border: outset 5pt green; \n
    border-collapse: separate;\n
    border-spacing: 5pt ;\n
	margin : 0 0 10pt 0 ;\n
	background-color: #33FF66 ;\n
}\n
div.impair{\n
	border: outset 5pt green; \n
    border-collapse: separate;\n
    border-spacing: 5pt ;\n
	margin : 0 0 10pt 0 ;\n
	background-color: #339933 ;\n
}\n
div.erreur1{\n
	border: outset 5pt red; \n
    border-collapse: separate;\n
    border-spacing: 5pt ;\n
	margin : 0 0 10pt 0 ;\n
	background-color: brown ;\n
}\n
div.erreur2{\n
	border: outset 5pt red; \n
    border-collapse: separate;\n
    border-spacing: 5pt ;\n
	margin : 0 0 10pt 0 ;\n
	background-color: coral ;\n
}\n
div.encours1{\n
	border: outset 5pt aqua; \n
    border-collapse: separate;\n
    border-spacing: 5pt ;\n
	margin : 0 0 10pt 0 ;\n
	background-color: blue ;\n
}\n
div.encours2{\n
	border: outset 5pt aqua; \n
    border-collapse: separate;\n
    border-spacing: 5pt ;\n
	margin : 0 0 10pt 0 ;\n
	background-color: aqua ;\n
}\n
div.logok{\n
	border : 1pt solid black ;\n
	margin : 5pt ; \n
	padding : 10pt ;\n
}\n
div.logok a{\n
	font : 12pt ;\n
	color : lawngreen ;\n
	text-decoration : underline ;\n
	background-color : darkgreen ;\n
	padding : 5 pt ;\n
}\n
div.logko {\n
	border : 1pt solid black ;\n
	margin : 5pt ; \n
	padding : 10pt ;\n
}\n
div.logko a{\n
	text-decoration : underline ;\n
	color : red ;\n
	background-color : yellow ;\n
	padding : 5 pt ;\n
}\n
&lt;/style&gt;\n
&lt;/head&gt;\n
&lt;body&gt;\n
&lt;!-- appel des templates qui vont chercher dans les datas (les logs) --&gt; \n
&lt;xsl:apply-templates select="/xsl:stylesheet/data:data" /&gt;\n
&lt;/body&gt;\n
&lt;/html&gt;\n
&lt;/xsl:template&gt;\n
\n
\n
&lt;xsl:template match="/xsl:stylesheet/data:data"&gt;\n
&lt;!--\n
    Ce premier appel de template va définir le layout de l état de l enregistrement
    1 row = un log d exécutionn
--&gt;\n
\n
&lt;xsl:if test="count(row) = 0"&gt; \n
&lt;a&gt;Aucun traitement&lt;/a&gt; \n
&lt;/xsl:if&gt;\n
\n
&lt;!-- JOBS EN COURSn
     j ai défini dans mon scriptn
     que les jobs en cours ont un exit 321321n
--&gt;\n
&lt;xsl:for-each select="row[exit = 321321]"&gt;\n
&lt;!-- le modulo est juste là pour faire une couleur un peu différente \n
     si plusieurs enregistrements de même type sont à la suite --&gt;\n
&lt;xsl:choose&gt;\n
&lt;xsl:when test="position() mod 2 = 0" &gt;\n
&lt;div class="encours1"&gt;\n
&lt;div class="in"&gt;\n
&lt;!-- appel du template pour le contenu du log --&gt;\n
&lt;xsl:call-template name="rapport" /&gt;\n
&lt;/div&gt;\n
&lt;/div&gt;\n
&lt;/xsl:when&gt;\n
&lt;xsl:otherwise&gt;\n
&lt;div class="encours2"&gt;\n
&lt;div class="in"&gt;\n
&lt;!-- appel du template pour le contenu du log --&gt;\n
&lt;xsl:call-template name="rapport" /&gt;\n
&lt;/div&gt;\n
&lt;/div&gt;\n
&lt;/xsl:otherwise&gt;\n
&lt;/xsl:choose&gt;\n
&lt;/xsl:for-each&gt; &lt;!-- fin des row EN COURS --&gt;\n
\n
\n
&lt;!-- JOB EN ERREUR --&gt;\n
&lt;xsl:for-each select="row[exit != 0 and exit != 321321]"&gt;\n
\n
&lt;xsl:choose&gt;\n
&lt;xsl:when test="position() mod 2 = 0" &gt;\n
&lt;div class="erreur1"&gt;\n
&lt;div class="in"&gt;\n
&lt;xsl:call-template name="rapport" /&gt;\n
&lt;/div&gt;\n
&lt;/div&gt;\n
&lt;/xsl:when&gt;\n
&lt;xsl:otherwise&gt;\n
&lt;div class="erreur2"&gt;\n
&lt;div class="in"&gt;\n
&lt;xsl:call-template name="rapport" /&gt;\n
&lt;/div&gt;\n
&lt;/div&gt;\n
&lt;/xsl:otherwise&gt;\n
&lt;/xsl:choose&gt;\n
&lt;/xsl:for-each&gt; &lt;!-- fin des row EN ERREUR --&gt;\n
\n
&lt;!-- JOB TERMINES --&gt;\n
&lt;xsl:for-each select="row[exit = 0]"&gt;\n
\n
&lt;xsl:choose&gt;\n
&lt;xsl:when test="position() mod 2 = 0" &gt;\n
&lt;div class="pair"&gt;\n
&lt;div class="in"&gt;\n
&lt;xsl:call-template name="rapport" /&gt;\n
&lt;/div&gt;\n
&lt;/div&gt;\n
&lt;/xsl:when&gt;\n
&lt;xsl:otherwise&gt;\n
&lt;div class="impair"&gt;\n
&lt;div class="in"&gt;\n
&lt;xsl:call-template name="rapport" /&gt;\n
&lt;/div&gt;\n
&lt;/div&gt;\n
&lt;/xsl:otherwise&gt;\n
&lt;/xsl:choose&gt;\n
&lt;/xsl:for-each&gt; &lt;!-- fin des row TERMINES --&gt;\n
\n
&lt;/xsl:template&gt; &lt;!-- fin du template des datas --&gt;\n
\n
&lt;!-- appel du template pour le contenu du log --&gt;\n
&lt;xsl:template name="rapport"&gt;\n
&lt;h1&gt;&lt;a&gt;Application : &lt;xsl:value-of select="app" /&gt;&lt;/a&gt;&lt;/h1&gt;\n
&lt;h2&gt;&lt;a&gt;Traitement : &lt;xsl:value-of select="job" /&gt;&lt;/a&gt;&lt;/h2&gt;\n
&lt;div class="logok"&gt;\n
&lt;a&gt;Log d execution : sortie standard : &lt;/a&gt;&lt;br /&gt;\n
&amp;lt;pre&amp;gt;\n
&lt;xsl:value-of select="logok" /&gt;\n
&amp;lt;/pre&amp;gt;\n
&lt;/div&gt;\n
&lt;div class="logko"&gt;\n
&lt;a&gt;Log d execution : sortie en erreur : &lt;/a&gt;&lt;br /&gt;\n
&amp;lt;pre&amp;gt;\n
&lt;xsl:value-of select="logko" /&gt;\n
&amp;lt;/pre&amp;gt;\n
&lt;/div&gt;\n
&lt;/xsl:template&gt; &lt;!-- fin du template rapport --&gt;\n
'</span>
<span class="nb">echo</span> <span class="nt">-e</span> <span class="nv">$entete</span> <span class="o">&gt;</span> <span class="nv">$XML</span>

<span class="nb">echo</span> <span class="s2">"&lt;data:data&gt;"</span> <span class="o">&gt;&gt;</span> <span class="nv">$XML</span>	<span class="c">#arbre xslt : /stylesheet/data:data/row</span>

<span class="k">for </span>LIGNE <span class="k">in</span> <span class="si">$(</span><span class="nb">cat</span> <span class="nv">$INFILE</span><span class="si">)</span>
<span class="k">do	
	</span><span class="nv">nom_exec</span><span class="o">=</span><span class="k">${</span><span class="nv">LIGNE</span><span class="p">%.*</span><span class="k">}</span>
	<span class="nv">nom_traitement</span><span class="o">=</span><span class="k">${</span><span class="nv">LIGNE</span><span class="p">%.*</span><span class="k">}</span>	<span class="c">#recuperation nom du fichier sans extension chaine la plus courte a droite du . suivi de n caracteres</span>
	<span class="nv">nom_traitement</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="nv">$nom_traitement</span> | <span class="nb">sed</span> <span class="s1">'s/_[0-9][0-9][0-9][0-9][0-9][0-9]-[0-9][0-9][0-9][0-9][0-9][0-9]$//'</span><span class="sb">`</span> <span class="c">#suppression de la date et heure exemple de sed</span>
	<span class="nv">date_exec</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="nv">$LIGNE</span> | <span class="nb">awk</span> <span class="nt">-F</span> <span class="s2">"_"</span> <span class="s1">'{print $NF}'</span> | <span class="nb">awk</span> <span class="nt">-F</span> <span class="s2">"."</span> <span class="s1">'{print $1}'</span> | <span class="nb">awk</span> <span class="nt">-F</span> <span class="s2">"-"</span> <span class="s1">'{print $1}'</span><span class="sb">`</span>	<span class="c">#je laisse un exemple avec awk -F est le delemiter $NF le dernier argument</span>
	<span class="nv">heure_exec</span><span class="o">=</span><span class="k">${</span><span class="nv">nom_exec</span><span class="p">##*-</span><span class="k">}</span>	<span class="c">#chaine la plus longue a gauche de - suivi de n caracteres</span>
	<span class="nv">heure_exec</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="nv">$heure_exec</span> | <span class="nb">sed</span> <span class="s1">'s/^[0-9][0-9]/&amp;:/'</span> | <span class="nb">sed</span> <span class="s1">'s/[0-9][0-9]$/:&amp;/'</span><span class="sb">`</span>	<span class="c">#trick pour rajouter : entre heures et minutes avec sed</span>
	<span class="nv">date_traitement</span><span class="o">=</span><span class="sb">`</span><span class="nb">date</span> <span class="nt">--date</span><span class="o">=</span><span class="s2">"</span><span class="nv">$date_exec</span><span class="s2"> </span><span class="nv">$heure_exec</span><span class="s2">"</span> +<span class="s2">"%d/%m/%y %H:%M:%S"</span><span class="sb">`</span> <span class="c">#interpretation de la date par --date et remise en format classique</span>
	<span class="nv">date_exec</span><span class="o">=</span><span class="sb">`</span><span class="nb">date</span> <span class="nt">--date</span><span class="o">=</span><span class="s2">"</span><span class="nv">$date_exec</span><span class="s2"> </span><span class="nv">$heure_exec</span><span class="s2">"</span> +%s<span class="sb">`</span>	<span class="c">#timestamp pour tester avec le timestamp minimum requis</span>
	
	<span class="k">if </span><span class="nb">test</span> <span class="s2">"</span><span class="nv">$date_exec</span><span class="s2">"</span> <span class="o">&gt;</span> <span class="s2">"</span><span class="nv">$dayminusday</span><span class="s2">"</span> <span class="nt">-a</span> <span class="nv">$LIGNE</span> <span class="o">!=</span> <span class="s2">""</span>
	<span class="k">then
		</span><span class="nb">echo</span> <span class="s2">"	&lt;row&gt;"</span> <span class="o">&gt;&gt;</span> <span class="nv">$XML</span>
		<span class="nb">echo</span> <span class="s2">"		&lt;app&gt;"</span> <span class="o">&gt;&gt;</span> <span class="nv">$XML</span>
		<span class="nv">app</span><span class="o">=</span><span class="sb">`</span><span class="nb">head</span> <span class="nt">-n</span> 20 <span class="s2">"</span><span class="nv">$LOGS_REP$LIGNE</span><span class="s2">"</span> | <span class="nb">grep</span> <span class="s2">"Application"</span> | <span class="nb">awk</span> <span class="nt">-F</span> <span class="s2">":"</span> <span class="s1">'{print $2}'</span><span class="sb">`</span>	<span class="c">#head comme tail mais en partant du debut recuperation du nom application dans les logs</span>
		<span class="nb">echo</span> <span class="s2">"		</span><span class="nv">$app</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> <span class="nv">$XML</span>
		<span class="nb">echo</span> <span class="s2">"		&lt;/app&gt;"</span> <span class="o">&gt;&gt;</span> <span class="nv">$XML</span>
					
		<span class="nb">echo</span> <span class="s2">"		&lt;job&gt;"</span> <span class="o">&gt;&gt;</span> <span class="nv">$XML</span>
		<span class="nv">job</span><span class="o">=</span><span class="sb">`</span><span class="nb">head</span> <span class="nt">-n</span> 20 <span class="s2">"</span><span class="nv">$LOGS_REP$LIGNE</span><span class="s2">"</span> | <span class="nb">grep</span> <span class="s2">"Traitement"</span> | <span class="nb">awk</span> <span class="nt">-F</span> <span class="s2">":"</span> <span class="s1">'{print $2}'</span><span class="sb">`</span>	<span class="c">#recuperation du nom traitement dans les logs</span>
		<span class="nb">echo</span> <span class="s2">"		</span><span class="nv">$job</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> <span class="nv">$XML</span>
		<span class="nb">echo</span> <span class="s2">"		&lt;/job&gt;"</span> <span class="o">&gt;&gt;</span> <span class="nv">$XML</span>
						
		<span class="nb">echo</span> <span class="s2">"		&lt;exit&gt;"</span> <span class="o">&gt;&gt;</span> <span class="nv">$XML</span>
		<span class="nv">num_exit</span><span class="o">=</span><span class="sb">`</span><span class="nb">tail</span> <span class="nt">-n</span> 5 <span class="s2">"</span><span class="nv">$LOGS_REP$LIGNE</span><span class="s2">"</span> | <span class="nb">grep</span> <span class="s2">"Exit"</span> | <span class="nb">awk</span> <span class="nt">-F</span> <span class="s2">"["</span> <span class="s1">'{print $2}'</span> | <span class="nb">awk</span> <span class="nt">-F</span> <span class="s2">"]"</span> <span class="s1">'{print $1}'</span><span class="sb">`</span>	<span class="c">#recuperation du numero exit dans les logs</span>
		<span class="k">if </span><span class="nb">test</span> <span class="s2">"</span><span class="k">${</span><span class="nv">num_exit</span><span class="k">}</span><span class="s2">"</span> <span class="o">!=</span> <span class="s2">""</span>
		<span class="k">then
			</span><span class="nb">echo</span> <span class="s2">"		</span><span class="nv">$num_exit</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> <span class="nv">$XML</span>
		<span class="k">else
			</span><span class="nb">echo</span> <span class="s2">"		321321"</span> <span class="o">&gt;&gt;</span> <span class="nv">$XML</span>
		<span class="k">fi
		</span><span class="nb">echo</span> <span class="s2">"		&lt;/exit&gt;"</span> <span class="o">&gt;&gt;</span> <span class="nv">$XML</span>
		
		<span class="nb">echo</span> <span class="s2">"		&lt;logok&gt;"</span> <span class="o">&gt;&gt;</span> <span class="nv">$XML</span>
		<span class="c">#cat ${LOGS_REP}$LIGNE    |  sed  's#&lt;#&amp;lt;#g' | sed 's#&gt;#&amp;gt;#g' | sed 's#&amp;#&amp;amp;#g' &gt;&gt; $XML	#sed remplace les &lt; et les &gt; par les notations xml pour ces caracteres speciaux</span>
		<span class="nb">cat</span> <span class="k">${</span><span class="nv">LOGS_REP</span><span class="k">}</span><span class="nv">$LIGNE</span>  | <span class="nb">sed</span> <span class="s1">'s#&amp;#&amp;amp;#g'</span>  |  <span class="nb">sed</span>  <span class="s1">'s#&lt;#&amp;lt;#g'</span> | <span class="nb">sed</span> <span class="s1">'s#&gt;#&amp;gt;#g'</span>  <span class="o">&gt;&gt;</span> <span class="nv">$XML</span>
		<span class="nb">echo</span> <span class="s2">"		&lt;/logok&gt;"</span> <span class="o">&gt;&gt;</span> <span class="nv">$XML</span>
		<span class="nv">logko</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="nv">$LIGNE</span> | <span class="nb">sed</span> <span class="s1">'s/.o$/.e/'</span><span class="sb">`</span>	<span class="c">#exemple de sed j aurai pu mettre ${nom_exec}.e</span>
		<span class="nb">echo</span> <span class="s2">"		&lt;logko&gt;"</span> <span class="o">&gt;&gt;</span> <span class="nv">$XML</span>
		<span class="nb">cat</span> <span class="k">${</span><span class="nv">LOGS_REP</span><span class="k">}</span><span class="nv">$logko</span>  | <span class="nb">sed</span> <span class="s1">'s#&amp;#&amp;amp;#g'</span>  |  <span class="nb">sed</span>  <span class="s1">'s#&lt;#&amp;lt;#g'</span> | <span class="nb">sed</span> <span class="s1">'s#&gt;#&amp;gt;#g'</span>  <span class="o">&gt;&gt;</span> <span class="nv">$XML</span>
		<span class="nb">echo</span> <span class="s2">"		&lt;/logko&gt;"</span> <span class="o">&gt;&gt;</span> <span class="nv">$XML</span>
		<span class="nb">echo</span> <span class="s2">"	&lt;/row&gt;"</span> <span class="o">&gt;&gt;</span> <span class="nv">$XML</span>
		
	<span class="k">fi
done

</span><span class="nb">echo</span> <span class="s2">"&lt;/data:data&gt;"</span> <span class="o">&gt;&gt;</span> <span class="nv">$XML</span>
<span class="nb">echo</span> <span class="s2">"&lt;/xsl:stylesheet&gt;"</span> <span class="o">&gt;&gt;</span> <span class="nv">$XML</span>	<span class="c">#arbre xslt : /stylesheet/data:data/row</span>

<span class="nb">rm</span> <span class="nt">-f</span> <span class="nv">$INFILE</span>	<span class="c">#nettoyage fichiers temp</span>
<span class="nb">rm</span> <span class="nt">-f</span> <span class="nv">$OUTFILE</span>
</code></pre></div></div>

  </article>
  
<nav>
  <ul class="pager">
    
     
    <li class="previous">
      <a href="https://virtual-thom.github.io/archives/ecrire-sa-queue-batch-vtom-cygwin-php-perl/"><span aria-hidden="true">&larr;</span> Ecrire sa queue batch VTOM (cygwin, php, perl, sap)</a> 
    </li>
    
     
     <li class="next">
      <a class="next" href="https://virtual-thom.github.io/archives/cle-ssh-entre-windows-et-linux-cygwin/">Mise en place clé ssh entre windows et unix/linux avec Cygwin <span aria-hidden="true">&rarr;</span></a> 
    </li>
     
    
  </ul>
</nav>


  <footer class="post-footer">
    
      
        <a itemprop="articleSection" class="btn btn-default btn-xs btn-categories" href="https://virtual-thom.github.io/archives"><span class="glyphicon glyphicon-asterisk"></span>Cmd</a>
      
        <a itemprop="articleSection" class="btn btn-default btn-xs btn-categories" href="https://virtual-thom.github.io/archives"><span class="glyphicon glyphicon-asterisk"></span>compte rendu</a>
      
        <a itemprop="articleSection" class="btn btn-default btn-xs btn-categories" href="https://virtual-thom.github.io/archives"><span class="glyphicon glyphicon-asterisk"></span>log d'exécution</a>
      
        <a itemprop="articleSection" class="btn btn-default btn-xs btn-categories" href="https://virtual-thom.github.io/archives"><span class="glyphicon glyphicon-asterisk"></span>Ordonnancement</a>
      
        <a itemprop="articleSection" class="btn btn-default btn-xs btn-categories" href="https://virtual-thom.github.io/archives"><span class="glyphicon glyphicon-asterisk"></span>Script</a>
      
        <a itemprop="articleSection" class="btn btn-default btn-xs btn-categories" href="https://virtual-thom.github.io/archives"><span class="glyphicon glyphicon-asterisk"></span>shell</a>
      
        <a itemprop="articleSection" class="btn btn-default btn-xs btn-categories" href="https://virtual-thom.github.io/archives"><span class="glyphicon glyphicon-asterisk"></span>Visual TOM</a>
      
        <a itemprop="articleSection" class="btn btn-default btn-xs btn-categories" href="https://virtual-thom.github.io/archives"><span class="glyphicon glyphicon-asterisk"></span>VTOM</a>
      
        <a itemprop="articleSection" class="btn btn-default btn-xs btn-categories" href="https://virtual-thom.github.io/archives"><span class="glyphicon glyphicon-asterisk"></span>xml</a>
      
        <a itemprop="articleSection" class="btn btn-default btn-xs btn-categories" href="https://virtual-thom.github.io/archives"><span class="glyphicon glyphicon-asterisk"></span>XML</a>
      
        <a itemprop="articleSection" class="btn btn-default btn-xs btn-categories" href="https://virtual-thom.github.io/archives"><span class="glyphicon glyphicon-asterisk"></span>xsl</a>
      
        <a itemprop="articleSection" class="btn btn-default btn-xs btn-categories" href="https://virtual-thom.github.io/archives"><span class="glyphicon glyphicon-asterisk"></span>XSL</a>
      
        <a itemprop="articleSection" class="btn btn-default btn-xs btn-categories" href="https://virtual-thom.github.io/archives"><span class="glyphicon glyphicon-asterisk"></span>xslt</a>
      
        <a itemprop="articleSection" class="btn btn-default btn-xs btn-categories" href="https://virtual-thom.github.io/archives"><span class="glyphicon glyphicon-asterisk"></span>XSLT</a>
      
    
    <span  itemprop="author publisher" class="hidden">Virtual Thom</span>
  </footer>
  
  <div id="disqus_thread" ></div>
  <script>
      var disqus_shortname = atob('dGhvbWFzLWFzbmFy'); 
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
</div>

      <footer id="site-footer">
    <div>&copy;<a href="https://github.com/virtual-thom/" title="Github Virtual-Thom">Virtual-Thom</a></div>
    <div>
            <a href="https://virtual-thom.github.io/archives/plan" title="Plan du site">sitemap</a> | <a href="https://virtual-thom.github.io/about" rel="publisher author" title="Curriculum vitae Thom">A propos</a>
    </div>
    <div>
        <a id="goto-site-header" href="#site-header" title="Retourner au début">&uArr; Top</a>
    </div>
    <div id="footer-disclaimer">
        <p>Avertissement : vous ne devez pas prendre pour argent comptant le contenu de ce site. Testez toujours la solution en environnement de test.</p>
        <p>Malgré le sérieux que je m'efforce de mettre dans le contenu de ces billets, je ne pourrai être tenu responsable d'éventuelles erreurs que cela pourrait engendrer.</p>
    </div>
    <div>
        <a class="hidden" href="https://virtual-thom.github.io/archives/sitemap.xml" title="SiteMap">sitemap</a>
    </div>
</footer>

    </div>
  </body>

</html>