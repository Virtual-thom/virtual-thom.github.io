<!DOCTYPE html>
<html lang="fr">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="apple-touch-icon" href="https://virtual-thom.github.io/archives/apple-touch-icon.png">
  <link rel="icon" href="https://virtual-thom.github.io/archives/favicon.ico" />
  <!-- Remplacé par Jekyll SEO (sinon apparait en double)
  <title>Virtual-Thom | Blog-notes VTOM et informatique</title>
  <meta name="description" content="Blog-notes VTOM, informatique, industrialisation, ordonnancement, DevOps">
  --> 
  
  <link rel="canonical" href="https://virtual-thom.github.io/archives/page12/">
  
  <link rel="stylesheet" media="screen" href="https://virtual-thom.github.io/archives/assets/main.css">
  
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Page 12 of 14 for Virtual-Thom Blog-notes VTOM et informatique | Blog-notes VTOM, informatique, industrialisation, ordonnancement, DevOps</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Virtual-Thom Blog-notes VTOM et informatique" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Blog-notes VTOM, informatique, industrialisation, ordonnancement, DevOps" />
<meta property="og:description" content="Blog-notes VTOM, informatique, industrialisation, ordonnancement, DevOps" />
<link rel="canonical" href="https://virtual-thom.github.io/archives/page12/" />
<meta property="og:url" content="https://virtual-thom.github.io/archives/page12/" />
<meta property="og:site_name" content="Virtual-Thom Blog-notes VTOM et informatique" />
<meta property="og:type" content="website" />
<link rel="prev" href="https://virtual-thom.github.io/archives/page11" />
<link rel="next" href="https://virtual-thom.github.io/archives/page13" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Virtual-Thom Blog-notes VTOM et informatique" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Blog-notes VTOM, informatique, industrialisation, ordonnancement, DevOps","headline":"Virtual-Thom Blog-notes VTOM et informatique","url":"https://virtual-thom.github.io/archives/page12/"}</script>
<!-- End Jekyll SEO tag -->

  
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Z8Y7902GRV"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Z8Y7902GRV');
</script>


  <body>
    <div class="container">
      <header id="site-header">
  <h1>Blog-notes VTOM, informatique, industrialisation, ordonnancement, DevOps</h1>
  <nav>
    <ul>
      <li>
        <a href="https://virtual-thom.github.io/archives" title="Home">
          <svg class="svg-icon" viewBox="0 0 20 20">
            <path d="M18.121,9.88l-7.832-7.836c-0.155-0.158-0.428-0.155-0.584,0L1.842,9.913c-0.262,0.263-0.073,0.705,0.292,0.705h2.069v7.042c0,0.227,0.187,0.414,0.414,0.414h3.725c0.228,0,0.414-0.188,0.414-0.414v-3.313h2.483v3.313c0,0.227,0.187,0.414,0.413,0.414h3.726c0.229,0,0.414-0.188,0.414-0.414v-7.042h2.068h0.004C18.331,10.617,18.389,10.146,18.121,9.88 M14.963,17.245h-2.896v-3.313c0-0.229-0.186-0.415-0.414-0.415H8.342c-0.228,0-0.414,0.187-0.414,0.415v3.313H5.032v-6.628h9.931V17.245z M3.133,9.79l6.864-6.868l6.867,6.868H3.133z"></path>
          </svg>
        </a>
      </li>
      <li>
        <a href="https://virtual-thom.github.io/archives/vos-commentaires-livre-d-or/" title="Commentaires - livre d'or">
          <svg class="svg-icon" viewBox="0 0 20 20">
            <path d="M17.657,2.982H2.342c-0.234,0-0.425,0.191-0.425,0.426v10.21c0,0.234,0.191,0.426,0.425,0.426h3.404v2.553c0,0.397,0.48,0.547,0.725,0.302l2.889-2.854h8.298c0.234,0,0.426-0.191,0.426-0.426V3.408C18.083,3.174,17.892,2.982,17.657,2.982M17.232,13.192H9.185c-0.113,0-0.219,0.045-0.3,0.124l-2.289,2.262v-1.96c0-0.233-0.191-0.426-0.425-0.426H2.767V3.833h14.465V13.192z M10,7.237c-0.821,0-1.489,0.668-1.489,1.489c0,0.821,0.668,1.489,1.489,1.489c0.821,0,1.488-0.668,1.488-1.489C11.488,7.905,10.821,7.237,10,7.237 M10,9.364c-0.352,0-0.638-0.288-0.638-0.638c0-0.351,0.287-0.638,0.638-0.638c0.351,0,0.638,0.287,0.638,0.638C10.638,9.077,10.351,9.364,10,9.364 M14.254,7.237c-0.821,0-1.489,0.668-1.489,1.489c0,0.821,0.668,1.489,1.489,1.489s1.489-0.668,1.489-1.489C15.743,7.905,15.075,7.237,14.254,7.237 M14.254,9.364c-0.351,0-0.638-0.288-0.638-0.638c0-0.351,0.287-0.638,0.638-0.638c0.352,0,0.639,0.287,0.639,0.638C14.893,9.077,14.605,9.364,14.254,9.364 M5.746,7.237c-0.821,0-1.489,0.668-1.489,1.489c0,0.821,0.668,1.489,1.489,1.489c0.821,0,1.489-0.668,1.489-1.489C7.234,7.905,6.566,7.237,5.746,7.237 M5.746,9.364c-0.351,0-0.638-0.288-0.638-0.638c0-0.351,0.287-0.638,0.638-0.638c0.351,0,0.638,0.287,0.638,0.638C6.384,9.077,6.096,9.364,5.746,9.364"></path>
          </svg>
        </a>
      </li>
      
      <li>
        <a href="https://virtual-thom.github.io/about" title="Curriculum Vitae Thom">
          <svg class="svg-icon" viewBox="0 0 20 20">
            <path d="M12.075,10.812c1.358-0.853,2.242-2.507,2.242-4.037c0-2.181-1.795-4.618-4.198-4.618S5.921,4.594,5.921,6.775c0,1.53,0.884,3.185,2.242,4.037c-3.222,0.865-5.6,3.807-5.6,7.298c0,0.23,0.189,0.42,0.42,0.42h14.273c0.23,0,0.42-0.189,0.42-0.42C17.676,14.619,15.297,11.677,12.075,10.812 M6.761,6.775c0-2.162,1.773-3.778,3.358-3.778s3.359,1.616,3.359,3.778c0,2.162-1.774,3.778-3.359,3.778S6.761,8.937,6.761,6.775 M3.415,17.69c0.218-3.51,3.142-6.297,6.704-6.297c3.562,0,6.486,2.787,6.705,6.297H3.415z"></path>
          </svg>
        </a>
      </li>
    </ul>
  </nav>
</header>

      <nav>
  <ul class="pagination">
    
    <li>
      <a href="/page11" class="Précédant">
        <span aria-hidden="true">&laquo;</span>
      </a>
    </li>
      
    <li>
      <a href="/archives/index.html">1</a>
    </li>
      
    <li>
      <a
        href="/archives/page2">2</a>
    </li>
      
    <li>
      <a
        href="/archives/page3">3</a>
    </li>
      
    <li>
      <a
        href="/archives/page4">4</a>
    </li>
      
    <li>
      <a
        href="/archives/page5">5</a>
    </li>
      
    <li>
      <a
        href="/archives/page6">6</a>
    </li>
      
    <li>
      <a
        href="/archives/page7">7</a>
    </li>
      
    <li>
      <a
        href="/archives/page8">8</a>
    </li>
      
    <li>
      <a
        href="/archives/page9">9</a>
    </li>
      
    <li>
      <a
        href="/archives/page10">10</a>
    </li>
      
    <li>
      <a
        href="/archives/page11">11</a>
    </li>
      
    <li class="active">
      <span>12</span>
    </li>
      
    <li>
      <a
        href="/archives/page13">13</a>
    </li>
      
    <li>
      <a
        href="/archives/page14">14</a>
    </li>
      
    <li>
      <a href="/page13" aria-label="Suivant">
        <span aria-hidden="true">&raquo;</span>
      </a>
    </li>
    
  </ul>
</nav>
<ul class="post-list post-list-with-type">
  
  <li>
    <a class="post-link" href="/archives/api-vplex-restful/">VPLEX Element Manager API, ou API VPLEX RESTful</a>
  </li>
  
  <li>
    <a class="post-link" href="/archives/encrypter-un-mot-de-passe-avec-openssl/">Encrypter un mot de passe avec openssl</a>
  </li>
  
  <li>
    <a class="post-link" href="/archives/service-agent-vtom-initd-chkconfig/">Service agent vtom dans /etc/init.d/ et chkconfig</a>
  </li>
  
  <li>
    <a class="post-link" href="/archives/san-hp-uxredecouverte-lun-sans-redemarrer/">Redécouverte LUN sans redémarrer HP-UX</a>
  </li>
  
  <li>
    <a class="post-link" href="/archives/san-linux-redecouverte-lun-sans-redemarrer/">Redécouverte LUN sans redémarrer</a>
  </li>
  
  <li>
    <a class="post-link" href="/archives/xor-vtom/">Comment faire un XOR VTOM logique</a>
  </li>
  
  <li>
    <a class="post-link" href="/archives/bug-v5-6-formule-avec-date-sous-format-jj-mm-aaaa/">Bug v5.6 - Formule avec date sous format jj-mm-aaaa</a>
  </li>
  
  <li>
    <a class="post-link" href="/archives/base-de-donnees-vtom-postgres-sql/">Accéder à la base de données VTOM PostgreSQL</a>
  </li>
  
  <li>
    <a class="post-link" href="/archives/application-3-tiers/">Application n tiers</a>
  </li>
  
  <li>
    <a class="post-link" href="/archives/hp-ux-decouvrir-et-recuperer-les-devices-de-lecteurs-de-librairie-drives-ou-tape-sans-redemarrer/">HP-UX découvrir et récupérer les devices de lecteurs de librairie (drives ou tape) sans redémarrer</a>
  </li>
  
</ul>


<div id="page-first-post">

  <div itemscope itemtype="http://schema.org/Article" class="post">

    <article class="post-content" itemprop="articleBody">
      <h1 itemprop="name about headline" class="post-title">VPLEX Element Manager API, ou API VPLEX RESTful</h1>
      <p>On ne peut pas automatiser, simplement et rapidement, une commande VPLEX Cli depuis un serveur d'administration distant. Et pour cause, lorsqu'on se connecte en ssh sur VPLEX, il faut de nouveau s'authentifier sur le vplexcli pour effectuer des commandes.
</p>
<p>
Mais qu'à cela ne tienne, EMC² a prévu des API web pour le VPLEX et on peut faire beaucoup de chose par des requêtes RESTful avec le client curl : requêtes pour administrer, superviser, récupérer des logs, etc.
</p>

      (voir plus)
      <a class="post-link" href="/archives/api-vplex-restful/">VPLEX Element Manager API, ou API VPLEX RESTful</a>
      <p class="post-meta">
        <time class="post-meta" itemprop="datePublished dateModified"
          datetime="2014-08-12T13:02:00+00:00">12-08-2014</time>
      </p>
    </article>
  </div>
</div>




















<ul class="post-list">
  
  
  
  
  <li>
    <div class="card">
      <h4><a class="post-link" href="/archives/encrypter-un-mot-de-passe-avec-openssl/">Encrypter un mot de passe avec openssl</a></h4>
      <p><p>J’ai souvent besoin d’écrire des scripts avec utilisateur et mot de passe de connexion. Je ne trouve pas très glamour le fait d’avoir le mot de passe en dur dans les scripts.</p>

<p>Voici ma manière de procéder pour avoir un semblant de sécurité pour masquer le mot de passe, avec openssl.</p>

</p>
      
          <a href="/archives/encrypter-un-mot-de-passe-avec-openssl/">Article complet ici</a>
      
    </div>

  </li>
  
  
  
  <li>
    <div class="card">
      <h4><a class="post-link" href="/archives/service-agent-vtom-initd-chkconfig/">Service agent vtom dans /etc/init.d/ et chkconfig</a></h4>
      <p><p>L’installation agent VTOM sur linux ne fournit pas de service dans /etc/init.d/ pour vérifier le statut, stopper ou démarrer l’agent. 
VTOM fournit en revanche les scripts permettant d’administrer l’agent (stop et start). 
Ce script agent_vtom (à copier coller dans /etc/init.d/agent_vtom en 755) permet de s’intégrer dans le chkconfig.</p>

<p><a href="/scripts/agent_vtom">agent_vtom</a></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/ksh</span>
<span class="c">#</span>
<span class="c"># chkconfig: 345 90 20</span>
<span class="c"># description: Agent VTOM.</span>
<span class="c">#========================================================</span>

<span class="nv">USER_VTOM</span><span class="o">=</span>vtom
<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$USER_VTOM</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"</span><span class="sb">`</span><span class="nb">whoami</span><span class="sb">`</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nv">SUBMIT</span><span class="o">=</span><span class="s2">""</span>
<span class="k">elif</span> <span class="o">[</span> <span class="s2">"root"</span> <span class="o">=</span> <span class="s2">"</span><span class="sb">`</span><span class="nb">whoami</span><span class="sb">`</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nv">SUBMIT</span><span class="o">=</span><span class="s2">"su - </span><span class="nv">$USER_VTOM</span><span class="s2"> -c "</span>
<span class="k">else
  </span><span class="nb">echo</span> <span class="s2">"Ce script doit etre lance en tant que root ou </span><span class="nv">$USER_VTOM</span><span class="s2"> =&gt; sortie"</span>
  <span class="nb">exit </span>2
<span class="k">fi
</span><span class="nv">TOM_HOME</span><span class="o">=</span><span class="k">${</span><span class="nv">TOM_HOME</span><span class="k">:-</span><span class="p">/opt/vtom</span><span class="k">}</span>
<span class="nv">RETVAL</span><span class="o">=</span>0

<span class="nv">prog</span><span class="o">=</span><span class="s2">"Agent VTOM"</span>

start<span class="o">(){</span>
	status
        <span class="k">if </span><span class="nb">test</span> <span class="nv">$RETVAL</span> <span class="nt">-eq</span> 0<span class="p">;</span> <span class="k">then
		</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$prog</span><span class="s2"> déjà démarré"</span>
		<span class="nb">exit </span>0
	<span class="k">fi	

        </span><span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"Démarrage </span><span class="nv">$prog</span><span class="s2">: "</span>

        <span class="k">if </span><span class="nb">test</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$SUBMIT</span><span class="s2">"</span><span class="p">;</span> <span class="k">then
                        </span><span class="nb">eval</span> <span class="s2">"</span><span class="k">${</span><span class="nv">TOM_HOME</span><span class="k">}</span><span class="s2">/admin/start_client &amp;"</span>
        <span class="k">else</span>
                        <span class="nv">$SUBMIT</span> <span class="s2">"</span><span class="k">${</span><span class="nv">TOM_HOME</span><span class="k">}</span><span class="s2">/admin/start_client &amp;"</span>
        <span class="k">fi

        </span><span class="nv">limite</span><span class="o">=</span>5
        <span class="nv">cpt</span><span class="o">=</span>0

        <span class="k">while </span><span class="nb">test</span> <span class="nv">$cpt</span> <span class="nt">-lt</span> <span class="nv">$limite</span>
        <span class="k">do
		</span>status
                <span class="k">if </span><span class="nb">test</span> <span class="nv">$RETVAL</span> <span class="nt">-eq</span> 1<span class="p">;</span> <span class="k">then
                        </span><span class="nv">cpt</span><span class="o">=</span><span class="sb">`</span><span class="nb">expr</span> <span class="nv">$cpt</span> + 1<span class="sb">`</span>
                <span class="k">else
                	</span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">Agent VTOM </span><span class="se">\0</span><span class="s2">33[0;32mDEMARRé</span><span class="se">\E</span><span class="s2">[0m</span><span class="se">\n</span><span class="s2">"</span>
			<span class="nb">exit </span>0
                <span class="k">fi
                </span><span class="nb">sleep </span>2
        <span class="k">done

	</span>status
        <span class="k">if </span><span class="nb">test</span> <span class="nv">$RETVAL</span> <span class="nt">-eq</span> 1<span class="p">;</span> <span class="k">then
                </span><span class="nb">echo</span> <span class="s2">"Problème lors du démarrage </span><span class="nv">$prog</span><span class="s2">"</span>
		<span class="nb">exit </span>123
        <span class="k">fi</span>
<span class="o">}</span>

stop_vtom<span class="o">(){</span>
	status
        <span class="k">if </span><span class="nb">test</span> <span class="nv">$RETVAL</span> <span class="nt">-eq</span> 1<span class="p">;</span> <span class="k">then
		</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$prog</span><span class="s2"> déjà arrêté"</span>
		<span class="nb">exit </span>0
	<span class="k">fi	
	
        </span><span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"Arrêt </span><span class="nv">$prog</span><span class="s2">: "</span>

        <span class="k">if </span><span class="nb">test</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$SUBMIT</span><span class="s2">"</span> <span class="p">;</span> <span class="k">then
                        </span><span class="nb">eval</span> <span class="s2">"</span><span class="k">${</span><span class="nv">TOM_HOME</span><span class="k">}</span><span class="s2">/admin/stop_client &amp;"</span>
        <span class="k">else</span> 
                        <span class="nv">$SUBMIT</span> <span class="s2">"</span><span class="k">${</span><span class="nv">TOM_HOME</span><span class="k">}</span><span class="s2">/admin/stop_client &amp;"</span>
        <span class="k">fi

        </span><span class="nv">limite</span><span class="o">=</span>5
        <span class="nv">cpt</span><span class="o">=</span>0

        <span class="k">while </span><span class="nb">test</span> <span class="nv">$cpt</span> <span class="nt">-lt</span> <span class="nv">$limite</span>
        <span class="k">do
                </span>status
                <span class="k">if </span><span class="nb">test</span> <span class="nv">$RETVAL</span> <span class="nt">-eq</span> 0<span class="p">;</span> <span class="k">then
                        </span><span class="nv">cpt</span><span class="o">=</span><span class="sb">`</span><span class="nb">expr</span> <span class="nv">$cpt</span> + 1<span class="sb">`</span>
                <span class="k">else
                	</span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">Agent VTOM </span><span class="se">\0</span><span class="s2">33[0;31mARRETé</span><span class="se">\E</span><span class="s2">[0m</span><span class="se">\n</span><span class="s2">"</span>
			<span class="nb">exit </span>0
                <span class="k">fi
                </span><span class="nb">sleep </span>2
        <span class="k">done
	
	</span>status
        <span class="k">if </span><span class="nb">test</span> <span class="nv">$RETVAL</span> <span class="nt">-eq</span> 0<span class="p">;</span> <span class="k">then
                </span><span class="nb">echo</span> <span class="s2">"Problème lors de l'arrêt </span><span class="nv">$prog</span><span class="s2">"</span>
		<span class="nb">exit </span>124
        <span class="k">fi</span>

        <span class="o">}</span>

status<span class="o">(){</span>
        ps <span class="nt">-ef</span>|grep bdaemon|grep <span class="nt">-v</span> <span class="nb">grep </span>1&gt; /dev/null 2&gt;&amp;1
        <span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> <span class="o">!=</span> 0 <span class="o">]</span> <span class="p">;</span> <span class="k">then
		</span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n</span><span class="nv">$prog</span><span class="s2"> : </span><span class="se">\0</span><span class="s2">33[0;31mOFF</span><span class="se">\E</span><span class="s2">[0m</span><span class="se">\n</span><span class="s2">"</span>
		<span class="nv">RETVAL</span><span class="o">=</span>1
        <span class="k">else
                </span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n</span><span class="nv">$prog</span><span class="s2"> : </span><span class="se">\0</span><span class="s2">33[0;32mON</span><span class="se">\E</span><span class="s2">[0m</span><span class="se">\n</span><span class="s2">"</span>
                <span class="nv">RETVAL</span><span class="o">=</span>0
        <span class="k">fi</span>
<span class="o">}</span>

restart<span class="o">(){</span>
    stop_vtom
    start
<span class="o">}</span>

<span class="k">case</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="k">in
    </span>start<span class="p">)</span>
        start
        <span class="p">;;</span>
    stop<span class="p">)</span>
        stop_vtom
        <span class="p">;;</span>
    status<span class="p">)</span>
        status
        <span class="p">;;</span>
    restart<span class="p">)</span>
        restart
        <span class="p">;;</span>
    <span class="k">*</span><span class="p">)</span>
        <span class="nb">echo</span> <span class="s2">$"Usage: </span><span class="nv">$0</span><span class="s2"> {start|stop|status|restart}"</span>
        <span class="nv">RETVAL</span><span class="o">=</span>1
<span class="k">esac

</span><span class="nb">exit</span> <span class="nv">$RETVAL</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chkconfig <span class="nt">--add</span> agent_vtom
chkconfig agent_vtom on
</code></pre></div></div>
<p>Tapez <code class="language-plaintext highlighter-rouge">chkconfig --list</code> pour vérifier la prise en compte.</p>

</p>
      
    </div>

  </li>
  
  
  
  <li>
    <div class="card">
      <h4><a class="post-link" href="/archives/san-hp-uxredecouverte-lun-sans-redemarrer/">Redécouverte LUN sans redémarrer HP-UX</a></h4>
      <p><pre lang="bash"> 
iosan -FnC
insf -e
powermt config
powermt save
powermt display dev=all
</pre>
</p>
      
    </div>

  </li>
  
  
  
  <li>
    <div class="card">
      <h4><a class="post-link" href="/archives/san-linux-redecouverte-lun-sans-redemarrer/">Redécouverte LUN sans redémarrer</a></h4>
      <p>Ce script ne date pas d'hier, mais il est tellement pratique et fonctionne encore dans ma production pour redécouvrir des LUN à chaud (sans redémarrer le serveur) sous Linux (testé de RedHat 4.7 à 5.5).

Je me suis largement inspiré de la documentation de RedHat <a title="lien RedHat" href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Storage_Administration_Guide/scanning-storage-interconnects.html">Scanning Storage Interconnects</a> et les deux lignes qui font le boulot sont celles-ci :
<pre lang="bash">echo "1" > /sys/class/fc_host/host/issue_lip
echo "- - -" > /sys/class/scsi_host/hosth/scan
</pre>
</p>
      
          <a href="/archives/san-linux-redecouverte-lun-sans-redemarrer/">Article complet ici</a>
      
    </div>

  </li>
  
  
  
  <li>
    <div class="card">
      <h4><a class="post-link" href="/archives/xor-vtom/">Comment faire un XOR VTOM logique</a></h4>
      <p><p>Ca n'arrive pas souvent mais on peut avoir besoin de jouer un traitement que si un des deux parents est terminé, mais pas les deux (XOR ou ou exclusif, je ne joue le fils C que si le père A ou B est terminé, mais pas les deux).
Petite démo XOR VTOM en image.
</p>
</p>
      
          <a href="/archives/xor-vtom/">Article complet ici</a>
      
    </div>

  </li>
  
  
  
  <li>
    <div class="card">
      <h4><a class="post-link" href="/archives/bug-v5-6-formule-avec-date-sous-format-jj-mm-aaaa/">Bug v5.6 - Formule avec date sous format jj-mm-aaaa</a></h4>
      <p><p>Depuis la v5.6 (mais je crois que ça a été corrigé depuis), les formules dont les dates contiennent des tirets - ne sont pas prises en compte.
Et comme j’en avais une flopée, je me suis amusé à les lister plutôt que de les chercher. Je vais vous montrer comment en PHP et un vtexport en xml.
Pour résoudre le problème, il suffit de remplacer le tiret - par un slash /.</p>

<p><em><strong>Attention ! je ne le dirai jamais assez, ne jouez pas en Prod. Sur des bugs comme ça, ouvrez un ticket chez Absyss.</strong></em></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;?php
if(! file_exists('export.xml')){
	$cr = passthru ( 'vtexport -x &gt; export.xml' ) ;
	if( $cr != 0) {
		echo "Erreur vtexport" ;
		die ;
	}
}
$xml = simplexml_load_file('export.xml');
$regex = "/^.*-.*$/";
 
foreach($xml-&gt;Environments-&gt;Environment as $env){
	$envname = $env['name'];
	foreach($env-&gt;Applications-&gt;Application as $application         ){
	   $appname = $application['name'];
	   foreach ( $application-&gt;Jobs-&gt;Job as $job ) {
		   if( preg_match ( $regex, utf8_decode( $job-&gt;Planning-&gt;Formula ) ) ){
			   echo $envname . " / " . $appname . " / " . $job['name'] ."\n" ;
			   echo utf8_decode( $job-&gt;Planning-&gt;Formula ) . "\n\n" ;
		   }
	   }
	}               
}
// penser à gérer votre export.xml après si besoin
</code></pre></div></div>
</p>
      
    </div>

  </li>
  
  
  
  <li>
    <div class="card">
      <h4><a class="post-link" href="/archives/base-de-donnees-vtom-postgres-sql/">Accéder à la base de données VTOM PostgreSQL</a></h4>
      <p><p>Vous savez sans doute que VTOM tend à basculer sa base de données en full PostgreSQL (maybe en version 6 ?). Quelques données y sont déjà, statistiques, historique, calendriers etc.</p>

<p>Pour l’instant, la base de données est “ouverte” et je vais vous montrer une manière de procéder pour accéder aux tables avec PHP. Vous pouvez tout aussi bien vous connecter à la base avec un utilitaire SQL du genre <a title="SQuirreL SQL client" href="http://squirrel-sql.sourceforge.net/">SQuirreL SQL client</a>.</p>
<p>
ou encore avec le binaire psql de l'installation VTOM.
vtom@f8eeaf8b30a0:/mnt/User/temp$ ~/sgbd/bin/psql -d vtom -p 30009
</p>

<p><strong>Attention ! Ne faites pas n’importe quoi sur votre base de Prod. Ce genre de manipulation n’est pas soutenu par Absyss.</strong></p>

<p><strong>Si vous avez des besoins, faites des demandes d’évolution à Absyss.</strong></p>

<p>Personnellement, je ne joue que sur mes serveurs de tests.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;?php
/*
  * à activer dans php.ini
  * extension=php_pdo.dll
  * extension=php_pdo_pgsql.dll
  *
*/
$host = 'localhost' ;
$user = 'vtom' ;
$db   = 'vtom' ;
$pass = 'vtom' ;
$port = '30009' ;
$dsn  = "pgsql:host=$host;dbname=$db;port=$port";
 
try {
                $dbh = new PDO( $dsn, $user, $pass );
} catch (PDOException $e) {
                die ( 'Erreur ! : ' . $e-&gt;getMessage() );
}
 
/*
  * list all tables
 
$sql = "SELECT table_schema,table_name
FROM information_schema.tables
ORDER BY table_schema,table_name;" ;
 
  * list all db
 
$sql = "SELECT datname FROM pg_database
WHERE datistemplate = false;" ;
 
*/

// exemple pour lister la table des stats (attention c'est gourmand en l'état, il faut bien sûr faire une requête plus spécifique) 
$sql = "select * from vt_stats_job ;" ;
 
$sth = $dbh-&gt;query( $sql ) ;
while ( $row = $sth-&gt;fetch(PDO::FETCH_ASSOC) ){
        print_r($row);
}
 
// close connection
if( $dbh ){
                $dbh = NULL ;
}
</code></pre></div></div>

<p>Mise à jour. C’est encore plus fun avec Node JS, lister les statistiques VTOM par exemple :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
var pg = require('pg');
//var conString = "postgres://username:password@localhost/database";
var conString = "postgres://vtom:vtom@localhost:30009/vtom";

var client = new pg.Client(conString);

var query = 'SELECT * FROM vt_stats_job;' ;
// var query = 'SELECT * FROM vt_histo;' ;
// var query = 'SELECT * FROM pg_stat_all_tables;' ; // lister toutes les tables

client.connect(function(err) {
 if(err) {
  return console.error('could not connect to postgres', err);
 }
 client.query(query, function(err, result) {
  if(err) {
   client.end();
   return console.error('error running query', err);
  }
  //console.log(result.rows);
  result.rows.forEach(function(row){
   // console.log(row.relname); //pg_stat_all_tables
   console.log(row);
  });
  client.end();
 });
});
</code></pre></div></div>
</p>
      
    </div>

  </li>
  
  
  
  <li>
    <div class="card">
      <h4><a class="post-link" href="/archives/application-3-tiers/">Application n tiers</a></h4>
      <p><p >&Agrave; force de travailler dans des domaines bien spécifiques (entreprise scindée en plusieurs cellules, aux métiers de production informatique bien différents, avec leurs propres missions), on ne sait plus très bien ce que font nos collègues (et vice versa, c'est ça d'avoir toujours la tête dans le guidon !).
Comme j'aime m'intéresser à tous les aspects d'une production informatique, je me suis renseigné auprès de mes camarades sur l'architecture générale de nos Systèmes d'Information (SI).</p>
<p >N'ayant à la bouche que cette "application 3 Tiers", j'ai décidé d'investiguer et me suis amusé à dessiner un schéma. J'ai pris pour exemple le Système d'Information de la Maintenance de l'Armée de Terre (SIM@T).</p>
</p>
      
          <a href="/archives/application-3-tiers/">Article complet ici</a>
      
    </div>

  </li>
  
  
  
  <li>
    <div class="card">
      <h4><a class="post-link" href="/archives/hp-ux-decouvrir-et-recuperer-les-devices-de-lecteurs-de-librairie-drives-ou-tape-sans-redemarrer/">HP-UX découvrir et récupérer les devices de lecteurs de librairie (drives ou tape) sans redémarrer</a></h4>
      <p><pre>
# ioscan -fnkC tape
Class     I  H/W Path  Driver S/W State   H/W Type     Description
==================================================================
tape      0  0/2/1/0.8.0.255.7.12.0  stape   CLAIMED     DEVICE       HP      Ultrium 4-SCSI
                      /dev/rmt/0m             /dev/rmt/0mn            /dev/rmt/c1t12d0BEST    /dev/rmt/c1t12d0BESTn
                      /dev/rmt/0mb            /dev/rmt/0mnb           /dev/rmt/c1t12d0BESTb   /dev/rmt/c1t12d0BESTnb
tape      7  0/2/1/1.8.0.255.7.12.0  stape   CLAIMED     DEVICE       HP      Ultrium 4-SCSI
                      /dev/rmt/7m             /dev/rmt/7mn            /dev/rmt/c2t12d0BEST    /dev/rmt/c2t12d0BESTn
                      /dev/rmt/7mb            /dev/rmt/7mnb           /dev/rmt/c2t12d0BESTb   /dev/rmt/c2t12d0BESTnb
tape      2  0/5/1/0.8.0.255.7.12.0  stape   CLAIMED     DEVICE       HP      Ultrium 4-SCSI
                      /dev/rmt/2m             /dev/rmt/2mn            /dev/rmt/c4t12d0BEST    /dev/rmt/c4t12d0BESTn
                      /dev/rmt/2mb            /dev/rmt/2mnb           /dev/rmt/c4t12d0BESTb   /dev/rmt/c4t12d0BESTnb
tape      4  0/5/1/1.8.0.255.7.12.0  stape   CLAIMED     DEVICE       HP      Ultrium 4-SCSI
                      /dev/rmt/4m             /dev/rmt/4mn            /dev/rmt/c3t12d0BEST    /dev/rmt/c3t12d0BESTn
                      /dev/rmt/4mb            /dev/rmt/4mnb           /dev/rmt/c3t12d0BESTb   /dev/rmt/c3t12d0BESTnb
 
# ioscan -fnk | grep DEVICE
tape        0  0/2/1/0.8.0.255.7.12.0   stape          CLAIMED     DEVICE       HP      Ultrium 4-SCSI
autoch      2  0/2/1/0.8.0.255.7.12.1   schgr          CLAIMED     DEVICE       HP      MSL G3 Series
target      1  0/2/1/1.8.0.255.7.12     tgt            CLAIMED     DEVICE
tape        7  0/2/1/1.8.0.255.7.12.0   stape          CLAIMED     DEVICE       HP      Ultrium 4-SCSI
target      3  0/5/1/0.8.0.255.7.12     tgt            CLAIMED     DEVICE
tape        2  0/5/1/0.8.0.255.7.12.0   stape          CLAIMED     DEVICE       HP      Ultrium 4-SCSI
target      4  0/5/1/1.8.0.255.7.12     tgt            CLAIMED     DEVICE
tape        4  0/5/1/1.8.0.255.7.12.0   stape          CLAIMED     DEVICE       HP      Ultrium 4-SCSI
</pre>

</p>
      
    </div>

  </li>
  
  
</ul>
<!-- Pagination links -->
<nav>
  <ul class="pagination">
    
    <li>
      <a href="/page11" class="Précédant">
        <span aria-hidden="true">&laquo;</span>
      </a>
    </li>
      
    <li>
      <a href="/archives/index.html">1</a>
    </li>
      
    <li>
      <a
        href="/archives/page2">2</a>
    </li>
      
    <li>
      <a
        href="/archives/page3">3</a>
    </li>
      
    <li>
      <a
        href="/archives/page4">4</a>
    </li>
      
    <li>
      <a
        href="/archives/page5">5</a>
    </li>
      
    <li>
      <a
        href="/archives/page6">6</a>
    </li>
      
    <li>
      <a
        href="/archives/page7">7</a>
    </li>
      
    <li>
      <a
        href="/archives/page8">8</a>
    </li>
      
    <li>
      <a
        href="/archives/page9">9</a>
    </li>
      
    <li>
      <a
        href="/archives/page10">10</a>
    </li>
      
    <li>
      <a
        href="/archives/page11">11</a>
    </li>
      
    <li class="active">
      <span>12</span>
    </li>
      
    <li>
      <a
        href="/archives/page13">13</a>
    </li>
      
    <li>
      <a
        href="/archives/page14">14</a>
    </li>
      
    <li>
      <a href="/page13" aria-label="Suivant">
        <span aria-hidden="true">&raquo;</span>
      </a>
    </li>
    
  </ul>
</nav>

      <footer id="site-footer">
    <div>&copy;<a href="https://github.com/virtual-thom/" title="Github Virtual-Thom">Virtual-Thom</a></div>
    <div>
            <a href="https://virtual-thom.github.io/archives/plan" title="Plan du site">sitemap</a> | <a href="https://virtual-thom.github.io/about" rel="publisher author" title="Curriculum vitae Thom">A propos</a>
    </div>
    <div>
        <a id="goto-site-header" href="#site-header" title="Retourner au début">&uArr; Top</a>
    </div>
    <div id="footer-disclaimer">
        <p>Avertissement : vous ne devez pas prendre pour argent comptant le contenu de ce site. Testez toujours la solution en environnement de test.</p>
        <p>Malgré le sérieux que je m'efforce de mettre dans le contenu de ces billets, je ne pourrai être tenu responsable d'éventuelles erreurs que cela pourrait engendrer.</p>
    </div>
    <div>
        <a class="hidden" href="https://virtual-thom.github.io/archives/sitemap.xml" title="SiteMap">sitemap</a>
    </div>
</footer>

    </div>
  </body>

</html>