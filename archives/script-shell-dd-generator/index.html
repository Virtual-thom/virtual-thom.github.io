<!DOCTYPE html>
<html lang="fr">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="apple-touch-icon" href="https://virtual-thom.github.io/archives/apple-touch-icon.png">
  <link rel="icon" href="https://virtual-thom.github.io/archives/favicon.ico" />
  <!-- Remplacé par Jekyll SEO (sinon apparait en double)
  <title>Script shell dd generator</title>
  <meta name="description" content="La commande dd en shell, à quoi ça sert ?Je vois deux principaux intérêts à la commande dd unix.  Copie bloc à bloc d’un support (CD, DVD, Clé, Disques, etc....">
  --> 
  
  <link rel="canonical" href="https://virtual-thom.github.io/archives/script-shell-dd-generator/">
  
  <link rel="stylesheet" media="screen" href="https://virtual-thom.github.io/archives/assets/main.css">
  
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Script shell dd generator | Virtual-Thom Blog-notes VTOM et informatique</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Script shell dd generator" />
<meta name="author" content="Virtual Thom" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="La commande dd en shell, à quoi ça sert ? Je vois deux principaux intérêts à la commande dd unix. Copie bloc à bloc d’un support (CD, DVD, Clé, Disques, etc.) Test de performance d’écriture entre la source et la destination de la copie. edit 2015) je viens de découvrir qu&#39;on pouvait créer un fichier plein de zéro (avec dd par exemple), le formater, et le monter comme si c&#39;était un filesystem ! ça me parait fou mais ça semble fonctionner. Très pratique quand il n&#39;y a pas de VG ou plus de place pour créer des lv, ou pas de fs disponible. Ca permet surtout de cloisonner l&#39;espace disque si, par exemple, on ne veut pas qu&#39;un répertoire impacte le fs complet. Magnifique tutorial de quota pour linux Next, create a 20M file (disk image) in a suitable location. What I did below is create the file disk-quota.ext3 in the directory /usr/disk-img. # mkdir -p /usr/disk-img # dd if=/dev/zero of=/usr/disk-img/disk-quota.ext3 count=40960 The dd command above created a 20MB file because, by default, dd uses a block size of 512 bytes. That makes this size: 40960*512=20971520. For kicks, we&#39;ll confirm this size. # ls -lh /usr/disk-img/disk-quota.ext3 -rw-r--r-- 1 root root 20M Jul 19 14:34 /usr/disk-img/disk-quota.ext3 Next, format this as an ext3 filesystem. # /sbin/mkfs -t ext3 -q /usr/disk-img/disk-quota.ext3 -F The &quot;-t&quot; gives it the type. You&#39;re not limited to ext3. In fact, you could use ext2 or other filesystems installed on your system. The &quot;-q&quot; is for the device, and &quot;-F&quot; is to force the creation without warning us that this is a file and not a block device. Lien Wikipédia dd (Unix). Toujours est-il que les paramètres de la commande ne sont pas forcément triviales. C’est pourquoi j’ai fait un petit script shell avec un menu. Script dd_generator.sh #!/bin/sh # # SCRIPT : dd_generator # AUTEUR : Virtual Thom # DATE : 02.10.13 # set -x # debug # set -n # verif syntax sans exec # ################################## # VARIABLES ################################## datenow=$(date +&quot;%d-%m-%y_%H.%M.%S&quot;) ibs=&#39;1024&#39; # nombre d&#39;octet lu d&#39;un coup du if count=&#39;10000&#39; # nombre de segments ibs lu (si 0 il va au bout du fichier) unit=&#39;Mo&#39; unit_base=1024 unit_mo=`expr ${unit_base} \* ${unit_base}` unit_go=`expr ${unit_mo} \* ${unit_base}` unit_to=`expr ${unit_go} \* ${unit_base}` fonc_calc_unit(){ case ${unit} in &quot;octets&quot;) unit_calc=1 ;; &quot;Ko&quot;) unit_calc=${unit_base} ;; &quot;Go&quot;) unit_calc=${unit_go} ;; &quot;To&quot;) unit_calc=${unit_to} ;; &quot;Mo&quot; | *) unit_calc=${unit_mo} ;; esac } fonc_calc_unit #total_size=&#39;expr ${ibs} \* ${count} \/ ${unit_calc}&#39; # par defaut en Mo, doit être évaluer total_size=&quot;echo &#39;scale=2;${ibs} * ${count} / ${unit_calc}&#39; | bc&quot; # par defaut en Mo, doit être évaluer total_size_msg=&#39;echo &quot;Taille Totale (en $unit) :&quot;&#39; of_path=&#39;echo &quot;${PWD}/dd_`eval ${total_size}`${unit}_${datenow}.bin&quot;&#39; # par defaut fichier écrit dans le répertoire courant if_path=&#39;/dev/zero&#39; # par defaut fichier lu constitué de vide msg_retour=&quot;Tapez retour99 ou laissez vide pour ne pas changer la valeur&quot; ################################## # FONCTIONS ################################## date_heure(){ date_heure_var=`date +&quot;%d/%m/%Y - %H:%M:%S : &quot;` echo &quot;${date_heure_var}$1&quot; } date_simple(){ date_heure_var=`date +&quot;%d%m%Y_%H%M%S&quot;` echo &quot;${date_heure_var}&quot; } fonc_sortie(){ numero_exit=$1 message_exit=$2 date_heure &quot;${message_exit}&quot; date_heure &quot;Fin du script. Exit : ${numero_exit}&quot; exit ${numero_exit} } fonc_pause(){ echo -e &quot;\nAppuyez sur Entrer pour continuer...\c&quot; read } fonc_trap_exit(){ echo &quot;&quot; fonc_sortie &quot;123&quot; &quot;Script interrompu&quot; } trap &#39;fonc_trap_exit&#39; 2 fonc_menu_principal(){ clear #TITRE echo -e &quot;\n\t################\n\t# DD GENERATOR #\n\t################\n&quot; echo -e &quot;\n\tdd of=`eval ${of_path}` if=${if_path} ibs=${ibs} count=${count}\n&quot; PS3=&quot;Selectionner une option et appuyer sur Entrer :&quot; select options in &quot;Unite par defaut : $unit&quot; &quot;Fichier lu : $if_path&quot; &quot;Fichier ecrit : `eval $of_path`&quot; &quot;Taille segment de lecture (octet) : $ibs&quot; &quot;Nombre de Segment : $count&quot; &quot;`eval $total_size_msg` `eval \&quot;$total_size\&quot;`&quot; &quot;Creer le fichier&quot; &quot;Quitter&quot; do case ${options} in &quot;Unite par defaut : $unit&quot;) menu_unit ;; &quot;Fichier lu : $if_path&quot;) clear echo -e &quot;Veuillez entrer le chemin complet du fichier à lire : \n\t(${msg_retour})&quot; read read_if_path fonc_test_retour &quot;${read_if_path}&quot; &amp;&amp; if_path=${read_if_path} fonc_menu_principal ;; &quot;Fichier ecrit : `eval $of_path`&quot;) clear echo -e &quot;Veuillez entrer le chemin complet du fichier à créer : \n\t(${msg_retour})&quot; read read_of_path fonc_test_retour &quot;${read_of_path}&quot; if test $? -eq 0 then of_path_tmp=${read_of_path} of_path=&#39;echo ${of_path_tmp}&#39; fi fonc_menu_principal ;; &quot;Taille segment de lecture (octet) : $ibs&quot;) clear echo -e &quot;Veuillez entrer la taille du segment lu : \n\t(${msg_retour})&quot; read read_ibs fonc_test_retour &quot;${read_ibs}&quot; &amp;&amp; ibs=${read_ibs} fonc_menu_principal ;; &quot;Nombre de Segment : $count&quot;) clear echo -e &quot;Veuillez entrer le nombre de segment : \n\t(${msg_retour})\n\t(tapez 0 pour copier le fichier if en totalite)&quot; read read_count fonc_test_retour &quot;${read_count}&quot; &amp;&amp; count=${read_count} fonc_menu_principal ;; &quot;`eval $total_size_msg` `eval \&quot;$total_size\&quot;`&quot;) clear echo -e &quot;Veuillez entrer `eval $total_size_msg` `eval \&quot;$total_size\&quot;` : \n\t(${msg_retour})\n\t(tapez 0 pour copier le fichier if en totalite)&quot; read read_total_size fonc_test_retour &quot;${read_total_size}&quot; &amp;&amp; fonc_calc_count fonc_menu_principal ;; &quot;Creer le fichier&quot;) fonc_dd_generator fonc_sortie $? ;; &quot;Quitter&quot;) fonc_sortie 0 ;; esac echo &quot;&quot; REPLY= clear echo -e &quot;\n\n\tDD GENERATOR\n\n&quot; done clear } fonc_dd_generator(){ if test $count -eq 0 then echo &quot;dd of=`eval ${of_path}` if=${if_path} ibs=${ibs}&quot; dd of=`eval ${of_path}` if=${if_path} ibs=${ibs} &amp;&amp; echo &quot;Le fichier `eval ${of_path}` a été créé&quot; else echo &quot;dd of=`eval ${of_path}` if=${if_path} ibs=${ibs} count=${count}&quot; dd of=`eval ${of_path}` if=${if_path} ibs=${ibs} count=${count}&amp;&amp; echo &quot;Le fichier `eval ${of_path}` a été créé&quot; fi } fonc_test_retour(){ if test &quot;$1&quot; == &quot;retour99&quot; -o -z &quot;$1&quot; then return 250 else return 0 fi } menu_unit(){ clear #TITRE echo -e &quot;\n\n\tUnite actuelle : $unit\n\n&quot; PS3=&quot;Selectionner une option et appuyer sur Entrer :&quot; select options in &quot;octets&quot; &quot;Ko&quot; &quot;Mo&quot; &quot;Go&quot; &quot;To&quot; &quot;Retour&quot; do case ${options} in &quot;octets&quot;) unit=&#39;octets&#39; fonc_calc_unit fonc_menu_principal ;; &quot;Ko&quot;) unit=&#39;Ko&#39; fonc_calc_unit fonc_menu_principal ;; &quot;Mo&quot;) unit=&#39;Mo&#39; fonc_calc_unit fonc_menu_principal ;; &quot;Go&quot;) unit=&#39;Go&#39; fonc_calc_unit fonc_menu_principal ;; &quot;To&quot;) unit=&#39;To&#39; fonc_calc_unit fonc_menu_principal ;; &quot;Retour&quot;) fonc_menu_principal break ;; esac echo &quot;&quot; REPLY= clear echo -e &quot;\n\n\tUnit actuelle : $unit\n\n&quot; done clear } fonc_calc_count(){ count=`expr ${read_total_size} \* ${unit_calc} \/ ${ibs}` } ################################## # SCRIPT ################################## fonc_menu_principal # end of script Résultat du script dd_generator.sh ################ # DD GENERATOR # ################ dd of=/SCRIPTS/dd_9.76Mo_15-10-14_09.53.09.bin if=/dev/zero ibs=1024 count=10000 1) Unite par defaut : Mo 2) Fichier lu : /dev/zero 3) Fichier ecrit : /SCRIPTS/dd_9.76Mo_15-10-14_09.53.09.bin 4) Taille segment de lecture (octet) : 1024 5) Nombre de Segment : 10000 6) Taille Totale (en Mo) : 9.76 7) Creer le fichier 8) Quitter Selectionner une option et appuyer sur Entrer :7 dd of=/SCRIPTS/dd_9.76Mo_15-10-14_09.53.09.bin if=/dev/zero ibs=1024 count=10000 10000+0 enregistrements lus 20000+0 enregistrements écrits 10240000 octets (10 MB) copiés, 0,05625 seconde, 182 MB/s Le fichier /SCRIPTS/dd_9.76Mo_15-10-14_09.53.09.bin a été créé 15/10/2014 - 09:53:33 : 15/10/2014 - 09:53:33 : Fin du script. Exit : 0 #ls -lisa /SCRIPTS/dd_9.76Mo_15-10-14_09.53.09.bin 23592966 10016 -rw-r--r-- 1 root root 10240000 oct 15 09:53 /SCRIPTS/dd_9.76Mo_15-10-14_09.53.09.bin #ls -lisah /SCRIPTS/dd_9.76Mo_15-10-14_09.53.09.bin 23592966 9,8M -rw-r--r-- 1 root root 9,8M oct 15 09:53 /SCRIPTS/dd_9.76Mo_15-10-14_09.53.09.bin" />
<meta property="og:description" content="La commande dd en shell, à quoi ça sert ? Je vois deux principaux intérêts à la commande dd unix. Copie bloc à bloc d’un support (CD, DVD, Clé, Disques, etc.) Test de performance d’écriture entre la source et la destination de la copie. edit 2015) je viens de découvrir qu&#39;on pouvait créer un fichier plein de zéro (avec dd par exemple), le formater, et le monter comme si c&#39;était un filesystem ! ça me parait fou mais ça semble fonctionner. Très pratique quand il n&#39;y a pas de VG ou plus de place pour créer des lv, ou pas de fs disponible. Ca permet surtout de cloisonner l&#39;espace disque si, par exemple, on ne veut pas qu&#39;un répertoire impacte le fs complet. Magnifique tutorial de quota pour linux Next, create a 20M file (disk image) in a suitable location. What I did below is create the file disk-quota.ext3 in the directory /usr/disk-img. # mkdir -p /usr/disk-img # dd if=/dev/zero of=/usr/disk-img/disk-quota.ext3 count=40960 The dd command above created a 20MB file because, by default, dd uses a block size of 512 bytes. That makes this size: 40960*512=20971520. For kicks, we&#39;ll confirm this size. # ls -lh /usr/disk-img/disk-quota.ext3 -rw-r--r-- 1 root root 20M Jul 19 14:34 /usr/disk-img/disk-quota.ext3 Next, format this as an ext3 filesystem. # /sbin/mkfs -t ext3 -q /usr/disk-img/disk-quota.ext3 -F The &quot;-t&quot; gives it the type. You&#39;re not limited to ext3. In fact, you could use ext2 or other filesystems installed on your system. The &quot;-q&quot; is for the device, and &quot;-F&quot; is to force the creation without warning us that this is a file and not a block device. Lien Wikipédia dd (Unix). Toujours est-il que les paramètres de la commande ne sont pas forcément triviales. C’est pourquoi j’ai fait un petit script shell avec un menu. Script dd_generator.sh #!/bin/sh # # SCRIPT : dd_generator # AUTEUR : Virtual Thom # DATE : 02.10.13 # set -x # debug # set -n # verif syntax sans exec # ################################## # VARIABLES ################################## datenow=$(date +&quot;%d-%m-%y_%H.%M.%S&quot;) ibs=&#39;1024&#39; # nombre d&#39;octet lu d&#39;un coup du if count=&#39;10000&#39; # nombre de segments ibs lu (si 0 il va au bout du fichier) unit=&#39;Mo&#39; unit_base=1024 unit_mo=`expr ${unit_base} \* ${unit_base}` unit_go=`expr ${unit_mo} \* ${unit_base}` unit_to=`expr ${unit_go} \* ${unit_base}` fonc_calc_unit(){ case ${unit} in &quot;octets&quot;) unit_calc=1 ;; &quot;Ko&quot;) unit_calc=${unit_base} ;; &quot;Go&quot;) unit_calc=${unit_go} ;; &quot;To&quot;) unit_calc=${unit_to} ;; &quot;Mo&quot; | *) unit_calc=${unit_mo} ;; esac } fonc_calc_unit #total_size=&#39;expr ${ibs} \* ${count} \/ ${unit_calc}&#39; # par defaut en Mo, doit être évaluer total_size=&quot;echo &#39;scale=2;${ibs} * ${count} / ${unit_calc}&#39; | bc&quot; # par defaut en Mo, doit être évaluer total_size_msg=&#39;echo &quot;Taille Totale (en $unit) :&quot;&#39; of_path=&#39;echo &quot;${PWD}/dd_`eval ${total_size}`${unit}_${datenow}.bin&quot;&#39; # par defaut fichier écrit dans le répertoire courant if_path=&#39;/dev/zero&#39; # par defaut fichier lu constitué de vide msg_retour=&quot;Tapez retour99 ou laissez vide pour ne pas changer la valeur&quot; ################################## # FONCTIONS ################################## date_heure(){ date_heure_var=`date +&quot;%d/%m/%Y - %H:%M:%S : &quot;` echo &quot;${date_heure_var}$1&quot; } date_simple(){ date_heure_var=`date +&quot;%d%m%Y_%H%M%S&quot;` echo &quot;${date_heure_var}&quot; } fonc_sortie(){ numero_exit=$1 message_exit=$2 date_heure &quot;${message_exit}&quot; date_heure &quot;Fin du script. Exit : ${numero_exit}&quot; exit ${numero_exit} } fonc_pause(){ echo -e &quot;\nAppuyez sur Entrer pour continuer...\c&quot; read } fonc_trap_exit(){ echo &quot;&quot; fonc_sortie &quot;123&quot; &quot;Script interrompu&quot; } trap &#39;fonc_trap_exit&#39; 2 fonc_menu_principal(){ clear #TITRE echo -e &quot;\n\t################\n\t# DD GENERATOR #\n\t################\n&quot; echo -e &quot;\n\tdd of=`eval ${of_path}` if=${if_path} ibs=${ibs} count=${count}\n&quot; PS3=&quot;Selectionner une option et appuyer sur Entrer :&quot; select options in &quot;Unite par defaut : $unit&quot; &quot;Fichier lu : $if_path&quot; &quot;Fichier ecrit : `eval $of_path`&quot; &quot;Taille segment de lecture (octet) : $ibs&quot; &quot;Nombre de Segment : $count&quot; &quot;`eval $total_size_msg` `eval \&quot;$total_size\&quot;`&quot; &quot;Creer le fichier&quot; &quot;Quitter&quot; do case ${options} in &quot;Unite par defaut : $unit&quot;) menu_unit ;; &quot;Fichier lu : $if_path&quot;) clear echo -e &quot;Veuillez entrer le chemin complet du fichier à lire : \n\t(${msg_retour})&quot; read read_if_path fonc_test_retour &quot;${read_if_path}&quot; &amp;&amp; if_path=${read_if_path} fonc_menu_principal ;; &quot;Fichier ecrit : `eval $of_path`&quot;) clear echo -e &quot;Veuillez entrer le chemin complet du fichier à créer : \n\t(${msg_retour})&quot; read read_of_path fonc_test_retour &quot;${read_of_path}&quot; if test $? -eq 0 then of_path_tmp=${read_of_path} of_path=&#39;echo ${of_path_tmp}&#39; fi fonc_menu_principal ;; &quot;Taille segment de lecture (octet) : $ibs&quot;) clear echo -e &quot;Veuillez entrer la taille du segment lu : \n\t(${msg_retour})&quot; read read_ibs fonc_test_retour &quot;${read_ibs}&quot; &amp;&amp; ibs=${read_ibs} fonc_menu_principal ;; &quot;Nombre de Segment : $count&quot;) clear echo -e &quot;Veuillez entrer le nombre de segment : \n\t(${msg_retour})\n\t(tapez 0 pour copier le fichier if en totalite)&quot; read read_count fonc_test_retour &quot;${read_count}&quot; &amp;&amp; count=${read_count} fonc_menu_principal ;; &quot;`eval $total_size_msg` `eval \&quot;$total_size\&quot;`&quot;) clear echo -e &quot;Veuillez entrer `eval $total_size_msg` `eval \&quot;$total_size\&quot;` : \n\t(${msg_retour})\n\t(tapez 0 pour copier le fichier if en totalite)&quot; read read_total_size fonc_test_retour &quot;${read_total_size}&quot; &amp;&amp; fonc_calc_count fonc_menu_principal ;; &quot;Creer le fichier&quot;) fonc_dd_generator fonc_sortie $? ;; &quot;Quitter&quot;) fonc_sortie 0 ;; esac echo &quot;&quot; REPLY= clear echo -e &quot;\n\n\tDD GENERATOR\n\n&quot; done clear } fonc_dd_generator(){ if test $count -eq 0 then echo &quot;dd of=`eval ${of_path}` if=${if_path} ibs=${ibs}&quot; dd of=`eval ${of_path}` if=${if_path} ibs=${ibs} &amp;&amp; echo &quot;Le fichier `eval ${of_path}` a été créé&quot; else echo &quot;dd of=`eval ${of_path}` if=${if_path} ibs=${ibs} count=${count}&quot; dd of=`eval ${of_path}` if=${if_path} ibs=${ibs} count=${count}&amp;&amp; echo &quot;Le fichier `eval ${of_path}` a été créé&quot; fi } fonc_test_retour(){ if test &quot;$1&quot; == &quot;retour99&quot; -o -z &quot;$1&quot; then return 250 else return 0 fi } menu_unit(){ clear #TITRE echo -e &quot;\n\n\tUnite actuelle : $unit\n\n&quot; PS3=&quot;Selectionner une option et appuyer sur Entrer :&quot; select options in &quot;octets&quot; &quot;Ko&quot; &quot;Mo&quot; &quot;Go&quot; &quot;To&quot; &quot;Retour&quot; do case ${options} in &quot;octets&quot;) unit=&#39;octets&#39; fonc_calc_unit fonc_menu_principal ;; &quot;Ko&quot;) unit=&#39;Ko&#39; fonc_calc_unit fonc_menu_principal ;; &quot;Mo&quot;) unit=&#39;Mo&#39; fonc_calc_unit fonc_menu_principal ;; &quot;Go&quot;) unit=&#39;Go&#39; fonc_calc_unit fonc_menu_principal ;; &quot;To&quot;) unit=&#39;To&#39; fonc_calc_unit fonc_menu_principal ;; &quot;Retour&quot;) fonc_menu_principal break ;; esac echo &quot;&quot; REPLY= clear echo -e &quot;\n\n\tUnit actuelle : $unit\n\n&quot; done clear } fonc_calc_count(){ count=`expr ${read_total_size} \* ${unit_calc} \/ ${ibs}` } ################################## # SCRIPT ################################## fonc_menu_principal # end of script Résultat du script dd_generator.sh ################ # DD GENERATOR # ################ dd of=/SCRIPTS/dd_9.76Mo_15-10-14_09.53.09.bin if=/dev/zero ibs=1024 count=10000 1) Unite par defaut : Mo 2) Fichier lu : /dev/zero 3) Fichier ecrit : /SCRIPTS/dd_9.76Mo_15-10-14_09.53.09.bin 4) Taille segment de lecture (octet) : 1024 5) Nombre de Segment : 10000 6) Taille Totale (en Mo) : 9.76 7) Creer le fichier 8) Quitter Selectionner une option et appuyer sur Entrer :7 dd of=/SCRIPTS/dd_9.76Mo_15-10-14_09.53.09.bin if=/dev/zero ibs=1024 count=10000 10000+0 enregistrements lus 20000+0 enregistrements écrits 10240000 octets (10 MB) copiés, 0,05625 seconde, 182 MB/s Le fichier /SCRIPTS/dd_9.76Mo_15-10-14_09.53.09.bin a été créé 15/10/2014 - 09:53:33 : 15/10/2014 - 09:53:33 : Fin du script. Exit : 0 #ls -lisa /SCRIPTS/dd_9.76Mo_15-10-14_09.53.09.bin 23592966 10016 -rw-r--r-- 1 root root 10240000 oct 15 09:53 /SCRIPTS/dd_9.76Mo_15-10-14_09.53.09.bin #ls -lisah /SCRIPTS/dd_9.76Mo_15-10-14_09.53.09.bin 23592966 9,8M -rw-r--r-- 1 root root 9,8M oct 15 09:53 /SCRIPTS/dd_9.76Mo_15-10-14_09.53.09.bin" />
<link rel="canonical" href="https://virtual-thom.github.io/archives/script-shell-dd-generator/" />
<meta property="og:url" content="https://virtual-thom.github.io/archives/script-shell-dd-generator/" />
<meta property="og:site_name" content="Virtual-Thom Blog-notes VTOM et informatique" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2014-10-16T11:49:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Script shell dd generator" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Virtual Thom"},"dateModified":"2014-10-16T11:49:00+00:00","datePublished":"2014-10-16T11:49:00+00:00","description":"La commande dd en shell, à quoi ça sert ? Je vois deux principaux intérêts à la commande dd unix. Copie bloc à bloc d’un support (CD, DVD, Clé, Disques, etc.) Test de performance d’écriture entre la source et la destination de la copie. edit 2015) je viens de découvrir qu&#39;on pouvait créer un fichier plein de zéro (avec dd par exemple), le formater, et le monter comme si c&#39;était un filesystem ! ça me parait fou mais ça semble fonctionner. Très pratique quand il n&#39;y a pas de VG ou plus de place pour créer des lv, ou pas de fs disponible. Ca permet surtout de cloisonner l&#39;espace disque si, par exemple, on ne veut pas qu&#39;un répertoire impacte le fs complet. Magnifique tutorial de quota pour linux Next, create a 20M file (disk image) in a suitable location. What I did below is create the file disk-quota.ext3 in the directory /usr/disk-img. # mkdir -p /usr/disk-img # dd if=/dev/zero of=/usr/disk-img/disk-quota.ext3 count=40960 The dd command above created a 20MB file because, by default, dd uses a block size of 512 bytes. That makes this size: 40960*512=20971520. For kicks, we&#39;ll confirm this size. # ls -lh /usr/disk-img/disk-quota.ext3 -rw-r--r-- 1 root root 20M Jul 19 14:34 /usr/disk-img/disk-quota.ext3 Next, format this as an ext3 filesystem. # /sbin/mkfs -t ext3 -q /usr/disk-img/disk-quota.ext3 -F The &quot;-t&quot; gives it the type. You&#39;re not limited to ext3. In fact, you could use ext2 or other filesystems installed on your system. The &quot;-q&quot; is for the device, and &quot;-F&quot; is to force the creation without warning us that this is a file and not a block device. Lien Wikipédia dd (Unix). Toujours est-il que les paramètres de la commande ne sont pas forcément triviales. C’est pourquoi j’ai fait un petit script shell avec un menu. Script dd_generator.sh #!/bin/sh # # SCRIPT : dd_generator # AUTEUR : Virtual Thom # DATE : 02.10.13 # set -x # debug # set -n # verif syntax sans exec # ################################## # VARIABLES ################################## datenow=$(date +&quot;%d-%m-%y_%H.%M.%S&quot;) ibs=&#39;1024&#39; # nombre d&#39;octet lu d&#39;un coup du if count=&#39;10000&#39; # nombre de segments ibs lu (si 0 il va au bout du fichier) unit=&#39;Mo&#39; unit_base=1024 unit_mo=`expr ${unit_base} \\* ${unit_base}` unit_go=`expr ${unit_mo} \\* ${unit_base}` unit_to=`expr ${unit_go} \\* ${unit_base}` fonc_calc_unit(){ case ${unit} in &quot;octets&quot;) unit_calc=1 ;; &quot;Ko&quot;) unit_calc=${unit_base} ;; &quot;Go&quot;) unit_calc=${unit_go} ;; &quot;To&quot;) unit_calc=${unit_to} ;; &quot;Mo&quot; | *) unit_calc=${unit_mo} ;; esac } fonc_calc_unit #total_size=&#39;expr ${ibs} \\* ${count} \\/ ${unit_calc}&#39; # par defaut en Mo, doit être évaluer total_size=&quot;echo &#39;scale=2;${ibs} * ${count} / ${unit_calc}&#39; | bc&quot; # par defaut en Mo, doit être évaluer total_size_msg=&#39;echo &quot;Taille Totale (en $unit) :&quot;&#39; of_path=&#39;echo &quot;${PWD}/dd_`eval ${total_size}`${unit}_${datenow}.bin&quot;&#39; # par defaut fichier écrit dans le répertoire courant if_path=&#39;/dev/zero&#39; # par defaut fichier lu constitué de vide msg_retour=&quot;Tapez retour99 ou laissez vide pour ne pas changer la valeur&quot; ################################## # FONCTIONS ################################## date_heure(){ date_heure_var=`date +&quot;%d/%m/%Y - %H:%M:%S : &quot;` echo &quot;${date_heure_var}$1&quot; } date_simple(){ date_heure_var=`date +&quot;%d%m%Y_%H%M%S&quot;` echo &quot;${date_heure_var}&quot; } fonc_sortie(){ numero_exit=$1 message_exit=$2 date_heure &quot;${message_exit}&quot; date_heure &quot;Fin du script. Exit : ${numero_exit}&quot; exit ${numero_exit} } fonc_pause(){ echo -e &quot;\\nAppuyez sur Entrer pour continuer...\\c&quot; read } fonc_trap_exit(){ echo &quot;&quot; fonc_sortie &quot;123&quot; &quot;Script interrompu&quot; } trap &#39;fonc_trap_exit&#39; 2 fonc_menu_principal(){ clear #TITRE echo -e &quot;\\n\\t################\\n\\t# DD GENERATOR #\\n\\t################\\n&quot; echo -e &quot;\\n\\tdd of=`eval ${of_path}` if=${if_path} ibs=${ibs} count=${count}\\n&quot; PS3=&quot;Selectionner une option et appuyer sur Entrer :&quot; select options in &quot;Unite par defaut : $unit&quot; &quot;Fichier lu : $if_path&quot; &quot;Fichier ecrit : `eval $of_path`&quot; &quot;Taille segment de lecture (octet) : $ibs&quot; &quot;Nombre de Segment : $count&quot; &quot;`eval $total_size_msg` `eval \\&quot;$total_size\\&quot;`&quot; &quot;Creer le fichier&quot; &quot;Quitter&quot; do case ${options} in &quot;Unite par defaut : $unit&quot;) menu_unit ;; &quot;Fichier lu : $if_path&quot;) clear echo -e &quot;Veuillez entrer le chemin complet du fichier à lire : \\n\\t(${msg_retour})&quot; read read_if_path fonc_test_retour &quot;${read_if_path}&quot; &amp;&amp; if_path=${read_if_path} fonc_menu_principal ;; &quot;Fichier ecrit : `eval $of_path`&quot;) clear echo -e &quot;Veuillez entrer le chemin complet du fichier à créer : \\n\\t(${msg_retour})&quot; read read_of_path fonc_test_retour &quot;${read_of_path}&quot; if test $? -eq 0 then of_path_tmp=${read_of_path} of_path=&#39;echo ${of_path_tmp}&#39; fi fonc_menu_principal ;; &quot;Taille segment de lecture (octet) : $ibs&quot;) clear echo -e &quot;Veuillez entrer la taille du segment lu : \\n\\t(${msg_retour})&quot; read read_ibs fonc_test_retour &quot;${read_ibs}&quot; &amp;&amp; ibs=${read_ibs} fonc_menu_principal ;; &quot;Nombre de Segment : $count&quot;) clear echo -e &quot;Veuillez entrer le nombre de segment : \\n\\t(${msg_retour})\\n\\t(tapez 0 pour copier le fichier if en totalite)&quot; read read_count fonc_test_retour &quot;${read_count}&quot; &amp;&amp; count=${read_count} fonc_menu_principal ;; &quot;`eval $total_size_msg` `eval \\&quot;$total_size\\&quot;`&quot;) clear echo -e &quot;Veuillez entrer `eval $total_size_msg` `eval \\&quot;$total_size\\&quot;` : \\n\\t(${msg_retour})\\n\\t(tapez 0 pour copier le fichier if en totalite)&quot; read read_total_size fonc_test_retour &quot;${read_total_size}&quot; &amp;&amp; fonc_calc_count fonc_menu_principal ;; &quot;Creer le fichier&quot;) fonc_dd_generator fonc_sortie $? ;; &quot;Quitter&quot;) fonc_sortie 0 ;; esac echo &quot;&quot; REPLY= clear echo -e &quot;\\n\\n\\tDD GENERATOR\\n\\n&quot; done clear } fonc_dd_generator(){ if test $count -eq 0 then echo &quot;dd of=`eval ${of_path}` if=${if_path} ibs=${ibs}&quot; dd of=`eval ${of_path}` if=${if_path} ibs=${ibs} &amp;&amp; echo &quot;Le fichier `eval ${of_path}` a été créé&quot; else echo &quot;dd of=`eval ${of_path}` if=${if_path} ibs=${ibs} count=${count}&quot; dd of=`eval ${of_path}` if=${if_path} ibs=${ibs} count=${count}&amp;&amp; echo &quot;Le fichier `eval ${of_path}` a été créé&quot; fi } fonc_test_retour(){ if test &quot;$1&quot; == &quot;retour99&quot; -o -z &quot;$1&quot; then return 250 else return 0 fi } menu_unit(){ clear #TITRE echo -e &quot;\\n\\n\\tUnite actuelle : $unit\\n\\n&quot; PS3=&quot;Selectionner une option et appuyer sur Entrer :&quot; select options in &quot;octets&quot; &quot;Ko&quot; &quot;Mo&quot; &quot;Go&quot; &quot;To&quot; &quot;Retour&quot; do case ${options} in &quot;octets&quot;) unit=&#39;octets&#39; fonc_calc_unit fonc_menu_principal ;; &quot;Ko&quot;) unit=&#39;Ko&#39; fonc_calc_unit fonc_menu_principal ;; &quot;Mo&quot;) unit=&#39;Mo&#39; fonc_calc_unit fonc_menu_principal ;; &quot;Go&quot;) unit=&#39;Go&#39; fonc_calc_unit fonc_menu_principal ;; &quot;To&quot;) unit=&#39;To&#39; fonc_calc_unit fonc_menu_principal ;; &quot;Retour&quot;) fonc_menu_principal break ;; esac echo &quot;&quot; REPLY= clear echo -e &quot;\\n\\n\\tUnit actuelle : $unit\\n\\n&quot; done clear } fonc_calc_count(){ count=`expr ${read_total_size} \\* ${unit_calc} \\/ ${ibs}` } ################################## # SCRIPT ################################## fonc_menu_principal # end of script Résultat du script dd_generator.sh ################ # DD GENERATOR # ################ dd of=/SCRIPTS/dd_9.76Mo_15-10-14_09.53.09.bin if=/dev/zero ibs=1024 count=10000 1) Unite par defaut : Mo 2) Fichier lu : /dev/zero 3) Fichier ecrit : /SCRIPTS/dd_9.76Mo_15-10-14_09.53.09.bin 4) Taille segment de lecture (octet) : 1024 5) Nombre de Segment : 10000 6) Taille Totale (en Mo) : 9.76 7) Creer le fichier 8) Quitter Selectionner une option et appuyer sur Entrer :7 dd of=/SCRIPTS/dd_9.76Mo_15-10-14_09.53.09.bin if=/dev/zero ibs=1024 count=10000 10000+0 enregistrements lus 20000+0 enregistrements écrits 10240000 octets (10 MB) copiés, 0,05625 seconde, 182 MB/s Le fichier /SCRIPTS/dd_9.76Mo_15-10-14_09.53.09.bin a été créé 15/10/2014 - 09:53:33 : 15/10/2014 - 09:53:33 : Fin du script. Exit : 0 #ls -lisa /SCRIPTS/dd_9.76Mo_15-10-14_09.53.09.bin 23592966 10016 -rw-r--r-- 1 root root 10240000 oct 15 09:53 /SCRIPTS/dd_9.76Mo_15-10-14_09.53.09.bin #ls -lisah /SCRIPTS/dd_9.76Mo_15-10-14_09.53.09.bin 23592966 9,8M -rw-r--r-- 1 root root 9,8M oct 15 09:53 /SCRIPTS/dd_9.76Mo_15-10-14_09.53.09.bin","headline":"Script shell dd generator","mainEntityOfPage":{"@type":"WebPage","@id":"https://virtual-thom.github.io/archives/script-shell-dd-generator/"},"url":"https://virtual-thom.github.io/archives/script-shell-dd-generator/"}</script>
<!-- End Jekyll SEO tag -->

  
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Z8Y7902GRV"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Z8Y7902GRV');
</script>


  <body>
    <div class="container">
      <header id="site-header">
  <h1>Blog-notes VTOM, informatique, industrialisation, ordonnancement, DevOps</h1>
  <nav>
    <ul>
      <li>
        <a href="https://virtual-thom.github.io/archives" title="Home">
          <svg class="svg-icon" viewBox="0 0 20 20">
            <path d="M18.121,9.88l-7.832-7.836c-0.155-0.158-0.428-0.155-0.584,0L1.842,9.913c-0.262,0.263-0.073,0.705,0.292,0.705h2.069v7.042c0,0.227,0.187,0.414,0.414,0.414h3.725c0.228,0,0.414-0.188,0.414-0.414v-3.313h2.483v3.313c0,0.227,0.187,0.414,0.413,0.414h3.726c0.229,0,0.414-0.188,0.414-0.414v-7.042h2.068h0.004C18.331,10.617,18.389,10.146,18.121,9.88 M14.963,17.245h-2.896v-3.313c0-0.229-0.186-0.415-0.414-0.415H8.342c-0.228,0-0.414,0.187-0.414,0.415v3.313H5.032v-6.628h9.931V17.245z M3.133,9.79l6.864-6.868l6.867,6.868H3.133z"></path>
          </svg>
        </a>
      </li>
      <li>
        <a href="https://virtual-thom.github.io/archives/vos-commentaires-livre-d-or/" title="Commentaires - livre d'or">
          <svg class="svg-icon" viewBox="0 0 20 20">
            <path d="M17.657,2.982H2.342c-0.234,0-0.425,0.191-0.425,0.426v10.21c0,0.234,0.191,0.426,0.425,0.426h3.404v2.553c0,0.397,0.48,0.547,0.725,0.302l2.889-2.854h8.298c0.234,0,0.426-0.191,0.426-0.426V3.408C18.083,3.174,17.892,2.982,17.657,2.982M17.232,13.192H9.185c-0.113,0-0.219,0.045-0.3,0.124l-2.289,2.262v-1.96c0-0.233-0.191-0.426-0.425-0.426H2.767V3.833h14.465V13.192z M10,7.237c-0.821,0-1.489,0.668-1.489,1.489c0,0.821,0.668,1.489,1.489,1.489c0.821,0,1.488-0.668,1.488-1.489C11.488,7.905,10.821,7.237,10,7.237 M10,9.364c-0.352,0-0.638-0.288-0.638-0.638c0-0.351,0.287-0.638,0.638-0.638c0.351,0,0.638,0.287,0.638,0.638C10.638,9.077,10.351,9.364,10,9.364 M14.254,7.237c-0.821,0-1.489,0.668-1.489,1.489c0,0.821,0.668,1.489,1.489,1.489s1.489-0.668,1.489-1.489C15.743,7.905,15.075,7.237,14.254,7.237 M14.254,9.364c-0.351,0-0.638-0.288-0.638-0.638c0-0.351,0.287-0.638,0.638-0.638c0.352,0,0.639,0.287,0.639,0.638C14.893,9.077,14.605,9.364,14.254,9.364 M5.746,7.237c-0.821,0-1.489,0.668-1.489,1.489c0,0.821,0.668,1.489,1.489,1.489c0.821,0,1.489-0.668,1.489-1.489C7.234,7.905,6.566,7.237,5.746,7.237 M5.746,9.364c-0.351,0-0.638-0.288-0.638-0.638c0-0.351,0.287-0.638,0.638-0.638c0.351,0,0.638,0.287,0.638,0.638C6.384,9.077,6.096,9.364,5.746,9.364"></path>
          </svg>
        </a>
      </li>
      
      <li>
        <a href="https://virtual-thom.github.io/about" title="Curriculum Vitae Thom">
          <svg class="svg-icon" viewBox="0 0 20 20">
            <path d="M12.075,10.812c1.358-0.853,2.242-2.507,2.242-4.037c0-2.181-1.795-4.618-4.198-4.618S5.921,4.594,5.921,6.775c0,1.53,0.884,3.185,2.242,4.037c-3.222,0.865-5.6,3.807-5.6,7.298c0,0.23,0.189,0.42,0.42,0.42h14.273c0.23,0,0.42-0.189,0.42-0.42C17.676,14.619,15.297,11.677,12.075,10.812 M6.761,6.775c0-2.162,1.773-3.778,3.358-3.778s3.359,1.616,3.359,3.778c0,2.162-1.774,3.778-3.359,3.778S6.761,8.937,6.761,6.775 M3.415,17.69c0.218-3.51,3.142-6.297,6.704-6.297c3.562,0,6.486,2.787,6.705,6.297H3.415z"></path>
          </svg>
        </a>
      </li>
    </ul>
  </nav>
</header>

      <div itemscope itemtype ="http://schema.org/Article" class="post">
  
  <header class="post-header">
    <h1 itemprop="name about headline" class="post-title">Script shell dd generator</h1>
    <p class="post-meta">
      <time itemprop="datePublished dateModified" datetime="2014-10-16T11:49:00+00:00">16-10-2014</time></p>
  </header>

  <article class="post-content" itemprop="articleBody">
    <h1 class="hidden">Script shell dd generator</h1>
    <h1 id="la-commande-dd-en-shell-à-quoi-ça-sert-">La commande dd en shell, à quoi ça sert ?</h1>
<p>Je vois deux principaux intérêts à la commande dd unix.</p>
<ol>
  <li>Copie bloc à bloc d’un support (CD, DVD, Clé, Disques, etc.)</li>
  <li>Test de performance d’écriture entre la source et la destination de la copie.</li>
</ol>

<p>edit 2015)</p>
<p>je viens de découvrir qu'on pouvait créer un fichier plein de zéro (avec dd par exemple), le formater, et le monter comme si c'était un filesystem ! ça me parait fou mais ça semble fonctionner. Très pratique quand il n'y a pas de VG ou plus de place pour créer des lv, ou pas de fs disponible. 

Ca permet surtout de cloisonner l'espace disque si, par exemple, on ne veut pas qu'un répertoire impacte le fs complet.
<a href="http://souptonuts.sourceforge.net/quota_tutorial.html" title="Linux quota tutorial">Magnifique tutorial de quota pour linux</a>
<pre>
Next, create a 20M file (disk image) in a suitable location. What I did below is create the file disk-quota.ext3 in the directory /usr/disk-img.

   # mkdir -p /usr/disk-img
   # dd if=/dev/zero of=/usr/disk-img/disk-quota.ext3 count=40960
The dd command above created a 20MB file because, by default, dd uses a block size of 512 bytes. That makes this size: 40960*512=20971520. For kicks, we'll confirm this size.

   # ls -lh /usr/disk-img/disk-quota.ext3
   -rw-r--r--  1 root root 20M Jul 19 14:34 /usr/disk-img/disk-quota.ext3
Next, format this as an ext3 filesystem.

   # /sbin/mkfs -t ext3 -q /usr/disk-img/disk-quota.ext3 -F
The "-t" gives it the type. You're not limited to ext3. In fact, you could use ext2 or other filesystems installed on your system. The "-q" is for the device, and "-F" is to force the creation without warning us that this is a file and not a block device.
</pre>
</p>

<p><a title="Lien Wikipédia dd (Unix)" href="http://fr.wikipedia.org/wiki/Dd_%28Unix%29">Lien Wikipédia dd (Unix).</a></p>

<p>Toujours est-il que les paramètres de la commande ne sont pas forcément triviales. C’est pourquoi j’ai fait un petit script shell avec un menu.</p>

<h1 id="script">Script</h1>
<p><a href="https://virtual-thom.github.io/archives/wp-content/uploads/dd_generator.sh.txt">dd_generator.sh</a></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/sh</span>
<span class="c">#</span>
<span class="c">#	SCRIPT	: dd_generator</span>
<span class="c">#	AUTEUR 	: Virtual Thom</span>
<span class="c">#	DATE	: 02.10.13</span>
<span class="c"># set -x # debug</span>
<span class="c"># set -n # verif syntax sans exec</span>
<span class="c">#</span>
<span class="c">##################################</span>
<span class="c">#	VARIABLES</span>
<span class="c">##################################</span>
<span class="nv">datenow</span><span class="o">=</span><span class="si">$(</span><span class="nb">date</span> +<span class="s2">"%d-%m-%y_%H.%M.%S"</span><span class="si">)</span>
<span class="nv">ibs</span><span class="o">=</span><span class="s1">'1024'</span> <span class="c"># nombre d'octet lu d'un coup du if</span>
<span class="nv">count</span><span class="o">=</span><span class="s1">'10000'</span> <span class="c"># nombre de segments ibs lu (si 0 il va au bout du fichier)</span>
<span class="nv">unit</span><span class="o">=</span><span class="s1">'Mo'</span>
<span class="nv">unit_base</span><span class="o">=</span>1024
<span class="nv">unit_mo</span><span class="o">=</span><span class="sb">`</span><span class="nb">expr</span> <span class="k">${</span><span class="nv">unit_base</span><span class="k">}</span> <span class="se">\*</span> <span class="k">${</span><span class="nv">unit_base</span><span class="k">}</span><span class="sb">`</span>
<span class="nv">unit_go</span><span class="o">=</span><span class="sb">`</span><span class="nb">expr</span> <span class="k">${</span><span class="nv">unit_mo</span><span class="k">}</span> <span class="se">\*</span> <span class="k">${</span><span class="nv">unit_base</span><span class="k">}</span><span class="sb">`</span>
<span class="nv">unit_to</span><span class="o">=</span><span class="sb">`</span><span class="nb">expr</span> <span class="k">${</span><span class="nv">unit_go</span><span class="k">}</span> <span class="se">\*</span> <span class="k">${</span><span class="nv">unit_base</span><span class="k">}</span><span class="sb">`</span>
fonc_calc_unit<span class="o">(){</span>
<span class="k">case</span> <span class="k">${</span><span class="nv">unit</span><span class="k">}</span> <span class="k">in</span>
	<span class="s2">"octets"</span><span class="p">)</span>
	<span class="nv">unit_calc</span><span class="o">=</span>1
	<span class="p">;;</span>
	<span class="s2">"Ko"</span><span class="p">)</span>
	<span class="nv">unit_calc</span><span class="o">=</span><span class="k">${</span><span class="nv">unit_base</span><span class="k">}</span>
	<span class="p">;;</span>
	<span class="s2">"Go"</span><span class="p">)</span>
	<span class="nv">unit_calc</span><span class="o">=</span><span class="k">${</span><span class="nv">unit_go</span><span class="k">}</span>
	<span class="p">;;</span>
	<span class="s2">"To"</span><span class="p">)</span>
	<span class="nv">unit_calc</span><span class="o">=</span><span class="k">${</span><span class="nv">unit_to</span><span class="k">}</span>
	<span class="p">;;</span>
	<span class="s2">"Mo"</span> <span class="p">|</span> <span class="k">*</span><span class="p">)</span>
	<span class="nv">unit_calc</span><span class="o">=</span><span class="k">${</span><span class="nv">unit_mo</span><span class="k">}</span>
	<span class="p">;;</span>
<span class="k">esac</span> 
<span class="o">}</span>
fonc_calc_unit
<span class="c">#total_size='expr ${ibs} \* ${count} \/ ${unit_calc}' # par defaut en Mo, doit être évaluer</span>
<span class="nv">total_size</span><span class="o">=</span><span class="s2">"echo 'scale=2;</span><span class="k">${</span><span class="nv">ibs</span><span class="k">}</span><span class="s2"> * </span><span class="k">${</span><span class="nv">count</span><span class="k">}</span><span class="s2"> / </span><span class="k">${</span><span class="nv">unit_calc</span><span class="k">}</span><span class="s2">' | bc"</span> <span class="c"># par defaut en Mo, doit être évaluer</span>
<span class="nv">total_size_msg</span><span class="o">=</span><span class="s1">'echo "Taille Totale (en $unit) :"'</span>
<span class="nv">of_path</span><span class="o">=</span><span class="s1">'echo "${PWD}/dd_`eval ${total_size}`${unit}_${datenow}.bin"'</span> <span class="c"># par defaut fichier écrit dans le répertoire courant</span>
<span class="nv">if_path</span><span class="o">=</span><span class="s1">'/dev/zero'</span> <span class="c"># par defaut fichier lu constitué de vide </span>
<span class="nv">msg_retour</span><span class="o">=</span><span class="s2">"Tapez retour99 ou laissez vide pour ne pas changer la valeur"</span>

<span class="c">##################################</span>
<span class="c">#	FONCTIONS</span>
<span class="c">##################################</span>
date_heure<span class="o">(){</span>
        <span class="nv">date_heure_var</span><span class="o">=</span><span class="sb">`</span><span class="nb">date</span> +<span class="s2">"%d/%m/%Y - %H:%M:%S : "</span><span class="sb">`</span>
        <span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">date_heure_var</span><span class="k">}</span><span class="nv">$1</span><span class="s2">"</span>
<span class="o">}</span>
date_simple<span class="o">(){</span>
        <span class="nv">date_heure_var</span><span class="o">=</span><span class="sb">`</span><span class="nb">date</span> +<span class="s2">"%d%m%Y_%H%M%S"</span><span class="sb">`</span>
        <span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">date_heure_var</span><span class="k">}</span><span class="s2">"</span>
<span class="o">}</span>
fonc_sortie<span class="o">(){</span>
        <span class="nv">numero_exit</span><span class="o">=</span><span class="nv">$1</span>
        <span class="nv">message_exit</span><span class="o">=</span><span class="nv">$2</span>
        date_heure <span class="s2">"</span><span class="k">${</span><span class="nv">message_exit</span><span class="k">}</span><span class="s2">"</span>
        date_heure <span class="s2">"Fin du script. Exit : </span><span class="k">${</span><span class="nv">numero_exit</span><span class="k">}</span><span class="s2">"</span>
        <span class="nb">exit</span> <span class="k">${</span><span class="nv">numero_exit</span><span class="k">}</span>
<span class="o">}</span>
fonc_pause<span class="o">(){</span>
   <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">Appuyez sur Entrer pour continuer...</span><span class="se">\c</span><span class="s2">"</span>
   <span class="nb">read</span>
<span class="o">}</span>
fonc_trap_exit<span class="o">(){</span>
	<span class="nb">echo</span> <span class="s2">""</span>
	fonc_sortie <span class="s2">"123"</span> <span class="s2">"Script interrompu"</span>
<span class="o">}</span>
<span class="nb">trap</span> <span class="s1">'fonc_trap_exit'</span> 2
fonc_menu_principal<span class="o">(){</span>
	clear

	<span class="c">#TITRE </span>
	<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n\t</span><span class="s2">################</span><span class="se">\n\t</span><span class="s2"># DD GENERATOR #</span><span class="se">\n\t</span><span class="s2">################</span><span class="se">\n</span><span class="s2">"</span>
	<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n\t</span><span class="s2">dd of=</span><span class="sb">`</span><span class="nb">eval</span> <span class="k">${</span><span class="nv">of_path</span><span class="k">}</span><span class="sb">`</span><span class="s2"> if=</span><span class="k">${</span><span class="nv">if_path</span><span class="k">}</span><span class="s2"> ibs=</span><span class="k">${</span><span class="nv">ibs</span><span class="k">}</span><span class="s2"> count=</span><span class="k">${</span><span class="nv">count</span><span class="k">}</span><span class="se">\n</span><span class="s2">"</span>
	<span class="nv">PS3</span><span class="o">=</span><span class="s2">"Selectionner une option et appuyer sur Entrer :"</span>

	<span class="k">select </span>options <span class="k">in</span> <span class="s2">"Unite par defaut : </span><span class="nv">$unit</span><span class="s2">"</span> <span class="s2">"Fichier lu : </span><span class="nv">$if_path</span><span class="s2">"</span> <span class="s2">"Fichier ecrit : </span><span class="sb">`</span><span class="nb">eval</span> <span class="nv">$of_path</span><span class="sb">`</span><span class="s2">"</span> <span class="s2">"Taille segment de lecture (octet) : </span><span class="nv">$ibs</span><span class="s2">"</span> <span class="s2">"Nombre de Segment : </span><span class="nv">$count</span><span class="s2">"</span> <span class="s2">"</span><span class="sb">`</span><span class="nb">eval</span> <span class="nv">$total_size_msg</span><span class="sb">`</span><span class="s2"> </span><span class="sb">`</span><span class="nb">eval</span> <span class="se">\"</span><span class="nv">$total_size</span><span class="se">\"</span><span class="sb">`</span><span class="s2">"</span> <span class="s2">"Creer le fichier"</span> <span class="s2">"Quitter"</span>
	<span class="k">do
	case</span> <span class="k">${</span><span class="nv">options</span><span class="k">}</span>	 <span class="k">in</span> 
		<span class="s2">"Unite par defaut : </span><span class="nv">$unit</span><span class="s2">"</span><span class="p">)</span>
			menu_unit
		<span class="p">;;</span>
		<span class="s2">"Fichier lu : </span><span class="nv">$if_path</span><span class="s2">"</span><span class="p">)</span>
			clear
			<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"Veuillez entrer le chemin complet du fichier à lire : </span><span class="se">\n\t</span><span class="s2">(</span><span class="k">${</span><span class="nv">msg_retour</span><span class="k">}</span><span class="s2">)"</span>
			<span class="nb">read </span>read_if_path
			fonc_test_retour <span class="s2">"</span><span class="k">${</span><span class="nv">read_if_path</span><span class="k">}</span><span class="s2">"</span> <span class="o">&amp;&amp;</span>  <span class="nv">if_path</span><span class="o">=</span><span class="k">${</span><span class="nv">read_if_path</span><span class="k">}</span>
			fonc_menu_principal
		<span class="p">;;</span>
		<span class="s2">"Fichier ecrit : </span><span class="sb">`</span><span class="nb">eval</span> <span class="nv">$of_path</span><span class="sb">`</span><span class="s2">"</span><span class="p">)</span>
			clear
			<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"Veuillez entrer le chemin complet du fichier à créer : </span><span class="se">\n\t</span><span class="s2">(</span><span class="k">${</span><span class="nv">msg_retour</span><span class="k">}</span><span class="s2">)"</span>
			<span class="nb">read </span>read_of_path
			fonc_test_retour <span class="s2">"</span><span class="k">${</span><span class="nv">read_of_path</span><span class="k">}</span><span class="s2">"</span>
			<span class="k">if </span><span class="nb">test</span> <span class="nv">$?</span> <span class="nt">-eq</span> 0
			<span class="k">then
				</span><span class="nv">of_path_tmp</span><span class="o">=</span><span class="k">${</span><span class="nv">read_of_path</span><span class="k">}</span>
				<span class="nv">of_path</span><span class="o">=</span><span class="s1">'echo ${of_path_tmp}'</span>
			<span class="k">fi
			</span>fonc_menu_principal
		<span class="p">;;</span>
		<span class="s2">"Taille segment de lecture (octet) : </span><span class="nv">$ibs</span><span class="s2">"</span><span class="p">)</span>
			clear
			<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"Veuillez entrer la taille du segment lu : </span><span class="se">\n\t</span><span class="s2">(</span><span class="k">${</span><span class="nv">msg_retour</span><span class="k">}</span><span class="s2">)"</span>
			<span class="nb">read </span>read_ibs 
			fonc_test_retour <span class="s2">"</span><span class="k">${</span><span class="nv">read_ibs</span><span class="k">}</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> <span class="nv">ibs</span><span class="o">=</span><span class="k">${</span><span class="nv">read_ibs</span><span class="k">}</span>
			fonc_menu_principal
		<span class="p">;;</span>
		<span class="s2">"Nombre de Segment : </span><span class="nv">$count</span><span class="s2">"</span><span class="p">)</span>
			clear
			<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"Veuillez entrer le nombre de segment : </span><span class="se">\n\t</span><span class="s2">(</span><span class="k">${</span><span class="nv">msg_retour</span><span class="k">}</span><span class="s2">)</span><span class="se">\n\t</span><span class="s2">(tapez 0 pour copier le fichier if en totalite)"</span>
			<span class="nb">read </span>read_count 
			fonc_test_retour <span class="s2">"</span><span class="k">${</span><span class="nv">read_count</span><span class="k">}</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> <span class="nv">count</span><span class="o">=</span><span class="k">${</span><span class="nv">read_count</span><span class="k">}</span>
			fonc_menu_principal
		<span class="p">;;</span>
		<span class="s2">"</span><span class="sb">`</span><span class="nb">eval</span> <span class="nv">$total_size_msg</span><span class="sb">`</span><span class="s2"> </span><span class="sb">`</span><span class="nb">eval</span> <span class="se">\"</span><span class="nv">$total_size</span><span class="se">\"</span><span class="sb">`</span><span class="s2">"</span><span class="p">)</span>
			clear
			<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"Veuillez entrer </span><span class="sb">`</span><span class="nb">eval</span> <span class="nv">$total_size_msg</span><span class="sb">`</span><span class="s2"> </span><span class="sb">`</span><span class="nb">eval</span> <span class="se">\"</span><span class="nv">$total_size</span><span class="se">\"</span><span class="sb">`</span><span class="s2"> : </span><span class="se">\n\t</span><span class="s2">(</span><span class="k">${</span><span class="nv">msg_retour</span><span class="k">}</span><span class="s2">)</span><span class="se">\n\t</span><span class="s2">(tapez 0 pour copier le fichier if en totalite)"</span>
			<span class="nb">read </span>read_total_size 
			fonc_test_retour <span class="s2">"</span><span class="k">${</span><span class="nv">read_total_size</span><span class="k">}</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> fonc_calc_count	
			fonc_menu_principal
		<span class="p">;;</span>
		<span class="s2">"Creer le fichier"</span><span class="p">)</span>
			fonc_dd_generator
			fonc_sortie <span class="nv">$?</span>  
		<span class="p">;;</span>
		<span class="s2">"Quitter"</span><span class="p">)</span>
			fonc_sortie 0
		<span class="p">;;</span>
		
	<span class="k">esac</span>
	<span class="nb">echo</span> <span class="s2">""</span>
	<span class="nv">REPLY</span><span class="o">=</span>
	clear
	<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n\n\t</span><span class="s2">DD GENERATOR</span><span class="se">\n\n</span><span class="s2">"</span>
	<span class="k">done
	</span>clear
<span class="o">}</span>
fonc_dd_generator<span class="o">(){</span>
    <span class="k">if </span><span class="nb">test</span> <span class="nv">$count</span> <span class="nt">-eq</span> 0 
	<span class="k">then 	
		</span><span class="nb">echo</span> <span class="s2">"dd of=</span><span class="sb">`</span><span class="nb">eval</span> <span class="k">${</span><span class="nv">of_path</span><span class="k">}</span><span class="sb">`</span><span class="s2"> if=</span><span class="k">${</span><span class="nv">if_path</span><span class="k">}</span><span class="s2"> ibs=</span><span class="k">${</span><span class="nv">ibs</span><span class="k">}</span><span class="s2">"</span>
		<span class="nb">dd </span><span class="nv">of</span><span class="o">=</span><span class="sb">`</span><span class="nb">eval</span> <span class="k">${</span><span class="nv">of_path</span><span class="k">}</span><span class="sb">`</span> <span class="k">if</span><span class="o">=</span><span class="k">${</span><span class="nv">if_path</span><span class="k">}</span> <span class="nv">ibs</span><span class="o">=</span><span class="k">${</span><span class="nv">ibs</span><span class="k">}</span> <span class="o">&amp;&amp;</span> 
		<span class="nb">echo</span> <span class="s2">"Le fichier </span><span class="sb">`</span><span class="nb">eval</span> <span class="k">${</span><span class="nv">of_path</span><span class="k">}</span><span class="sb">`</span><span class="s2"> a été créé"</span> 
	<span class="k">else
		</span><span class="nb">echo</span> <span class="s2">"dd of=</span><span class="sb">`</span><span class="nb">eval</span> <span class="k">${</span><span class="nv">of_path</span><span class="k">}</span><span class="sb">`</span><span class="s2"> if=</span><span class="k">${</span><span class="nv">if_path</span><span class="k">}</span><span class="s2"> ibs=</span><span class="k">${</span><span class="nv">ibs</span><span class="k">}</span><span class="s2"> count=</span><span class="k">${</span><span class="nv">count</span><span class="k">}</span><span class="s2">"</span> 
		<span class="nb">dd </span><span class="nv">of</span><span class="o">=</span><span class="sb">`</span><span class="nb">eval</span> <span class="k">${</span><span class="nv">of_path</span><span class="k">}</span><span class="sb">`</span> <span class="k">if</span><span class="o">=</span><span class="k">${</span><span class="nv">if_path</span><span class="k">}</span> <span class="nv">ibs</span><span class="o">=</span><span class="k">${</span><span class="nv">ibs</span><span class="k">}</span> <span class="nv">count</span><span class="o">=</span><span class="k">${</span><span class="nv">count</span><span class="k">}</span><span class="o">&amp;&amp;</span> 
		<span class="nb">echo</span> <span class="s2">"Le fichier </span><span class="sb">`</span><span class="nb">eval</span> <span class="k">${</span><span class="nv">of_path</span><span class="k">}</span><span class="sb">`</span><span class="s2"> a été créé"</span> 
	<span class="k">fi</span>
<span class="o">}</span>
fonc_test_retour<span class="o">(){</span>
	<span class="k">if </span><span class="nb">test</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"retour99"</span> <span class="nt">-o</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> 
	<span class="k">then
		return </span>250
	<span class="k">else
		return </span>0
	<span class="k">fi</span>
<span class="o">}</span>
menu_unit<span class="o">(){</span>
	clear

        <span class="c">#TITRE</span>
        <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n\n\t</span><span class="s2">Unite actuelle : </span><span class="nv">$unit</span><span class="se">\n\n</span><span class="s2">"</span>
        <span class="nv">PS3</span><span class="o">=</span><span class="s2">"Selectionner une option et appuyer sur Entrer :"</span>

        <span class="k">select </span>options <span class="k">in</span> <span class="s2">"octets"</span> <span class="s2">"Ko"</span> <span class="s2">"Mo"</span> <span class="s2">"Go"</span> <span class="s2">"To"</span> <span class="s2">"Retour"</span>
	<span class="k">do
		case</span> <span class="k">${</span><span class="nv">options</span><span class="k">}</span> <span class="k">in</span> 
			<span class="s2">"octets"</span><span class="p">)</span>
				<span class="nv">unit</span><span class="o">=</span><span class="s1">'octets'</span>
				fonc_calc_unit
				fonc_menu_principal
			<span class="p">;;</span>
			<span class="s2">"Ko"</span><span class="p">)</span>
				<span class="nv">unit</span><span class="o">=</span><span class="s1">'Ko'</span>
				fonc_calc_unit
				fonc_menu_principal
			<span class="p">;;</span>
			<span class="s2">"Mo"</span><span class="p">)</span>
				<span class="nv">unit</span><span class="o">=</span><span class="s1">'Mo'</span>
				fonc_calc_unit
				fonc_menu_principal
			<span class="p">;;</span>
			<span class="s2">"Go"</span><span class="p">)</span>
				<span class="nv">unit</span><span class="o">=</span><span class="s1">'Go'</span>
				fonc_calc_unit
				fonc_menu_principal
			<span class="p">;;</span>
			<span class="s2">"To"</span><span class="p">)</span>
				<span class="nv">unit</span><span class="o">=</span><span class="s1">'To'</span>
				fonc_calc_unit
				fonc_menu_principal
			<span class="p">;;</span>
			<span class="s2">"Retour"</span><span class="p">)</span>
				fonc_menu_principal
				<span class="nb">break</span>
			<span class="p">;;</span>
		<span class="k">esac</span>
        <span class="nb">echo</span> <span class="s2">""</span>
        <span class="nv">REPLY</span><span class="o">=</span>
        clear
        <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n\n\t</span><span class="s2">Unit actuelle : </span><span class="nv">$unit</span><span class="se">\n\n</span><span class="s2">"</span>
        <span class="k">done
        </span>clear

<span class="o">}</span>
fonc_calc_count<span class="o">(){</span>
	<span class="nv">count</span><span class="o">=</span><span class="sb">`</span><span class="nb">expr</span> <span class="k">${</span><span class="nv">read_total_size</span><span class="k">}</span> <span class="se">\*</span> <span class="k">${</span><span class="nv">unit_calc</span><span class="k">}</span> <span class="se">\/</span> <span class="k">${</span><span class="nv">ibs</span><span class="k">}</span><span class="sb">`</span>
<span class="o">}</span>

<span class="c">##################################</span>
<span class="c">#	SCRIPT</span>
<span class="c">##################################</span>
fonc_menu_principal
<span class="c"># end of script</span>
</code></pre></div></div>

<h1 id="résultat-du-script-dd_generatorsh">Résultat du script dd_generator.sh</h1>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>################
# DD GENERATOR #
################
dd of=/SCRIPTS/dd_9.76Mo_15-10-14_09.53.09.bin if=/dev/zero ibs=1024 count=10000
1) Unite par defaut : Mo
2) Fichier lu : /dev/zero
3) Fichier ecrit : /SCRIPTS/dd_9.76Mo_15-10-14_09.53.09.bin
4) Taille segment de lecture (octet) : 1024
5) Nombre de Segment : 10000
6) Taille Totale (en Mo) : 9.76
7) Creer le fichier

8) Quitter
Selectionner une option et appuyer sur Entrer :7

dd of=/SCRIPTS/dd_9.76Mo_15-10-14_09.53.09.bin if=/dev/zero ibs=1024 count=10000
10000+0 enregistrements lus
20000+0 enregistrements écrits
10240000 octets (10 MB) copiés, 0,05625 seconde, 182 MB/s
Le fichier /SCRIPTS/dd_9.76Mo_15-10-14_09.53.09.bin a été créé
15/10/2014 - 09:53:33 :
15/10/2014 - 09:53:33 : Fin du script. Exit : 0

#ls -lisa /SCRIPTS/dd_9.76Mo_15-10-14_09.53.09.bin
23592966 10016 -rw-r--r-- 1 root root 10240000 oct 15 09:53 /SCRIPTS/dd_9.76Mo_15-10-14_09.53.09.bin
#ls -lisah /SCRIPTS/dd_9.76Mo_15-10-14_09.53.09.bin
23592966 9,8M -rw-r--r-- 1 root root 9,8M oct 15 09:53 /SCRIPTS/dd_9.76Mo_15-10-14_09.53.09.bin
</code></pre></div></div>

  </article>
  
<nav>
  <ul class="pager">
    
     
    <li class="previous">
      <a href="https://virtual-thom.github.io/archives/lister-luns-par-pool-projet-script-aksh-zfs-storage-7310-oracle-unified-storage-systems-documentation/"><span aria-hidden="true">&larr;</span> Lister tous les LUNs par Pool et par projet en script aksh - ZFS Storage 7310 (Oracle Unified Storage Systems)</a> 
    </li>
    
     
     <li class="next">
      <a class="next" href="https://virtual-thom.github.io/archives/vtom-impossible-de-changer-les-queues-d-execution-sous-windows/">Impossible de changer les Queues d'exécution sous Windows <span aria-hidden="true">&rarr;</span></a> 
    </li>
     
    
  </ul>
</nav>


  <footer class="post-footer">
    
      
        <a itemprop="articleSection" class="btn btn-default btn-xs btn-categories" href="https://virtual-thom.github.io/archives"><span class="glyphicon glyphicon-asterisk"></span>dd</a>
      
        <a itemprop="articleSection" class="btn btn-default btn-xs btn-categories" href="https://virtual-thom.github.io/archives"><span class="glyphicon glyphicon-asterisk"></span>iso</a>
      
        <a itemprop="articleSection" class="btn btn-default btn-xs btn-categories" href="https://virtual-thom.github.io/archives"><span class="glyphicon glyphicon-asterisk"></span>Script</a>
      
        <a itemprop="articleSection" class="btn btn-default btn-xs btn-categories" href="https://virtual-thom.github.io/archives"><span class="glyphicon glyphicon-asterisk"></span>script</a>
      
        <a itemprop="articleSection" class="btn btn-default btn-xs btn-categories" href="https://virtual-thom.github.io/archives"><span class="glyphicon glyphicon-asterisk"></span>shell</a>
      
        <a itemprop="articleSection" class="btn btn-default btn-xs btn-categories" href="https://virtual-thom.github.io/archives"><span class="glyphicon glyphicon-asterisk"></span>test performance</a>
      
    
    <span  itemprop="author publisher" class="hidden">Virtual Thom</span>
  </footer>
  
  <div id="disqus_thread" ></div>
  <script>
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'thomas-asnar'; // required: replace example with your forum shortname
  
      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
</div>

      <footer id="site-footer">
    <div>&copy;<a href="https://github.com/virtual-thom/" title="Github Virtual-Thom">Virtual-Thom</a></div>
    <div>
            <a href="https://virtual-thom.github.io/archives/plan" title="Plan du site">sitemap</a> | <a href="https://virtual-thom.github.io/about" rel="publisher author" title="Curriculum vitae Thom">A propos</a>
    </div>
    <div>
        <a id="goto-site-header" href="#site-header" title="Retourner au début">&uArr; Top</a>
    </div>
    <div id="footer-disclaimer">
        <p>Avertissement : vous ne devez pas prendre pour argent comptant le contenu de ce site. Testez toujours la solution en environnement de test.</p>
        <p>Malgré le sérieux que je m'efforce de mettre dans le contenu de ces billets, je ne pourrai être tenu responsable d'éventuelles erreurs que cela pourrait engendrer.</p>
    </div>
    <div>
        <a class="hidden" href="https://virtual-thom.github.io/archives/sitemap.xml" title="SiteMap">sitemap</a>
    </div>
</footer>

    </div>
  </body>

</html>