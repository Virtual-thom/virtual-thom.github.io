<!DOCTYPE html>
<html lang="fr">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="apple-touch-icon" href="https://virtual-thom.github.io/archives/apple-touch-icon.png">
  <link rel="icon" href="https://virtual-thom.github.io/archives/favicon.ico" />
  <!-- Remplacé par Jekyll SEO (sinon apparait en double)
  <title>Mise à jour des Agents VTOM via "Gestion des paquets vtom"</title>
  <meta name="description" content="On n’a plus aucune excuse pour ne plus avoir nos agents vtom à jour avec la livraison par package vtom.Ci-après une façon de faire et mes problèmes rencontré...">
  --> 
  
  <link rel="canonical" href="https://virtual-thom.github.io/archives/mise-a-jour-agents-vtom/">
  
  <link rel="stylesheet" media="screen" href="https://virtual-thom.github.io/archives/assets/main.css">
  
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Mise à jour des Agents VTOM via “Gestion des paquets vtom” | Virtual-Thom Blog-notes VTOM et informatique</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Mise à jour des Agents VTOM via “Gestion des paquets vtom”" />
<meta name="author" content="Virtual Thom" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="On n’a plus aucune excuse pour ne plus avoir nos agents vtom à jour avec la livraison par package vtom. Ci-après une façon de faire et mes problèmes rencontrés avec leurs workaround vus avec Absyss pour certains, d’autres, tout bête, mais tellement insuportable, genre des alias sur linux en root rm = rm -i (merci Stephan pour l’idée de résolution)" />
<meta property="og:description" content="On n’a plus aucune excuse pour ne plus avoir nos agents vtom à jour avec la livraison par package vtom. Ci-après une façon de faire et mes problèmes rencontrés avec leurs workaround vus avec Absyss pour certains, d’autres, tout bête, mais tellement insuportable, genre des alias sur linux en root rm = rm -i (merci Stephan pour l’idée de résolution)" />
<link rel="canonical" href="https://virtual-thom.github.io/archives/mise-a-jour-agents-vtom/" />
<meta property="og:url" content="https://virtual-thom.github.io/archives/mise-a-jour-agents-vtom/" />
<meta property="og:site_name" content="Virtual-Thom Blog-notes VTOM et informatique" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-09-27T18:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Mise à jour des Agents VTOM via “Gestion des paquets vtom”" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Virtual Thom"},"dateModified":"2024-09-27T18:00:00+00:00","datePublished":"2024-09-27T18:00:00+00:00","description":"On n’a plus aucune excuse pour ne plus avoir nos agents vtom à jour avec la livraison par package vtom. Ci-après une façon de faire et mes problèmes rencontrés avec leurs workaround vus avec Absyss pour certains, d’autres, tout bête, mais tellement insuportable, genre des alias sur linux en root rm = rm -i (merci Stephan pour l’idée de résolution)","headline":"Mise à jour des Agents VTOM via “Gestion des paquets vtom”","mainEntityOfPage":{"@type":"WebPage","@id":"https://virtual-thom.github.io/archives/mise-a-jour-agents-vtom/"},"url":"https://virtual-thom.github.io/archives/mise-a-jour-agents-vtom/"}</script>
<!-- End Jekyll SEO tag -->

  
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Z8Y7902GRV"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Z8Y7902GRV');
</script>


  <body>
    <div class="container">
      <header id="site-header">
  <h1>Blog-notes VTOM, informatique, industrialisation, ordonnancement, DevOps</h1>
  <nav>
    <ul>
      <li>
        <a href="https://virtual-thom.github.io/archives" title="Home">
          <svg class="svg-icon" viewBox="0 0 20 20">
            <path d="M18.121,9.88l-7.832-7.836c-0.155-0.158-0.428-0.155-0.584,0L1.842,9.913c-0.262,0.263-0.073,0.705,0.292,0.705h2.069v7.042c0,0.227,0.187,0.414,0.414,0.414h3.725c0.228,0,0.414-0.188,0.414-0.414v-3.313h2.483v3.313c0,0.227,0.187,0.414,0.413,0.414h3.726c0.229,0,0.414-0.188,0.414-0.414v-7.042h2.068h0.004C18.331,10.617,18.389,10.146,18.121,9.88 M14.963,17.245h-2.896v-3.313c0-0.229-0.186-0.415-0.414-0.415H8.342c-0.228,0-0.414,0.187-0.414,0.415v3.313H5.032v-6.628h9.931V17.245z M3.133,9.79l6.864-6.868l6.867,6.868H3.133z"></path>
          </svg>
        </a>
      </li>
      <li>
        <a href="https://virtual-thom.github.io/archives/vos-commentaires-livre-d-or/" title="Commentaires - livre d'or">
          <svg class="svg-icon" viewBox="0 0 20 20">
            <path d="M17.657,2.982H2.342c-0.234,0-0.425,0.191-0.425,0.426v10.21c0,0.234,0.191,0.426,0.425,0.426h3.404v2.553c0,0.397,0.48,0.547,0.725,0.302l2.889-2.854h8.298c0.234,0,0.426-0.191,0.426-0.426V3.408C18.083,3.174,17.892,2.982,17.657,2.982M17.232,13.192H9.185c-0.113,0-0.219,0.045-0.3,0.124l-2.289,2.262v-1.96c0-0.233-0.191-0.426-0.425-0.426H2.767V3.833h14.465V13.192z M10,7.237c-0.821,0-1.489,0.668-1.489,1.489c0,0.821,0.668,1.489,1.489,1.489c0.821,0,1.488-0.668,1.488-1.489C11.488,7.905,10.821,7.237,10,7.237 M10,9.364c-0.352,0-0.638-0.288-0.638-0.638c0-0.351,0.287-0.638,0.638-0.638c0.351,0,0.638,0.287,0.638,0.638C10.638,9.077,10.351,9.364,10,9.364 M14.254,7.237c-0.821,0-1.489,0.668-1.489,1.489c0,0.821,0.668,1.489,1.489,1.489s1.489-0.668,1.489-1.489C15.743,7.905,15.075,7.237,14.254,7.237 M14.254,9.364c-0.351,0-0.638-0.288-0.638-0.638c0-0.351,0.287-0.638,0.638-0.638c0.352,0,0.639,0.287,0.639,0.638C14.893,9.077,14.605,9.364,14.254,9.364 M5.746,7.237c-0.821,0-1.489,0.668-1.489,1.489c0,0.821,0.668,1.489,1.489,1.489c0.821,0,1.489-0.668,1.489-1.489C7.234,7.905,6.566,7.237,5.746,7.237 M5.746,9.364c-0.351,0-0.638-0.288-0.638-0.638c0-0.351,0.287-0.638,0.638-0.638c0.351,0,0.638,0.287,0.638,0.638C6.384,9.077,6.096,9.364,5.746,9.364"></path>
          </svg>
        </a>
      </li>
      
      <li>
        <a href="https://virtual-thom.github.io/about" title="Curriculum Vitae Thom">
          <svg class="svg-icon" viewBox="0 0 20 20">
            <path d="M12.075,10.812c1.358-0.853,2.242-2.507,2.242-4.037c0-2.181-1.795-4.618-4.198-4.618S5.921,4.594,5.921,6.775c0,1.53,0.884,3.185,2.242,4.037c-3.222,0.865-5.6,3.807-5.6,7.298c0,0.23,0.189,0.42,0.42,0.42h14.273c0.23,0,0.42-0.189,0.42-0.42C17.676,14.619,15.297,11.677,12.075,10.812 M6.761,6.775c0-2.162,1.773-3.778,3.358-3.778s3.359,1.616,3.359,3.778c0,2.162-1.774,3.778-3.359,3.778S6.761,8.937,6.761,6.775 M3.415,17.69c0.218-3.51,3.142-6.297,6.704-6.297c3.562,0,6.486,2.787,6.705,6.297H3.415z"></path>
          </svg>
        </a>
      </li>
    </ul>
  </nav>
</header>

      <div itemscope itemtype ="http://schema.org/Article" class="post">
  
  <header class="post-header">
    <h1 itemprop="name about headline" class="post-title">Mise à jour des Agents VTOM via "Gestion des paquets vtom"</h1>
    <p class="post-meta">
      <time itemprop="datePublished dateModified" datetime="2024-09-27T18:00:00+00:00">27-09-2024</time></p>
  </header>

  <article class="post-content" itemprop="articleBody">
    <h1 class="hidden">Mise à jour des Agents VTOM via "Gestion des paquets vtom"</h1>
    <p>On n’a plus aucune excuse pour ne plus avoir nos agents vtom à jour avec la livraison par package vtom.<br />
Ci-après une façon de faire et mes problèmes rencontrés avec leurs workaround vus avec Absyss pour certains, d’autres, tout bête, mais tellement insuportable, genre des alias sur linux en root rm = rm -i (merci Stephan pour l’idée de résolution)<br />
<!--more-->
v712<br />
Bon déjà il faut le savoir, les paquets qu’on télécharge les VT-CS-(Linux|Win|AIX|etc).Z fournis par Absyss, sont utilisables directement tels quels.<br />
Le principe est de déposer dans votre répertoire de dépôt (sur le serveur VTOM) ces fichiers VT-CSxxx.Z.<br />
Outils &gt; “Gestion de paquets” &gt; Ajout d’un dépôt si ce n’est pas déjà fait qui pointe vers votre répertoire avec vos paquets sur le serveur VTOM.</p>

<p>Ma façon de faire et solution palliative pour contourner les problèmes qui sont au nombre de 4 :</p>
<ul>
  <li>pas assez de place sur /opt/vtom pour la livraison pour les linux   ==&gt; faire un bout de script dans le script de préinstallation pour rajouter de l’espace jusqu’à 2GO minimum dans mon cas</li>
  <li>alias interactifs type rm == rm -i sous linux    ==&gt; rajouter dans le script de préinstallation <code class="language-plaintext highlighter-rouge">unalias -a</code></li>
  <li>impossible de démarrer le vtmanager v712  sous Windows par manque de dll, et en réalité du paquet REDIST c++    ==&gt; en fait, Absyss le donne en livraison, il suffira de le passer en prérequis avant livraison du paquet client</li>
  <li>service Windows bdaemon AbsyssBatchManager qui pointe vers l’ancien emplacement <code class="language-plaintext highlighter-rouge">%ABM_HOME%\services\bdaemon.exe</code> au lieu du nouvel emplacement <code class="language-plaintext highlighter-rouge">%ABM_BIN%\bdaemon.exe</code>    ==&gt; rajouter dans le script de préinstallation un regedit qui change l’ImagePath du service</li>
</ul>

<p>Pour Windows, passer en une fois tous les agents le paquet en prérequis (c’est très rapide) VT-RDIST-WNTxx.Z<br />
puis sélectionner le paquet VT-CS-Winxxx.Z &gt; modifier le paquet &gt;</p>
<ul>
  <li>supprimer de l’arborescence les queues abm\bin\submit_queue_wnt.bat et ps1.bat qu’on a tous à peu près modifiées à notre sauce (notamment pour l’args loop à remplacer par $*) et qu’ils relivrent constamment dans leur paquet</li>
  <li>ajouter dans une ligne dans le cmd de pré-installation (cocher la case) <code class="language-plaintext highlighter-rouge">reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\AbsyssBatchManager" /v ImagePath /t REG_SZ /d "%ABM_BIN%\bdaemon.exe" /f</code></li>
  <li>construire le paquet, ça va créer un autre paquet que le VT-CS-WINxxx.Z qui est comme en lecture seule, <code class="language-plaintext highlighter-rouge">Visual TOM Agent-7.1.2e1 FR NT64 Windows.vtpk</code> autant le laisser avec ce nom</li>
  <li>Transférer un paquet, sélectionner tous les agents à mettre à jour &gt; Transférer et basta (on peut suivre dans Outils &gt; Suivre des installations des paquets &gt; Recharger)</li>
</ul>

<p>Pour Linux, le bout de script pour l’espace disque est vraiment pour un cas personnel à rajouter que sur les quelques vieux agents mals foutus que j’avais.<br />
Sélectionner le paquet VT-CS-Linxxx.Z &gt; modifier le paquet &gt;</p>
<ul>
  <li>pour les mêmes raisons, supprimer de l’aborescence les queues “dites standard” admin/tom_submit.ksh sh bash etc</li>
  <li>rajouter des lignes dans le script de pré-installation déjà existant</li>
</ul>

<div class="language-ksh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># lignes à rajouter en début de script, spécifique à mon contexte</span>
<span class="nb">set</span> <span class="nt">-x</span> <span class="p">;</span> <span class="c"># parceque j'aime bien voir ce qu'il se passe dans le compte rendu d'exécution dans "Suivre des installations des paquets"</span>
<span class="nb">unalias</span> <span class="nt">-a</span> <span class="p">;</span> <span class="c"># pour pallier aux alias interactifs</span>

<span class="nv">FSVTOM</span><span class="o">=</span><span class="s2">"/opt/vtom"</span> <span class="c"># toutes mes installs sont là mais à voir pour utiliser un autre path</span>
<span class="nv">MAX_SIZE</span><span class="o">=</span><span class="s2">"2000"</span>
<span class="nv">FSDEVMAPPER</span><span class="o">=</span><span class="si">$(</span><span class="nb">df</span> <span class="nt">--output</span><span class="o">=</span><span class="nb">source</span> <span class="nv">$FSVTOM</span> | <span class="nb">tail</span> <span class="nt">-1</span><span class="si">)</span>
<span class="nv">CURRENT_SIZE</span><span class="o">=</span><span class="si">$(</span><span class="nb">df</span> <span class="nt">-m</span> <span class="nt">--output</span><span class="o">=</span>size <span class="nv">$FSVTOM</span> | <span class="nb">tail</span> <span class="nt">-1</span><span class="si">)</span>
<span class="c"># Vérifier si la taille actuelle est inférieure à la taille minimale</span>
<span class="k">if</span> <span class="o">[</span> <span class="nv">$CURRENT_SIZE</span> <span class="nt">-lt</span> <span class="nv">$MAX_SIZE</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"La taille de </span><span class="nv">$FSVTOM</span><span class="s2"> est inférieure à 2 Go. Extension du système de fichiers..."</span>
    <span class="c"># étendre le volume logique et le système de fichiers à 2 Go</span>
    lvextend <span class="nt">-r</span> <span class="nt">-L</span> 2G <span class="nv">$FSDEVMAPPER</span> <span class="p">;</span> <span class="c"># dans le cas où il y a assez de free space à étendre, sinon malheureusement il faudra augmenter la taille des vg voire des pe etc</span>
    <span class="nb">echo</span> <span class="s2">"Extension terminée."</span>
<span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"La taille de </span><span class="nv">$FSVTOM</span><span class="s2"> est supérieure ou égale à 2 Go. Aucune action nécessaire."</span>
<span class="k">fi</span>
<span class="c"># ... laisser le reste du script bien sûr</span>
</code></pre></div></div>
<ul>
  <li>construire le paquet, ça va créer un autre paquet que le VT-CS-Linxxx.Z qui est comme en lecture seule, <code class="language-plaintext highlighter-rouge">Visual TOM Agent-7.1.2e1 FR X64 Linux.vtpk</code> autant le laisser avec ce nom</li>
  <li>Transférer un paquet, sélectionner tous les agents à mettre à jour &gt; Transférer et basta (on peut suivre dans Outils &gt; Suivre des installations des paquets &gt; Recharger)</li>
</ul>

<p>Pour info, de ce que j’ai pu voir, ça ne fait pas planter les jobs en cours, ça garde le “log on as” pour windows, ça garde le vtom.ini, bref tout bien pour ma part.<br />
Je n’ai plus aucune excuse pour ne pas mettre à jour mes agents régulièrement !</p>

  </article>
  
<nav>
  <ul class="pager">
    
     
    <li class="previous">
      <a href="https://virtual-thom.github.io/archives/compte-rendu-package-vtmanager/"><span aria-hidden="true">&larr;</span> Compte rendu package vtmanager</a> 
    </li>
    
     
     <li class="next">
      <a class="next" href="https://virtual-thom.github.io/archives/fonctions-vtom/">Fonctions VTOM <span aria-hidden="true">&rarr;</span></a> 
    </li>
     
    
  </ul>
</nav>


  <footer class="post-footer">
    
      
    
    <span  itemprop="author publisher" class="hidden">Virtual Thom</span>
  </footer>
  
  <div id="disqus_thread" ></div>
  <script>
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'thomas-asnar'; // required: replace example with your forum shortname
  
      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
</div>

      <footer id="site-footer">
    <div>&copy;<a href="https://github.com/virtual-thom/" title="Github Virtual-Thom">Virtual-Thom</a></div>
    <div>
            <a href="https://virtual-thom.github.io/archives/plan" title="Plan du site">sitemap</a> | <a href="https://virtual-thom.github.io/about" rel="publisher author" title="Curriculum vitae Thom">A propos</a>
    </div>
    <div>
        <a id="goto-site-header" href="#site-header" title="Retourner au début">&uArr; Top</a>
    </div>
    <div id="footer-disclaimer">
        <p>Avertissement : vous ne devez pas prendre pour argent comptant le contenu de ce site. Testez toujours la solution en environnement de test.</p>
        <p>Malgré le sérieux que je m'efforce de mettre dans le contenu de ces billets, je ne pourrai être tenu responsable d'éventuelles erreurs que cela pourrait engendrer.</p>
    </div>
    <div>
        <a class="hidden" href="https://virtual-thom.github.io/archives/sitemap.xml" title="SiteMap">sitemap</a>
    </div>
</footer>

    </div>
  </body>

</html>